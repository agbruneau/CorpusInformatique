
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Corpus encyclopédique francophone — science informatique, interopérabilité et entreprise agentique">
      
      
        <meta name="author" content="André-Guy Bruneau">
      
      
        <link rel="canonical" href="https://agbruneau.github.io/CorpusInformatique/III%20-%20Entreprise%20Agentique/Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.4_Applications_Consommatrices/">
      
      
        <link rel="prev" href="../Chapitre_III.3_Clients_Kafka_Production/">
      
      
        <link rel="next" href="../Chapitre_III.5_Cas_Utilisation_Kafka/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>III.4 — Applications consommatrices - Corpus Informatique</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapitre-iii4" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../../.." title="Corpus Informatique" class="md-header__button md-logo" aria-label="Corpus Informatique" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Corpus Informatique
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              III.4 — Applications consommatrices
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/agbruneau/CorpusInformatique" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    agbruneau/CorpusInformatique
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Onglets" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Accueil

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.1_Fondements_Logiques_Raisonnement/" class="md-tabs__link">
          
  
  
    
  
  I — Science et Génie Informatique

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.1_Introduction_Problematique/" class="md-tabs__link">
          
  
  
    
  
  II — Interopérabilité

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.1_Crise_Integration_Systemique/" class="md-tabs__link">
          
  
  
    
  
  III — Entreprise Agentique

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Corpus Informatique" class="md-nav__button md-logo" aria-label="Corpus Informatique" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Corpus Informatique
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/agbruneau/CorpusInformatique" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    agbruneau/CorpusInformatique
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    I — Science et Génie Informatique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    I — Science et Génie Informatique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume I — Fondements Mathématiques et Théorie de l'Informatique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume I — Fondements Mathématiques et Théorie de l'Informatique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.1_Fondements_Logiques_Raisonnement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.1 — Fondements logiques et raisonnement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.2_Structures_Discretes_Combinatoire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.2 — Structures discrètes et combinatoire
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.3_Theorie_Graphes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.3 — Théorie des graphes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.4_Langages_Formels_Automates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.4 — Langages formels et automates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.5_Calculabilite_Decidabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.5 — Calculabilité et décidabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.6_Theorie_Complexite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.6 — Théorie de la complexité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume II — Architecture des Ordinateurs et Systèmes Numériques
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume II — Architecture des Ordinateurs et Systèmes Numériques
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.7_Systemes_Numeriques_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.7 — Systèmes numériques et données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.8_Circuits_Combinatoires/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.8 — Circuits combinatoires
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.9_Circuits_Sequentiels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.9 — Circuits séquentiels
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.10_Conception_Systeme_HDL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.10 — Conception système HDL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.11_Architecture_ISA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.11 — Architecture ISA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.12_Conception_CPU/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.12 — Conception CPU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.13_Parallelisme_ILP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.13 — Parallélisme ILP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.14_Hierarchie_Memoire_Stockage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.14 — Hiérarchie mémoire et stockage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.15_Systemes_IO_Accelere/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.15 — Systèmes I/O accélérés
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume III — Systèmes d'Exploitation, Langages et Environnements
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume III — Systèmes d'Exploitation, Langages et Environnements
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.16_Systemes_Exploitation_OS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.16 — Systèmes d'exploitation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.17_Gestion_Concurrence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.17 — Gestion de la concurrence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.18_Gestion_Memoire_Fichiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.18 — Gestion mémoire et fichiers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.19_Conception_Langages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.19 — Conception des langages
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.20_Compilation_Interpretation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.20 — Compilation et interprétation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.21_Environnements_Virtualisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.21 — Environnements et virtualisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume IV — Structures de Données, Algorithmique et Génie Logiciel
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume IV — Structures de Données, Algorithmique et Génie Logiciel
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.22_Structures_Donnees_Fondamentales/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.22 — Structures de données fondamentales
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.23_Structures_Donnees_Avancees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.23 — Structures de données avancées
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.24_Conception_Analyse_Algorithmes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.24 — Conception et analyse d'algorithmes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.25_Algorithmes_Graphes_Avances/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.25 — Algorithmes de graphes avancés
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.26_Processus_Developpement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.26 — Processus de développement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.27_Architecture_Logicielle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.27 — Architecture logicielle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.28_Qualite_Test_Maintenance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.28 — Qualité, test et maintenance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.29_DevOps_SRE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.29 — DevOps et SRE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume V — Données, Réseaux, Cloud et Sécurité
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume V — Données, Réseaux, Cloud et Sécurité
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.30_SGBD_Fondements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.30 — SGBD fondements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.31_SGBD_Implementation_Transactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.31 — SGBD implémentation et transactions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.32_Donnees_Modernes_BigData/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.32 — Données modernes et Big Data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.33_Fondements_Reseaux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.33 — Fondements des réseaux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.34_Protocoles_Internetworking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.34 — Protocoles et internetworking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.35_Systemes_Distribues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.35 — Systèmes distribués
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.36_Cloud_Infrastructures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.36 — Cloud et infrastructures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.37_Fondements_Securite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.37 — Fondements de la sécurité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.38_Cryptographie_Appliquee/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.38 — Cryptographie appliquée
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.39_Securite_Reseaux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.39 — Sécurité des réseaux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.40_Securite_Systemes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.40 — Sécurité des systèmes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume VI — Intelligence Artificielle et Systèmes Interactifs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume VI — Intelligence Artificielle et Systèmes Interactifs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.41_Fondements_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.41 — Fondements de l'IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.42_Connaissance_Raisonnement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.42 — Connaissance et raisonnement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.43_ML_Fondements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.43 — ML fondements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.44_DeepLearning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.44 — Deep Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.45_Reinforcement_Learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.45 — Reinforcement Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.46_TALN_NLP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.46 — TALN / NLP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.47_Vision_Ordinateur/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.47 — Vision par ordinateur
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.48_Infographie_Visualisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.48 — Infographie et visualisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.49_IHM_HCI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.49 — IHM / HCI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.50_Robotique_IoT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.50 — Robotique et IoT
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume VII — Technologies Émergentes et Frontières
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume VII — Technologies Émergentes et Frontières
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.51_Informatique_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.51 — Informatique quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.52_Algorithmes_Cryptographie_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.52 — Algorithmes et cryptographie quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.53_HPC_Exascale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.53 — HPC et exascale
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.54_Architectures_Post_Moore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.54 — Architectures post-Moore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.55_Modeles_Fondateurs_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.55 — Modèles fondateurs IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.56_AGI_Alignement_Securite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.56 — AGI, alignement et sécurité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.57_Sciences_Computationnelles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.57 — Sciences computationnelles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.58_CyberPhysiques_Jumeaux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.58 — Systèmes cyber-physiques et jumeaux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.59_Web3_Decentralise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.59 — Web3 et décentralisé
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.60_Synthese_Frontieres/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.60 — Synthèse et frontières
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume VIII — Convergence AGI–Quantique : Fondements et Algorithmes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume VIII — Convergence AGI–Quantique : Fondements et Algorithmes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.61_Introduction_Informatique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.61 — Introduction à l'informatique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.62_Convergence_AGI_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.62 — Convergence AGI-quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.63_Evolution_IA_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.63 — Évolution IA-quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.64_Reseaux_Neuronaux_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.64 — Réseaux neuronaux quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.65_Algorithmes_Evolutionnaires_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.65 — Algorithmes évolutionnaires quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.66_Renforcement_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.66 — Renforcement quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.67_Architectures_Hybrides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.67 — Architectures hybrides
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.68_SVM_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.68 — SVM quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.69_Codage_Donnees_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.69 — Codage de données quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.70_Scalabilite_Correction_Erreurs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.70 — Scalabilité et correction d'erreurs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume IX — Convergence AGI–Quantique : Applications et Perspectives
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume IX — Convergence AGI–Quantique : Applications et Perspectives
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.71_TALN_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.71 — TALN quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.72_Securite_Confidentialite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.72 — Sécurité et confidentialité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.73_Ethique_Reglementaire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.73 — Éthique et réglementaire
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.74_Implementation_Materielle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.74 — Implémentation matérielle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.75_Middleware_Software/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.75 — Middleware et software
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.76_Etudes_Cas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.76 — Études de cas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.77_Durabilite_Energie/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.77 — Durabilité et énergie
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.78_Metriques_Bancs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.78 — Métriques et bancs d'essai
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.79_Perspectives_Avenir/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.79 — Perspectives d'avenir
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.80_Infrastructure_Centres_Donnees_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.80 — Infrastructure et centres de données IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    II — Interopérabilité
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    II — Interopérabilité
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.1_Introduction_Problematique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.1 — Introduction et problématique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.2_Fondements_Theoriques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.2 — Fondements théoriques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.3_Integration_Applications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.3 — Intégration des applications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.4_Integration_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.4 — Intégration des données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.5_Integration_Evenements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.5 — Intégration des événements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.6_Standards_Contrats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.6 — Standards et contrats
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.7_Resilience_Observabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.7 — Résilience et observabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.8_Collaboration_Automatisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.8 — Collaboration et automatisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.9_Architecture_Reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.9 — Architecture de référence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.10_Order_to_Cash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.10 — Order-to-Cash
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.11_Entreprise_Agentique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.11 — Entreprise agentique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.12_Securite_Identite_Conformite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.12 — Sécurité, identité et conformité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.A_Annexes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Annexes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    III — Entreprise Agentique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    III — Entreprise Agentique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume I — Fondations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume I — Fondations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.1_Crise_Integration_Systemique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.1 — Crise d'intégration systémique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.2_Fondements_Dimensions_Interoperabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.2 — Fondements et dimensions de l'interopérabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.3_Cadres_Reference_Standards_Maturite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.3 — Cadres de référence, standards et maturité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.4_Principes_Architecture_Reactive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.4 — Principes d'architecture réactive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.5_Ecosysteme_API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.5 — Écosystème API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.6_Architecture_Evenements_EDA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.6 — Architecture événements (EDA)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.7_Contrats_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.7 — Contrats de données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.8_Conception_Implementation_Observabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.8 — Conception et implémentation de l'observabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.9_Etudes_Cas_Architecturales/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.9 — Études de cas architecturales
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.10_Limites_Interoperabilite_Semantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.10 — Limites de l'interopérabilité sémantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.11_IA_Moteur_Interoperabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.11 — IA moteur d'interopérabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.12_Definition_Interoperabilite_Cognitivo_Adaptative/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.12 — Définition de l'interopérabilité cognitivo-adaptative
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.13_Ere_IA_Agentique_Modele_Travailleur_Numerique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.13 — Ère IA agentique et modèle du travailleur numérique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.14_Maillage_Agentique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.14 — Maillage agentique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.15_Ingenierie_Systemes_Cognitifs_Protocoles_Interaction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.15 — Ingénierie des systèmes cognitifs et protocoles d'interaction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.16_Modele_Operationnel_Symbiose_Humain_Agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.16 — Modèle opérationnel de symbiose humain-agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.17_Gouvernance_Constitutionnelle_Alignement_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.17 — Gouvernance constitutionnelle et alignement IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.18_AgentOps_Industrialisation_Securisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.18 — AgentOps : industrialisation et sécurisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.19_Architecte_Intentions_Role_Sociotechnique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.19 — Architecte des intentions : rôle sociotechnique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.20_Cockpit_Berger_Intention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.20 — Cockpit du berger d'intention
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.21_Feuille_Route_Transformation_Agentique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.21 — Feuille de route de la transformation agentique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.22_Gestion_Strategique_Portefeuille_Applicatif_APM_Cognitif/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.22 — Gestion stratégique du portefeuille applicatif (APM cognitif)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.23_Patrons_Modernisation_Agentification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.23 — Patrons de modernisation et agentification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.24_Industrialisation_Ingenierie_Plateforme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.24 — Industrialisation et ingénierie de plateforme
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.25_Economie_Cognitive_Diplomatie_Algorithmique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.25 — Économie cognitive et diplomatie algorithmique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.26_Gestion_Risques_Systemiques_Superalignement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.26 — Gestion des risques systémiques et superalignement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.27_Prospective_Agent_Auto_Architecturant_AGI_Entreprise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.27 — Prospective : agent auto-architecturant et AGI d'entreprise
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.28_Conclusion_Architecture_Intentionnelle_Sagesse_Collective/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.28 — Conclusion : architecture intentionnelle et sagesse collective
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume II — Infrastructure Agentique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume II — Infrastructure Agentique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.1_Ingenierie_Plateforme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.1 — Ingénierie de plateforme
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.2_Fondamentaux_Apache_Kafka_Confluent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.2 — Fondamentaux Apache Kafka et Confluent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.3_Conception_Modelisation_Flux_Evenements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.3 — Conception et modélisation des flux d'événements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.4_Contrats_Donnees_Gouvernance_Semantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.4 — Contrats de données et gouvernance sémantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.5_Flux_Temps_Reel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.5 — Flux temps réel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.6_Google_Cloud_Vertex_AI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.6 — Google Cloud et Vertex AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.7_Ingenierie_Contexte_RAG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.7 — Ingénierie de contexte et RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.8_Integration_Backbone_Evenementiel_Couche_Cognitive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.8 — Intégration backbone événementiel et couche cognitive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.9_Patrons_Architecturaux_Avances_AEM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.9 — Patrons architecturaux avancés (AEM)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.10_Pipelines_CI_CD_Deploiement_Agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.10 — Pipelines CI/CD et déploiement d'agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.11_Observabilite_Comportementale_Monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.11 — Observabilité comportementale et monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.12_Tests_Evaluation_Simulation_Systemes_Multi_Agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.12 — Tests, évaluation et simulation de systèmes multi-agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.13_Paysage_Menaces_Securite_Systemes_Agentiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.13 — Paysage des menaces et sécurité des systèmes agentiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.14_Securisation_Infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.14 — Sécurisation de l'infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.15_Conformite_Reglementaire_Gestion_Confidentialite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.15 — Conformité réglementaire et gestion de la confidentialité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume III — Apache Kafka : Guide de l'Architecte
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume III — Apache Kafka : Guide de l'Architecte
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.1_Decouvrir_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.1 — Découvrir Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.2_Architecture_Cluster_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.2 — Architecture du cluster Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.3_Clients_Kafka_Production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.3 — Clients Kafka en production
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    III.4 — Applications consommatrices
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    III.4 — Applications consommatrices
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creation-dapplications-consommatrices" class="md-nav__link">
    <span class="md-ellipsis">
      
        CRÉATION D'APPLICATIONS CONSOMMATRICES
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii41-consommateur-kafka-architecture-et-principes-fondamentaux" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.4.1 Consommateur Kafka : Architecture et Principes Fondamentaux
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.4.1 Consommateur Kafka : Architecture et Principes Fondamentaux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-interne-du-consommateur" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Interne du Consommateur
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#la-boucle-de-consommation" class="md-nav__link">
    <span class="md-ellipsis">
      
        La Boucle de Consommation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gestion-des-offsets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gestion des Offsets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-fondamentale" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Fondamentale
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Fondamentale">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-complete-dun-groupe-de-consommateurs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration complete d'un groupe de consommateurs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii42-atteindre-le-parallelisme-groupes-de-consommateurs" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.4.2 Atteindre le Parallélisme : Groupes de Consommateurs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.4.2 Atteindre le Parallélisme : Groupes de Consommateurs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#le-concept-de-groupe-de-consommateurs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Le Concept de Groupe de Consommateurs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#independance-des-groupes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Indépendance des Groupes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-coordinateur-de-groupe" class="md-nav__link">
    <span class="md-ellipsis">
      
        Le Coordinateur de Groupe
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strategies-dassignation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stratégies d'Assignation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dimensionnement-des-groupes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dimensionnement des Groupes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii43-maitriser-le-reequilibrage-des-consommateurs" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.4.3 Maîtriser le Rééquilibrage des Consommateurs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.4.3 Maîtriser le Rééquilibrage des Consommateurs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anatomie-dun-reequilibrage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Anatomie d'un Rééquilibrage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reequilibrage-cooperatif-incremental" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rééquilibrage Coopératif (Incrémental)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimisation-du-reequilibrage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimisation du Rééquilibrage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gestion-des-callbacks-de-reequilibrage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gestion des Callbacks de Rééquilibrage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii44-modeles-de-conception-fondamentaux" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.4.4 Modèles de Conception Fondamentaux
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.4.4 Modèles de Conception Fondamentaux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-un-thread-par-consommateur" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern : Un Thread par Consommateur
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-decouplage-fetch-et-traitement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern : Découplage Fetch et Traitement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-pause-et-resume" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern : Pause et Resume
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-assignation-manuelle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern : Assignation Manuelle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-at-least-once-avec-idempotence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern : At-Least-Once avec Idempotence
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii45-strategies-de-consommation-avancees" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.4.5 Stratégies de Consommation Avancées
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.4.5 Stratégies de Consommation Avancées">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exactly-once-semantic-avec-transactions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exactly-Once Semantic avec Transactions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consommation-multi-topic" class="md-nav__link">
    <span class="md-ellipsis">
      
        Consommation Multi-Topic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seek-et-replay" class="md-nav__link">
    <span class="md-ellipsis">
      
        Seek et Replay
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consommation-avec-dead-letter-queue" class="md-nav__link">
    <span class="md-ellipsis">
      
        Consommation avec Dead Letter Queue
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii46-reglage-des-performances" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.4.6 Réglage des Performances
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.4.6 Réglage des Performances">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metriques-de-performance-du-consommateur" class="md-nav__link">
    <span class="md-ellipsis">
      
        Métriques de Performance du Consommateur
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-jmx-et-export" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration JMX et Export
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimisation-du-debit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimisation du Débit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimisation-de-la-latence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimisation de la Latence
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compromis-debit-vs-latence-tableau-de-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compromis Débit vs. Latence — Tableau de Référence
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eviter-les-problemes-de-timeout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Éviter les Problèmes de Timeout
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii47-construire-des-consommateurs-resilients" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.4.7 Construire des Consommateurs Résilients
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.4.7 Construire des Consommateurs Résilients">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gestion-des-erreurs-de-deserialisation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gestion des Erreurs de Désérialisation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strategies-de-retry-avancees" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stratégies de Retry Avancées
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shutdown-gracieux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shutdown Gracieux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idempotence-du-traitement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Idempotence du Traitement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-et-alerting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring et Alerting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checklist-de-mise-en-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        Checklist de Mise en Production
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii48-resume" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.4.8 Résumé
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.4.8 Résumé">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-et-principes-fondamentaux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture et Principes Fondamentaux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#groupes-de-consommateurs-et-parallelisme" class="md-nav__link">
    <span class="md-ellipsis">
      
        Groupes de Consommateurs et Parallélisme
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reequilibrage-des-consommateurs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rééquilibrage des Consommateurs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modeles-de-conception" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modèles de Conception
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strategies-avancees" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stratégies Avancées
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimisation-des-performances" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimisation des Performances
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resilience-et-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Résilience et Opérations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vers-le-chapitre-suivant" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vers le Chapitre Suivant
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.5_Cas_Utilisation_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.5 — Cas d'utilisation Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.6_Contrats_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.6 — Contrats de données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.7_Patrons_Interaction_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.7 — Patrons d'interaction Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.8_Conception_Application_Streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.8 — Conception d'application streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.9_Gestion_Kafka_Entreprise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.9 — Gestion Kafka en entreprise
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.10_Organisation_Projet_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.10 — Organisation d'un projet Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.11_Operer_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.11 — Opérer Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.12_Avenir_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.12 — L'avenir de Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume IV — Apache Iceberg et Lakehouse
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume IV — Apache Iceberg et Lakehouse
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.1_Monde_Lakehouse_Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.1 — Le monde Lakehouse et Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.2_Anatomie_Technique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.2 — Anatomie technique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.3_Mise_Pratique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.3 — Mise en pratique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.4_Preparer_Passage_Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.4 — Préparer le passage à Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.5_Selection_Couche_Stockage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.5 — Sélection de la couche de stockage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.6_Architecture_Couche_Ingestion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.6 — Architecture de la couche d'ingestion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.7_Implementation_Couche_Catalogue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.7 — Implémentation de la couche catalogue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.8_Conception_Couche_Federation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.8 — Conception de la couche de fédération
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.9_Comprendre_Couche_Consommation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.9 — Comprendre la couche de consommation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.10_Maintenir_Lakehouse_Production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.10 — Maintenir le Lakehouse en production
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.11_Operationnaliser_Apache_Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.11 — Opérationnaliser Apache Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.12_Evolution_Streaming_Lakehouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.12 — Évolution du streaming Lakehouse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.13_Securite_Gouvernance_Conformite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.13 — Sécurité, gouvernance et conformité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.14_Integration_Microsoft_Fabric_PowerBI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.14 — Intégration Microsoft Fabric et Power BI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.15_Contexte_Canadien_Etudes_Cas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.15 — Contexte canadien et études de cas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.16_Conclusion_Perspectives_2026_2030/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.16 — Conclusion et perspectives 2026-2030
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.Annexe_A_Specification_Apache_Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Annexe A — Spécification Apache Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.Annexe_B_Glossaire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Annexe B — Glossaire
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume V — Développeur Renaissance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume V — Développeur Renaissance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.0_Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.0 — Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.1_Convergence_Ages_Or/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.1 — Convergence des âges d'or
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.2_Curiosite_Appliquee/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.2 — Curiosité appliquée
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.3_Pensee_Systemique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.3 — Pensée systémique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.4_Nouvelle_Communication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.4 — Nouvelle communication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.5_Imperatif_Qualite_Responsabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.5 — Impératif qualité et responsabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.6_Capital_Humain_Profil_Polymathe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.6 — Capital humain et profil polymathe
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.7_Art_Batir_Futur/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.7 — L'art de bâtir le futur
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.8_Bibliotheque_Developpeur_Renaissance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.8 — Bibliothèque du développeur Renaissance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.9_Mandat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.9 — Mandat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.10_Spec_Driven_Development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.10 — Spec-Driven Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="chapitre-iii4">Chapitre III.4<a class="headerlink" href="#chapitre-iii4" title="Permanent link">&para;</a></h1>
<h2 id="creation-dapplications-consommatrices">CRÉATION D'APPLICATIONS CONSOMMATRICES<a class="headerlink" href="#creation-dapplications-consommatrices" title="Permanent link">&para;</a></h2>
<hr />
<blockquote>
<p><em>« Un système de messagerie n'est aussi bon que sa capacité à délivrer les messages de manière fiable et efficace aux applications qui les attendent. »</em></p>
<p>— Neha Narkhede, Co-créatrice d'Apache Kafka</p>
</blockquote>
<hr />
<p>Le chapitre précédent a exploré en détail la production de messages vers Kafka. Ce chapitre examine l'autre côté de l'équation : comment les applications consomment et traitent les messages depuis Kafka. Si la production détermine comment les données entrent dans le système, la consommation détermine comment elles en sortent et créent de la valeur.</p>
<p>Le consommateur Kafka (consumer) est souvent perçu comme le symétrique du producteur — là où l'un envoie, l'autre reçoit. Cette vision simpliste masque une complexité considérable. Le consommateur doit gérer le parallélisme via les groupes de consommateurs, coordonner le rééquilibrage lors des changements de topologie, suivre sa progression via les offsets, gérer les erreurs de traitement, et maintenir des performances optimales sous charge variable.</p>
<p>L'architecte qui maîtrise les concepts développés dans ce chapitre sera capable de concevoir des applications de consommation robustes, scalables et performantes. Il comprendra les compromis entre les différentes stratégies de commit d'offset, saura dimensionner les groupes de consommateurs, et pourra diagnostiquer les problèmes de lag ou de rééquilibrage.</p>
<p>Nous explorerons successivement l'architecture du consommateur, les groupes de consommateurs et le parallélisme, le rééquilibrage, les modèles de conception, les stratégies avancées, l'optimisation des performances, et la construction de consommateurs résilients.</p>
<hr />
<h2 id="iii41-consommateur-kafka-architecture-et-principes-fondamentaux">III.4.1 Consommateur Kafka : Architecture et Principes Fondamentaux<a class="headerlink" href="#iii41-consommateur-kafka-architecture-et-principes-fondamentaux" title="Permanent link">&para;</a></h2>
<h3 id="architecture-interne-du-consommateur">Architecture Interne du Consommateur<a class="headerlink" href="#architecture-interne-du-consommateur" title="Permanent link">&para;</a></h3>
<p>Le consommateur Kafka est un client qui lit des messages depuis un ou plusieurs topics. Contrairement à certains systèmes de messagerie où le broker « pousse » les messages vers les consommateurs, Kafka utilise un modèle « pull » où le consommateur demande activement les messages au broker.</p>
<p><strong>Le modèle pull.</strong> Le consommateur envoie des requêtes « fetch » aux brokers pour récupérer les messages. Ce modèle présente plusieurs avantages : le consommateur contrôle son rythme de consommation (backpressure naturel), il peut relire des messages en repositionnant son offset, et le broker n'a pas besoin de maintenir l'état de chaque consommateur.</p>
<p><strong>Composants internes.</strong> Le consommateur Kafka se compose de plusieurs sous-systèmes qui collaborent pour récupérer et traiter les messages.</p>
<p>Le <strong>Fetcher</strong> est responsable de l'envoi des requêtes fetch aux brokers et de la réception des réponses. Il maintient des buffers de messages pré-fetchés pour réduire la latence perçue par l'application.</p>
<p>Le <strong>ConsumerCoordinator</strong> gère l'appartenance au groupe de consommateurs, participe au protocole de rééquilibrage, et communique avec le coordinateur de groupe sur le broker.</p>
<p>Le <strong>SubscriptionState</strong> maintient l'état des abonnements (topics, partitions assignées) et la position courante (offset) pour chaque partition.</p>
<p>Le <strong>ConsumerNetworkClient</strong> gère les connexions réseau vers les brokers, le multiplexage des requêtes, et les timeouts.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>┌─────────────────────────────────────────────────────────────────────┐
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>│                        Application Thread                           │
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>│  ┌──────────┐    ┌──────────────┐    ┌─────────────────────────┐   │
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>│  │  poll()  │───▶│ Fetcher      │───▶│   Deserializers         │   │
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>│  └──────────┘    └──────────────┘    └───────────┬─────────────┘   │
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>│                         │                        │                  │
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>│                         ▼                        ▼                  │
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>│  ┌──────────────────────────────────────────────────────────────┐  │
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>│  │              ConsumerRecords&lt;K, V&gt;                           │  │
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>│  └──────────────────────────────────────────────────────────────┘  │
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>└─────────────────────────────────────────────────────────────────────┘
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>                          │
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>                          ▼
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>┌─────────────────────────────────────────────────────────────────────┐
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>│                    ConsumerCoordinator                              │
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────────┐ │
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>│  │ Group       │  │ Heartbeat   │  │ Rebalance                   │ │
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>│  │ Membership  │  │ Thread      │  │ Protocol                    │ │
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>│  └─────────────┘  └─────────────┘  └─────────────────────────────┘ │
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>└─────────────────────────────────────────────────────────────────────┘
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>                          │
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>                          ▼
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>┌─────────────────────────────────────────────────────────────────────┐
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>│                      Kafka Brokers                                  │
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>│              (Group Coordinator + Partition Leaders)                │
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>└─────────────────────────────────────────────────────────────────────┘
</code></pre></div>
<blockquote>
<p><strong>Définition formelle</strong></p>
<p>Un <strong>consommateur Kafka</strong> est un client qui s'abonne à un ou plusieurs topics et récupère les messages via des requêtes fetch. Le consommateur maintient un <strong>offset</strong> par partition, représentant la position du prochain message à lire. L'offset est un entier 64 bits monotone croissant, unique par partition.</p>
</blockquote>
<h3 id="la-boucle-de-consommation">La Boucle de Consommation<a class="headerlink" href="#la-boucle-de-consommation" title="Permanent link">&para;</a></h3>
<p>Le pattern fondamental d'utilisation du consommateur est la boucle de consommation (poll loop). L'application appelle répétitivement <code>poll()</code> pour récupérer des lots de messages.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;bootstrap.servers&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;localhost:9092&quot;</span><span class="p">);</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;group.id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;my-consumer-group&quot;</span><span class="p">);</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key.deserializer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="p">);</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;value.deserializer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="p">);</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="n">KafkaConsumer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KafkaConsumer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="n">consumer</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;my-topic&quot;</span><span class="p">));</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">        </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">            </span><span class="n">processRecord</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">    </span><span class="n">consumer</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Comportement de <code>poll()</code>.</strong> L'appel <code>poll(Duration timeout)</code> effectue plusieurs opérations critiques simultanément. Il envoie des heartbeats au coordinateur de groupe pour maintenir l'appartenance au groupe. Il rafraîchit les métadonnées du cluster si nécessaire (changement de leader, nouvelles partitions). Il fetch de nouveaux messages si le buffer local est insuffisant. Finalement, il retourne les messages disponibles dans un objet <code>ConsumerRecords</code>.</p>
<p>Le timeout spécifie combien de temps attendre si aucun message n'est disponible. Un timeout de 0 retourne immédiatement (avec ou sans messages). Un timeout long bloque jusqu'à ce que des messages soient disponibles ou que le timeout expire. Le choix du timeout impacte la réactivité de l'application et la fréquence des heartbeats.</p>
<p><strong>Thread safety.</strong> Le consommateur Kafka n'est <strong>pas thread-safe</strong>. Tous les appels doivent être effectués depuis le même thread. Cette contrainte de conception est volontaire : elle simplifie l'implémentation et évite les problèmes de synchronisation coûteux. L'exception est <code>wakeup()</code> qui peut être appelé depuis un autre thread pour interrompre un <code>poll()</code> bloquant, utile pour l'arrêt gracieux.</p>
<p><strong>Structure de ConsumerRecords.</strong> L'objet retourné par <code>poll()</code> contient les messages groupés par partition. Cela permet un traitement optimisé :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1">// Itération sur tous les records</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="n">processRecord</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="p">}</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="c1">// Ou itération par partition (utile pour le commit par partition)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TopicPartition</span><span class="w"> </span><span class="n">partition</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">.</span><span class="na">partitions</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">partitionRecords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">records</span><span class="p">.</span><span class="na">records</span><span class="p">(</span><span class="n">partition</span><span class="p">);</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">partitionRecords</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">        </span><span class="n">processRecord</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="c1">// Commit pour cette partition spécifiquement</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">lastOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partitionRecords</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">partitionRecords</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="na">offset</span><span class="p">();</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">    </span><span class="n">consumer</span><span class="p">.</span><span class="na">commitSync</span><span class="p">(</span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonMap</span><span class="p">(</span><span class="n">partition</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">OffsetAndMetadata</span><span class="p">(</span><span class="n">lastOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)));</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="p">}</span>
</code></pre></div>
<blockquote>
<p><strong>Note de terrain</strong></p>
<p><em>Contexte</em> : Application de traitement de logs avec exigence de monitoring précis par source.</p>
<p><em>Problème initial</em> : Traitement de tous les records en vrac, impossible de savoir quelle partition/source pose problème.</p>
<p><em>Solution</em> : Itération par partition avec métriques séparées. Chaque partition correspond à une source de logs distincte. Le monitoring par partition permet d'identifier rapidement les sources problématiques.</p>
<p><em>Bonus</em> : Le commit par partition permet une granularité fine — si une partition a des erreurs, les autres peuvent continuer à progresser.</p>
</blockquote>
<h3 id="gestion-des-offsets">Gestion des Offsets<a class="headerlink" href="#gestion-des-offsets" title="Permanent link">&para;</a></h3>
<p>L'<strong>offset</strong> est le mécanisme par lequel le consommateur suit sa progression dans chaque partition. Comprendre la gestion des offsets est crucial pour garantir le traitement correct des messages.</p>
<p><strong>Offset courant vs. offset commité.</strong> Le consommateur maintient deux notions d'offset par partition :
- L'<strong>offset courant</strong> (position) est l'offset du prochain message à lire. Il avance automatiquement après chaque <code>poll()</code>.
- L'<strong>offset commité</strong> est le dernier offset persisté, indiquant jusqu'où le traitement est confirmé.</p>
<p>La différence entre ces deux offsets est importante lors des redémarrages. Si le consommateur crashe, il reprendra depuis le dernier offset commité, pas depuis l'offset courant. Les messages entre l'offset commité et l'offset courant seront retraités.</p>
<p><strong>Commit automatique.</strong> Par défaut (<code>enable.auto.commit=true</code>), le consommateur commite automatiquement les offsets périodiquement (<code>auto.commit.interval.ms</code>, défaut 5 secondes). Ce mode est simple mais peut causer des pertes ou des duplicatas :
- Si le consommateur crashe après avoir traité des messages mais avant le commit automatique, ces messages seront retraités (duplicatas).
- Si le commit automatique se produit avant que le traitement ne soit terminé et que le consommateur crashe, des messages peuvent être perdus.</p>
<p><strong>Commit manuel.</strong> Pour un contrôle précis, désactiver le commit automatique (<code>enable.auto.commit=false</code>) et commiter explicitement :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">// Commit synchrone - bloque jusqu&#39;à confirmation</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">consumer</span><span class="p">.</span><span class="na">commitSync</span><span class="p">();</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1">// Commit asynchrone - retourne immédiatement</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">consumer</span><span class="p">.</span><span class="na">commitAsync</span><span class="p">((</span><span class="n">offsets</span><span class="p">,</span><span class="w"> </span><span class="n">exception</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exception</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Commit failed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">exception</span><span class="p">);</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="p">});</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="c1">// Commit d&#39;offsets spécifiques</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">OffsetAndMetadata</span><span class="o">&gt;</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="n">offsets</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TopicPartition</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OffsetAndMetadata</span><span class="p">(</span><span class="n">lastOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="n">consumer</span><span class="p">.</span><span class="na">commitSync</span><span class="p">(</span><span class="n">offsets</span><span class="p">);</span>
</code></pre></div>
<blockquote>
<p><strong>Exemple concret</strong></p>
<p><em>Scénario</em> : Un consommateur traite des commandes. Il lit 10 messages (offsets 100-109), traite les 5 premiers avec succès, puis crashe.</p>
<p><em>Avec commit automatique (défaut)</em> : Si le commit automatique s'est produit après avoir lu les 10 messages, l'offset commité est 110. Au redémarrage, le consommateur reprend à 110 — les messages 105-109 non traités sont perdus.</p>
<p><em>Avec commit manuel après chaque message</em> : L'offset commité est 105 (dernier message traité + 1). Au redémarrage, le consommateur reprend à 105 — les messages 105-109 seront retraités.</p>
<p><em>Leçon</em> : Le commit automatique est dangereux pour les traitements critiques. Préférer le commit manuel après traitement réussi.</p>
</blockquote>
<h3 id="configuration-fondamentale">Configuration Fondamentale<a class="headerlink" href="#configuration-fondamentale" title="Permanent link">&para;</a></h3>
<p>Les paramètres de configuration du consommateur contrôlent son comportement. L'architecte doit comprendre les paramètres clés.</p>
<p><strong><code>bootstrap.servers</code></strong> : Liste des brokers pour la découverte initiale du cluster.</p>
<p><strong><code>group.id</code></strong> : Identifiant du groupe de consommateurs. Obligatoire pour la consommation avec groupes. Les consommateurs avec le même <code>group.id</code> partagent les partitions.</p>
<p><strong><code>key.deserializer</code> et <code>value.deserializer</code></strong> : Classes de désérialisation pour convertir les octets en objets.</p>
<p><strong><code>enable.auto.commit</code></strong> (défaut true) : Active le commit automatique des offsets.</p>
<p><strong><code>auto.commit.interval.ms</code></strong> (défaut 5000) : Intervalle entre les commits automatiques.</p>
<p><strong><code>auto.offset.reset</code></strong> (défaut latest) : Comportement quand aucun offset commité n'existe ou que l'offset est invalide. Les valeurs sont <code>earliest</code> (début de la partition), <code>latest</code> (fin de la partition), ou <code>none</code> (exception).</p>
<p><strong><code>max.poll.records</code></strong> (défaut 500) : Nombre maximal de messages retournés par <code>poll()</code>.</p>
<p><strong><code>max.poll.interval.ms</code></strong> (défaut 300000) : Intervalle maximal entre deux appels <code>poll()</code> avant que le consommateur soit considéré comme mort.</p>
<p><strong><code>session.timeout.ms</code></strong> (défaut 45000) : Timeout de session avec le coordinateur. Si aucun heartbeat n'est reçu dans ce délai, le consommateur est éjecté du groupe.</p>
<p><strong><code>fetch.min.bytes</code></strong> (défaut 1) : Taille minimale de données à retourner. Le broker attend d'avoir au moins cette quantité avant de répondre.</p>
<p><strong><code>fetch.max.wait.ms</code></strong> (défaut 500) : Temps maximal d'attente du broker si <code>fetch.min.bytes</code> n'est pas atteint.</p>
<h4 id="configuration-complete-dun-groupe-de-consommateurs">Configuration complete d'un groupe de consommateurs<a class="headerlink" href="#configuration-complete-dun-groupe-de-consommateurs" title="Permanent link">&para;</a></h4>
<p>L'exemple suivant presente une configuration Java complete et commentee pour un groupe de consommateurs en production. Cette configuration distingue trois profils typiques — traitement transactionnel, analytique en temps reel et ingestion bulk — chacun avec ses compromis entre latence, debit et fiabilite.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.kafka.clients.consumer.ConsumerConfig</span><span class="p">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.kafka.common.serialization.StringDeserializer</span><span class="p">;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.confluent.kafka.serializers.KafkaAvroDeserializer</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Properties</span><span class="p">;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="cm">/**</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="cm"> * Configurations de référence pour groupes de consommateurs Kafka.</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="cm"> * Trois profils adaptés aux cas d&#39;usage les plus courants.</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="cm"> */</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ConsumerConfigurations</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="cm">     * Profil TRANSACTIONNEL — Traitement fiable message par message.</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="cm">     * Garantie : at-least-once avec commit manuel.</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="cm">     * Cas d&#39;usage : traitement de commandes, événements financiers, agents cognitifs.</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="cm">     */</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Properties</span><span class="w"> </span><span class="nf">configTransactionnel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">        </span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">        </span><span class="c1">// Connexion et identification</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="p">,</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">                  </span><span class="s">&quot;kafka-1:9092,kafka-2:9092,kafka-3:9092&quot;</span><span class="p">);</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">GROUP_ID_CONFIG</span><span class="p">,</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">                  </span><span class="s">&quot;groupe-traitement-commandes-v2&quot;</span><span class="p">);</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">CLIENT_ID_CONFIG</span><span class="p">,</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">                  </span><span class="s">&quot;consommateur-commandes-instance-1&quot;</span><span class="p">);</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">        </span><span class="c1">// Désérialisation avec Schema Registry</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">KEY_DESERIALIZER_CLASS_CONFIG</span><span class="p">,</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">                  </span><span class="n">StringDeserializer</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="p">,</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">                  </span><span class="n">KafkaAvroDeserializer</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;schema.registry.url&quot;</span><span class="p">,</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">                  </span><span class="s">&quot;https://schema-registry:8081&quot;</span><span class="p">);</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;specific.avro.reader&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">        </span><span class="c1">// Fiabilité : commit manuel, isolation transactionnelle</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">ENABLE_AUTO_COMMIT_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">ISOLATION_LEVEL_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;read_committed&quot;</span><span class="p">);</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">AUTO_OFFSET_RESET_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;earliest&quot;</span><span class="p">);</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="w">        </span><span class="c1">// Traitement : lots modérés pour équilibrer latence et débit</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">MAX_POLL_RECORDS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">MAX_POLL_INTERVAL_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">300000</span><span class="p">);</span>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">FETCH_MIN_BYTES_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">FETCH_MAX_WAIT_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="w">        </span><span class="c1">// Rééquilibrage : protocole coopératif (Kafka 3.x+)</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">PARTITION_ASSIGNMENT_STRATEGY_CONFIG</span><span class="p">,</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="w">                  </span><span class="s">&quot;org.apache.kafka.clients.consumer.CooperativeStickyAssignor&quot;</span><span class="p">);</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">SESSION_TIMEOUT_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">30000</span><span class="p">);</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">HEARTBEAT_INTERVAL_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">);</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="w">        </span><span class="c1">// Sécurité SASL/SSL</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;security.protocol&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SASL_SSL&quot;</span><span class="p">);</span>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;sasl.mechanism&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SCRAM-SHA-256&quot;</span><span class="p">);</span>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;sasl.jaas.config&quot;</span><span class="p">,</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="w">                  </span><span class="s">&quot;org.apache.kafka.common.security.scram.ScramLoginModule required &quot;</span>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a><span class="w">                  </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;username=\&quot;${KAFKA_USER}\&quot; password=\&quot;${KAFKA_PASSWORD}\&quot;;&quot;</span><span class="p">);</span>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">props</span><span class="p">;</span>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a><span class="cm">     * Profil ANALYTIQUE TEMPS RÉEL — Haut débit, latence acceptable.</span>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="cm">     * Garantie : at-least-once avec commit automatique.</span>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a><span class="cm">     * Cas d&#39;usage : alimentation data lake, métriques, tableaux de bord.</span>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a><span class="cm">     */</span>
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Properties</span><span class="w"> </span><span class="nf">configAnalytique</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a><span class="w">        </span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configTransactionnel</span><span class="p">();</span><span class="w"> </span><span class="c1">// Hérite de la base</span>
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a>
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">GROUP_ID_CONFIG</span><span class="p">,</span>
<a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a><span class="w">                  </span><span class="s">&quot;groupe-analytique-lakehouse-v1&quot;</span><span class="p">);</span>
<a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a>
<a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a><span class="w">        </span><span class="c1">// Débit : lots volumineux, attente pour accumulation</span>
<a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">MAX_POLL_RECORDS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">);</span>
<a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">FETCH_MIN_BYTES_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">1048576</span><span class="p">);</span><span class="w">   </span><span class="c1">// 1 Mo</span>
<a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">FETCH_MAX_WAIT_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">);</span><span class="w">    </span><span class="c1">// 2 sec</span>
<a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">MAX_PARTITION_FETCH_BYTES_CONFIG</span><span class="p">,</span>
<a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a><span class="w">                  </span><span class="mi">10485760</span><span class="p">);</span><span class="w"> </span><span class="c1">// 10 Mo</span>
<a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a>
<a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a><span class="w">        </span><span class="c1">// Commit automatique acceptable pour l&#39;analytique</span>
<a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">ENABLE_AUTO_COMMIT_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">AUTO_COMMIT_INTERVAL_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p">);</span>
<a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a>
<a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">props</span><span class="p">;</span>
<a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a>
<a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a><span class="cm">     * Profil AGENT COGNITIF — Faible latence, traitement unitaire.</span>
<a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a><span class="cm">     * Garantie : exactly-once via transactions.</span>
<a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a><span class="cm">     * Cas d&#39;usage : agents IA réactifs, traitement événementiel.</span>
<a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a><span class="cm">     */</span>
<a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Properties</span><span class="w"> </span><span class="nf">configAgentCognitif</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a><span class="w">        </span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configTransactionnel</span><span class="p">();</span><span class="w"> </span><span class="c1">// Hérite de la base</span>
<a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a>
<a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">GROUP_ID_CONFIG</span><span class="p">,</span>
<a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a><span class="w">                  </span><span class="s">&quot;groupe-agent-service-client-v2&quot;</span><span class="p">);</span>
<a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a>
<a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a><span class="w">        </span><span class="c1">// Réactivité maximale : un message à la fois</span>
<a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">MAX_POLL_RECORDS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">FETCH_MIN_BYTES_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">FETCH_MAX_WAIT_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span>
<a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a>
<a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a><span class="w">        </span><span class="c1">// Timeout étendu pour le traitement LLM (inférence longue)</span>
<a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">MAX_POLL_INTERVAL_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">600000</span><span class="p">);</span>
<a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a>
<a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a><span class="w">        </span><span class="c1">// Isolation stricte pour les transactions</span>
<a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a><span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">ISOLATION_LEVEL_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;read_committed&quot;</span><span class="p">);</span>
<a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a>
<a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">props</span><span class="p">;</span>
<a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a><span class="p">}</span>
</code></pre></div>
<p>Ces trois profils illustrent le principe fondamental selon lequel la configuration du consommateur doit etre alignee avec le patron d'acces aux donnees. Le profil transactionnel privilegie la fiabilite (commit manuel, <code>read_committed</code>, lots de 100 messages). Le profil analytique maximise le debit (lots de 2000 messages, <code>fetch.min.bytes</code> de 1 Mo, commit automatique). Le profil agent cognitif optimise la reactivite (un seul message par poll, fetch immediat) tout en tolerant les traitements longs via un <code>max.poll.interval.ms</code> etendu a 10 minutes, necessaire pour accommoder la latence d'inference des modeles de langage. L'utilisation du <code>CooperativeStickyAssignor</code> dans les trois profils garantit un reequilibrage sans interruption lors des mises a l'echelle.</p>
<hr />
<h2 id="iii42-atteindre-le-parallelisme-groupes-de-consommateurs">III.4.2 Atteindre le Parallélisme : Groupes de Consommateurs<a class="headerlink" href="#iii42-atteindre-le-parallelisme-groupes-de-consommateurs" title="Permanent link">&para;</a></h2>
<h3 id="le-concept-de-groupe-de-consommateurs">Le Concept de Groupe de Consommateurs<a class="headerlink" href="#le-concept-de-groupe-de-consommateurs" title="Permanent link">&para;</a></h3>
<p>Un <strong>groupe de consommateurs</strong> (consumer group) est un ensemble de consommateurs qui collaborent pour consommer un topic. Les partitions du topic sont distribuées entre les membres du groupe, permettant un traitement parallèle.</p>
<p><strong>Principe fondamental.</strong> Chaque partition est assignée à exactement un consommateur du groupe à un instant donné. Un consommateur peut être assigné à plusieurs partitions, mais une partition ne peut avoir qu'un seul consommateur dans un groupe donné.</p>
<p>Cette règle garantit que les messages d'une partition sont traités dans l'ordre par un seul consommateur, préservant les garanties d'ordre de Kafka. C'est une propriété fondamentale qui distingue Kafka des systèmes de messagerie traditionnels où les messages peuvent être distribués à n'importe quel worker disponible.</p>
<p><strong>Parallélisme maximal.</strong> Le nombre maximal de consommateurs actifs dans un groupe est égal au nombre de partitions du topic. Si un groupe a plus de consommateurs que de partitions, les consommateurs excédentaires restent inactifs (idle), attendant qu'une partition se libère.</p>
<p>Cette limite implique que le parallélisme doit être planifié dès la création du topic. Un topic avec 4 partitions ne peut pas avoir plus de 4 consommateurs actifs simultanément, quelle que soit la puissance des machines ou le nombre d'instances déployées.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Topic avec 4 partitions :
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>Groupe A (2 consommateurs) :
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>┌─────────────┐     ┌─────────────┐
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>│ Consumer A1 │     │ Consumer A2 │
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>│ P0, P1      │     │ P2, P3      │
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>└─────────────┘     └─────────────┘
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>Groupe B (4 consommateurs) :
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>│ Consumer B1 │ │ Consumer B2 │ │ Consumer B3 │ │ Consumer B4 │
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>│ P0          │ │ P1          │ │ P2          │ │ P3          │
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>Groupe C (6 consommateurs) :
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>│ Consumer C1 │ │ Consumer C2 │ │ Consumer C3 │ │ Consumer C4 │ │ Consumer C5 │ │ Consumer C6 │
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>│ P0          │ │ P1          │ │ P2          │ │ P3          │ │ (idle)      │ │ (idle)      │
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
</code></pre></div>
<blockquote>
<p><strong>Définition formelle</strong></p>
<p>Un <strong>groupe de consommateurs</strong> est identifié par un <code>group.id</code> unique. Tous les consommateurs partageant le même <code>group.id</code> forment un groupe et se partagent les partitions des topics auxquels ils sont abonnés. Le <strong>coordinateur de groupe</strong> (group coordinator) est un broker responsable de la gestion des membres du groupe et de l'orchestration des rééquilibrages.</p>
</blockquote>
<h3 id="independance-des-groupes">Indépendance des Groupes<a class="headerlink" href="#independance-des-groupes" title="Permanent link">&para;</a></h3>
<p>Les groupes de consommateurs sont complètement indépendants les uns des autres. Chaque groupe maintient ses propres offsets et sa propre progression dans les topics. Cette indépendance est fondamentale pour l'architecture événementielle.</p>
<p><strong>Implications de l'indépendance :</strong></p>
<p><em>Pas d'interférence.</em> Un groupe qui prend du retard n'impacte pas les autres groupes. Chaque groupe avance à son propre rythme.</p>
<p><em>Offsets séparés.</em> Les offsets sont stockés par groupe dans le topic <code>__consumer_offsets</code>. Le groupe A peut être à l'offset 1000 tandis que le groupe B est à l'offset 5000.</p>
<p><em>Consommation multiple.</em> Le même message peut être consommé par plusieurs groupes. Kafka ne supprime pas les messages après consommation (contrairement à une file traditionnelle).</p>
<p>Cette indépendance permet plusieurs patterns architecturaux puissants :</p>
<p><strong>Multiples applications consommant le même topic.</strong> Chaque application a son propre <code>group.id</code> et consomme tous les messages indépendamment. C'est le pattern classique pour diffuser des événements à plusieurs systèmes — le système de facturation, le système de notification, et le système d'analytique peuvent tous consommer les événements de commande.</p>
<p><strong>Scaling horizontal d'une application.</strong> Toutes les instances d'une même application partagent le même <code>group.id</code> et se répartissent les partitions. C'est le pattern pour augmenter le débit de traitement sans modifier le code applicatif.</p>
<p><strong>Environnements de test.</strong> Un groupe de test peut consommer le même topic qu'un groupe de production sans interférence. Utile pour valider des changements avec des données réelles.</p>
<p><strong>Replay et retraitement.</strong> Un nouveau groupe peut consommer un topic depuis le début (<code>auto.offset.reset=earliest</code>) pour reconstruire un système downstream ou effectuer une analyse historique.</p>
<blockquote>
<p><strong>Exemple concret</strong></p>
<p><em>Scénario</em> : Un topic <code>orders.created</code> reçoit tous les événements de création de commande.</p>
<p><em>Groupe 1 : fulfillment-service</em> : Déclenche la préparation des commandes. Besoin de traitement rapide.</p>
<p><em>Groupe 2 : analytics-pipeline</em> : Alimente un data warehouse. Peut tolérer quelques minutes de retard.</p>
<p><em>Groupe 3 : fraud-detection</em> : Analyse en temps réel pour détecter les fraudes. Priorité maximale sur la latence.</p>
<p><em>Groupe 4 : audit-service</em> : Archive toutes les commandes pour conformité. Consomme depuis le début du topic.</p>
<p>Ces quatre groupes consomment le même topic simultanément, chacun avec ses propres exigences et sa propre progression.</p>
</blockquote>
<h3 id="le-coordinateur-de-groupe">Le Coordinateur de Groupe<a class="headerlink" href="#le-coordinateur-de-groupe" title="Permanent link">&para;</a></h3>
<p>Le <strong>coordinateur de groupe</strong> (group coordinator) est un broker désigné pour gérer un groupe de consommateurs spécifique. Le choix du coordinateur est déterministe basé sur le hash du <code>group.id</code>.</p>
<p><strong>Responsabilités du coordinateur :</strong>
- Maintenir la liste des membres actifs du groupe
- Détecter les défaillances via les heartbeats
- Orchestrer les rééquilibrages
- Stocker les offsets commités dans le topic <code>__consumer_offsets</code></p>
<p><strong>Élection du leader du groupe.</strong> Parmi les membres du groupe, un est élu « leader ». Le leader est responsable de calculer l'assignation des partitions lors d'un rééquilibrage. Le coordinateur exécute l'assignation calculée par le leader.</p>
<h3 id="strategies-dassignation">Stratégies d'Assignation<a class="headerlink" href="#strategies-dassignation" title="Permanent link">&para;</a></h3>
<p>La stratégie d'assignation détermine comment les partitions sont distribuées entre les consommateurs. Plusieurs stratégies sont disponibles via <code>partition.assignment.strategy</code>.</p>
<p><strong>RangeAssignor (défaut historique).</strong> Assigne des plages contiguës de partitions à chaque consommateur. Peut créer des déséquilibres si le nombre de partitions n'est pas divisible par le nombre de consommateurs.</p>
<p><strong>RoundRobinAssignor.</strong> Distribue les partitions en round-robin entre les consommateurs. Plus équilibré que Range mais peut séparer les partitions d'un même topic entre plusieurs consommateurs.</p>
<p><strong>StickyAssignor.</strong> Tente de préserver les assignations existantes lors des rééquilibrages tout en maintenant l'équilibre. Réduit le nombre de partitions qui changent de propriétaire.</p>
<p><strong>CooperativeStickyAssignor (recommandé).</strong> Combinaison de StickyAssignor avec le protocole de rééquilibrage coopératif. Minimise les interruptions lors des rééquilibrages.</p>
<table>
<thead>
<tr>
<th>Stratégie</th>
<th>Équilibre</th>
<th>Stabilité</th>
<th>Interruption</th>
</tr>
</thead>
<tbody>
<tr>
<td>RangeAssignor</td>
<td>Moyen</td>
<td>Faible</td>
<td>Totale</td>
</tr>
<tr>
<td>RoundRobinAssignor</td>
<td>Bon</td>
<td>Faible</td>
<td>Totale</td>
</tr>
<tr>
<td>StickyAssignor</td>
<td>Bon</td>
<td>Bonne</td>
<td>Totale</td>
</tr>
<tr>
<td>CooperativeStickyAssignor</td>
<td>Bon</td>
<td>Bonne</td>
<td>Minimale</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Décision architecturale</strong></p>
<p><em>Contexte</em> : Choix de la stratégie d'assignation pour un groupe de consommateurs traitant des commandes critiques.</p>
<p><em>Exigences</em> : Minimiser les interruptions lors des déploiements, maintenir un équilibre de charge.</p>
<p><em>Options</em> :
1. RangeAssignor (défaut) : Simple mais rééquilibrages disruptifs.
2. StickyAssignor : Moins de mouvements de partitions mais rééquilibrages bloquants.
3. CooperativeStickyAssignor : Rééquilibrages non-bloquants, stabilité.</p>
<p><em>Décision</em> : CooperativeStickyAssignor — le rééquilibrage coopératif permet aux consommateurs non affectés de continuer à traiter pendant le rééquilibrage.</p>
<p><em>Configuration</em> :
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="na">partition.assignment.strategy</span><span class="o">=</span><span class="s">org.apache.kafka.clients.consumer.CooperativeStickyAssignor</span>
</code></pre></div></p>
</blockquote>
<h3 id="dimensionnement-des-groupes">Dimensionnement des Groupes<a class="headerlink" href="#dimensionnement-des-groupes" title="Permanent link">&para;</a></h3>
<p>Le dimensionnement du groupe de consommateurs est une décision architecturale importante qui impacte le débit, la latence, et la résilience.</p>
<p><strong>Facteurs à considérer :</strong></p>
<p><em>Débit requis.</em> Si un seul consommateur ne peut pas traiter le débit du topic, plus de consommateurs sont nécessaires. Mesurer le débit de traitement d'un consommateur et comparer au débit de production.</p>
<p><em>Nombre de partitions.</em> Le parallélisme maximal est limité par le nombre de partitions. Avoir plus de consommateurs que de partitions est inutile.</p>
<p><em>Latence de traitement.</em> Plus de consommateurs parallèles peut réduire la latence globale en distribuant la charge.</p>
<p><em>Coût et ressources.</em> Chaque consommateur consomme des ressources (mémoire, connexions réseau, CPU). Équilibrer le besoin de performance avec le coût.</p>
<p><em>Résilience.</em> Avoir des consommateurs en excès (standby) permet une reprise rapide en cas de défaillance.</p>
<p><strong>Règle empirique.</strong> Commencer avec un nombre de consommateurs égal au nombre de partitions divisé par 2, puis ajuster basé sur les métriques de lag et de débit.</p>
<hr />
<h2 id="iii43-maitriser-le-reequilibrage-des-consommateurs">III.4.3 Maîtriser le Rééquilibrage des Consommateurs<a class="headerlink" href="#iii43-maitriser-le-reequilibrage-des-consommateurs" title="Permanent link">&para;</a></h2>
<h3 id="anatomie-dun-reequilibrage">Anatomie d'un Rééquilibrage<a class="headerlink" href="#anatomie-dun-reequilibrage" title="Permanent link">&para;</a></h3>
<p>Le <strong>rééquilibrage</strong> (rebalance) est le processus par lequel les partitions sont redistribuées entre les consommateurs d'un groupe. Il se produit lors de changements de membership (nouveau consommateur, départ, crash) ou de changements de souscription (ajout/suppression de topics).</p>
<p><strong>Déclencheurs de rééquilibrage :</strong>
- Un nouveau consommateur rejoint le groupe
- Un consommateur quitte le groupe (fermeture gracieuse)
- Un consommateur est considéré mort (timeout de session ou de poll)
- Le nombre de partitions d'un topic souscrit change
- Un consommateur change sa souscription</p>
<p><strong>Protocole de rééquilibrage (avant le rééquilibrage coopératif) :</strong></p>
<ol>
<li>
<p><strong>JoinGroup</strong> : Les consommateurs envoient une requête JoinGroup au coordinateur avec leurs souscriptions et les stratégies d'assignation supportées.</p>
</li>
<li>
<p><strong>Synchronisation</strong> : Le coordinateur choisit un leader parmi les membres. Le leader calcule l'assignation.</p>
</li>
<li>
<p><strong>SyncGroup</strong> : Le leader envoie l'assignation au coordinateur. Tous les membres récupèrent leur assignation via SyncGroup.</p>
</li>
<li>
<p><strong>Reprise</strong> : Les consommateurs commencent à consommer leurs partitions assignées.</p>
</li>
</ol>
<p><strong>Le problème du « stop-the-world ».</strong> Dans le protocole classique (Eager), tous les consommateurs arrêtent de consommer pendant le rééquilibrage. Même les consommateurs dont les partitions ne changent pas sont interrompus. Pour les grands groupes, ce « stop-the-world » peut durer plusieurs secondes.</p>
<h3 id="reequilibrage-cooperatif-incremental">Rééquilibrage Coopératif (Incrémental)<a class="headerlink" href="#reequilibrage-cooperatif-incremental" title="Permanent link">&para;</a></h3>
<p>Le <strong>rééquilibrage coopératif</strong> (Kafka 2.4+) améliore significativement l'expérience en permettant aux consommateurs de continuer à traiter leurs partitions non affectées pendant le rééquilibrage.</p>
<p><strong>Principe.</strong> Au lieu de révoquer toutes les partitions au début du rééquilibrage, seules les partitions qui doivent changer de propriétaire sont révoquées. Les autres consommateurs continuent normalement.</p>
<p><strong>Déroulement :</strong></p>
<ol>
<li>
<p><strong>Premier rééquilibrage</strong> : L'assignation cible est calculée. Les partitions à transférer sont identifiées et révoquées de leurs propriétaires actuels.</p>
</li>
<li>
<p><strong>Deuxième rééquilibrage</strong> : Les partitions révoquées sont assignées à leurs nouveaux propriétaires.</p>
</li>
<li>
<p><strong>Continuation</strong> : Les consommateurs non affectés n'ont jamais arrêté de traiter.</p>
</li>
</ol>
<p><strong>Activation.</strong> Utiliser <code>CooperativeStickyAssignor</code> comme stratégie d'assignation :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;partition.assignment.strategy&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">          </span><span class="s">&quot;org.apache.kafka.clients.consumer.CooperativeStickyAssignor&quot;</span><span class="p">);</span>
</code></pre></div>
<blockquote>
<p><strong>Note de terrain</strong></p>
<p><em>Contexte</em> : Application de traitement de commandes avec 20 consommateurs et 100 partitions. Déploiements fréquents (plusieurs fois par jour).</p>
<p><em>Problème avec le protocole Eager</em> : Chaque déploiement (rolling restart) déclenche ~20 rééquilibrages, chacun causant une interruption de 5-10 secondes. Au total, ~2 minutes d'indisponibilité par déploiement.</p>
<p><em>Solution</em> : Migration vers CooperativeStickyAssignor.</p>
<p><em>Résultat</em> : Les rééquilibrages sont quasi-transparents. Seules les partitions du consommateur redémarré sont temporairement non traitées (~2 secondes). Les 19 autres consommateurs continuent sans interruption.</p>
<p><em>Leçon</em> : Le rééquilibrage coopératif est essentiel pour les groupes de consommateurs de production. Migrer dès que possible.</p>
</blockquote>
<h3 id="optimisation-du-reequilibrage">Optimisation du Rééquilibrage<a class="headerlink" href="#optimisation-du-reequilibrage" title="Permanent link">&para;</a></h3>
<p>Même avec le rééquilibrage coopératif, certaines optimisations réduisent l'impact des rééquilibrages.</p>
<p><strong>Assignation statique (<code>group.instance.id</code>).</strong> En assignant un identifiant d'instance statique à chaque consommateur, Kafka peut reconnaître un consommateur qui redémarre et lui réassigner les mêmes partitions sans rééquilibrage complet.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;group.instance.id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;consumer-instance-1&quot;</span><span class="p">);</span>
</code></pre></div>
<p>Avec un <code>group.instance.id</code>, le consommateur a un délai de grâce (<code>session.timeout.ms</code>) pour redémarrer avant qu'un rééquilibrage ne soit déclenché.</p>
<p><strong>Réduction des timeouts.</strong> Des timeouts plus courts permettent une détection plus rapide des consommateurs morts, mais augmentent le risque de faux positifs (consommateur temporairement lent considéré comme mort).</p>
<p><strong>Heartbeats fréquents.</strong> Configurer <code>heartbeat.interval.ms</code> à environ 1/3 de <code>session.timeout.ms</code> pour une détection fiable.</p>
<p><strong>Traitement rapide dans <code>poll()</code>.</strong> Si le traitement entre deux <code>poll()</code> dépasse <code>max.poll.interval.ms</code>, le consommateur est éjecté. Soit traiter plus rapidement, soit réduire <code>max.poll.records</code>.</p>
<h3 id="gestion-des-callbacks-de-reequilibrage">Gestion des Callbacks de Rééquilibrage<a class="headerlink" href="#gestion-des-callbacks-de-reequilibrage" title="Permanent link">&para;</a></h3>
<p>Le consommateur peut être notifié des rééquilibrages via un <code>ConsumerRebalanceListener</code>. Ces callbacks permettent d'effectuer des actions avant et après le rééquilibrage.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">consumer</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConsumerRebalanceListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onPartitionsRevoked</span><span class="p">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="o">&gt;</span><span class="w"> </span><span class="n">partitions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span><span class="c1">// Appelé avant que les partitions soient révoquées</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">        </span><span class="c1">// Commiter les offsets, fermer les ressources</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Partitions révoquées: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">partitions</span><span class="p">);</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="na">commitSync</span><span class="p">();</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onPartitionsAssigned</span><span class="p">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="o">&gt;</span><span class="w"> </span><span class="n">partitions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">        </span><span class="c1">// Appelé après que les nouvelles partitions sont assignées</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">        </span><span class="c1">// Initialiser les ressources, éventuellement seek</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Partitions assignées: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">partitions</span><span class="p">);</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onPartitionsLost</span><span class="p">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="o">&gt;</span><span class="w"> </span><span class="n">partitions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">        </span><span class="c1">// Appelé quand les partitions sont perdues (pas de chance de commit)</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">        </span><span class="c1">// Avec rééquilibrage coopératif uniquement</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Partitions perdues: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">partitions</span><span class="p">);</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="p">});</span>
</code></pre></div>
<p><strong>Cas d'usage des callbacks :</strong></p>
<p><em>Commit avant révocation.</em> Commiter les offsets des messages traités avant de perdre les partitions pour éviter le retraitement.</p>
<p><em>Nettoyage de ressources.</em> Fermer les connexions, fichiers, ou caches associés aux partitions révoquées.</p>
<p><em>Initialisation de ressources.</em> Ouvrir des connexions ou charger des caches pour les nouvelles partitions.</p>
<p><em>Positionnement personnalisé.</em> Après assignation, utiliser <code>seek()</code> pour repositionner l'offset si nécessaire (ex: reprise depuis un checkpoint externe).</p>
<hr />
<h2 id="iii44-modeles-de-conception-fondamentaux">III.4.4 Modèles de Conception Fondamentaux<a class="headerlink" href="#iii44-modeles-de-conception-fondamentaux" title="Permanent link">&para;</a></h2>
<h3 id="pattern-un-thread-par-consommateur">Pattern : Un Thread par Consommateur<a class="headerlink" href="#pattern-un-thread-par-consommateur" title="Permanent link">&para;</a></h3>
<p>Le pattern le plus simple et le plus courant : chaque consommateur s'exécute dans son propre thread.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SingleThreadConsumer</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">KafkaConsumer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AtomicBoolean</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AtomicBoolean</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SingleThreadConsumer</span><span class="p">(</span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KafkaConsumer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">));</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">.</span><span class="na">get</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">                </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">                    </span><span class="n">process</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">                </span><span class="n">consumer</span><span class="p">.</span><span class="na">commitSync</span><span class="p">();</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">            </span><span class="n">consumer</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="w">        </span><span class="n">running</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="na">wakeup</span><span class="p">();</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="p">}</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="c1">// Utilisation</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="n">ExecutorService</span><span class="w"> </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="n">numConsumers</span><span class="p">);</span>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">numConsumers</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="w">    </span><span class="n">executor</span><span class="p">.</span><span class="na">submit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SingleThreadConsumer</span><span class="p">(</span><span class="n">createProps</span><span class="p">()));</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Avantages :</strong>
- Simple à implémenter et comprendre
- Respect naturel du modèle single-threaded du consommateur Kafka
- Ordre de traitement préservé par partition</p>
<p><strong>Inconvénients :</strong>
- Un seul thread de traitement par consommateur
- Si le traitement est lent, le consommateur ne peut pas suivre
- Pas de parallélisation du traitement au sein d'un consommateur</p>
<h3 id="pattern-decouplage-fetch-et-traitement">Pattern : Découplage Fetch et Traitement<a class="headerlink" href="#pattern-decouplage-fetch-et-traitement" title="Permanent link">&para;</a></h3>
<p>Pour les traitements lourds, découpler le fetch des messages de leur traitement permet de paralléliser le traitement.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DecoupledConsumer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">KafkaConsumer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="p">;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ExecutorService</span><span class="w"> </span><span class="n">processingPool</span><span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">queue</span><span class="p">;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AtomicBoolean</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AtomicBoolean</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DecoupledConsumer</span><span class="p">(</span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">numProcessors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KafkaConsumer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">processingPool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="n">numProcessors</span><span class="p">);</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedBlockingQueue</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">));</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">        </span><span class="c1">// Démarrer les workers de traitement</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">numProcessors</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">            </span><span class="n">processingPool</span><span class="p">.</span><span class="na">submit</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">processRecords</span><span class="p">);</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">fetchLoop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">.</span><span class="na">get</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">                </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="w">                    </span><span class="n">queue</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">record</span><span class="p">);</span><span class="w"> </span><span class="c1">// Peut bloquer si la queue est pleine</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">interrupt</span><span class="p">();</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="w">            </span><span class="n">consumer</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">processRecords</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">.</span><span class="na">get</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">queue</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="w">                </span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MILLISECONDS</span><span class="p">);</span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">record</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a><span class="w">                    </span><span class="n">process</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a><span class="w">                </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">interrupt</span><span class="p">();</span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Avantages :</strong>
- Traitement parallèle des messages
- Le fetch n'est pas bloqué par le traitement</p>
<p><strong>Inconvénients :</strong>
- L'ordre de traitement n'est plus garanti
- La gestion des offsets est complexe (quand commiter ?)
- Risque de perte de messages si la queue en mémoire est perdue</p>
<blockquote>
<p><strong>Anti-patron</strong></p>
<p><em>« Nous traitons les messages dans un thread pool et commitons immédiatement après le fetch. »</em> Ce pattern est dangereux : si le traitement échoue après le commit, les messages sont perdus. Si l'application crashe avec des messages dans la queue en mémoire, ils sont perdus.</p>
<p><em>Meilleure approche</em> : Si le traitement parallèle est nécessaire et que la perte n'est pas acceptable, utiliser un système de tracking externe (base de données) pour suivre les messages traités, ou accepter les duplicatas avec un traitement idempotent.</p>
</blockquote>
<h3 id="pattern-pause-et-resume">Pattern : Pause et Resume<a class="headerlink" href="#pattern-pause-et-resume" title="Permanent link">&para;</a></h3>
<p>Le consommateur peut mettre en pause et reprendre la consommation de partitions spécifiques. Ce pattern est utile pour la gestion de backpressure.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BackpressureConsumer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">KafkaConsumer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="p">;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">HIGH_WATERMARK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">LOW_WATERMARK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">.</span><span class="na">get</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">            </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">            </span><span class="c1">// Ajouter au buffer</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">                </span><span class="n">buffer</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">            </span><span class="c1">// Gestion du backpressure</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">HIGH_WATERMARK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">                </span><span class="n">consumer</span><span class="p">.</span><span class="na">pause</span><span class="p">(</span><span class="n">consumer</span><span class="p">.</span><span class="na">assignment</span><span class="p">());</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Buffer plein, pause de la consommation&quot;</span><span class="p">);</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LOW_WATERMARK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="w">                </span><span class="n">consumer</span><span class="p">.</span><span class="na">resume</span><span class="p">(</span><span class="n">consumer</span><span class="p">.</span><span class="na">assignment</span><span class="p">());</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Cas d'usage :</strong>
- Limiter la pression sur un système downstream lent
- Gérer des pics de charge temporaires
- Implémenter une consommation à débit contrôlé</p>
<h3 id="pattern-assignation-manuelle">Pattern : Assignation Manuelle<a class="headerlink" href="#pattern-assignation-manuelle" title="Permanent link">&para;</a></h3>
<p>Au lieu de s'abonner à un topic et de laisser Kafka gérer l'assignation, le consommateur peut demander des partitions spécifiques.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">// Assignation manuelle</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">TopicPartition</span><span class="w"> </span><span class="n">partition0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TopicPartition</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">TopicPartition</span><span class="w"> </span><span class="n">partition1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TopicPartition</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">consumer</span><span class="p">.</span><span class="na">assign</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">partition0</span><span class="p">,</span><span class="w"> </span><span class="n">partition1</span><span class="p">));</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="c1">// Avec seek pour repositionnement</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="n">consumer</span><span class="p">.</span><span class="na">seek</span><span class="p">(</span><span class="n">partition0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Début de la partition</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="n">consumer</span><span class="p">.</span><span class="na">seekToEnd</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">partition1</span><span class="p">));</span><span class="w"> </span><span class="c1">// Fin de la partition</span>
</code></pre></div>
<p><strong>Cas d'usage :</strong>
- Replay de données spécifiques
- Migration ou réparation de données
- Consommation sans groupe (pas de coordination)
- Tests et débogage</p>
<p><strong>Attention.</strong> Avec l'assignation manuelle, il n'y a pas de groupe de consommateurs, pas de rééquilibrage automatique, et pas de stockage automatique des offsets dans <code>__consumer_offsets</code>. L'application est responsable de tout.</p>
<h3 id="pattern-at-least-once-avec-idempotence">Pattern : At-Least-Once avec Idempotence<a class="headerlink" href="#pattern-at-least-once-avec-idempotence" title="Permanent link">&para;</a></h3>
<p>Pour garantir at-least-once sans perdre de messages, commiter les offsets après le traitement réussi et rendre le traitement idempotent pour gérer les duplicatas.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">processWithIdempotence</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">.</span><span class="na">get</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">        </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">messageId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractMessageId</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">            </span><span class="c1">// Vérifier si déjà traité</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">processedMessages</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">messageId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Message {} déjà traité, skip&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">messageId</span><span class="p">);</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">            </span><span class="c1">// Traiter</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">            </span><span class="n">process</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">            </span><span class="c1">// Marquer comme traité</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">            </span><span class="n">processedMessages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">messageId</span><span class="p">);</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">        </span><span class="c1">// Commiter après traitement</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="na">commitSync</span><span class="p">();</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Implémentation de l'idempotence :</strong>
- Stocker les IDs des messages traités dans une base de données ou un cache
- Utiliser des opérations naturellement idempotentes (UPSERT, PUT)
- Inclure un ID unique dans chaque message côté producteur</p>
<hr />
<h2 id="iii45-strategies-de-consommation-avancees">III.4.5 Stratégies de Consommation Avancées<a class="headerlink" href="#iii45-strategies-de-consommation-avancees" title="Permanent link">&para;</a></h2>
<h3 id="exactly-once-semantic-avec-transactions">Exactly-Once Semantic avec Transactions<a class="headerlink" href="#exactly-once-semantic-avec-transactions" title="Permanent link">&para;</a></h3>
<p>Pour atteindre l'exactly-once de bout en bout dans un pipeline Kafka (consommation → transformation → production), utiliser les transactions côté consommateur en conjonction avec un producteur transactionnel. Cette approche garantit que le traitement d'un message et la production de ses résultats sont atomiques.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">// Configuration du consommateur</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">Properties</span><span class="w"> </span><span class="n">consumerProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">consumerProps</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;bootstrap.servers&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;localhost:9092&quot;</span><span class="p">);</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">consumerProps</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;group.id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;exactly-once-processor&quot;</span><span class="p">);</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">consumerProps</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;isolation.level&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;read_committed&quot;</span><span class="p">);</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">consumerProps</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;enable.auto.commit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">);</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="c1">// Configuration du producteur transactionnel</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="n">Properties</span><span class="w"> </span><span class="n">producerProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="n">producerProps</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;bootstrap.servers&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;localhost:9092&quot;</span><span class="p">);</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="n">producerProps</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;transactional.id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;processor-txn-1&quot;</span><span class="p">);</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="n">producerProps</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;enable.idempotence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">);</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="n">KafkaConsumer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KafkaConsumer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">consumerProps</span><span class="p">);</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="n">KafkaProducer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">producer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KafkaProducer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">producerProps</span><span class="p">);</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="n">consumer</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;input-topic&quot;</span><span class="p">));</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="n">producer</span><span class="p">.</span><span class="na">initTransactions</span><span class="p">();</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">.</span><span class="na">get</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">records</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">        </span><span class="n">producer</span><span class="p">.</span><span class="na">beginTransaction</span><span class="p">();</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">                </span><span class="c1">// Transformer et produire</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">transformedValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transform</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="na">value</span><span class="p">());</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">                </span><span class="n">ProducerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProducerRecord</span><span class="o">&lt;&gt;</span><span class="p">(</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">                    </span><span class="s">&quot;output-topic&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">                    </span><span class="kd">record</span><span class="err">.</span><span class="nc">key</span><span class="p">(),</span><span class="w"> </span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">                    </span><span class="n">transformedValue</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="w">                </span><span class="p">);</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w">                </span><span class="n">producer</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="w">            </span><span class="c1">// Commiter les offsets consommés dans la même transaction</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="w">            </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">OffsetAndMetadata</span><span class="o">&gt;</span><span class="w"> </span><span class="n">offsetsToCommit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TopicPartition</span><span class="w"> </span><span class="n">partition</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">.</span><span class="na">partitions</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="w">                </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">partitionRecords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">records</span><span class="p">.</span><span class="na">records</span><span class="p">(</span><span class="n">partition</span><span class="p">);</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="w">                </span><span class="kt">long</span><span class="w"> </span><span class="n">lastOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partitionRecords</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">partitionRecords</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="na">offset</span><span class="p">();</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="w">                </span><span class="n">offsetsToCommit</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">partition</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OffsetAndMetadata</span><span class="p">(</span><span class="n">lastOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="w">            </span><span class="n">producer</span><span class="p">.</span><span class="na">sendOffsetsToTransaction</span><span class="p">(</span><span class="n">offsetsToCommit</span><span class="p">,</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">groupMetadata</span><span class="p">());</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="w">            </span><span class="n">producer</span><span class="p">.</span><span class="na">commitTransaction</span><span class="p">();</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ProducerFencedException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">OutOfOrderSequenceException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a><span class="w">            </span><span class="c1">// Erreur fatale - le producteur doit être recréé</span>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">KafkaException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a><span class="w">            </span><span class="n">producer</span><span class="p">.</span><span class="na">abortTransaction</span><span class="p">();</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Points clés de l'exactly-once :</strong></p>
<p><em><code>isolation.level=read_committed</code></em> : Le consommateur ne voit que les messages de transactions commitées. Les messages de transactions en cours ou abandonnées sont filtrés automatiquement.</p>
<p><em>Les offsets sont commités dans la transaction</em> : L'appel <code>sendOffsetsToTransaction()</code> inclut les offsets consommés dans la transaction en cours. Si la transaction est abandonnée, les offsets ne sont pas commités, et les messages seront relus.</p>
<p><em>Atomicité garantie</em> : Soit tous les messages de sortie sont produits ET les offsets sont commités, soit rien ne se passe. Il n'y a pas d'état intermédiaire visible.</p>
<p><strong>Limitations et considérations :</strong></p>
<p>L'exactly-once transactionnel ajoute une latence significative (coordination avec le transaction coordinator). Il est justifié pour les traitements critiques mais peut être excessif pour les pipelines à haute performance où l'at-least-once avec idempotence suffit.</p>
<p>Le <code>transactional.id</code> doit être unique par instance de processeur. En cas de scaling, chaque nouvelle instance a besoin de son propre ID.</p>
<h3 id="consommation-multi-topic">Consommation Multi-Topic<a class="headerlink" href="#consommation-multi-topic" title="Permanent link">&para;</a></h3>
<p>Un consommateur peut s'abonner à plusieurs topics simultanément, soit en les listant explicitement, soit via un pattern regex. Cette capacité est puissante pour les architectures où un service doit réagir à plusieurs types d'événements.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">// Liste explicite - quand les topics sont connus à l&#39;avance</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">consumer</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;orders&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;payments&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;shipments&quot;</span><span class="p">));</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1">// Pattern regex - pour les topics dynamiques</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="c1">// Consomme tous les topics commençant par &quot;events-&quot;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="n">consumer</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">Pattern</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span><span class="s">&quot;events-.*&quot;</span><span class="p">));</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="c1">// Pattern avec région</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="c1">// Consomme events-eu-*, events-us-*, etc.</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="n">consumer</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">Pattern</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span><span class="s">&quot;events-[a-z]{2}-.*&quot;</span><span class="p">));</span>
</code></pre></div>
<p><strong>Considérations pour le multi-topic :</strong></p>
<p><em>Distribution des partitions</em> : Les partitions de tous les topics sont distribuées entre les membres du groupe comme s'il s'agissait d'un seul topic. Un consommateur peut recevoir des partitions de différents topics.</p>
<p><em>Routing du traitement</em> : Un seul <code>poll()</code> peut retourner des messages de différents topics. Le traitement doit router les messages vers la logique appropriée.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="na">topic</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;orders&quot;</span><span class="p">:</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">            </span><span class="n">handleOrder</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;payments&quot;</span><span class="p">:</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">            </span><span class="n">handlePayment</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;shipments&quot;</span><span class="p">:</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">            </span><span class="n">handleShipment</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">        </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">            </span><span class="c1">// Pour les patterns regex, gérer les topics inconnus</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="na">topic</span><span class="p">().</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;events-&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">                </span><span class="n">handleGenericEvent</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Topic inattendu: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">topic</span><span class="p">());</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="p">}</span>
</code></pre></div>
<p><em>Pattern regex et découverte dynamique</em> : Avec un pattern regex, le consommateur découvre les nouveaux topics périodiquement (<code>metadata.max.age.ms</code>, défaut 5 minutes). Un nouveau topic matching le pattern sera automatiquement ajouté à la souscription.</p>
<blockquote>
<p><strong>Note de terrain</strong></p>
<p><em>Contexte</em> : Plateforme multi-tenant où chaque tenant a son propre topic <code>events-{tenant-id}</code>.</p>
<p><em>Approche initiale</em> : Un consommateur dédié par tenant. Résultat : 500 consommateurs pour 500 tenants, overhead de ressources massif.</p>
<p><em>Solution</em> : Un groupe de consommateurs avec pattern <code>events-.*</code>. Tous les topics tenant sont consommés par le même groupe, les partitions distribuées entre ~20 consommateurs.</p>
<p><em>Bénéfices</em> : Réduction de 95% des ressources. Scaling automatique quand de nouveaux tenants sont ajoutés. Monitoring centralisé.</p>
<p><em>Attention</em> : Le routing doit extraire le tenant-id du nom de topic pour appliquer la logique appropriée.</p>
</blockquote>
<h3 id="seek-et-replay">Seek et Replay<a class="headerlink" href="#seek-et-replay" title="Permanent link">&para;</a></h3>
<p>Le consommateur peut repositionner son offset pour relire des messages ou sauter en avant. Cette capacité est fondamentale pour plusieurs cas d'usage opérationnels.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1">// Repositionner au début - rejouer tout l&#39;historique</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">consumer</span><span class="p">.</span><span class="na">seekToBeginning</span><span class="p">(</span><span class="n">consumer</span><span class="p">.</span><span class="na">assignment</span><span class="p">());</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="c1">// Repositionner à la fin - ignorer l&#39;historique</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="n">consumer</span><span class="p">.</span><span class="na">seekToEnd</span><span class="p">(</span><span class="n">consumer</span><span class="p">.</span><span class="na">assignment</span><span class="p">());</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="c1">// Repositionner à un offset spécifique</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="n">consumer</span><span class="p">.</span><span class="na">seek</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TopicPartition</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="c1">// Repositionner à un timestamp - rejouer depuis une date</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">timestampsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="n">Instant</span><span class="w"> </span><span class="n">targetTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">minus</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofHours</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TopicPartition</span><span class="w"> </span><span class="n">partition</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">assignment</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">    </span><span class="n">timestampsToSearch</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">partition</span><span class="p">,</span><span class="w"> </span><span class="n">targetTime</span><span class="p">.</span><span class="na">toEpochMilli</span><span class="p">());</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="p">}</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">OffsetAndTimestamp</span><span class="o">&gt;</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">offsetsForTimes</span><span class="p">(</span><span class="n">timestampsToSearch</span><span class="p">);</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">OffsetAndTimestamp</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">offsets</span><span class="p">.</span><span class="na">entrySet</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="na">getValue</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="na">seek</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="na">getKey</span><span class="p">(),</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="na">getValue</span><span class="p">().</span><span class="na">offset</span><span class="p">());</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Partition {} repositionnée à offset {} (timestamp {})&quot;</span><span class="p">,</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">            </span><span class="n">entry</span><span class="p">.</span><span class="na">getKey</span><span class="p">(),</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="na">getValue</span><span class="p">().</span><span class="na">offset</span><span class="p">(),</span><span class="w"> </span><span class="n">targetTime</span><span class="p">);</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Cas d'usage du seek :</strong></p>
<p><em>Replay après correction de bug</em> : Un bug a causé un traitement incorrect des messages des dernières 24 heures. Après correction, repositionner les offsets pour retraiter ces messages.</p>
<p><em>Reconstruction d'un système downstream</em> : Une base de données dérivée est corrompue. Repositionner au début du topic pour reconstruire l'état complet.</p>
<p><em>Saut de messages corrompus</em> : Des messages malformés bloquent le traitement. Repositionner après le segment corrompu pour continuer.</p>
<p><em>Reprise depuis un checkpoint externe</em> : L'état de traitement est persisté dans une base externe plutôt que dans Kafka. Au démarrage, repositionner selon le checkpoint.</p>
<blockquote>
<p><strong>Décision architecturale</strong></p>
<p><em>Contexte</em> : Système de projection CQRS où l'état est reconstruit depuis les événements.</p>
<p><em>Options pour le checkpoint</em> :
1. <em>Offsets Kafka uniquement</em> : Simple, mais la reconstruction nécessite de rejouer tout le topic.
2. <em>Snapshots périodiques + offsets</em> : Snapshot de l'état toutes les heures, position offset sauvegardée avec le snapshot.</p>
<p><em>Décision</em> : Option 2. Au démarrage, charger le dernier snapshot et <code>seek()</code> à l'offset correspondant. La reconstruction ne rejoue que les événements depuis le snapshot.</p>
<p><em>Bénéfice</em> : Temps de démarrage réduit de 99% (5 minutes vs 8 heures pour un topic de 1 an).</p>
</blockquote>
<h3 id="consommation-avec-dead-letter-queue">Consommation avec Dead Letter Queue<a class="headerlink" href="#consommation-avec-dead-letter-queue" title="Permanent link">&para;</a></h3>
<p>Quand un message ne peut pas être traité après plusieurs tentatives (erreur de désérialisation, erreur métier, dépendance indisponible), le router vers une Dead Letter Queue (DLQ) permet de continuer le traitement des autres messages sans blocage.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DLQEnabledConsumer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">KafkaConsumer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="p">;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">KafkaProducer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dlqProducer</span><span class="p">;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">consumeWithDLQ</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">.</span><span class="na">get</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">            </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">                </span><span class="kt">boolean</span><span class="w"> </span><span class="n">processed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">processWithRetry</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">processed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">                    </span><span class="n">sendToDLQ</span><span class="p">(</span><span class="n">record</span><span class="p">,</span><span class="w"> </span><span class="n">lastException</span><span class="p">);</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">            </span><span class="n">consumer</span><span class="p">.</span><span class="na">commitSync</span><span class="p">();</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">processWithRetry</span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">attempts</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">maxRetries</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="w">                </span><span class="n">process</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RetriableException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="w">                </span><span class="n">attempts</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="w">                </span><span class="n">lastException</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="w">                    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">attempts</span><span class="p">));</span><span class="w"> </span><span class="c1">// Backoff exponentiel</span>
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">ie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a><span class="w">                    </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">interrupt</span><span class="p">();</span>
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NonRetriableException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a><span class="w">                </span><span class="n">lastException</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
<a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// Pas de retry, envoyer directement en DLQ</span>
<a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a>
<a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendToDLQ</span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="p">,</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">dlqTopic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">topic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.dlq&quot;</span><span class="p">;</span>
<a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a>
<a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a><span class="w">        </span><span class="n">ProducerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dlqRecord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProducerRecord</span><span class="o">&lt;&gt;</span><span class="p">(</span>
<a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a><span class="w">            </span><span class="n">dlqTopic</span><span class="p">,</span>
<a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a><span class="w">            </span><span class="kd">record</span><span class="err">.</span><span class="nc">key</span><span class="p">(),</span>
<a id="__codelineno-19-51" name="__codelineno-19-51" href="#__codelineno-19-51"></a><span class="w">            </span><span class="kd">record</span><span class="err">.</span><span class="nc">value</span><span class="p">()</span>
<a id="__codelineno-19-52" name="__codelineno-19-52" href="#__codelineno-19-52"></a><span class="w">        </span><span class="p">);</span>
<a id="__codelineno-19-53" name="__codelineno-19-53" href="#__codelineno-19-53"></a>
<a id="__codelineno-19-54" name="__codelineno-19-54" href="#__codelineno-19-54"></a><span class="w">        </span><span class="c1">// Métadonnées pour le diagnostic et le rejeu</span>
<a id="__codelineno-19-55" name="__codelineno-19-55" href="#__codelineno-19-55"></a><span class="w">        </span><span class="n">dlqRecord</span><span class="p">.</span><span class="na">headers</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;X-Original-Topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">topic</span><span class="p">().</span><span class="na">getBytes</span><span class="p">());</span>
<a id="__codelineno-19-56" name="__codelineno-19-56" href="#__codelineno-19-56"></a><span class="w">        </span><span class="n">dlqRecord</span><span class="p">.</span><span class="na">headers</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;X-Original-Partition&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-19-57" name="__codelineno-19-57" href="#__codelineno-19-57"></a><span class="w">            </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="na">partition</span><span class="p">()).</span><span class="na">getBytes</span><span class="p">());</span>
<a id="__codelineno-19-58" name="__codelineno-19-58" href="#__codelineno-19-58"></a><span class="w">        </span><span class="n">dlqRecord</span><span class="p">.</span><span class="na">headers</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;X-Original-Offset&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-19-59" name="__codelineno-19-59" href="#__codelineno-19-59"></a><span class="w">            </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="na">offset</span><span class="p">()).</span><span class="na">getBytes</span><span class="p">());</span>
<a id="__codelineno-19-60" name="__codelineno-19-60" href="#__codelineno-19-60"></a><span class="w">        </span><span class="n">dlqRecord</span><span class="p">.</span><span class="na">headers</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;X-Original-Timestamp&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-19-61" name="__codelineno-19-61" href="#__codelineno-19-61"></a><span class="w">            </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="na">timestamp</span><span class="p">()).</span><span class="na">getBytes</span><span class="p">());</span>
<a id="__codelineno-19-62" name="__codelineno-19-62" href="#__codelineno-19-62"></a><span class="w">        </span><span class="n">dlqRecord</span><span class="p">.</span><span class="na">headers</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;X-Error-Class&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-19-63" name="__codelineno-19-63" href="#__codelineno-19-63"></a><span class="w">            </span><span class="n">error</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">().</span><span class="na">getBytes</span><span class="p">());</span>
<a id="__codelineno-19-64" name="__codelineno-19-64" href="#__codelineno-19-64"></a><span class="w">        </span><span class="n">dlqRecord</span><span class="p">.</span><span class="na">headers</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;X-Error-Message&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-19-65" name="__codelineno-19-65" href="#__codelineno-19-65"></a><span class="w">            </span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="na">getMessage</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="na">getMessage</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;null&quot;</span><span class="p">).</span><span class="na">getBytes</span><span class="p">());</span>
<a id="__codelineno-19-66" name="__codelineno-19-66" href="#__codelineno-19-66"></a><span class="w">        </span><span class="n">dlqRecord</span><span class="p">.</span><span class="na">headers</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;X-Error-Timestamp&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-19-67" name="__codelineno-19-67" href="#__codelineno-19-67"></a><span class="w">            </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">getBytes</span><span class="p">());</span>
<a id="__codelineno-19-68" name="__codelineno-19-68" href="#__codelineno-19-68"></a><span class="w">        </span><span class="n">dlqRecord</span><span class="p">.</span><span class="na">headers</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;X-Retry-Count&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-19-69" name="__codelineno-19-69" href="#__codelineno-19-69"></a><span class="w">            </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">maxRetries</span><span class="p">).</span><span class="na">getBytes</span><span class="p">());</span>
<a id="__codelineno-19-70" name="__codelineno-19-70" href="#__codelineno-19-70"></a>
<a id="__codelineno-19-71" name="__codelineno-19-71" href="#__codelineno-19-71"></a><span class="w">        </span><span class="n">dlqProducer</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">dlqRecord</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">exception</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-72" name="__codelineno-19-72" href="#__codelineno-19-72"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exception</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-73" name="__codelineno-19-73" href="#__codelineno-19-73"></a><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Échec d&#39;envoi vers DLQ pour offset {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">offset</span><span class="p">(),</span><span class="w"> </span><span class="n">exception</span><span class="p">);</span>
<a id="__codelineno-19-74" name="__codelineno-19-74" href="#__codelineno-19-74"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-75" name="__codelineno-19-75" href="#__codelineno-19-75"></a><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Message envoyé vers DLQ: {} -&gt; {} offset {}&quot;</span><span class="p">,</span>
<a id="__codelineno-19-76" name="__codelineno-19-76" href="#__codelineno-19-76"></a><span class="w">                    </span><span class="kd">record</span><span class="err">.</span><span class="nc">topic</span><span class="p">(),</span><span class="w"> </span><span class="n">dlqTopic</span><span class="p">,</span><span class="w"> </span><span class="n">metadata</span><span class="p">.</span><span class="na">offset</span><span class="p">());</span>
<a id="__codelineno-19-77" name="__codelineno-19-77" href="#__codelineno-19-77"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-19-78" name="__codelineno-19-78" href="#__codelineno-19-78"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-19-79" name="__codelineno-19-79" href="#__codelineno-19-79"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-80" name="__codelineno-19-80" href="#__codelineno-19-80"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Bonnes pratiques DLQ :</strong></p>
<p><em>Métadonnées complètes</em> : Inclure suffisamment d'informations pour diagnostiquer l'erreur et rejouer le message si nécessaire.</p>
<p><em>Monitoring de la DLQ</em> : Configurer des alertes sur le volume de la DLQ. Un pic soudain indique un problème systémique.</p>
<p><em>Processus de traitement DLQ</em> : Définir un processus clair pour examiner et traiter les messages en DLQ — correction manuelle, rejeu automatique après correction du bug, archivage.</p>
<p><em>Rétention adaptée</em> : Configurer une rétention plus longue sur les topics DLQ pour laisser le temps d'investiguer et corriger.</p>
<hr />
<h2 id="iii46-reglage-des-performances">III.4.6 Réglage des Performances<a class="headerlink" href="#iii46-reglage-des-performances" title="Permanent link">&para;</a></h2>
<h3 id="metriques-de-performance-du-consommateur">Métriques de Performance du Consommateur<a class="headerlink" href="#metriques-de-performance-du-consommateur" title="Permanent link">&para;</a></h3>
<p>Avant d'optimiser, mesurer. Les métriques clés permettent d'identifier les goulots d'étranglement et de valider les optimisations. Le consommateur Kafka expose des dizaines de métriques via JMX, mais certaines sont plus critiques que d'autres.</p>
<p><strong>Consumer lag — La métrique reine.</strong> Le lag est la différence entre le dernier offset produit et l'offset courant du consommateur. Un lag croissant indique que le consommateur ne suit pas le rythme de production.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>Lag = (Latest Offset) - (Current Consumer Offset)
</code></pre></div>
<p>Le lag peut être mesuré de plusieurs façons :</p>
<p><em>Métriques JMX du consommateur</em> : <code>records-lag</code> (par partition), <code>records-lag-avg</code> (moyenne sur toutes les partitions), <code>records-lag-max</code> (maximum). Ces métriques sont disponibles si le consommateur est actif.</p>
<p><em>Outils externes</em> : Burrow (LinkedIn), Kafka Lag Exporter (Lightbend), Conduktor, Confluent Control Center. Ces outils peuvent mesurer le lag même si le consommateur est arrêté.</p>
<p><em>Commande CLI</em> : <code>kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group my-group --describe</code></p>
<blockquote>
<p><strong>Perspective stratégique</strong></p>
<p>Le lag est l'indicateur le plus important de la santé d'un pipeline Kafka. Un lag stable (même non nul) est acceptable — le consommateur est simplement en retard d'un montant constant. Un lag croissant est un problème : le consommateur prend du retard progressivement et finira par accumuler des heures voire des jours de retard.</p>
<p>La dérivée du lag (lag growth rate) est souvent plus importante que le lag absolu.</p>
</blockquote>
<p><strong>Throughput.</strong> Nombre de messages ou volume de données consommés par seconde. Les métriques clés sont :
- <code>records-consumed-rate</code> : Messages par seconde
- <code>bytes-consumed-rate</code> : Octets par seconde
- <code>fetch-rate</code> : Requêtes fetch par seconde</p>
<p><strong>Latence de fetch.</strong> Temps pour récupérer les messages depuis le broker :
- <code>fetch-latency-avg</code> : Latence moyenne des requêtes fetch
- <code>fetch-latency-max</code> : Latence maximale observée</p>
<p>Une latence fetch élevée peut indiquer des problèmes réseau, un broker surchargé, ou des partitions sur des disques lents.</p>
<p><strong>Métriques de groupe.</strong> Pour comprendre la santé du groupe de consommateurs :
- <code>rebalance-total</code> : Nombre total de rééquilibrages depuis le démarrage
- <code>rebalance-rate-per-hour</code> : Fréquence des rééquilibrages
- <code>last-rebalance-seconds-ago</code> : Temps depuis le dernier rééquilibrage
- <code>assigned-partitions</code> : Nombre de partitions assignées à ce consommateur</p>
<p><strong>Métriques de commit.</strong> Pour comprendre le comportement des commits :
- <code>commit-rate</code> : Nombre de commits par seconde
- <code>commit-latency-avg</code> : Latence moyenne des commits
- <code>committed-time-ns-total</code> : Temps total passé à commiter</p>
<h3 id="configuration-jmx-et-export">Configuration JMX et Export<a class="headerlink" href="#configuration-jmx-et-export" title="Permanent link">&para;</a></h3>
<p>Pour collecter les métriques du consommateur, activer JMX et configurer un exporteur :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Activation JMX sur l&#39;application Java</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>java<span class="w"> </span>-Dcom.sun.management.jmxremote<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">     </span>-Dcom.sun.management.jmxremote.port<span class="o">=</span><span class="m">9999</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">     </span>-Dcom.sun.management.jmxremote.authenticate<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">     </span>-Dcom.sun.management.jmxremote.ssl<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">     </span>-jar<span class="w"> </span>my-consumer-app.jar
</code></pre></div>
<p>Pour Prometheus avec JMX Exporter :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># jmx_exporter_config.yml</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">  </span><span class="c1"># Métriques de lag</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka.consumer&lt;type=consumer-fetch-manager-metrics, client-id=(.+), topic=(.+), partition=(.+)&gt;&lt;&gt;records-lag</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka_consumer_records_lag</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">      </span><span class="nt">client_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$1&quot;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">      </span><span class="nt">topic</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$2&quot;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">      </span><span class="nt">partition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$3&quot;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">  </span><span class="c1"># Métriques de débit</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka.consumer&lt;type=consumer-fetch-manager-metrics, client-id=(.+)&gt;&lt;&gt;records-consumed-rate</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka_consumer_records_consumed_rate</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">      </span><span class="nt">client_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$1&quot;</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">  </span><span class="c1"># Métriques de groupe</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka.consumer&lt;type=consumer-coordinator-metrics, client-id=(.+)&gt;&lt;&gt;rebalance-total</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka_consumer_rebalance_total</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="w">      </span><span class="nt">client_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$1&quot;</span>
</code></pre></div>
<h3 id="optimisation-du-debit">Optimisation du Débit<a class="headerlink" href="#optimisation-du-debit" title="Permanent link">&para;</a></h3>
<p>Quand le lag est croissant et que le consommateur ne suit pas, plusieurs leviers permettent d'augmenter le débit.</p>
<p><strong>Augmenter <code>fetch.min.bytes</code>.</strong> Par défaut (1 byte), le broker répond dès qu'il a des données. Augmenter cette valeur force le broker à attendre d'avoir plus de données, réduisant le nombre de requêtes et améliorant l'efficacité.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="na">fetch.min.bytes</span><span class="o">=</span><span class="s">1048576  # 1 MB</span>
</code></pre></div>
<p><em>Quand utiliser</em> : Quand le réseau ou le nombre de requêtes est le goulot d'étranglement. Le consommateur fait trop de petites requêtes.</p>
<p><em>Effet secondaire</em> : Augmente la latence minimale — le broker attend d'avoir suffisamment de données.</p>
<p><strong>Augmenter <code>fetch.max.wait.ms</code>.</strong> Temps maximal d'attente si <code>fetch.min.bytes</code> n'est pas atteint. Combiné avec <code>fetch.min.bytes</code>, permet d'optimiser le batching des fetch.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="na">fetch.max.wait.ms</span><span class="o">=</span><span class="s">500  # 500ms</span>
</code></pre></div>
<p><strong>Augmenter <code>max.partition.fetch.bytes</code>.</strong> Taille maximale de données à récupérer par partition par requête. Une valeur plus grande permet de récupérer plus de messages en une seule requête.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="na">max.partition.fetch.bytes</span><span class="o">=</span><span class="s">1048576  # 1 MB par partition</span>
</code></pre></div>
<p><em>Attention</em> : Augmente la mémoire utilisée. Avec N partitions assignées, le consommateur peut utiliser jusqu'à N × <code>max.partition.fetch.bytes</code> de mémoire pour les buffers.</p>
<p><strong>Augmenter <code>max.poll.records</code>.</strong> Nombre maximal de messages retournés par <code>poll()</code>. Plus de messages par poll réduit l'overhead de l'appel poll() mais augmente le temps entre les polls.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="na">max.poll.records</span><span class="o">=</span><span class="s">1000  # ou plus</span>
</code></pre></div>
<p><em>Attention</em> : Si le traitement de <code>max.poll.records</code> messages prend plus de <code>max.poll.interval.ms</code>, le consommateur sera éjecté du groupe.</p>
<p><strong>Paralléliser les consommateurs.</strong> Si un seul consommateur ne peut pas suivre malgré les optimisations, ajouter des consommateurs au groupe (dans la limite du nombre de partitions).</p>
<p><strong>Optimiser le traitement.</strong> Souvent, le goulot d'étranglement n'est pas Kafka mais le traitement applicatif. Profiler le code de traitement pour identifier les inefficacités.</p>
<blockquote>
<p><strong>Note de terrain</strong></p>
<p><em>Contexte</em> : Application de traitement d'événements avec lag croissant de 500 messages/seconde.</p>
<p><em>Diagnostic</em> : 
- Débit consommateur : 1000 msg/s
- Débit producteur : 1500 msg/s
- Profiling : 60% du temps dans la sérialisation JSON, 30% dans l'appel base de données, 10% dans Kafka</p>
<p><em>Actions</em> :
1. Migration JSON → Avro : Sérialisation 5× plus rapide → débit 2000 msg/s
2. Batch des écritures DB : Latence DB réduite → débit 3000 msg/s
3. Kafka n'était pas le problème !</p>
<p><em>Leçon</em> : Avant d'optimiser Kafka, vérifier que Kafka est le goulot d'étranglement.</p>
</blockquote>
<h3 id="optimisation-de-la-latence">Optimisation de la Latence<a class="headerlink" href="#optimisation-de-la-latence" title="Permanent link">&para;</a></h3>
<p>Pour les applications temps réel où chaque milliseconde compte, optimiser la latence de bout en bout.</p>
<p><strong>Réduire <code>fetch.min.bytes</code>.</strong> Une valeur basse (1, le défaut) garantit que le broker répond dès qu'il a des données, minimisant la latence.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="na">fetch.min.bytes</span><span class="o">=</span><span class="s">1</span>
</code></pre></div>
<p><strong>Réduire <code>fetch.max.wait.ms</code>.</strong> Limite le temps d'attente du broker même si <code>fetch.min.bytes</code> n'est pas atteint.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="na">fetch.max.wait.ms</span><span class="o">=</span><span class="s">100  # ou moins</span>
</code></pre></div>
<p><strong>Réduire <code>max.poll.records</code>.</strong> Moins de messages par poll signifie un traitement plus rapide et un retour plus rapide à poll().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="na">max.poll.records</span><span class="o">=</span><span class="s">100</span>
</code></pre></div>
<p><strong>Désactiver le commit automatique.</strong> Le commit automatique introduit un délai avant que les offsets ne soient persistés. Avec un commit manuel immédiat après traitement, la progression est plus prévisible.</p>
<p><strong>Traitement asynchrone avec commit immédiat.</strong> Pour la latence minimale, commiter immédiatement après réception (avant traitement) et traiter de manière asynchrone. Attention : cela convertit la garantie en at-most-once.</p>
<h3 id="compromis-debit-vs-latence-tableau-de-reference">Compromis Débit vs. Latence — Tableau de Référence<a class="headerlink" href="#compromis-debit-vs-latence-tableau-de-reference" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Paramètre</th>
<th>Pour le débit</th>
<th>Pour la latence</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fetch.min.bytes</code></td>
<td>1 MB</td>
<td>1 byte</td>
<td>Batching vs. réactivité</td>
</tr>
<tr>
<td><code>fetch.max.wait.ms</code></td>
<td>500ms</td>
<td>50-100ms</td>
<td>Attente vs. réactivité</td>
</tr>
<tr>
<td><code>max.poll.records</code></td>
<td>1000+</td>
<td>50-100</td>
<td>Volume vs. fréquence</td>
</tr>
<tr>
<td><code>max.partition.fetch.bytes</code></td>
<td>1 MB</td>
<td>256 KB</td>
<td>Efficacité vs. mémoire</td>
</tr>
<tr>
<td>Nombre de consommateurs</td>
<td>Moins, plus chargés</td>
<td>Plus, moins chargés</td>
<td>Ressources vs. parallélisme</td>
</tr>
<tr>
<td>Commit</td>
<td>Périodique</td>
<td>Après chaque batch</td>
<td>Efficacité vs. progression</td>
</tr>
</tbody>
</table>
<h3 id="eviter-les-problemes-de-timeout">Éviter les Problèmes de Timeout<a class="headerlink" href="#eviter-les-problemes-de-timeout" title="Permanent link">&para;</a></h3>
<p>Les timeouts mal configurés sont une source fréquente de problèmes en production. Un timeout trop court cause des éjections intempestives ; un timeout trop long retarde la détection des vraies pannes.</p>
<p><strong><code>session.timeout.ms</code></strong> (défaut 45s) : Si le consommateur ne peut pas envoyer de heartbeat dans ce délai, il est éjecté du groupe. </p>
<p><em>Trop court</em> : Des GC pauses ou des pics de charge peuvent causer des éjections intempestives, déclenchant des rééquilibrages inutiles.</p>
<p><em>Trop long</em> : Un consommateur vraiment mort n'est pas détecté rapidement, laissant ses partitions sans traitement.</p>
<p><strong><code>heartbeat.interval.ms</code></strong> (défaut 3s) : Intervalle entre les heartbeats envoyés au coordinateur. Devrait être environ 1/3 de <code>session.timeout.ms</code> pour garantir plusieurs heartbeats par session.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="na">session.timeout.ms</span><span class="o">=</span><span class="s">30000</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="na">heartbeat.interval.ms</span><span class="o">=</span><span class="s">10000</span>
</code></pre></div>
<p><strong><code>max.poll.interval.ms</code></strong> (défaut 5 min) : Intervalle maximal entre deux appels <code>poll()</code>. Si le traitement des messages prend plus de temps que cette valeur, le consommateur est considéré comme mort et éjecté.</p>
<p>C'est le timeout le plus fréquemment mal configuré. Si le traitement d'un batch de messages prend longtemps (accès base de données, appels API externes), augmenter ce timeout ou réduire <code>max.poll.records</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Pour un traitement lent (batch ML, agrégations complexes)</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="na">max.poll.interval.ms</span><span class="o">=</span><span class="s">600000  # 10 minutes</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="na">max.poll.records</span><span class="o">=</span><span class="s">50  # Moins de messages par poll</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="c1"># Pour un traitement rapide</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="na">max.poll.interval.ms</span><span class="o">=</span><span class="s">30000  # 30 secondes</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="na">max.poll.records</span><span class="o">=</span><span class="s">500</span>
</code></pre></div>
<blockquote>
<p><strong>Anti-patron</strong></p>
<p><em>« Notre consommateur est éjecté régulièrement alors qu'il fonctionne. »</em></p>
<p><em>Diagnostic</em> : <code>max.poll.interval.ms</code> trop court par rapport au temps de traitement réel.</p>
<p><em>Symptôme</em> : Logs montrant <code>"Member ... has failed to heartbeat"</code> ou <code>"Member ... has left the group"</code> alors que l'application tourne.</p>
<p><em>Solution</em> : Mesurer le temps réel de traitement d'un batch, configurer <code>max.poll.interval.ms</code> à 2-3× ce temps, ou réduire <code>max.poll.records</code>.</p>
</blockquote>
<hr />
<h2 id="iii47-construire-des-consommateurs-resilients">III.4.7 Construire des Consommateurs Résilients<a class="headerlink" href="#iii47-construire-des-consommateurs-resilients" title="Permanent link">&para;</a></h2>
<h3 id="gestion-des-erreurs-de-deserialisation">Gestion des Erreurs de Désérialisation<a class="headerlink" href="#gestion-des-erreurs-de-deserialisation" title="Permanent link">&para;</a></h3>
<p>Les erreurs de désérialisation sont courantes quand les schémas évoluent ou quand des messages corrompus arrivent dans le topic. Par défaut, une erreur de désérialisation fait échouer le <code>poll()</code>, bloquant potentiellement tout le consommateur pour un seul message malformé.</p>
<p><strong>Désérialiseur avec gestion d'erreur :</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ErrorHandlingDeserializer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Deserializer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Deserializer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">delegate</span><span class="p">;</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">errorTopic</span><span class="p">;</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">KafkaProducer</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]&gt;</span><span class="w"> </span><span class="n">errorProducer</span><span class="p">;</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">delegate</span><span class="p">.</span><span class="na">deserialize</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Erreur de désérialisation pour topic {}: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="w">            </span><span class="c1">// Optionnel : envoyer le message brut vers un topic d&#39;erreur</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errorProducer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="w">                </span><span class="n">ProducerRecord</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]&gt;</span><span class="w"> </span><span class="n">errorRecord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProducerRecord</span><span class="o">&lt;&gt;</span><span class="p">(</span>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="w">                    </span><span class="n">errorTopic</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">                </span><span class="n">errorRecord</span><span class="p">.</span><span class="na">headers</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;X-Original-Topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">topic</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a><span class="w">                </span><span class="n">errorRecord</span><span class="p">.</span><span class="na">headers</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;X-Error&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">().</span><span class="na">getBytes</span><span class="p">());</span>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="w">                </span><span class="n">errorProducer</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">errorRecord</span><span class="p">);</span>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a>
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// Retourner null permet de filtrer ensuite</span>
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a><span class="p">}</span>
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a><span class="c1">// Utilisation avec filtrage des nulls</span>
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">MyObject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">MyObject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="na">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Message ignoré (désérialisation échouée) à offset {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">offset</span><span class="p">());</span>
<a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a><span class="w">        </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a><span class="w">    </span><span class="n">process</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Spring Kafka ErrorHandlingDeserializer.</strong> Pour les applications Spring Kafka, un <code>ErrorHandlingDeserializer</code> encapsule l'erreur dans un header plutôt que de lever une exception :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="n">ErrorHandlingDeserializer</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ErrorHandlingDeserializer</span><span class="p">.</span><span class="na">VALUE_DESERIALIZER_CLASS</span><span class="p">,</span><span class="w"> </span><span class="n">JsonDeserializer</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</code></pre></div>
<p>L'erreur est accessible via <code>record.headers().lastHeader(ErrorHandlingDeserializer.VALUE_DESERIALIZER_EXCEPTION_HEADER)</code>.</p>
<p><strong>Schémas et compatibilité.</strong> La meilleure prévention des erreurs de désérialisation est une gestion rigoureuse des schémas avec Schema Registry et des règles de compatibilité. Cependant, même avec une bonne gouvernance, des erreurs peuvent survenir (messages legacy, corruption, bugs producteur).</p>
<h3 id="strategies-de-retry-avancees">Stratégies de Retry Avancées<a class="headerlink" href="#strategies-de-retry-avancees" title="Permanent link">&para;</a></h3>
<p>Quand le traitement échoue, plusieurs stratégies de retry permettent de récupérer des erreurs transitoires sans perdre de messages.</p>
<p><strong>Retry immédiat avec limite.</strong> Réessayer immédiatement un nombre limité de fois. Simple mais peut surcharger un système déjà en difficulté.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">processWithImmediateRetry</span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">maxAttempts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxAttempts</span><span class="p">;</span><span class="w"> </span><span class="n">attempt</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">            </span><span class="n">process</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// Succès</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RetriableException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attempt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">maxAttempts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">                </span><span class="n">sendToDLQ</span><span class="p">(</span><span class="n">record</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Tentative {}/{} échouée pour offset {}&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">                </span><span class="n">attempt</span><span class="p">,</span><span class="w"> </span><span class="n">maxAttempts</span><span class="p">,</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">offset</span><span class="p">());</span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Retry avec backoff exponentiel.</strong> Augmenter progressivement le délai entre les tentatives. Laisse le temps au système de récupérer.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">processWithExponentialBackoff</span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">maxAttempts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">baseDelayMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">maxDelayMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxAttempts</span><span class="p">;</span><span class="w"> </span><span class="n">attempt</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">            </span><span class="n">process</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RetriableException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attempt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">maxAttempts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">                </span><span class="n">sendToDLQ</span><span class="p">(</span><span class="n">record</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="w">                </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="w">            </span><span class="kt">long</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">baseDelayMs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">maxDelayMs</span><span class="p">);</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">            </span><span class="c1">// Ajouter du jitter pour éviter les thundering herds</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="w">            </span><span class="n">delay</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">ThreadLocalRandom</span><span class="p">.</span><span class="na">current</span><span class="p">().</span><span class="na">nextLong</span><span class="p">(</span><span class="n">delay</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Tentative {}/{} échouée, retry dans {}ms&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">attempt</span><span class="p">,</span><span class="w"> </span><span class="n">maxAttempts</span><span class="p">,</span><span class="w"> </span><span class="n">delay</span><span class="p">);</span>
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a><span class="w">                </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">);</span>
<a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">ie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a><span class="w">                </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">interrupt</span><span class="p">();</span>
<a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a><span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">ie</span><span class="p">);</span>
<a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Retry topic avec délai.</strong> Pour les erreurs nécessitant un délai plus long (système externe indisponible), envoyer vers des topics de retry avec des délais progressifs.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1">// Architecture : topic → retry-1m → retry-5m → retry-15m → dlq</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">processWithRetryTopics</span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">retryHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getHeader</span><span class="p">(</span><span class="n">record</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X-Retry-Count&quot;</span><span class="p">);</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">retryCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">retryHeader</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">retryHeader</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">        </span><span class="n">process</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RetriableException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">nextTopic</span><span class="p">;</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">retryCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="w">            </span><span class="n">nextTopic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">topic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.retry-1m&quot;</span><span class="p">;</span>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">retryCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">            </span><span class="n">nextTopic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">topic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.retry-5m&quot;</span><span class="p">;</span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">retryCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">            </span><span class="n">nextTopic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">topic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.retry-15m&quot;</span><span class="p">;</span>
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="w">            </span><span class="n">nextTopic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">topic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.dlq&quot;</span><span class="p">;</span>
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a>
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="w">        </span><span class="n">sendToTopic</span><span class="p">(</span><span class="n">nextTopic</span><span class="p">,</span><span class="w"> </span><span class="n">record</span><span class="p">,</span><span class="w"> </span><span class="n">retryCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a><span class="p">}</span>
</code></pre></div>
<p>Les topics de retry peuvent être consommés par des consommateurs dédiés qui attendent le délai approprié avant de renvoyer au topic principal.</p>
<h3 id="shutdown-gracieux">Shutdown Gracieux<a class="headerlink" href="#shutdown-gracieux" title="Permanent link">&para;</a></h3>
<p>Un arrêt gracieux permet de terminer le traitement en cours et de commiter les offsets avant de quitter, évitant le retraitement au redémarrage.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GracefulConsumer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">KafkaConsumer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="p">;</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AtomicBoolean</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AtomicBoolean</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CountDownLatch</span><span class="w"> </span><span class="n">shutdownLatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CountDownLatch</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="w">            </span><span class="n">consumer</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">));</span>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">.</span><span class="na">get</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="w">                </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">records</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">running</span><span class="p">.</span><span class="na">get</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">                        </span><span class="c1">// Arrêt demandé pendant le traitement</span>
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a><span class="w">                        </span><span class="c1">// Commiter les offsets déjà traités</span>
<a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a><span class="w">                    </span><span class="n">process</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a>
<a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">records</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a><span class="w">                    </span><span class="n">consumer</span><span class="p">.</span><span class="na">commitSync</span><span class="p">();</span>
<a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">WakeupException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a><span class="w">            </span><span class="c1">// Exception normale si shutdown appelé pendant poll()</span>
<a id="__codelineno-37-28" name="__codelineno-37-28" href="#__codelineno-37-28"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">.</span><span class="na">get</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-29" name="__codelineno-37-29" href="#__codelineno-37-29"></a><span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="p">;</span><span class="w"> </span><span class="c1">// Inattendu si on n&#39;est pas en shutdown</span>
<a id="__codelineno-37-30" name="__codelineno-37-30" href="#__codelineno-37-30"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-37-31" name="__codelineno-37-31" href="#__codelineno-37-31"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-32" name="__codelineno-37-32" href="#__codelineno-37-32"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-33" name="__codelineno-37-33" href="#__codelineno-37-33"></a><span class="w">                </span><span class="c1">// Commit final des offsets</span>
<a id="__codelineno-37-34" name="__codelineno-37-34" href="#__codelineno-37-34"></a><span class="w">                </span><span class="n">consumer</span><span class="p">.</span><span class="na">commitSync</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofSeconds</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
<a id="__codelineno-37-35" name="__codelineno-37-35" href="#__codelineno-37-35"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-36" name="__codelineno-37-36" href="#__codelineno-37-36"></a><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Échec du commit final&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-37-37" name="__codelineno-37-37" href="#__codelineno-37-37"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-38" name="__codelineno-37-38" href="#__codelineno-37-38"></a><span class="w">                </span><span class="n">consumer</span><span class="p">.</span><span class="na">close</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofSeconds</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
<a id="__codelineno-37-39" name="__codelineno-37-39" href="#__codelineno-37-39"></a><span class="w">                </span><span class="n">shutdownLatch</span><span class="p">.</span><span class="na">countDown</span><span class="p">();</span>
<a id="__codelineno-37-40" name="__codelineno-37-40" href="#__codelineno-37-40"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-37-41" name="__codelineno-37-41" href="#__codelineno-37-41"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-37-42" name="__codelineno-37-42" href="#__codelineno-37-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-43" name="__codelineno-37-43" href="#__codelineno-37-43"></a>
<a id="__codelineno-37-44" name="__codelineno-37-44" href="#__codelineno-37-44"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-45" name="__codelineno-37-45" href="#__codelineno-37-45"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Arrêt gracieux demandé&quot;</span><span class="p">);</span>
<a id="__codelineno-37-46" name="__codelineno-37-46" href="#__codelineno-37-46"></a><span class="w">        </span><span class="n">running</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-37-47" name="__codelineno-37-47" href="#__codelineno-37-47"></a><span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="na">wakeup</span><span class="p">();</span><span class="w"> </span><span class="c1">// Interrompt le poll() en cours</span>
<a id="__codelineno-37-48" name="__codelineno-37-48" href="#__codelineno-37-48"></a>
<a id="__codelineno-37-49" name="__codelineno-37-49" href="#__codelineno-37-49"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-50" name="__codelineno-37-50" href="#__codelineno-37-50"></a><span class="w">            </span><span class="c1">// Attendre la fin du traitement</span>
<a id="__codelineno-37-51" name="__codelineno-37-51" href="#__codelineno-37-51"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">completed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shutdownLatch</span><span class="p">.</span><span class="na">await</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span>
<a id="__codelineno-37-52" name="__codelineno-37-52" href="#__codelineno-37-52"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">completed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-53" name="__codelineno-37-53" href="#__codelineno-37-53"></a><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Timeout lors de l&#39;arrêt gracieux&quot;</span><span class="p">);</span>
<a id="__codelineno-37-54" name="__codelineno-37-54" href="#__codelineno-37-54"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-37-55" name="__codelineno-37-55" href="#__codelineno-37-55"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-56" name="__codelineno-37-56" href="#__codelineno-37-56"></a><span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">interrupt</span><span class="p">();</span>
<a id="__codelineno-37-57" name="__codelineno-37-57" href="#__codelineno-37-57"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-37-58" name="__codelineno-37-58" href="#__codelineno-37-58"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-59" name="__codelineno-37-59" href="#__codelineno-37-59"></a><span class="p">}</span>
<a id="__codelineno-37-60" name="__codelineno-37-60" href="#__codelineno-37-60"></a>
<a id="__codelineno-37-61" name="__codelineno-37-61" href="#__codelineno-37-61"></a><span class="c1">// Intégration avec le hook de shutdown JVM</span>
<a id="__codelineno-37-62" name="__codelineno-37-62" href="#__codelineno-37-62"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-63" name="__codelineno-37-63" href="#__codelineno-37-63"></a><span class="w">    </span><span class="n">GracefulConsumer</span><span class="w"> </span><span class="n">consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GracefulConsumer</span><span class="p">(</span><span class="n">createProps</span><span class="p">());</span>
<a id="__codelineno-37-64" name="__codelineno-37-64" href="#__codelineno-37-64"></a>
<a id="__codelineno-37-65" name="__codelineno-37-65" href="#__codelineno-37-65"></a><span class="w">    </span><span class="n">Runtime</span><span class="p">.</span><span class="na">getRuntime</span><span class="p">().</span><span class="na">addShutdownHook</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-66" name="__codelineno-37-66" href="#__codelineno-37-66"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Signal de shutdown reçu&quot;</span><span class="p">);</span>
<a id="__codelineno-37-67" name="__codelineno-37-67" href="#__codelineno-37-67"></a><span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="na">shutdown</span><span class="p">();</span>
<a id="__codelineno-37-68" name="__codelineno-37-68" href="#__codelineno-37-68"></a><span class="w">    </span><span class="p">}));</span>
<a id="__codelineno-37-69" name="__codelineno-37-69" href="#__codelineno-37-69"></a>
<a id="__codelineno-37-70" name="__codelineno-37-70" href="#__codelineno-37-70"></a><span class="w">    </span><span class="n">consumer</span><span class="p">.</span><span class="na">run</span><span class="p">();</span>
<a id="__codelineno-37-71" name="__codelineno-37-71" href="#__codelineno-37-71"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Points clés du shutdown gracieux :</strong></p>
<p><em><code>wakeup()</code></em> : Seule méthode thread-safe du consommateur, permet d'interrompre un <code>poll()</code> bloquant depuis un autre thread.</p>
<p><em>Timeout de commit final</em> : Le commit final peut échouer si le coordinateur est indisponible. Prévoir un timeout raisonnable.</p>
<p><em>Timeout de close</em> : La fermeture du consommateur notifie le coordinateur de son départ. Un timeout évite de bloquer indéfiniment.</p>
<p><em>Hook JVM</em> : Le shutdown hook garantit que le signal SIGTERM (Kubernetes, systemd) déclenche l'arrêt gracieux.</p>
<h3 id="idempotence-du-traitement">Idempotence du Traitement<a class="headerlink" href="#idempotence-du-traitement" title="Permanent link">&para;</a></h3>
<p>Même avec les meilleures pratiques, des messages peuvent être traités plusieurs fois (rééquilibrage au mauvais moment, crash après traitement mais avant commit). Le traitement doit être idempotent ou gérer explicitement les duplicatas.</p>
<p><strong>Stratégies d'idempotence :</strong></p>
<p><em>Opérations naturellement idempotentes</em> : UPSERT, PUT (vs. INSERT, POST). Le résultat est le même que l'opération soit exécutée une ou plusieurs fois.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1">// Idempotent : écraser la valeur existante</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">database</span><span class="p">.</span><span class="na">upsert</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">newValue</span><span class="p">);</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="c1">// Non idempotent : insère un nouveau record à chaque fois</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="n">database</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">newValue</span><span class="p">);</span>
</code></pre></div>
<p><em>Tracking des messages traités</em> : Stocker les IDs des messages traités et vérifier avant traitement.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">processIdempotent</span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">record</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">messageId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">topic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">partition</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="na">offset</span><span class="p">();</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">processedCache</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">messageId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Message {} déjà traité, skip&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">messageId</span><span class="p">);</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">    </span><span class="n">process</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">    </span><span class="n">processedCache</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">messageId</span><span class="p">);</span>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="p">}</span>
</code></pre></div>
<p><em>Clé de déduplication dans le message</em> : Le producteur inclut un ID unique que le consommateur utilise pour dédupliquer.</p>
<h3 id="monitoring-et-alerting">Monitoring et Alerting<a class="headerlink" href="#monitoring-et-alerting" title="Permanent link">&para;</a></h3>
<p><strong>Métriques essentielles à surveiller :</strong></p>
<table>
<thead>
<tr>
<th>Métrique</th>
<th>Seuil d'alerte</th>
<th>Signification</th>
</tr>
</thead>
<tbody>
<tr>
<td>Consumer lag</td>
<td>&gt; 10000 pendant 5 min</td>
<td>Le consommateur ne suit pas</td>
</tr>
<tr>
<td>Lag growth rate</td>
<td>Positif pendant 10 min</td>
<td>Problème de capacité persistant</td>
</tr>
<tr>
<td>Rebalance rate</td>
<td>&gt; 1/heure</td>
<td>Instabilité du groupe</td>
</tr>
<tr>
<td>Poll rate</td>
<td>&lt; attendu</td>
<td>Traitement trop lent ou consommateur bloqué</td>
</tr>
<tr>
<td>Commit latency</td>
<td>&gt; 1s</td>
<td>Problème avec le coordinateur</td>
</tr>
<tr>
<td>Error rate</td>
<td>&gt; 0.1%</td>
<td>Erreurs de traitement à investiguer</td>
</tr>
<tr>
<td>DLQ volume</td>
<td>&gt; 0</td>
<td>Messages non traités</td>
</tr>
</tbody>
</table>
<p><strong>Alertes recommandées en production :</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># Prometheus alerting rules</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="nt">groups</span><span class="p">:</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka-consumer-alerts</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConsumerLagHigh</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka_consumer_records_lag &gt; 10000</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Consumer</span><span class="nv"> </span><span class="s">lag</span><span class="nv"> </span><span class="s">élevé</span><span class="nv"> </span><span class="s">pour</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.group</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConsumerLagCritical</span>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka_consumer_records_lag &gt; 100000</span>
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Consumer</span><span class="nv"> </span><span class="s">lag</span><span class="nv"> </span><span class="s">critique</span><span class="nv"> </span><span class="s">pour</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.group</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a>
<a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FrequentRebalances</span>
<a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(kafka_consumer_rebalance_total[1h]) &gt; 2</span>
<a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Rééquilibrages</span><span class="nv"> </span><span class="s">fréquents</span><span class="nv"> </span><span class="s">pour</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.group</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-40-27" name="__codelineno-40-27" href="#__codelineno-40-27"></a>
<a id="__codelineno-40-28" name="__codelineno-40-28" href="#__codelineno-40-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DLQNonEmpty</span>
<a id="__codelineno-40-29" name="__codelineno-40-29" href="#__codelineno-40-29"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka_consumer_records_lag{topic=~&quot;.*\\.dlq&quot;} &gt; 0</span>
<a id="__codelineno-40-30" name="__codelineno-40-30" href="#__codelineno-40-30"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<a id="__codelineno-40-31" name="__codelineno-40-31" href="#__codelineno-40-31"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-40-32" name="__codelineno-40-32" href="#__codelineno-40-32"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-40-33" name="__codelineno-40-33" href="#__codelineno-40-33"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-40-34" name="__codelineno-40-34" href="#__codelineno-40-34"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Messages</span><span class="nv"> </span><span class="s">en</span><span class="nv"> </span><span class="s">DLQ</span><span class="nv"> </span><span class="s">pour</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.topic</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>
<p><strong>Dashboards recommandés :</strong></p>
<ol>
<li><em>Vue d'ensemble du groupe</em> : Nombre de membres, partitions assignées, lag total par groupe.</li>
<li><em>Lag par partition</em> : Heatmap ou graphique permettant d'identifier les partitions problématiques.</li>
<li><em>Throughput</em> : Messages/seconde et bytes/seconde par consommateur et au total.</li>
<li><em>Santé</em> : Taux d'erreur, fréquence des rééquilibrages, latence des commits.</li>
<li><em>Dead Letter Queue</em> : Volume des DLQ par topic, évolution dans le temps.</li>
</ol>
<h3 id="checklist-de-mise-en-production">Checklist de Mise en Production<a class="headerlink" href="#checklist-de-mise-en-production" title="Permanent link">&para;</a></h3>
<p><strong>Configuration :</strong>
- [ ] <code>group.id</code> unique et descriptif
- [ ] <code>client.id</code> configuré pour identification dans les métriques
- [ ] <code>enable.auto.commit=false</code> pour le commit manuel
- [ ] <code>auto.offset.reset</code> approprié (earliest ou latest selon le cas)
- [ ] Timeouts ajustés selon le temps de traitement réel
- [ ] <code>partition.assignment.strategy</code> = CooperativeStickyAssignor
- [ ] <code>group.instance.id</code> pour les déploiements rolling (optionnel)</p>
<p><strong>Résilience :</strong>
- [ ] Gestion des erreurs de désérialisation
- [ ] Stratégie de retry avec backoff
- [ ] Dead Letter Queue configurée
- [ ] Shutdown gracieux implémenté avec hook JVM
- [ ] Traitement idempotent ou gestion des duplicatas</p>
<p><strong>Monitoring :</strong>
- [ ] Métriques JMX exposées et collectées
- [ ] Alertes sur le lag configurées
- [ ] Alertes sur les rééquilibrages fréquents
- [ ] Dashboard de monitoring disponible
- [ ] Monitoring de la DLQ</p>
<p><strong>Tests :</strong>
- [ ] Tests unitaires avec MockConsumer
- [ ] Tests d'intégration avec Testcontainers
- [ ] Tests de charge validés
- [ ] Tests de résilience (kill de consommateurs, rééquilibrages forcés)
- [ ] Tests de replay (seek + retraitement)</p>
<hr />
<h2 id="iii48-resume">III.4.8 Résumé<a class="headerlink" href="#iii48-resume" title="Permanent link">&para;</a></h2>
<p>Ce chapitre a exploré en profondeur le consommateur Kafka, le composant responsable de la lecture et du traitement des messages depuis le cluster. Une maîtrise complète du consommateur est essentielle pour construire des applications réactives, scalables et fiables dans une architecture événementielle.</p>
<h3 id="architecture-et-principes-fondamentaux">Architecture et Principes Fondamentaux<a class="headerlink" href="#architecture-et-principes-fondamentaux" title="Permanent link">&para;</a></h3>
<p>Le consommateur Kafka utilise un modèle <strong>pull</strong> où il demande activement les messages aux brokers via des requêtes fetch. Cette architecture fondamentale offre plusieurs avantages distinctifs par rapport au modèle push des systèmes de messagerie traditionnels. Le consommateur contrôle naturellement son rythme de consommation, créant un backpressure naturel qui empêche la surcharge. Il peut repositionner son offset pour relire des messages, permettant le replay et la reconstruction de systèmes. Le broker n'a pas besoin de maintenir l'état de chaque consommateur, simplifiant son implémentation et améliorant sa scalabilité.</p>
<p>La <strong>boucle de consommation</strong> (poll loop) est le pattern central de toute application consommatrice. L'application appelle répétitivement <code>poll()</code> pour récupérer des lots de messages. Chaque appel à <code>poll()</code> effectue plusieurs opérations critiques simultanément : envoi de heartbeats au coordinateur pour maintenir l'appartenance au groupe, rafraîchissement des métadonnées du cluster si nécessaire, fetch de nouveaux messages depuis les brokers, et retour des messages disponibles à l'application. Le consommateur n'est pas thread-safe — tous les appels doivent provenir du même thread, ce qui simplifie l'implémentation et évite les problèmes de synchronisation coûteux.</p>
<p>La <strong>gestion des offsets</strong> est le mécanisme central pour le suivi de la progression et les garanties de livraison. L'offset courant avance automatiquement à chaque lecture, mais l'offset commité (persisté dans le topic <code>__consumer_offsets</code>) détermine le point de reprise en cas de redémarrage. Cette distinction est cruciale : le commit automatique est pratique mais dangereux pour les traitements critiques car il peut causer des pertes de messages ou des duplicatas. Le commit manuel après traitement réussi est fortement recommandé pour les applications de production où la fiabilité est importante.</p>
<h3 id="groupes-de-consommateurs-et-parallelisme">Groupes de Consommateurs et Parallélisme<a class="headerlink" href="#groupes-de-consommateurs-et-parallelisme" title="Permanent link">&para;</a></h3>
<p>Les <strong>groupes de consommateurs</strong> sont le mécanisme fondamental pour le parallélisme en Kafka. Un groupe est identifié par un <code>group.id</code> unique, et tous les consommateurs partageant ce <code>group.id</code> forment un groupe qui se partage les partitions des topics souscrits. La règle fondamentale est que chaque partition est assignée à exactement un consommateur du groupe à tout instant, garantissant que les messages d'une partition sont traités dans l'ordre par un seul consommateur.</p>
<p>Cette architecture implique que le <strong>parallélisme maximal</strong> est égal au nombre de partitions du topic. Avoir plus de consommateurs que de partitions signifie que certains consommateurs resteront inactifs, attendant qu'une partition se libère. Cette limite doit être considérée dès la conception du topic — le nombre de partitions détermine le parallélisme maximal possible pour tout le cycle de vie du topic.</p>
<p>Les groupes de consommateurs sont <strong>complètement indépendants</strong> les uns des autres. Chaque groupe maintient ses propres offsets et sa propre progression. Cette indépendance permet plusieurs patterns architecturaux puissants : diffusion d'événements vers plusieurs systèmes (chaque système a son propre groupe), scaling horizontal d'une application (toutes les instances partagent le même groupe), environnements de test isolés (le groupe de test n'interfère pas avec la production), et replay pour reconstruction (un nouveau groupe peut consommer depuis le début).</p>
<p>Le <strong>dimensionnement du groupe</strong> doit équilibrer plusieurs facteurs : le débit requis (plus de consommateurs pour plus de débit), le nombre de partitions (limite supérieure du parallélisme), les ressources disponibles (chaque consommateur consomme mémoire, CPU, connexions), et la résilience souhaitée (consommateurs en standby pour reprise rapide).</p>
<h3 id="reequilibrage-des-consommateurs">Rééquilibrage des Consommateurs<a class="headerlink" href="#reequilibrage-des-consommateurs" title="Permanent link">&para;</a></h3>
<p>Le <strong>rééquilibrage</strong> est le processus par lequel les partitions sont redistribuées entre les membres d'un groupe lors de changements de membership. Un rééquilibrage se produit quand un nouveau consommateur rejoint le groupe, quand un consommateur quitte le groupe (gracieusement ou par crash), quand le nombre de partitions d'un topic souscrit change, ou quand un consommateur change sa souscription.</p>
<p>Le protocole de rééquilibrage <strong>classique (Eager)</strong> interrompt tous les consommateurs du groupe pendant le rééquilibrage. Même les consommateurs dont les partitions ne changent pas doivent arrêter de consommer, créant une interruption « stop-the-world » qui peut durer plusieurs secondes pour les grands groupes. Ce comportement est particulièrement problématique pour les applications nécessitant une haute disponibilité.</p>
<p>Le protocole de rééquilibrage <strong>coopératif</strong> (disponible depuis Kafka 2.4) améliore significativement cette situation en permettant aux consommateurs de continuer à traiter leurs partitions non affectées pendant le rééquilibrage. Seules les partitions qui changent de propriétaire sont révoquées, et le rééquilibrage se déroule en deux phases pour minimiser les interruptions. L'utilisation du <code>CooperativeStickyAssignor</code> est fortement recommandée pour tous les nouveaux déploiements.</p>
<p>L'<strong>assignation statique</strong> (<code>group.instance.id</code>) permet à un consommateur redémarré de récupérer automatiquement ses partitions précédentes sans déclencher de rééquilibrage complet, pourvu qu'il redémarre avant l'expiration du <code>session.timeout.ms</code>. Cette fonctionnalité est particulièrement utile pour les déploiements rolling où les consommateurs redémarrent fréquemment.</p>
<h3 id="modeles-de-conception">Modèles de Conception<a class="headerlink" href="#modeles-de-conception" title="Permanent link">&para;</a></h3>
<p>Plusieurs <strong>patterns</strong> structurent les applications consommatrices selon leurs besoins spécifiques :</p>
<p>Le pattern <strong>un thread par consommateur</strong> est le plus simple et le plus courant. Chaque consommateur s'exécute dans son propre thread, préservant naturellement l'ordre de traitement et respectant la contrainte single-threaded du consommateur. Ce pattern est recommandé pour la majorité des cas d'usage.</p>
<p>Le pattern <strong>découplage fetch/traitement</strong> sépare le thread qui appelle <code>poll()</code> des threads qui traitent les messages. Cette approche permet le traitement parallèle mais complexifie significativement la gestion des offsets — quand peut-on commiter si le traitement est asynchrone ? Ce pattern nécessite une attention particulière pour éviter les pertes de messages.</p>
<p>Le pattern <strong>pause/resume</strong> utilise les méthodes <code>pause()</code> et <code>resume()</code> du consommateur pour implémenter le backpressure vers les systèmes downstream. Le consommateur met en pause les partitions quand le système downstream est surchargé et reprend quand la situation s'améliore.</p>
<p>Le pattern <strong>assignation manuelle</strong> utilise <code>assign()</code> au lieu de <code>subscribe()</code> pour un contrôle total sur les partitions consommées. Ce pattern est utile pour le replay ciblé, la migration de données, ou les cas où la coordination de groupe n'est pas souhaitée.</p>
<p>Le pattern <strong>at-least-once avec idempotence</strong> combine le commit manuel après traitement avec un traitement idempotent pour garantir qu'aucun message n'est perdu tout en gérant correctement les duplicatas inévitables.</p>
<h3 id="strategies-avancees">Stratégies Avancées<a class="headerlink" href="#strategies-avancees" title="Permanent link">&para;</a></h3>
<p>L'<strong>exactly-once sémantique</strong> de bout en bout est atteinte en combinant les transactions Kafka avec <code>isolation.level=read_committed</code> côté consommateur. Les offsets consommés et les messages produits sont commités dans la même transaction atomique, garantissant que le traitement d'un message et la production de ses résultats réussissent ou échouent ensemble.</p>
<p>La <strong>consommation multi-topic</strong> permet à un groupe de traiter plusieurs types d'événements depuis différents topics. Les abonnements peuvent être explicites (liste de topics) ou dynamiques (pattern regex). Le routing du traitement doit gérer les différents types de messages reçus.</p>
<p>Le <strong>seek</strong> permet le repositionnement des offsets pour diverses raisons : replay après correction de bug, reconstruction de systèmes downstream, saut de messages corrompus, ou reprise depuis un checkpoint externe. Le repositionnement par timestamp (<code>offsetsForTimes()</code>) est particulièrement utile pour les reprises basées sur une date.</p>
<p>Les <strong>Dead Letter Queues</strong> isolent les messages non traitables après épuisement des retry, permettant au flux principal de continuer tout en préservant les messages problématiques pour analyse et correction ultérieure. Une DLQ bien conçue inclut suffisamment de métadonnées pour diagnostiquer l'erreur et rejouer le message.</p>
<h3 id="optimisation-des-performances">Optimisation des Performances<a class="headerlink" href="#optimisation-des-performances" title="Permanent link">&para;</a></h3>
<p>Le <strong>consumer lag</strong> est la métrique reine pour évaluer la santé d'un consommateur. Le lag représente la différence entre le dernier offset produit et l'offset courant du consommateur. Un lag stable (même non nul) est acceptable — le consommateur est simplement en retard d'un montant constant. Un lag croissant est un problème qui nécessite une intervention : soit augmenter le nombre de consommateurs, soit optimiser le traitement.</p>
<p>L'optimisation du <strong>débit</strong> passe par l'augmentation du batching : <code>fetch.min.bytes</code> plus élevé force le broker à attendre plus de données avant de répondre, <code>max.poll.records</code> plus élevé permet de traiter plus de messages par appel poll(), et l'ajout de consommateurs parallèles augmente la capacité de traitement globale.</p>
<p>L'optimisation de la <strong>latence</strong> privilégie des fetch rapides et un traitement fréquent : <code>fetch.min.bytes</code> bas garantit une réponse rapide du broker, <code>fetch.max.wait.ms</code> court limite le temps d'attente, et <code>max.poll.records</code> modéré permet un retour rapide à la boucle de consommation.</p>
<p>Les <strong>timeouts</strong> doivent être soigneusement configurés pour éviter les faux positifs (éjection d'un consommateur fonctionnel) tout en détectant rapidement les vraies pannes. <code>session.timeout.ms</code> contrôle la détection des pannes, <code>heartbeat.interval.ms</code> doit être environ 1/3 du session timeout, et <code>max.poll.interval.ms</code> doit accommoder le temps de traitement réel entre les polls.</p>
<h3 id="resilience-et-operations">Résilience et Opérations<a class="headerlink" href="#resilience-et-operations" title="Permanent link">&para;</a></h3>
<p>Les consommateurs résilients implémentent plusieurs mécanismes de protection :</p>
<p>La <strong>gestion des erreurs de désérialisation</strong> évite qu'un seul message malformé ne bloque tout le consommateur. Un désérialiseur avec gestion d'erreur peut logger l'erreur, envoyer le message brut vers un topic d'erreur, et retourner null pour permettre au traitement de continuer.</p>
<p>Les <strong>stratégies de retry</strong> avec backoff exponentiel permettent de récupérer des erreurs transitoires sans surcharger les systèmes en difficulté. Le jitter (variation aléatoire) évite les « thundering herds » où tous les retry arrivent simultanément.</p>
<p>Le <strong>shutdown gracieux</strong> termine le traitement en cours et commite les offsets avant de quitter, évitant le retraitement au redémarrage. L'intégration avec le hook de shutdown JVM garantit que les signaux système (SIGTERM) déclenchent l'arrêt gracieux.</p>
<p>L'<strong>idempotence du traitement</strong> garantit que le même message peut être traité plusieurs fois avec le même résultat, gérant correctement les duplicatas inévitables lors des rééquilibrages ou des reprises.</p>
<p>Le <strong>monitoring</strong> du lag, des rééquilibrages, et du taux d'erreur permet de détecter les problèmes avant qu'ils n'impactent les utilisateurs. Les alertes doivent être actionnables — un lag croissant nécessite une action, pas seulement une notification.</p>
<hr />
<h3 id="vers-le-chapitre-suivant">Vers le Chapitre Suivant<a class="headerlink" href="#vers-le-chapitre-suivant" title="Permanent link">&para;</a></h3>
<p>Ce chapitre a couvert la consommation de messages — comment les applications lisent et traitent depuis Kafka. Le chapitre suivant, « Cas d'Utilisation Kafka », explorera quand utiliser Kafka, comment naviguer les implémentations en contexte réel, et les alternatives à considérer selon les cas d'usage.</p>
<p>La maîtrise de la production (chapitre III.3) et de la consommation (ce chapitre) permet à l'architecte de concevoir des pipelines événementiels complets, de bout en bout, avec les garanties appropriées à chaque cas d'usage métier.</p>
<hr />
<p><em>Volume III : Apache Kafka - Guide de l'Architecte</em></p>
<p><em>Chapitre III.4 — Création d'Applications Consommatrices</em></p>
<p><em>Monographie « L'Entreprise Agentique »</em></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Retour en haut de la page
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/agbruneau/CorpusInformatique" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "toc.integrate", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>