
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Corpus encyclopédique francophone — science informatique, interopérabilité et entreprise agentique">
      
      
        <meta name="author" content="André-Guy Bruneau">
      
      
        <link rel="canonical" href="https://agbruneau.github.io/CorpusInformatique/III%20-%20Entreprise%20Agentique/Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.11_Operer_Kafka/">
      
      
        <link rel="prev" href="../Chapitre_III.10_Organisation_Projet_Kafka/">
      
      
        <link rel="next" href="../Chapitre_III.12_Avenir_Kafka/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>III.11 — Opérer Kafka - Corpus Informatique</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapitre-iii11-operer-kafka" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../../.." title="Corpus Informatique" class="md-header__button md-logo" aria-label="Corpus Informatique" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Corpus Informatique
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              III.11 — Opérer Kafka
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/agbruneau/CorpusInformatique" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    agbruneau/CorpusInformatique
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Onglets" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Accueil

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.1_Fondements_Logiques_Raisonnement/" class="md-tabs__link">
          
  
  
    
  
  I — Science et Génie Informatique

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.1_Introduction_Problematique/" class="md-tabs__link">
          
  
  
    
  
  II — Interopérabilité

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.1_Crise_Integration_Systemique/" class="md-tabs__link">
          
  
  
    
  
  III — Entreprise Agentique

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Corpus Informatique" class="md-nav__button md-logo" aria-label="Corpus Informatique" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Corpus Informatique
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/agbruneau/CorpusInformatique" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    agbruneau/CorpusInformatique
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    I — Science et Génie Informatique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    I — Science et Génie Informatique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume I — Fondements Mathématiques et Théorie de l'Informatique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume I — Fondements Mathématiques et Théorie de l'Informatique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.1_Fondements_Logiques_Raisonnement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.1 — Fondements logiques et raisonnement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.2_Structures_Discretes_Combinatoire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.2 — Structures discrètes et combinatoire
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.3_Theorie_Graphes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.3 — Théorie des graphes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.4_Langages_Formels_Automates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.4 — Langages formels et automates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.5_Calculabilite_Decidabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.5 — Calculabilité et décidabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.6_Theorie_Complexite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.6 — Théorie de la complexité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume II — Architecture des Ordinateurs et Systèmes Numériques
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume II — Architecture des Ordinateurs et Systèmes Numériques
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.7_Systemes_Numeriques_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.7 — Systèmes numériques et données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.8_Circuits_Combinatoires/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.8 — Circuits combinatoires
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.9_Circuits_Sequentiels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.9 — Circuits séquentiels
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.10_Conception_Systeme_HDL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.10 — Conception système HDL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.11_Architecture_ISA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.11 — Architecture ISA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.12_Conception_CPU/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.12 — Conception CPU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.13_Parallelisme_ILP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.13 — Parallélisme ILP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.14_Hierarchie_Memoire_Stockage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.14 — Hiérarchie mémoire et stockage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.15_Systemes_IO_Accelere/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.15 — Systèmes I/O accélérés
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume III — Systèmes d'Exploitation, Langages et Environnements
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume III — Systèmes d'Exploitation, Langages et Environnements
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.16_Systemes_Exploitation_OS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.16 — Systèmes d'exploitation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.17_Gestion_Concurrence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.17 — Gestion de la concurrence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.18_Gestion_Memoire_Fichiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.18 — Gestion mémoire et fichiers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.19_Conception_Langages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.19 — Conception des langages
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.20_Compilation_Interpretation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.20 — Compilation et interprétation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.21_Environnements_Virtualisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.21 — Environnements et virtualisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume IV — Structures de Données, Algorithmique et Génie Logiciel
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume IV — Structures de Données, Algorithmique et Génie Logiciel
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.22_Structures_Donnees_Fondamentales/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.22 — Structures de données fondamentales
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.23_Structures_Donnees_Avancees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.23 — Structures de données avancées
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.24_Conception_Analyse_Algorithmes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.24 — Conception et analyse d'algorithmes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.25_Algorithmes_Graphes_Avances/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.25 — Algorithmes de graphes avancés
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.26_Processus_Developpement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.26 — Processus de développement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.27_Architecture_Logicielle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.27 — Architecture logicielle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.28_Qualite_Test_Maintenance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.28 — Qualité, test et maintenance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.29_DevOps_SRE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.29 — DevOps et SRE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume V — Données, Réseaux, Cloud et Sécurité
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume V — Données, Réseaux, Cloud et Sécurité
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.30_SGBD_Fondements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.30 — SGBD fondements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.31_SGBD_Implementation_Transactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.31 — SGBD implémentation et transactions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.32_Donnees_Modernes_BigData/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.32 — Données modernes et Big Data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.33_Fondements_Reseaux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.33 — Fondements des réseaux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.34_Protocoles_Internetworking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.34 — Protocoles et internetworking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.35_Systemes_Distribues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.35 — Systèmes distribués
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.36_Cloud_Infrastructures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.36 — Cloud et infrastructures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.37_Fondements_Securite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.37 — Fondements de la sécurité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.38_Cryptographie_Appliquee/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.38 — Cryptographie appliquée
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.39_Securite_Reseaux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.39 — Sécurité des réseaux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.40_Securite_Systemes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.40 — Sécurité des systèmes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume VI — Intelligence Artificielle et Systèmes Interactifs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume VI — Intelligence Artificielle et Systèmes Interactifs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.41_Fondements_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.41 — Fondements de l'IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.42_Connaissance_Raisonnement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.42 — Connaissance et raisonnement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.43_ML_Fondements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.43 — ML fondements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.44_DeepLearning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.44 — Deep Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.45_Reinforcement_Learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.45 — Reinforcement Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.46_TALN_NLP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.46 — TALN / NLP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.47_Vision_Ordinateur/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.47 — Vision par ordinateur
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.48_Infographie_Visualisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.48 — Infographie et visualisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.49_IHM_HCI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.49 — IHM / HCI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.50_Robotique_IoT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.50 — Robotique et IoT
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume VII — Technologies Émergentes et Frontières
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume VII — Technologies Émergentes et Frontières
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.51_Informatique_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.51 — Informatique quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.52_Algorithmes_Cryptographie_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.52 — Algorithmes et cryptographie quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.53_HPC_Exascale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.53 — HPC et exascale
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.54_Architectures_Post_Moore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.54 — Architectures post-Moore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.55_Modeles_Fondateurs_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.55 — Modèles fondateurs IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.56_AGI_Alignement_Securite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.56 — AGI, alignement et sécurité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.57_Sciences_Computationnelles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.57 — Sciences computationnelles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.58_CyberPhysiques_Jumeaux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.58 — Systèmes cyber-physiques et jumeaux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.59_Web3_Decentralise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.59 — Web3 et décentralisé
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.60_Synthese_Frontieres/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.60 — Synthèse et frontières
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume VIII — Convergence AGI–Quantique : Fondements et Algorithmes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume VIII — Convergence AGI–Quantique : Fondements et Algorithmes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.61_Introduction_Informatique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.61 — Introduction à l'informatique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.62_Convergence_AGI_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.62 — Convergence AGI-quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.63_Evolution_IA_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.63 — Évolution IA-quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.64_Reseaux_Neuronaux_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.64 — Réseaux neuronaux quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.65_Algorithmes_Evolutionnaires_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.65 — Algorithmes évolutionnaires quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.66_Renforcement_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.66 — Renforcement quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.67_Architectures_Hybrides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.67 — Architectures hybrides
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.68_SVM_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.68 — SVM quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.69_Codage_Donnees_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.69 — Codage de données quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.70_Scalabilite_Correction_Erreurs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.70 — Scalabilité et correction d'erreurs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume IX — Convergence AGI–Quantique : Applications et Perspectives
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume IX — Convergence AGI–Quantique : Applications et Perspectives
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.71_TALN_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.71 — TALN quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.72_Securite_Confidentialite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.72 — Sécurité et confidentialité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.73_Ethique_Reglementaire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.73 — Éthique et réglementaire
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.74_Implementation_Materielle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.74 — Implémentation matérielle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.75_Middleware_Software/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.75 — Middleware et software
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.76_Etudes_Cas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.76 — Études de cas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.77_Durabilite_Energie/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.77 — Durabilité et énergie
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.78_Metriques_Bancs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.78 — Métriques et bancs d'essai
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.79_Perspectives_Avenir/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.79 — Perspectives d'avenir
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.80_Infrastructure_Centres_Donnees_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.80 — Infrastructure et centres de données IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    II — Interopérabilité
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    II — Interopérabilité
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.1_Introduction_Problematique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.1 — Introduction et problématique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.2_Fondements_Theoriques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.2 — Fondements théoriques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.3_Integration_Applications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.3 — Intégration des applications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.4_Integration_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.4 — Intégration des données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.5_Integration_Evenements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.5 — Intégration des événements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.6_Standards_Contrats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.6 — Standards et contrats
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.7_Resilience_Observabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.7 — Résilience et observabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.8_Collaboration_Automatisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.8 — Collaboration et automatisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.9_Architecture_Reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.9 — Architecture de référence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.10_Order_to_Cash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.10 — Order-to-Cash
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.11_Entreprise_Agentique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.11 — Entreprise agentique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.12_Securite_Identite_Conformite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.12 — Sécurité, identité et conformité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.A_Annexes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Annexes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    III — Entreprise Agentique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    III — Entreprise Agentique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume I — Fondations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume I — Fondations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.1_Crise_Integration_Systemique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.1 — Crise d'intégration systémique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.2_Fondements_Dimensions_Interoperabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.2 — Fondements et dimensions de l'interopérabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.3_Cadres_Reference_Standards_Maturite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.3 — Cadres de référence, standards et maturité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.4_Principes_Architecture_Reactive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.4 — Principes d'architecture réactive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.5_Ecosysteme_API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.5 — Écosystème API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.6_Architecture_Evenements_EDA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.6 — Architecture événements (EDA)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.7_Contrats_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.7 — Contrats de données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.8_Conception_Implementation_Observabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.8 — Conception et implémentation de l'observabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.9_Etudes_Cas_Architecturales/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.9 — Études de cas architecturales
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.10_Limites_Interoperabilite_Semantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.10 — Limites de l'interopérabilité sémantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.11_IA_Moteur_Interoperabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.11 — IA moteur d'interopérabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.12_Definition_Interoperabilite_Cognitivo_Adaptative/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.12 — Définition de l'interopérabilité cognitivo-adaptative
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.13_Ere_IA_Agentique_Modele_Travailleur_Numerique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.13 — Ère IA agentique et modèle du travailleur numérique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.14_Maillage_Agentique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.14 — Maillage agentique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.15_Ingenierie_Systemes_Cognitifs_Protocoles_Interaction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.15 — Ingénierie des systèmes cognitifs et protocoles d'interaction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.16_Modele_Operationnel_Symbiose_Humain_Agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.16 — Modèle opérationnel de symbiose humain-agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.17_Gouvernance_Constitutionnelle_Alignement_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.17 — Gouvernance constitutionnelle et alignement IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.18_AgentOps_Industrialisation_Securisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.18 — AgentOps : industrialisation et sécurisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.19_Architecte_Intentions_Role_Sociotechnique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.19 — Architecte des intentions : rôle sociotechnique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.20_Cockpit_Berger_Intention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.20 — Cockpit du berger d'intention
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.21_Feuille_Route_Transformation_Agentique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.21 — Feuille de route de la transformation agentique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.22_Gestion_Strategique_Portefeuille_Applicatif_APM_Cognitif/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.22 — Gestion stratégique du portefeuille applicatif (APM cognitif)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.23_Patrons_Modernisation_Agentification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.23 — Patrons de modernisation et agentification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.24_Industrialisation_Ingenierie_Plateforme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.24 — Industrialisation et ingénierie de plateforme
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.25_Economie_Cognitive_Diplomatie_Algorithmique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.25 — Économie cognitive et diplomatie algorithmique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.26_Gestion_Risques_Systemiques_Superalignement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.26 — Gestion des risques systémiques et superalignement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.27_Prospective_Agent_Auto_Architecturant_AGI_Entreprise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.27 — Prospective : agent auto-architecturant et AGI d'entreprise
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.28_Conclusion_Architecture_Intentionnelle_Sagesse_Collective/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.28 — Conclusion : architecture intentionnelle et sagesse collective
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume II — Infrastructure Agentique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume II — Infrastructure Agentique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.1_Ingenierie_Plateforme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.1 — Ingénierie de plateforme
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.2_Fondamentaux_Apache_Kafka_Confluent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.2 — Fondamentaux Apache Kafka et Confluent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.3_Conception_Modelisation_Flux_Evenements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.3 — Conception et modélisation des flux d'événements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.4_Contrats_Donnees_Gouvernance_Semantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.4 — Contrats de données et gouvernance sémantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.5_Flux_Temps_Reel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.5 — Flux temps réel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.6_Google_Cloud_Vertex_AI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.6 — Google Cloud et Vertex AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.7_Ingenierie_Contexte_RAG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.7 — Ingénierie de contexte et RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.8_Integration_Backbone_Evenementiel_Couche_Cognitive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.8 — Intégration backbone événementiel et couche cognitive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.9_Patrons_Architecturaux_Avances_AEM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.9 — Patrons architecturaux avancés (AEM)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.10_Pipelines_CI_CD_Deploiement_Agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.10 — Pipelines CI/CD et déploiement d'agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.11_Observabilite_Comportementale_Monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.11 — Observabilité comportementale et monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.12_Tests_Evaluation_Simulation_Systemes_Multi_Agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.12 — Tests, évaluation et simulation de systèmes multi-agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.13_Paysage_Menaces_Securite_Systemes_Agentiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.13 — Paysage des menaces et sécurité des systèmes agentiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.14_Securisation_Infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.14 — Sécurisation de l'infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.15_Conformite_Reglementaire_Gestion_Confidentialite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.15 — Conformité réglementaire et gestion de la confidentialité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume III — Apache Kafka : Guide de l'Architecte
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume III — Apache Kafka : Guide de l'Architecte
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.1_Decouvrir_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.1 — Découvrir Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.2_Architecture_Cluster_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.2 — Architecture du cluster Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.3_Clients_Kafka_Production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.3 — Clients Kafka en production
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.4_Applications_Consommatrices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.4 — Applications consommatrices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.5_Cas_Utilisation_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.5 — Cas d'utilisation Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.6_Contrats_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.6 — Contrats de données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.7_Patrons_Interaction_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.7 — Patrons d'interaction Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.8_Conception_Application_Streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.8 — Conception d'application streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.9_Gestion_Kafka_Entreprise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.9 — Gestion Kafka en entreprise
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.10_Organisation_Projet_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.10 — Organisation d'un projet Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    III.11 — Opérer Kafka
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    III.11 — Opérer Kafka
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii111-evolution-et-mises-a-niveau-du-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.1 Évolution et Mises à Niveau du Cluster
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.11.1 Évolution et Mises à Niveau du Cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iii1111-strategie-de-gestion-des-versions" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.1.1 Stratégie de Gestion des Versions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1112-migration-de-zookeeper-vers-kraft" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.1.2 Migration de ZooKeeper vers KRaft
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1113-rolling-upgrades-et-zero-downtime" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.1.3 Rolling Upgrades et Zero-Downtime
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1114-gestion-des-protocoles-et-compatibilite" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.1.4 Gestion des Protocoles et Compatibilité
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii112-mobilite-des-donnees" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.2 Mobilité des Données
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.11.2 Mobilité des Données">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iii1121-replication-inter-clusters-avec-mirrormaker-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.2.1 Réplication Inter-Clusters avec MirrorMaker 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1122-gestion-du-lag-de-replication" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.2.2 Gestion du Lag de Réplication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1123-migration-de-topics-entre-clusters" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.2.3 Migration de Topics entre Clusters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii113-surveillance-du-cluster-kafka" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.3 Surveillance du Cluster Kafka
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.11.3 Surveillance du Cluster Kafka">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iii1131-architecture-dobservabilite" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.3.1 Architecture d'Observabilité
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1132-metriques-essentielles-des-brokers" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.3.2 Métriques Essentielles des Brokers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1133-metriques-des-producers-et-consumers" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.3.3 Métriques des Producers et Consumers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1134-surveillance-des-topics-et-partitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.3.4 Surveillance des Topics et Partitions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1135-centralisation-des-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.3.5 Centralisation des Logs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii114-clinique-doptimisation-des-performances" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.4 Clinique d'Optimisation des Performances
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.11.4 Clinique d&#39;Optimisation des Performances">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iii1141-diagnostic-des-problemes-de-performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.4.1 Diagnostic des Problèmes de Performance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1142-optimisation-des-producers" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.4.2 Optimisation des Producers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1143-optimisation-des-consumers" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.4.3 Optimisation des Consumers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1144-optimisation-des-brokers" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.4.4 Optimisation des Brokers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1145-gestion-des-hot-partitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.4.5 Gestion des Hot Partitions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii115-reprise-apres-sinistre-et-basculement" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.5 Reprise Après Sinistre et Basculement
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III.11.5 Reprise Après Sinistre et Basculement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iii1151-strategies-de-continuite-dactivite" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.5.1 Stratégies de Continuité d'Activité
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1152-procedure-de-basculement" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.5.2 Procédure de Basculement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1153-procedure-de-retour-failback" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.5.3 Procédure de Retour (Failback)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1154-tests-de-reprise-apres-sinistre" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.5.4 Tests de Reprise Après Sinistre
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iii1155-documentation-et-runbooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        III.11.5.5 Documentation et Runbooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-2-titre" class="md-nav__link">
    <span class="md-ellipsis">
      
        Étape 2: [Titre]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rollback" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rollback
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#escalade" class="md-nav__link">
    <span class="md-ellipsis">
      
        Escalade
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#historique-des-modifications" class="md-nav__link">
    <span class="md-ellipsis">
      
        Historique des modifications
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_III.12_Avenir_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.12 — L'avenir de Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume IV — Apache Iceberg et Lakehouse
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume IV — Apache Iceberg et Lakehouse
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.1_Monde_Lakehouse_Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.1 — Le monde Lakehouse et Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.2_Anatomie_Technique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.2 — Anatomie technique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.3_Mise_Pratique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.3 — Mise en pratique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.4_Preparer_Passage_Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.4 — Préparer le passage à Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.5_Selection_Couche_Stockage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.5 — Sélection de la couche de stockage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.6_Architecture_Couche_Ingestion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.6 — Architecture de la couche d'ingestion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.7_Implementation_Couche_Catalogue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.7 — Implémentation de la couche catalogue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.8_Conception_Couche_Federation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.8 — Conception de la couche de fédération
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.9_Comprendre_Couche_Consommation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.9 — Comprendre la couche de consommation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.10_Maintenir_Lakehouse_Production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.10 — Maintenir le Lakehouse en production
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.11_Operationnaliser_Apache_Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.11 — Opérationnaliser Apache Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.12_Evolution_Streaming_Lakehouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.12 — Évolution du streaming Lakehouse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.13_Securite_Gouvernance_Conformite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.13 — Sécurité, gouvernance et conformité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.14_Integration_Microsoft_Fabric_PowerBI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.14 — Intégration Microsoft Fabric et Power BI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.15_Contexte_Canadien_Etudes_Cas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.15 — Contexte canadien et études de cas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.16_Conclusion_Perspectives_2026_2030/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.16 — Conclusion et perspectives 2026-2030
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.Annexe_A_Specification_Apache_Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Annexe A — Spécification Apache Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.Annexe_B_Glossaire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Annexe B — Glossaire
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume V — Développeur Renaissance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume V — Développeur Renaissance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.0_Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.0 — Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.1_Convergence_Ages_Or/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.1 — Convergence des âges d'or
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.2_Curiosite_Appliquee/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.2 — Curiosité appliquée
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.3_Pensee_Systemique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.3 — Pensée systémique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.4_Nouvelle_Communication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.4 — Nouvelle communication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.5_Imperatif_Qualite_Responsabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.5 — Impératif qualité et responsabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.6_Capital_Humain_Profil_Polymathe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.6 — Capital humain et profil polymathe
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.7_Art_Batir_Futur/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.7 — L'art de bâtir le futur
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.8_Bibliotheque_Developpeur_Renaissance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.8 — Bibliothèque du développeur Renaissance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.9_Mandat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.9 — Mandat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.10_Spec_Driven_Development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.10 — Spec-Driven Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="chapitre-iii11-operer-kafka">Chapitre III.11 - Opérer Kafka<a class="headerlink" href="#chapitre-iii11-operer-kafka" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>L'exploitation d'un cluster Kafka en production représente un défi permanent qui exige vigilance, expertise et méthodologie. Contrairement à de nombreuses technologies où le déploiement initial constitue l'essentiel de l'effort, Kafka révèle sa complexité dans la durée : évolutions de versions, croissance des volumes, incidents imprévus et exigences de continuité d'activité testent quotidiennement les équipes opérationnelles.</p>
<p>Ce chapitre adopte la perspective de l'architecte responsable de la pérennité opérationnelle d'une plateforme Kafka. Il couvre les cinq dimensions critiques de l'exploitation : l'évolution et les mises à niveau du cluster, la mobilité des données entre environnements et régions, la surveillance approfondie, l'optimisation continue des performances, et les stratégies de reprise après sinistre.</p>
<p>L'enjeu dépasse la simple disponibilité technique. Un cluster Kafka mal opéré accumule une dette opérationnelle qui compromet progressivement sa capacité à servir les besoins métier. Les mises à niveau retardées créent des vulnérabilités de sécurité. Les problèmes de performance non diagnostiqués érodent la confiance des équipes applicatives. Les lacunes dans la préparation aux sinistres se révèlent au pire moment. À l'inverse, une exploitation rigoureuse transforme Kafka en infrastructure de confiance sur laquelle l'organisation peut bâtir sa stratégie événementielle.</p>
<hr />
<h2 id="iii111-evolution-et-mises-a-niveau-du-cluster">III.11.1 Évolution et Mises à Niveau du Cluster<a class="headerlink" href="#iii111-evolution-et-mises-a-niveau-du-cluster" title="Permanent link">&para;</a></h2>
<h3 id="iii1111-strategie-de-gestion-des-versions">III.11.1.1 Stratégie de Gestion des Versions<a class="headerlink" href="#iii1111-strategie-de-gestion-des-versions" title="Permanent link">&para;</a></h3>
<p>La gestion des versions Kafka constitue un équilibre délicat entre stabilité opérationnelle et accès aux nouvelles fonctionnalités. Apache Kafka maintient une cadence de release soutenue, avec des versions majeures annuelles et des versions mineures trimestrielles.</p>
<p><strong>Cycle de vie des versions Kafka</strong></p>
<table>
<thead>
<tr>
<th>Type de version</th>
<th>Fréquence</th>
<th>Contenu</th>
<th>Support typique</th>
</tr>
</thead>
<tbody>
<tr>
<td>Majeure (X.0)</td>
<td>Annuelle</td>
<td>Nouvelles fonctionnalités majeures, breaking changes potentiels</td>
<td>2-3 ans</td>
</tr>
<tr>
<td>Mineure (X.Y)</td>
<td>Trimestrielle</td>
<td>Fonctionnalités incrémentales, améliorations</td>
<td>1 an</td>
</tr>
<tr>
<td>Patch (X.Y.Z)</td>
<td>Ad hoc</td>
<td>Corrections de bugs, vulnérabilités</td>
<td>Jusqu'à la prochaine mineure</td>
</tr>
</tbody>
</table>
<p><strong>Politique de mise à niveau recommandée</strong></p>
<p>L'architecte doit définir une politique claire qui équilibre risque et bénéfice :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Exemple de politique de mise à niveau</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nt">upgrade_policy</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">security_patches</span><span class="p">:</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="nt">delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7_days</span><span class="w">          </span><span class="c1"># Validation minimale en staging</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="nt">approval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ops_team</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="nt">rollout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">immediate_after_validation</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">  </span><span class="nt">minor_versions</span><span class="p">:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="nt">delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30_days</span><span class="w">         </span><span class="c1"># Attendre retours communauté</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">    </span><span class="nt">approval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">architecture_review</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">    </span><span class="nt">rollout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quarterly_maintenance_window</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">  </span><span class="nt">major_versions</span><span class="p">:</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">    </span><span class="nt">delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90_days</span><span class="w">         </span><span class="c1"># Validation approfondie</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">    </span><span class="nt">approval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">steering_committee</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="nt">rollout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">planned_project</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="nt">prerequisites</span><span class="p">:</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">full_regression_testing</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">performance_baseline</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rollback_plan_validated</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">documentation_updated</span>
</code></pre></div>
<blockquote>
<p><strong>Décision architecturale</strong></p>
<p><em>Contexte</em> : Une institution financière utilise Kafka 3.4 et doit décider de la mise à niveau vers Kafka 3.7 (dernière version stable).</p>
<p><em>Options</em> : (1) Mise à niveau immédiate pour bénéficier des améliorations KRaft, (2) Attente de la version 4.0 pour une migration majeure unique.</p>
<p><em>Décision</em> : Mise à niveau vers 3.7 avec migration KRaft planifiée. La dette technique accumulée en retardant les mises à niveau dépasse le coût d'une migration intermédiaire. De plus, les correctifs de sécurité de 3.4 arrivent en fin de support.</p>
</blockquote>
<h3 id="iii1112-migration-de-zookeeper-vers-kraft">III.11.1.2 Migration de ZooKeeper vers KRaft<a class="headerlink" href="#iii1112-migration-de-zookeeper-vers-kraft" title="Permanent link">&para;</a></h3>
<p>La migration vers KRaft (Kafka Raft) représente l'évolution architecturale majeure de Kafka depuis sa création. KRaft élimine la dépendance à ZooKeeper en intégrant la gestion des métadonnées directement dans les brokers Kafka.</p>
<p><strong>Avantages de KRaft</strong></p>
<table>
<thead>
<tr>
<th>Dimension</th>
<th>ZooKeeper</th>
<th>KRaft</th>
<th>Bénéfice</th>
</tr>
</thead>
<tbody>
<tr>
<td>Architecture</td>
<td>Cluster séparé à maintenir</td>
<td>Intégré aux brokers</td>
<td>Simplification opérationnelle</td>
</tr>
<tr>
<td>Scalabilité</td>
<td>Limite ~200K partitions</td>
<td>Millions de partitions</td>
<td>Croissance sans contrainte</td>
</tr>
<tr>
<td>Temps de récupération</td>
<td>Minutes (élection leader)</td>
<td>Secondes</td>
<td>Disponibilité améliorée</td>
</tr>
<tr>
<td>Complexité déploiement</td>
<td>Double cluster</td>
<td>Cluster unique</td>
<td>Réduction des coûts</td>
</tr>
</tbody>
</table>
<p><strong>Processus de migration</strong></p>
<p>La migration s'effectue en plusieurs phases pour minimiser les risques :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Phase 1: Préparation
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>├── Validation version Kafka ≥ 3.3
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>├── Audit des configurations ZooKeeper-spécifiques
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>├── Tests en environnement isolé
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>└── Formation des équipes
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>Phase 2: Mode hybride
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>├── Ajout des contrôleurs KRaft
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>├── Migration des métadonnées
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>├── Validation fonctionnelle
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>└── Surveillance intensive
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>Phase 3: Basculement
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>├── Désactivation de ZooKeeper
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>├── Reconfiguration des clients (si nécessaire)
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>├── Décommissionnement ZooKeeper
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>└── Documentation mise à jour
</code></pre></div>
<p><strong>Script de migration KRaft</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="c1"># scripts/migrate_to_kraft.sh</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="nv">KAFKA_HOME</span><span class="o">=</span><span class="s2">&quot;/opt/kafka&quot;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="nv">CLUSTER_ID</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>/var/kafka/cluster_id<span class="k">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Phase 1: Génération des métadonnées KRaft ===&quot;</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="c1"># Créer le répertoire des métadonnées KRaft</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/kafka/kraft-combined-logs
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="c1"># Formater le stockage KRaft</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="nv">$KAFKA_HOME</span>/bin/kafka-storage.sh<span class="w"> </span>format<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span>--config<span class="w"> </span><span class="nv">$KAFKA_HOME</span>/config/kraft/server.properties<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span>--cluster-id<span class="w"> </span><span class="nv">$CLUSTER_ID</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">    </span>--ignore-formatted
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Phase 2: Migration des métadonnées depuis ZooKeeper ===&quot;</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="c1"># Exporter les métadonnées ZooKeeper</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="nv">$KAFKA_HOME</span>/bin/kafka-metadata.sh<span class="w"> </span>snapshot<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">    </span>--snapshot<span class="w"> </span>/tmp/kraft-snapshot<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">    </span>--cluster-id<span class="w"> </span><span class="nv">$CLUSTER_ID</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="c1"># Vérifier l&#39;intégrité de la migration</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="nv">$KAFKA_HOME</span>/bin/kafka-metadata.sh<span class="w"> </span>verify<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">    </span>--snapshot<span class="w"> </span>/tmp/kraft-snapshot<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">    </span>--cluster-id<span class="w"> </span><span class="nv">$CLUSTER_ID</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Phase 3: Démarrage en mode KRaft ===&quot;</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="c1"># Les brokers doivent être redémarrés avec la nouvelle configuration</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="c1"># Ceci est géré par le rolling restart orchestré</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Migration préparée. Exécuter le rolling restart avec la nouvelle configuration.&quot;</span>
</code></pre></div>
<blockquote>
<p><strong>Note de terrain</strong></p>
<p><em>Contexte</em> : Migration KRaft d'un cluster Kafka de 15 brokers dans une entreprise de commerce électronique.</p>
<p><em>Défi</em> : Le cluster gérait 50 000 topics avec des centaines de milliers de partitions. La migration devait s'effectuer sans interruption de service pendant la période des fêtes.</p>
<p><em>Solution</em> : Migration en trois phases étalées sur 6 semaines avec fenêtres de maintenance nocturnes. Déploiement de contrôleurs KRaft dédiés avant la migration pour valider la stabilité.</p>
<p><em>Leçon</em> : Prévoir un temps de coexistence ZooKeeper/KRaft plus long que prévu initialement. Les comportements subtils ne se révèlent qu'en production avec charge réelle.</p>
</blockquote>
<h3 id="iii1113-rolling-upgrades-et-zero-downtime">III.11.1.3 Rolling Upgrades et Zero-Downtime<a class="headerlink" href="#iii1113-rolling-upgrades-et-zero-downtime" title="Permanent link">&para;</a></h3>
<p>Les mises à niveau sans interruption exploitent la réplication Kafka pour maintenir la disponibilité pendant le processus.</p>
<p><strong>Prérequis pour le rolling upgrade</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Vérifications pré-upgrade</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nt">prerequisites</span><span class="p">:</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="nt">cluster_health</span><span class="p">:</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">all_brokers_online</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">under_replicated_partitions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">offline_partitions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">isr_shrink_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span><span class="nt">configuration</span><span class="p">:</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">min_insync_replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">≥ 2</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">replication_factor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">≥ 3</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">unclean_leader_election</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">disk_usage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt; 70%</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cpu_headroom</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span><span class="err"> 30%</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">network_headroom</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span><span class="err"> 30%</span>
</code></pre></div>
<p><strong>Procédure de rolling upgrade</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1"># scripts/rolling_upgrade.sh</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="nv">BROKERS</span><span class="o">=</span><span class="s2">&quot;kafka-1 kafka-2 kafka-3 kafka-4 kafka-5&quot;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="nv">NEW_VERSION</span><span class="o">=</span><span class="s2">&quot;3.7.0&quot;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="nv">KAFKA_HOME</span><span class="o">=</span><span class="s2">&quot;/opt/kafka&quot;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>wait_for_isr_sync<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">broker_id</span><span class="o">=</span><span class="nv">$1</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Attente de la synchronisation ISR pour broker </span><span class="nv">$broker_id</span><span class="s2">...&quot;</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">        </span><span class="nv">under_replicated</span><span class="o">=</span><span class="k">$(</span><span class="nv">$KAFKA_HOME</span>/bin/kafka-topics.sh<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">            </span>--bootstrap-server<span class="w"> </span>localhost:9092<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">            </span>--describe<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">            </span>--under-replicated-partitions<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="k">)</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$under_replicated</span><span class="s2">&quot;</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ISR synchronisé pour toutes les partitions&quot;</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Partitions sous-répliquées: </span><span class="nv">$under_replicated</span><span class="s2">. Attente...&quot;</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">        </span>sleep<span class="w"> </span><span class="m">30</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">    </span><span class="k">done</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="o">}</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>controlled_shutdown<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">broker</span><span class="o">=</span><span class="nv">$1</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Arrêt contrôlé de </span><span class="nv">$broker</span><span class="s2">...&quot;</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">    </span>ssh<span class="w"> </span><span class="nv">$broker</span><span class="w"> </span><span class="s2">&quot;sudo systemctl stop kafka&quot;</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">    </span><span class="c1"># Attendre que le broker soit complètement arrêté</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">10</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="o">}</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>upgrade_broker<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">broker</span><span class="o">=</span><span class="nv">$1</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à niveau de </span><span class="nv">$broker</span><span class="s2"> vers </span><span class="nv">$NEW_VERSION</span><span class="s2">...&quot;</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="w">    </span>ssh<span class="w"> </span><span class="nv">$broker</span><span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="s">        # Backup de la configuration</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="s">        cp -r /opt/kafka/config /opt/kafka/config.backup</span>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="s">        # Téléchargement et installation de la nouvelle version</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="s">        wget -q &quot;https://downloads.apache.org/kafka/$NEW_VERSION/kafka_2.13-$NEW_VERSION.tgz&quot; \</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="s">            -O /tmp/kafka.tgz</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="s">        tar -xzf /tmp/kafka.tgz -C /opt/</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="s">        rm -rf /opt/kafka</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="s">        mv /opt/kafka_2.13-$NEW_VERSION /opt/kafka</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="s">        # Restauration de la configuration</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a><span class="s">        cp -r /opt/kafka/config.backup/* /opt/kafka/config/</span>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="s">        # Ajustement du protocole inter-broker si nécessaire</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="s">        # (commenté - à activer selon la stratégie de migration)</span>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a><span class="s">        # echo &quot;inter.broker.protocol.version=3.6&quot; &gt;&gt; /opt/kafka/config/server.properties</span>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a><span class="s">EOF</span>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a><span class="o">}</span>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>start_broker<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">broker</span><span class="o">=</span><span class="nv">$1</span>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Démarrage de </span><span class="nv">$broker</span><span class="s2">...&quot;</span>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a><span class="w">    </span>ssh<span class="w"> </span><span class="nv">$broker</span><span class="w"> </span><span class="s2">&quot;sudo systemctl start kafka&quot;</span>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a>
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a><span class="w">    </span><span class="c1"># Attendre que le broker rejoigne le cluster</span>
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">30</span>
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a>
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a><span class="w">    </span><span class="c1"># Vérifier que le broker est en ligne</span>
<a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">broker_id</span><span class="o">=</span><span class="k">$(</span>ssh<span class="w"> </span><span class="nv">$broker</span><span class="w"> </span><span class="s2">&quot;cat /var/kafka/meta.properties | grep broker.id | cut -d= -f2&quot;</span><span class="k">)</span>
<a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a>
<a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a><span class="w">        </span><span class="nv">online</span><span class="o">=</span><span class="k">$(</span><span class="nv">$KAFKA_HOME</span>/bin/kafka-broker-api-versions.sh<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a><span class="w">            </span>--bootstrap-server<span class="w"> </span><span class="nv">$broker</span>:9092<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;ApiVersion&quot;</span><span class="k">)</span>
<a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a>
<a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$online</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Broker </span><span class="nv">$broker_id</span><span class="s2"> en ligne&quot;</span>
<a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a>
<a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Attente du démarrage de </span><span class="nv">$broker</span><span class="s2">...&quot;</span>
<a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a><span class="w">        </span>sleep<span class="w"> </span><span class="m">10</span>
<a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a><span class="w">    </span><span class="k">done</span>
<a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a><span class="o">}</span>
<a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a>
<a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a><span class="c1"># Boucle principale de mise à niveau</span>
<a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a><span class="k">for</span><span class="w"> </span>broker<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$BROKERS</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;==========================================&quot;</span>
<a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Traitement de </span><span class="nv">$broker</span><span class="s2">&quot;</span>
<a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;==========================================&quot;</span>
<a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a>
<a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a><span class="w">    </span><span class="c1"># 1. Arrêt contrôlé</span>
<a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a><span class="w">    </span>controlled_shutdown<span class="w"> </span><span class="nv">$broker</span>
<a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a>
<a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a><span class="w">    </span><span class="c1"># 2. Attendre la réélection des leaders</span>
<a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">60</span>
<a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a>
<a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a><span class="w">    </span><span class="c1"># 3. Mise à niveau</span>
<a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a><span class="w">    </span>upgrade_broker<span class="w"> </span><span class="nv">$broker</span>
<a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a>
<a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a><span class="w">    </span><span class="c1"># 4. Redémarrage</span>
<a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a><span class="w">    </span>start_broker<span class="w"> </span><span class="nv">$broker</span>
<a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a>
<a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a><span class="w">    </span><span class="c1"># 5. Attendre la synchronisation complète</span>
<a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a><span class="w">    </span>wait_for_isr_sync<span class="w"> </span><span class="nv">$broker</span>
<a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a>
<a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$broker</span><span class="s2"> mis à niveau avec succès&quot;</span>
<a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a><span class="k">done</span>
<a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a>
<a id="__codelineno-4-114" name="__codelineno-4-114" href="#__codelineno-4-114"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Rolling upgrade terminé&quot;</span>
</code></pre></div>
<h3 id="iii1114-gestion-des-protocoles-et-compatibilite">III.11.1.4 Gestion des Protocoles et Compatibilité<a class="headerlink" href="#iii1114-gestion-des-protocoles-et-compatibilite" title="Permanent link">&para;</a></h3>
<p>La compatibilité entre versions Kafka repose sur deux paramètres critiques : <code>inter.broker.protocol.version</code> et <code>log.message.format.version</code>.</p>
<p><strong>Stratégie de migration des protocoles</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Étape 1: Mise à niveau des binaires (tous les brokers)
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>         inter.broker.protocol.version = ancienne version
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>         log.message.format.version = ancienne version
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>Étape 2: Mise à niveau du protocole inter-broker
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>         inter.broker.protocol.version = nouvelle version
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>         log.message.format.version = ancienne version
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>         (Rolling restart)
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>Étape 3: Mise à niveau du format des messages
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>         inter.broker.protocol.version = nouvelle version
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>         log.message.format.version = nouvelle version
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>         (Rolling restart)
</code></pre></div>
<blockquote>
<p><strong>Anti-patron</strong></p>
<p>Mettre à niveau simultanément les binaires et les protocoles. Cette approche empêche le rollback en cas de problème car les anciens brokers ne peuvent plus communiquer avec les nouveaux. Toujours procéder en phases distinctes avec validation intermédiaire.</p>
</blockquote>
<hr />
<h2 id="iii112-mobilite-des-donnees">III.11.2 Mobilité des Données<a class="headerlink" href="#iii112-mobilite-des-donnees" title="Permanent link">&para;</a></h2>
<h3 id="iii1121-replication-inter-clusters-avec-mirrormaker-2">III.11.2.1 Réplication Inter-Clusters avec MirrorMaker 2<a class="headerlink" href="#iii1121-replication-inter-clusters-avec-mirrormaker-2" title="Permanent link">&para;</a></h3>
<p>MirrorMaker 2 (MM2) assure la réplication des données entre clusters Kafka, permettant des architectures multi-région et des stratégies de reprise après sinistre.</p>
<p><strong>Architectures de réplication</strong></p>
<table>
<thead>
<tr>
<th>Architecture</th>
<th>Description</th>
<th>Cas d'usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Active-Passive</td>
<td>Un cluster primaire, un réplica en lecture seule</td>
<td>Disaster Recovery</td>
</tr>
<tr>
<td>Active-Active</td>
<td>Deux clusters acceptant les écritures</td>
<td>Géo-distribution</td>
</tr>
<tr>
<td>Hub-and-Spoke</td>
<td>Cluster central agrégant plusieurs régions</td>
<td>Analytics centralisé</td>
</tr>
<tr>
<td>Mesh</td>
<td>Réplication bidirectionnelle entre tous les clusters</td>
<td>Fédération globale</td>
</tr>
</tbody>
</table>
<p><strong>Configuration MirrorMaker 2 pour Active-Passive</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># mm2-config.properties - Configuration Active-Passive</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c1"># Définition des clusters</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="na">clusters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">primary, dr</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="na">primary.bootstrap.servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">kafka-primary-1:9092,kafka-primary-2:9092,kafka-primary-3:9092</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="na">dr.bootstrap.servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">kafka-dr-1:9092,kafka-dr-2:9092,kafka-dr-3:9092</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="c1"># Réplication Primary -&gt; DR</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="na">primary-&gt;dr.enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="na">primary-&gt;dr.topics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">.*</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="na">primary-&gt;dr.topics.blacklist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">.*</span><span class="se">\.</span><span class="s">internal, __.*</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="c1"># Configuration du connecteur source</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="na">primary-&gt;dr.source.cluster.bootstrap.servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">kafka-primary-1:9092,kafka-primary-2:9092</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="na">primary-&gt;dr.source.cluster.security.protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SASL_SSL</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="na">primary-&gt;dr.source.cluster.sasl.mechanism</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SCRAM-SHA-512</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="c1"># Configuration du connecteur sink</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="na">primary-&gt;dr.target.cluster.bootstrap.servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">kafka-dr-1:9092,kafka-dr-2:9092</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="na">primary-&gt;dr.target.cluster.security.protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SASL_SSL</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="c1"># Synchronisation des offsets</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="na">primary-&gt;dr.sync.group.offsets.enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="na">primary-&gt;dr.sync.group.offsets.interval.seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">10</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="c1"># Synchronisation des ACL</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="na">primary-&gt;dr.acl.sync.enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="c1"># Réplication des topics de configuration</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="na">primary-&gt;dr.config.sync.enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="c1"># Performance</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="na">primary-&gt;dr.replication.factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="na">primary-&gt;dr.offset.lag.max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">100</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="na">primary-&gt;dr.producer.batch.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">16384</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="na">primary-&gt;dr.producer.linger.ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">5</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="c1"># Métriques</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="na">primary-&gt;dr.emit.heartbeats.enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="na">primary-&gt;dr.emit.checkpoints.enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="na">primary-&gt;dr.emit.heartbeats.interval.seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">5</span>
</code></pre></div>
<p><strong>Déploiement MirrorMaker 2 sur Kubernetes</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># mirrormaker2-deployment.yaml</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mirrormaker2</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mirrormaker2</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mirrormaker2</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mirrormaker2</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">confluentinc/cp-kafka:7.5.0</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="w">          </span><span class="nt">command</span><span class="p">:</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="w">              </span><span class="no">connect-mirror-maker /etc/mm2/mm2-config.properties</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="w">          </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="w">            </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2Gi&quot;</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="w">              </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1000m&quot;</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="w">            </span><span class="nt">limits</span><span class="p">:</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4Gi&quot;</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="w">              </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2000m&quot;</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mm2-config</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/mm2</span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secrets</span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/kafka/secrets</span>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KAFKA_HEAP_OPTS</span>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-Xms1g</span><span class="nv"> </span><span class="s">-Xmx2g&quot;</span>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KAFKA_JMX_PORT</span>
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;9999&quot;</span>
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8083</span>
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rest</span>
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9999</span>
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jmx</span>
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a><span class="w">          </span><span class="nt">livenessProbe</span><span class="p">:</span>
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a><span class="w">            </span><span class="nt">httpGet</span><span class="p">:</span>
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a><span class="w">              </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/connectors</span>
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a><span class="w">              </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8083</span>
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a><span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a><span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a><span class="w">          </span><span class="nt">readinessProbe</span><span class="p">:</span>
<a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a><span class="w">            </span><span class="nt">httpGet</span><span class="p">:</span>
<a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a><span class="w">              </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/connectors</span>
<a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a><span class="w">              </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8083</span>
<a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a><span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a><span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mm2-config</span>
<a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span>
<a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mm2-config</span>
<a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secrets</span>
<a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a><span class="w">          </span><span class="nt">secret</span><span class="p">:</span>
<a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a><span class="w">            </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka-credentials</span>
</code></pre></div>
<h3 id="iii1122-gestion-du-lag-de-replication">III.11.2.2 Gestion du Lag de Réplication<a class="headerlink" href="#iii1122-gestion-du-lag-de-replication" title="Permanent link">&para;</a></h3>
<p>Le lag de réplication représente le retard entre les données du cluster source et leur réplique. Sa surveillance est critique pour les architectures de reprise après sinistre.</p>
<p><strong>Métriques de lag à surveiller</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1">// Monitoring du lag MirrorMaker 2</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MirrorMakerLagMonitor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AdminClient</span><span class="w"> </span><span class="n">sourceAdmin</span><span class="p">;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AdminClient</span><span class="w"> </span><span class="n">targetAdmin</span><span class="p">;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MeterRegistry</span><span class="w"> </span><span class="n">meterRegistry</span><span class="p">;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">measureReplicationLag</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">        </span><span class="c1">// Récupérer les offsets source</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sourceOffsets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getLatestOffsets</span><span class="p">(</span><span class="n">sourceAdmin</span><span class="p">);</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">        </span><span class="c1">// Récupérer les offsets répliqués</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">targetOffsets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getLatestOffsets</span><span class="p">(</span><span class="n">targetAdmin</span><span class="p">);</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">        </span><span class="c1">// Calculer le lag par partition</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">        </span><span class="n">sourceOffsets</span><span class="p">.</span><span class="na">forEach</span><span class="p">((</span><span class="n">tp</span><span class="p">,</span><span class="w"> </span><span class="n">sourceOffset</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">targetTopic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;primary.&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tp</span><span class="p">.</span><span class="na">topic</span><span class="p">();</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">            </span><span class="n">TopicPartition</span><span class="w"> </span><span class="n">targetTp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TopicPartition</span><span class="p">(</span><span class="n">targetTopic</span><span class="p">,</span><span class="w"> </span><span class="n">tp</span><span class="p">.</span><span class="na">partition</span><span class="p">());</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">            </span><span class="n">Long</span><span class="w"> </span><span class="n">targetOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">targetOffsets</span><span class="p">.</span><span class="na">getOrDefault</span><span class="p">(</span><span class="n">targetTp</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">L</span><span class="p">);</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">            </span><span class="kt">long</span><span class="w"> </span><span class="n">lag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sourceOffset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">targetOffset</span><span class="p">;</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">            </span><span class="c1">// Enregistrer la métrique</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">            </span><span class="n">Gauge</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;mm2.replication.lag&quot;</span><span class="p">)</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">                </span><span class="p">.</span><span class="na">tag</span><span class="p">(</span><span class="s">&quot;source.topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tp</span><span class="p">.</span><span class="na">topic</span><span class="p">())</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">                </span><span class="p">.</span><span class="na">tag</span><span class="p">(</span><span class="s">&quot;partition&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">tp</span><span class="p">.</span><span class="na">partition</span><span class="p">()))</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">                </span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="n">meterRegistry</span><span class="p">)</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">                </span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">lag</span><span class="p">);</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">            </span><span class="c1">// Alerter si le lag dépasse le seuil</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lag</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">LAG_THRESHOLD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">                </span><span class="n">alertOnHighLag</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="w"> </span><span class="n">lag</span><span class="p">);</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Duration</span><span class="w"> </span><span class="nf">estimateRecoveryTime</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">        </span><span class="c1">// Mesurer le débit de réplication</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">replicationRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">measureReplicationRate</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">        </span><span class="c1">// Calculer le lag total</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">totalLag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateTotalLag</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="w">        </span><span class="c1">// Estimer le temps de rattrapage</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">replicationRate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ofSeconds</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">totalLag</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">replicationRate</span><span class="p">));</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ofDays</span><span class="p">(</span><span class="mi">365</span><span class="p">);</span><span class="w"> </span><span class="c1">// Valeur sentinelle si pas de réplication</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Alerting sur le lag de réplication</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># prometheus-rules.yaml</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nt">groups</span><span class="p">:</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mirrormaker2_alerts</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MM2ReplicationLagHigh</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mm2_replication_lag &gt; 10000</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lag</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">réplication</span><span class="nv"> </span><span class="s">élevé&quot;</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Le</span><span class="nv"> </span><span class="s">lag</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">réplication</span><span class="nv"> </span><span class="s">pour</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.source_topic</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">partition</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.partition</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">est</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">messages&quot;</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MM2ReplicationLagCritical</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mm2_replication_lag &gt; 100000</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2m</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lag</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">réplication</span><span class="nv"> </span><span class="s">critique&quot;</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Risque</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">perte</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">données</span><span class="nv"> </span><span class="s">en</span><span class="nv"> </span><span class="s">cas</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">basculement.</span><span class="nv"> </span><span class="s">Lag:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MM2ReplicationStopped</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(mm2_records_replicated_total[5m]) == 0</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Réplication</span><span class="nv"> </span><span class="s">MirrorMaker</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">arrêtée&quot;</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Aucun</span><span class="nv"> </span><span class="s">message</span><span class="nv"> </span><span class="s">répliqué</span><span class="nv"> </span><span class="s">depuis</span><span class="nv"> </span><span class="s">5</span><span class="nv"> </span><span class="s">minutes&quot;</span>
</code></pre></div>
<h3 id="iii1123-migration-de-topics-entre-clusters">III.11.2.3 Migration de Topics entre Clusters<a class="headerlink" href="#iii1123-migration-de-topics-entre-clusters" title="Permanent link">&para;</a></h3>
<p>La migration de topics d'un cluster à un autre requiert une planification minutieuse pour préserver l'intégrité des données et minimiser l'interruption.</p>
<p><strong>Stratégies de migration</strong></p>
<table>
<thead>
<tr>
<th>Stratégie</th>
<th>Description</th>
<th>Downtime</th>
<th>Complexité</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dual-Write</td>
<td>Écriture simultanée source et cible</td>
<td>Aucun</td>
<td>Haute (coordination clients)</td>
</tr>
<tr>
<td>MirrorMaker</td>
<td>Réplication puis basculement</td>
<td>Minimal (secondes)</td>
<td>Moyenne</td>
</tr>
<tr>
<td>Export/Import</td>
<td>Sauvegarde puis restauration</td>
<td>Élevé</td>
<td>Faible</td>
</tr>
<tr>
<td>Consumer-Producer</td>
<td>Application de migration dédiée</td>
<td>Variable</td>
<td>Moyenne</td>
</tr>
</tbody>
</table>
<p><strong>Procédure de migration avec MirrorMaker</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="c1"># scripts/migrate_topic.sh</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="nv">SOURCE_CLUSTER</span><span class="o">=</span><span class="s2">&quot;kafka-old:9092&quot;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="nv">TARGET_CLUSTER</span><span class="o">=</span><span class="s2">&quot;kafka-new:9092&quot;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="nv">TOPIC_TO_MIGRATE</span><span class="o">=</span><span class="s2">&quot;orders.created&quot;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="nv">CONSUMER_GROUPS</span><span class="o">=</span><span class="s2">&quot;order-processor,analytics-consumer&quot;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Phase 1: Démarrage de la réplication ===&quot;</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="c1"># Configurer et démarrer MirrorMaker pour le topic spécifique</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>/tmp/mm2-migration.properties<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="s">clusters = source, target</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="s">source.bootstrap.servers = $SOURCE_CLUSTER</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="s">target.bootstrap.servers = $TARGET_CLUSTER</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="s">source-&gt;target.enabled = true</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="s">source-&gt;target.topics = $TOPIC_TO_MIGRATE</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="s">source-&gt;target.sync.group.offsets.enabled = true</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="s">EOF</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="c1"># Démarrer MirrorMaker</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>connect-mirror-maker<span class="w"> </span>/tmp/mm2-migration.properties<span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="nv">MM2_PID</span><span class="o">=</span><span class="nv">$!</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;MirrorMaker démarré (PID: </span><span class="nv">$MM2_PID</span><span class="s2">)&quot;</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Phase 2: Attente de la synchronisation ===&quot;</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="w">    </span><span class="c1"># Vérifier le lag</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="w">    </span><span class="nv">lag</span><span class="o">=</span><span class="k">$(</span>kafka-consumer-groups.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$TARGET_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="w">        </span>--describe<span class="w"> </span>--group<span class="w"> </span>mm2-source<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a><span class="w">        </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="nv">$TOPIC_TO_MIGRATE</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="w">        </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{sum += $6} END {print sum}&#39;</span><span class="k">)</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lag</span><span class="s2">&quot;</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Lag acceptable: </span><span class="nv">$lag</span><span class="s2"> messages&quot;</span>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a><span class="w">        </span><span class="k">break</span>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Lag actuel: </span><span class="nv">$lag</span><span class="s2"> messages. Attente...&quot;</span>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">10</span>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a><span class="k">done</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Phase 3: Basculement des consommateurs ===&quot;</span>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a><span class="k">for</span><span class="w"> </span>group<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$CONSUMER_GROUPS</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Migration du groupe </span><span class="nv">$group</span><span class="s2">...&quot;</span>
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a>
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a><span class="w">    </span><span class="c1"># Récupérer les offsets depuis le topic checkpoint</span>
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a><span class="w">    </span>kafka-consumer-groups.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$TARGET_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a><span class="w">        </span>--group<span class="w"> </span><span class="nv">$group</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a><span class="w">        </span>--reset-offsets<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a><span class="w">        </span>--topic<span class="w"> </span>source.<span class="nv">$TOPIC_TO_MIGRATE</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a><span class="w">        </span>--to-earliest<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a><span class="w">        </span>--execute
<a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a><span class="k">done</span>
<a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a>
<a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Phase 4: Validation ===&quot;</span>
<a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a>
<a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a><span class="c1"># Vérifier que les consommateurs lisent depuis le nouveau cluster</span>
<a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a><span class="k">for</span><span class="w"> </span>group<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$CONSUMER_GROUPS</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a><span class="w">    </span>kafka-consumer-groups.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$TARGET_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a><span class="w">        </span>--describe<span class="w"> </span>--group<span class="w"> </span><span class="nv">$group</span>
<a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a><span class="k">done</span>
<a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a>
<a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Phase 5: Nettoyage ===&quot;</span>
<a id="__codelineno-10-68" name="__codelineno-10-68" href="#__codelineno-10-68"></a>
<a id="__codelineno-10-69" name="__codelineno-10-69" href="#__codelineno-10-69"></a><span class="c1"># Arrêter MirrorMaker</span>
<a id="__codelineno-10-70" name="__codelineno-10-70" href="#__codelineno-10-70"></a><span class="nb">kill</span><span class="w"> </span><span class="nv">$MM2_PID</span>
<a id="__codelineno-10-71" name="__codelineno-10-71" href="#__codelineno-10-71"></a>
<a id="__codelineno-10-72" name="__codelineno-10-72" href="#__codelineno-10-72"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Migration terminée. Vérifier le fonctionnement avant de supprimer l&#39;ancien topic.&quot;</span>
</code></pre></div>
<blockquote>
<p><strong>Note de terrain</strong></p>
<p><em>Contexte</em> : Migration de 200 topics d'un cluster Kafka on-premise vers Confluent Cloud pour une entreprise de logistique.</p>
<p><em>Défi</em> : Les applications ne pouvaient tolérer plus de 30 secondes d'interruption pendant les heures d'affaires.</p>
<p><em>Solution</em> : Migration topic par topic sur 3 mois avec dual-write temporaire pour les topics critiques. Automatisation complète du processus avec rollback automatique si le lag dépassait 1000 messages.</p>
<p><em>Leçon</em> : Sous-estimer le temps de migration est l'erreur la plus courante. Prévoir 50 % de marge sur les estimations initiales.</p>
</blockquote>
<hr />
<h2 id="iii113-surveillance-du-cluster-kafka">III.11.3 Surveillance du Cluster Kafka<a class="headerlink" href="#iii113-surveillance-du-cluster-kafka" title="Permanent link">&para;</a></h2>
<h3 id="iii1131-architecture-dobservabilite">III.11.3.1 Architecture d'Observabilité<a class="headerlink" href="#iii1131-architecture-dobservabilite" title="Permanent link">&para;</a></h3>
<p>Une surveillance efficace de Kafka repose sur trois piliers : métriques, logs et traces. L'architecture d'observabilité doit couvrir l'ensemble de la chaîne, des brokers aux applications clientes.</p>
<p><strong>Stack d'observabilité recommandée</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>┌─────────────────────────────────────────────────────────────────┐
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>│                      Visualisation                               │
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>│  │   Grafana   │  │   Kibana    │  │    Jaeger   │              │
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>│  │  (Metrics)  │  │   (Logs)    │  │  (Traces)   │              │
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>│         │                │                │                      │
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>├─────────┼────────────────┼────────────────┼─────────────────────┤
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>│         │    Stockage    │                │                      │
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>│  ┌──────┴──────┐  ┌──────┴──────┐  ┌──────┴──────┐              │
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>│  │ Prometheus  │  │Elasticsearch│  │    Tempo    │              │
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>│  │   / Mimir   │  │             │  │             │              │
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>│         │                │                │                      │
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>├─────────┼────────────────┼────────────────┼─────────────────────┤
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>│         │   Collection   │                │                      │
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>│  ┌──────┴──────┐  ┌──────┴──────┐  ┌──────┴──────┐              │
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>│  │JMX Exporter │  │  Filebeat   │  │ OTel Agent  │              │
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>│  │             │  │  / Fluentd  │  │             │              │
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>│         │                │                │                      │
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>├─────────┴────────────────┴────────────────┴─────────────────────┤
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>│                    Sources de données                            │
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>│  │   Brokers   │  │   Clients   │  │   Connect   │              │
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>│  │    Kafka    │  │  Producers  │  │   Workers   │              │
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>│  │             │  │  Consumers  │  │             │              │
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>│  └─────────────┘  └─────────────┘  └─────────────┘              │
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>└─────────────────────────────────────────────────────────────────┘
</code></pre></div>
<h3 id="iii1132-metriques-essentielles-des-brokers">III.11.3.2 Métriques Essentielles des Brokers<a class="headerlink" href="#iii1132-metriques-essentielles-des-brokers" title="Permanent link">&para;</a></h3>
<p><strong>Métriques de santé du cluster</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># prometheus-kafka-rules.yaml</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nt">groups</span><span class="p">:</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka_broker_health</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">      </span><span class="c1"># Partitions sous-répliquées</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">record</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka:under_replicated_partitions:sum</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum(kafka_server_replicamanager_underreplicatedpartitions)</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">      </span><span class="c1"># Partitions hors ligne</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">record</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka:offline_partitions:sum</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum(kafka_controller_kafkacontroller_offlinepartitionscount)</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">      </span><span class="c1"># Élections de leader non propres</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">record</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka:unclean_leader_elections:rate5m</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum(rate(kafka_controller_controllerstats_uncleanleaderelectionspersec[5m]))</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">      </span><span class="c1"># ISR en contraction</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">record</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka:isr_shrinks:rate5m</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum(rate(kafka_server_replicamanager_isrshrinkspersec[5m]))</span>
</code></pre></div>
<p><strong>Tableau de bord Grafana - Santé du cluster</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nt">&quot;panels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Partitions sous-répliquées&quot;</span><span class="p">,</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stat&quot;</span><span class="p">,</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">      </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">          </span><span class="nt">&quot;expr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum(kafka_server_replicamanager_underreplicatedpartitions)&quot;</span><span class="p">,</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">          </span><span class="nt">&quot;legendFormat&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Under-replicated&quot;</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">      </span><span class="p">],</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">      </span><span class="nt">&quot;thresholds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">        </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;absolute&quot;</span><span class="p">,</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">        </span><span class="nt">&quot;steps&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">          </span><span class="p">{</span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;green&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">          </span><span class="p">{</span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">          </span><span class="p">{</span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">}</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">        </span><span class="p">]</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Débit d&#39;entrée par broker&quot;</span><span class="p">,</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;graph&quot;</span><span class="p">,</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="w">      </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="w">          </span><span class="nt">&quot;expr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sum(rate(kafka_server_brokertopicmetrics_bytesinpersec[5m])) by (instance)&quot;</span><span class="p">,</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="w">          </span><span class="nt">&quot;legendFormat&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{ instance }}&quot;</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="w">      </span><span class="p">]</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Latence de réplication&quot;</span><span class="p">,</span>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;graph&quot;</span><span class="p">,</span>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a><span class="w">      </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="w">          </span><span class="nt">&quot;expr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kafka_server_replicafetchermanager_maxlag&quot;</span><span class="p">,</span>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a><span class="w">          </span><span class="nt">&quot;legendFormat&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Max Lag&quot;</span>
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a><span class="w">      </span><span class="p">]</span>
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Métriques de performance des brokers</strong></p>
<table>
<thead>
<tr>
<th>Métrique</th>
<th>Description</th>
<th>Seuil d'alerte</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>RequestHandlerAvgIdlePercent</code></td>
<td>Utilisation des threads de requête</td>
<td>&lt; 30%</td>
</tr>
<tr>
<td><code>NetworkProcessorAvgIdlePercent</code></td>
<td>Utilisation des threads réseau</td>
<td>&lt; 30%</td>
</tr>
<tr>
<td><code>UnderReplicatedPartitions</code></td>
<td>Partitions sans réplicas complets</td>
<td>&gt; 0</td>
</tr>
<tr>
<td><code>ActiveControllerCount</code></td>
<td>Nombre de contrôleurs actifs</td>
<td>≠ 1</td>
</tr>
<tr>
<td><code>OfflinePartitionsCount</code></td>
<td>Partitions sans leader</td>
<td>&gt; 0</td>
</tr>
<tr>
<td><code>BytesInPerSec</code>/<code>BytesOutPerSec</code></td>
<td>Débit réseau</td>
<td>Dépend de la capacité</td>
</tr>
<tr>
<td><code>TotalProduceRequestsPerSec</code></td>
<td>Requêtes de production</td>
<td>Baseline + 50%</td>
</tr>
<tr>
<td><code>TotalFetchRequestsPerSec</code></td>
<td>Requêtes de consommation</td>
<td>Baseline + 50%</td>
</tr>
</tbody>
</table>
<h3 id="iii1133-metriques-des-producers-et-consumers">III.11.3.3 Métriques des Producers et Consumers<a class="headerlink" href="#iii1133-metriques-des-producers-et-consumers" title="Permanent link">&para;</a></h3>
<p><strong>Configuration JMX pour les clients</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1">// Configuration des métriques producer</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MonitoredKafkaProducer</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">KafkaProducer</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="n">producer</span><span class="p">;</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MeterRegistry</span><span class="w"> </span><span class="n">meterRegistry</span><span class="p">;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MonitoredKafkaProducer</span><span class="p">(</span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="p">,</span><span class="w"> </span><span class="n">MeterRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">meterRegistry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">registry</span><span class="p">;</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">producer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KafkaProducer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">        </span><span class="c1">// Enregistrer les métriques</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">        </span><span class="n">registerMetrics</span><span class="p">();</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">registerMetrics</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">        </span><span class="c1">// Métriques du producer</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">        </span><span class="n">producer</span><span class="p">.</span><span class="na">metrics</span><span class="p">().</span><span class="na">forEach</span><span class="p">((</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isImportantMetric</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">                </span><span class="n">Gauge</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;kafka.producer.&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="na">name</span><span class="p">())</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">                    </span><span class="p">.</span><span class="na">tag</span><span class="p">(</span><span class="s">&quot;client.id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="p">.</span><span class="na">metricName</span><span class="p">().</span><span class="na">tags</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;client-id&quot;</span><span class="p">))</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="w">                    </span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="n">meterRegistry</span><span class="p">);</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isImportantMetric</span><span class="p">(</span><span class="n">MetricName</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="na">name</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;record-send-rate&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="w">               </span><span class="n">name</span><span class="p">.</span><span class="na">name</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;record-error-rate&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="w">               </span><span class="n">name</span><span class="p">.</span><span class="na">name</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;request-latency-avg&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="w">               </span><span class="n">name</span><span class="p">.</span><span class="na">name</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;batch-size-avg&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="w">               </span><span class="n">name</span><span class="p">.</span><span class="na">name</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;buffer-available-bytes&quot;</span><span class="p">);</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Métriques critiques des consumers</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Règles d&#39;alerte pour les consumers</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="nt">groups</span><span class="p">:</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka_consumer_alerts</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConsumerLagHigh</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">          </span><span class="no">sum(kafka_consumer_group_lag) by (group, topic) &gt; 10000</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lag</span><span class="nv"> </span><span class="s">élevé</span><span class="nv"> </span><span class="s">pour</span><span class="nv"> </span><span class="s">le</span><span class="nv"> </span><span class="s">groupe</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.group</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Le</span><span class="nv"> </span><span class="s">consumer</span><span class="nv"> </span><span class="s">group</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.group</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">un</span><span class="nv"> </span><span class="s">lag</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">sur</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.topic</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConsumerLagGrowing</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">          </span><span class="no">deriv(kafka_consumer_group_lag[10m]) &gt; 100</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lag</span><span class="nv"> </span><span class="s">en</span><span class="nv"> </span><span class="s">croissance</span><span class="nv"> </span><span class="s">pour</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.group</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Le</span><span class="nv"> </span><span class="s">lag</span><span class="nv"> </span><span class="s">augmente</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">messages/seconde&quot;</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConsumerGroupInactive</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">          </span><span class="no">kafka_consumer_group_members == 0</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Consumer</span><span class="nv"> </span><span class="s">group</span><span class="nv"> </span><span class="s">inactif&quot;</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Le</span><span class="nv"> </span><span class="s">groupe</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.group</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">n&#39;a</span><span class="nv"> </span><span class="s">aucun</span><span class="nv"> </span><span class="s">membre</span><span class="nv"> </span><span class="s">actif&quot;</span>
</code></pre></div>
<h3 id="iii1134-surveillance-des-topics-et-partitions">III.11.3.4 Surveillance des Topics et Partitions<a class="headerlink" href="#iii1134-surveillance-des-topics-et-partitions" title="Permanent link">&para;</a></h3>
<p><strong>Script de diagnostic des topics</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="c1"># scripts/topic_health_check.sh</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="nv">BOOTSTRAP_SERVERS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">localhost</span><span class="p">:</span><span class="nv">9092</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Diagnostic de santé des topics ===&quot;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="c1"># Partitions sous-répliquées</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Partitions sous-répliquées ---&quot;</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>kafka-topics.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$BOOTSTRAP_SERVERS</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">    </span>--describe<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">    </span>--under-replicated-partitions
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="c1"># Partitions hors ligne</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Partitions hors ligne ---&quot;</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>kafka-topics.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$BOOTSTRAP_SERVERS</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span>--describe<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">    </span>--unavailable-partitions
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="c1"># Topics avec ISR réduit</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Topics avec ISR &lt; replication.factor ---&quot;</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>kafka-topics.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$BOOTSTRAP_SERVERS</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w">    </span>--describe<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;/Isr:/ {</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="s1">        split($0, a, &quot;Replicas:&quot;);</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="s1">        split(a[2], b, &quot;Isr:&quot;);</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="s1">        replicas = gsub(/,/, &quot;,&quot;, b[1]) + 1;</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="s1">        isr = gsub(/,/, &quot;,&quot;, b[2]) + 1;</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="s1">        if (isr &lt; replicas) print $0</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="s1">    }&#39;</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a><span class="c1"># Distribution des partitions par broker</span>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Distribution des leaders par broker ---&quot;</span>
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a>kafka-topics.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$BOOTSTRAP_SERVERS</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="w">    </span>--describe<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Leader:&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $6}&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a>
<a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a><span class="c1"># Topics les plus volumineux</span>
<a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Top 10 topics par nombre de partitions ---&quot;</span>
<a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a>kafka-topics.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$BOOTSTRAP_SERVERS</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a><span class="w">    </span>--describe<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;PartitionCount:&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $4, $2}&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10
</code></pre></div>
<h3 id="iii1135-centralisation-des-logs">III.11.3.5 Centralisation des Logs<a class="headerlink" href="#iii1135-centralisation-des-logs" title="Permanent link">&para;</a></h3>
<p><strong>Configuration Filebeat pour Kafka</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># filebeat-kafka.yml</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="nt">filebeat.inputs</span><span class="p">:</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/kafka/server.log</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/kafka/controller.log</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/kafka/state-change.log</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">    </span><span class="nt">multiline</span><span class="p">:</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">      </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;^\[&#39;</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">      </span><span class="nt">negate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">      </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">after</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">      </span><span class="nt">log_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka-broker</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">      </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">    </span><span class="nt">fields_under_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/kafka/kafka-request.log</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">      </span><span class="nt">log_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka-request</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w">    </span><span class="nt">fields_under_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="nt">processors</span><span class="p">:</span>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dissect</span><span class="p">:</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">      </span><span class="nt">tokenizer</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;[%{timestamp}]</span><span class="nv"> </span><span class="s">%{level}</span><span class="nv"> </span><span class="s">%{message}&quot;</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">      </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;message&quot;</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w">      </span><span class="nt">target_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kafka&quot;</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="w">        </span><span class="nt">equals</span><span class="p">:</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">          </span><span class="nt">log_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka-broker</span>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">add_host_metadata</span><span class="p">:</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="w">      </span><span class="nt">when.not.contains.tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">forwarded</span>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">add_cloud_metadata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~</span>
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a>
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="nt">output.elasticsearch</span><span class="p">:</span>
<a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;elasticsearch:9200&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a><span class="w">  </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kafka-logs-%{+yyyy.MM.dd}&quot;</span>
<a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>
<a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a><span class="nt">setup.template</span><span class="p">:</span>
<a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kafka-logs&quot;</span>
<a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a><span class="w">  </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kafka-logs-*&quot;</span>
<a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a><span class="w">  </span><span class="nt">settings</span><span class="p">:</span>
<a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a><span class="w">    </span><span class="nt">index.number_of_shards</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a><span class="w">    </span><span class="nt">index.number_of_replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</code></pre></div>
<p><strong>Patterns de logs à surveiller</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Patterns critiques dans les logs Kafka</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nt">alert_patterns</span><span class="p">:</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">  </span><span class="nt">critical</span><span class="p">:</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;FATAL&quot;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Erreur</span><span class="nv"> </span><span class="s">fatale</span><span class="nv"> </span><span class="s">du</span><span class="nv"> </span><span class="s">broker&quot;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;page_on_call&quot;</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;OutOfMemoryError&quot;</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Dépassement</span><span class="nv"> </span><span class="s">mémoire&quot;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;page_on_call&quot;</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;No</span><span class="nv"> </span><span class="s">space</span><span class="nv"> </span><span class="s">left</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">device&quot;</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Disque</span><span class="nv"> </span><span class="s">plein&quot;</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;page_on_call&quot;</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">  </span><span class="nt">warning</span><span class="p">:</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WARN.*ISR.*shrunk&quot;</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ISR</span><span class="nv"> </span><span class="s">en</span><span class="nv"> </span><span class="s">contraction&quot;</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;create_ticket&quot;</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WARN.*Unable</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">connect&quot;</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Problème</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">connectivité&quot;</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;investigate&quot;</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WARN.*Request.*timed</span><span class="nv"> </span><span class="s">out&quot;</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Timeout</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">requête&quot;</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;investigate&quot;</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="w">  </span><span class="nt">info</span><span class="p">:</span>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;INFO.*Leader.*changed&quot;</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Changement</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">leader&quot;</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;log_only&quot;</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;INFO.*Partition.*reassignment&quot;</span>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Réassignation</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">partition&quot;</span>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;log_only&quot;</span>
</code></pre></div>
<hr />
<h2 id="iii114-clinique-doptimisation-des-performances">III.11.4 Clinique d'Optimisation des Performances<a class="headerlink" href="#iii114-clinique-doptimisation-des-performances" title="Permanent link">&para;</a></h2>
<h3 id="iii1141-diagnostic-des-problemes-de-performance">III.11.4.1 Diagnostic des Problèmes de Performance<a class="headerlink" href="#iii1141-diagnostic-des-problemes-de-performance" title="Permanent link">&para;</a></h3>
<p>L'optimisation des performances Kafka suit une méthodologie systématique qui identifie les goulots d'étranglement avant d'appliquer des corrections.</p>
<p><strong>Arbre de décision du diagnostic</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>Performance dégradée
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>│
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>├── Latence élevée ?
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>│   ├── Latence producer ?
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>│   │   ├── Batch size trop petit → Augmenter batch.size
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>│   │   ├── Linger.ms trop bas → Augmenter linger.ms
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>│   │   └── Acks=all avec ISR lent → Vérifier santé réplicas
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>│   │
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>│   └── Latence consumer ?
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>│       ├── Traitement lent → Optimiser logique applicative
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>│       ├── Rebalancing fréquent → Augmenter session.timeout.ms
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>│       └── Fetch size inadapté → Ajuster fetch.min.bytes
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>│
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>├── Débit insuffisant ?
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>│   ├── Côté broker ?
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>│   │   ├── CPU saturé → Ajouter brokers ou partitions
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>│   │   ├── Disque saturé → Vérifier I/O, ajouter disques
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>│   │   └── Réseau saturé → Vérifier bande passante
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>│   │
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>│   ├── Côté producer ?
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>│   │   ├── Sérialisation lente → Optimiser sérialisation
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>│   │   └── Compression inefficace → Changer algorithme
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>│   │
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>│   └── Côté consumer ?
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>│       ├── Pas assez de partitions → Augmenter partitions
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>│       └── Pas assez de consumers → Ajouter instances
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>│
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>└── Instabilité (erreurs intermittentes) ?
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>    ├── Timeout fréquents → Ajuster timeouts
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>    ├── Rebalancing constant → Vérifier heartbeat
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>    └── Déconnexions → Vérifier réseau et configuration
</code></pre></div>
<h3 id="iii1142-optimisation-des-producers">III.11.4.2 Optimisation des Producers<a class="headerlink" href="#iii1142-optimisation-des-producers" title="Permanent link">&para;</a></h3>
<p><strong>Paramètres critiques du producer</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">// Configuration producer optimisée pour le débit</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kd">public</span><span class="w"> </span><span class="n">Properties</span><span class="w"> </span><span class="nf">createHighThroughputProducerConfig</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">    </span><span class="c1">// Identification</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">CLIENT_ID_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;high-throughput-producer&quot;</span><span class="p">);</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="n">bootstrapServers</span><span class="p">);</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">    </span><span class="c1">// Sérialisation</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">KEY_SERIALIZER_CLASS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="n">StringSerializer</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="n">KafkaAvroSerializer</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">    </span><span class="c1">// Batching - clé de la performance</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">BATCH_SIZE_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">65536</span><span class="p">);</span><span class="w">        </span><span class="c1">// 64 KB par batch</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">LINGER_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">            </span><span class="c1">// Attendre 10ms max</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">BUFFER_MEMORY_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">67108864</span><span class="p">);</span><span class="w">  </span><span class="c1">// 64 MB de buffer</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">    </span><span class="c1">// Compression - réduire bande passante et stockage</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">COMPRESSION_TYPE_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lz4&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Bon compromis vitesse/ratio</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">    </span><span class="c1">// Fiabilité - ajuster selon besoins</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">ACKS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;all&quot;</span><span class="p">);</span><span class="w">             </span><span class="c1">// Durabilité maximale</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">RETRIES_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">RETRY_BACKOFF_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="w">    </span><span class="c1">// Idempotence - éviter les doublons</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">ENABLE_IDEMPOTENCE_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="w">    </span><span class="c1">// Timeouts</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">REQUEST_TIMEOUT_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">30000</span><span class="p">);</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">DELIVERY_TIMEOUT_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">120000</span><span class="p">);</span>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="w">    </span><span class="c1">// Performance réseau</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">SEND_BUFFER_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">131072</span><span class="p">);</span><span class="w">     </span><span class="c1">// 128 KB</span>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">props</span><span class="p">;</span>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Comparaison des algorithmes de compression</strong></p>
<table>
<thead>
<tr>
<th>Algorithme</th>
<th>Ratio compression</th>
<th>Vitesse compression</th>
<th>Vitesse décompression</th>
<th>Recommandation</th>
</tr>
</thead>
<tbody>
<tr>
<td>none</td>
<td>1:1</td>
<td>N/A</td>
<td>N/A</td>
<td>Tests uniquement</td>
</tr>
<tr>
<td>gzip</td>
<td>~70%</td>
<td>Lente</td>
<td>Moyenne</td>
<td>Stockage long terme</td>
</tr>
<tr>
<td>snappy</td>
<td>~50%</td>
<td>Rapide</td>
<td>Très rapide</td>
<td>Legacy, compatibilité</td>
</tr>
<tr>
<td>lz4</td>
<td>~55%</td>
<td>Très rapide</td>
<td>Très rapide</td>
<td><strong>Production générale</strong></td>
</tr>
<tr>
<td>zstd</td>
<td>~65%</td>
<td>Rapide</td>
<td>Rapide</td>
<td>Meilleur ratio moderne</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note de terrain</strong></p>
<p><em>Contexte</em> : Optimisation d'un pipeline d'ingestion IoT traitant 500 000 messages/seconde.</p>
<p><em>Défi</em> : Le débit plafonnait à 200 000 messages/seconde malgré des brokers non saturés.</p>
<p><em>Solution</em> : Augmentation du batch.size de 16 KB à 128 KB, linger.ms de 0 à 20 ms, et passage de snappy à lz4. Le débit a triplé.</p>
<p><em>Leçon</em> : Le batching est le levier d'optimisation le plus puissant. Un batch trop petit multiplie les round-trips réseau inutilement.</p>
</blockquote>
<h3 id="iii1143-optimisation-des-consumers">III.11.4.3 Optimisation des Consumers<a class="headerlink" href="#iii1143-optimisation-des-consumers" title="Permanent link">&para;</a></h3>
<p><strong>Configuration consumer pour différents profils</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">// Consumer optimisé pour la latence</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">Properties</span><span class="w"> </span><span class="nf">createLowLatencyConsumerConfig</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">FETCH_MIN_BYTES_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">          </span><span class="c1">// Pas d&#39;attente</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">FETCH_MAX_WAIT_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span><span class="w">      </span><span class="c1">// 100ms max</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">MAX_POLL_RECORDS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span><span class="w">       </span><span class="c1">// Petits lots</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">SESSION_TIMEOUT_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">);</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">HEARTBEAT_INTERVAL_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">);</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">props</span><span class="p">;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="p">}</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="c1">// Consumer optimisé pour le débit</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="kd">public</span><span class="w"> </span><span class="n">Properties</span><span class="w"> </span><span class="nf">createHighThroughputConsumerConfig</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">    </span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">FETCH_MIN_BYTES_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">65536</span><span class="p">);</span><span class="w">      </span><span class="c1">// 64 KB minimum</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">FETCH_MAX_BYTES_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">52428800</span><span class="p">);</span><span class="w">   </span><span class="c1">// 50 MB max</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">FETCH_MAX_WAIT_MS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">);</span><span class="w">      </span><span class="c1">// Attendre pour batching</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">MAX_POLL_RECORDS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span><span class="w">      </span><span class="c1">// Gros lots</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">    </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">MAX_PARTITION_FETCH_BYTES_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="mi">10485760</span><span class="p">);</span><span class="w"> </span><span class="c1">// 10 MB</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">props</span><span class="p">;</span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Diagnostic du consumer lag</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="c1"># scripts/diagnose_consumer_lag.sh</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="nv">BOOTSTRAP_SERVERS</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="nv">CONSUMER_GROUP</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Diagnostic du lag pour </span><span class="nv">$CONSUMER_GROUP</span><span class="s2"> ===&quot;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="c1"># Lag par partition</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Lag par partition ---&quot;</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>kafka-consumer-groups.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$BOOTSTRAP_SERVERS</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">    </span>--describe<span class="w"> </span>--group<span class="w"> </span><span class="nv">$CONSUMER_GROUP</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>column<span class="w"> </span>-t
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="c1"># Tendance du lag (nécessite métriques historiques)</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Analyse ---&quot;</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="nv">lag_data</span><span class="o">=</span><span class="k">$(</span>kafka-consumer-groups.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$BOOTSTRAP_SERVERS</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="w">    </span>--describe<span class="w"> </span>--group<span class="w"> </span><span class="nv">$CONSUMER_GROUP</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span>+2<span class="k">)</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="nv">total_lag</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="nv">max_lag</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="nv">partitions_with_lag</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="w">    </span><span class="nv">lag</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $6}&#39;</span><span class="k">)</span>
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lag</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lag</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="w">        </span><span class="nv">total_lag</span><span class="o">=</span><span class="k">$((</span><span class="nv">total_lag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">lag</span><span class="k">))</span>
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lag</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="w">            </span><span class="nv">partitions_with_lag</span><span class="o">=</span><span class="k">$((</span><span class="nv">partitions_with_lag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lag</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$max_lag</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="w">            </span><span class="nv">max_lag</span><span class="o">=</span><span class="nv">$lag</span>
<a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a><span class="k">done</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lag_data</span><span class="s2">&quot;</span>
<a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a>
<a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Lag total: </span><span class="nv">$total_lag</span><span class="s2">&quot;</span>
<a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Lag maximum: </span><span class="nv">$max_lag</span><span class="s2">&quot;</span>
<a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Partitions avec lag: </span><span class="nv">$partitions_with_lag</span><span class="s2">&quot;</span>
<a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a>
<a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a><span class="c1"># Recommandations</span>
<a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Recommandations ---&quot;</span>
<a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a>
<a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$total_lag</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">100000</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;⚠️  Lag élevé: Considérer l&#39;ajout de consumers ou l&#39;optimisation du traitement&quot;</span>
<a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a><span class="k">fi</span>
<a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a>
<a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$max_lag</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">50000</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$partitions_with_lag</span><span class="s2">&quot;</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;⚠️  Lag concentré sur peu de partitions: Possible hot partition&quot;</span>
<a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a><span class="k">fi</span>
</code></pre></div>
<h3 id="iii1144-optimisation-des-brokers">III.11.4.4 Optimisation des Brokers<a class="headerlink" href="#iii1144-optimisation-des-brokers" title="Permanent link">&para;</a></h3>
<p><strong>Configuration broker pour hautes performances</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># server.properties - Configuration optimisée</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="c1"># Threads de traitement</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="na">num.network.threads</span><span class="o">=</span><span class="s">8</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="na">num.io.threads</span><span class="o">=</span><span class="s">16</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="na">num.replica.fetchers</span><span class="o">=</span><span class="s">4</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="c1"># Buffers socket</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="na">socket.send.buffer.bytes</span><span class="o">=</span><span class="s">102400</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="na">socket.receive.buffer.bytes</span><span class="o">=</span><span class="s">102400</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="na">socket.request.max.bytes</span><span class="o">=</span><span class="s">104857600</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="c1"># Logs</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="na">log.flush.interval.messages</span><span class="o">=</span><span class="s">10000</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="na">log.flush.interval.ms</span><span class="o">=</span><span class="s">1000</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="c1"># Réplication</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="na">replica.fetch.min.bytes</span><span class="o">=</span><span class="s">1</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="na">replica.fetch.max.bytes</span><span class="o">=</span><span class="s">10485760</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="na">replica.fetch.wait.max.ms</span><span class="o">=</span><span class="s">500</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="na">replica.lag.time.max.ms</span><span class="o">=</span><span class="s">30000</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="c1"># Segments</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="na">log.segment.bytes</span><span class="o">=</span><span class="s">1073741824</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="na">log.retention.check.interval.ms</span><span class="o">=</span><span class="s">300000</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="c1"># Compression</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="na">compression.type</span><span class="o">=</span><span class="s">producer</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="c1"># OS page cache</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="na">log.flush.scheduler.interval.ms</span><span class="o">=</span><span class="s">9223372036854775807</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="c1"># Quotas (optionnel)</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="c1"># quota.producer.default=10485760</span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="c1"># quota.consumer.default=10485760</span>
</code></pre></div>
<p><strong>Tuning du système d'exploitation</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="c1"># scripts/tune_os_for_kafka.sh</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Configuration OS pour Kafka ===&quot;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="c1"># Augmenter les limites de fichiers ouverts</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/security/limits.conf<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="s">kafka soft nofile 128000</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="s">kafka hard nofile 128000</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="s">kafka soft nproc 65536</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="s">kafka hard nproc 65536</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="s">EOF</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="c1"># Paramètres réseau</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/sysctl.conf<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="s"># Buffers réseau</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="s">net.core.wmem_default=131072</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="s">net.core.rmem_default=131072</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="s">net.core.wmem_max=2097152</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="s">net.core.rmem_max=2097152</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="s">net.ipv4.tcp_wmem=4096 65536 2048000</span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="s">net.ipv4.tcp_rmem=4096 65536 2048000</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="s"># Connexions</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="s">net.core.netdev_max_backlog=50000</span>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="s">net.ipv4.tcp_max_syn_backlog=30000</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="s">net.ipv4.tcp_max_tw_buckets=2000000</span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="s">net.ipv4.tcp_tw_reuse=1</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="s">net.ipv4.tcp_fin_timeout=10</span>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="s"># Virtual memory</span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a><span class="s">vm.swappiness=1</span>
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a><span class="s">vm.dirty_background_ratio=5</span>
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a><span class="s">vm.dirty_ratio=60</span>
<a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a><span class="s">EOF</span>
<a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a>
<a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>sysctl<span class="w"> </span>-p
<a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>
<a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a><span class="c1"># Désactiver les huge pages transparentes (recommandé pour Kafka)</span>
<a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="nb">echo</span><span class="w"> </span>never<span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/mm/transparent_hugepage/enabled
<a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a><span class="nb">echo</span><span class="w"> </span>never<span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/mm/transparent_hugepage/defrag
<a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a>
<a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Configuration OS appliquée. Redémarrer Kafka pour appliquer les limites.&quot;</span>
</code></pre></div>
<h3 id="iii1145-gestion-des-hot-partitions">III.11.4.5 Gestion des Hot Partitions<a class="headerlink" href="#iii1145-gestion-des-hot-partitions" title="Permanent link">&para;</a></h3>
<p>Les hot partitions surviennent lorsqu'une partition reçoit disproportionnément plus de trafic que les autres, créant un goulot d'étranglement.</p>
<p><strong>Diagnostic des hot partitions</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1">// Outil de diagnostic des hot partitions</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HotPartitionDetector</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AdminClient</span><span class="w"> </span><span class="n">adminClient</span><span class="p">;</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">PartitionStats</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">analyzeDistribution</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">PartitionStats</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">        </span><span class="c1">// Récupérer les offsets de début et fin</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beginningOffsets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getBeginningOffsets</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">endOffsets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getEndOffsets</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">        </span><span class="c1">// Calculer le volume par partition</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">totalMessages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">volumes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TopicPartition</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">endOffsets</span><span class="p">.</span><span class="na">keySet</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="w">            </span><span class="kt">long</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">endOffsets</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">beginningOffsets</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">tp</span><span class="p">);</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="w">            </span><span class="n">volumes</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">volume</span><span class="p">);</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">            </span><span class="n">totalMessages</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">volume</span><span class="p">;</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="w">            </span><span class="n">stats</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PartitionStats</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="w"> </span><span class="n">volume</span><span class="p">));</span>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="w">        </span><span class="c1">// Calculer les statistiques</span>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">totalMessages</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">volumes</span><span class="p">.</span><span class="na">size</span><span class="p">();</span>
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">stdDev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateStdDev</span><span class="p">(</span><span class="n">volumes</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">);</span>
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="w">        </span><span class="c1">// Identifier les outliers (&gt; 2 écarts-types)</span>
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">PartitionStats</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">stats</span><span class="p">.</span><span class="na">values</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="w">            </span><span class="kt">double</span><span class="w"> </span><span class="n">zScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ps</span><span class="p">.</span><span class="na">volume</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">stdDev</span><span class="p">;</span>
<a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a><span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setZScore</span><span class="p">(</span><span class="n">zScore</span><span class="p">);</span>
<a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a>
<a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">zScore</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">2.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a><span class="w">                </span><span class="n">ps</span><span class="p">.</span><span class="na">setHotPartition</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Hot partition détectée: {} avec z-score {}&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a><span class="w">                    </span><span class="n">ps</span><span class="p">.</span><span class="na">partition</span><span class="p">,</span><span class="w"> </span><span class="n">zScore</span><span class="p">);</span>
<a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a>
<a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">stats</span><span class="p">;</span>
<a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a>
<a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">suggestRemediations</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">PartitionStats</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stats</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">suggestions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a>
<a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">hotPartitionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stats</span><span class="p">.</span><span class="na">values</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a><span class="w">            </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">PartitionStats</span><span class="p">::</span><span class="n">isHotPartition</span><span class="p">)</span>
<a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a><span class="w">            </span><span class="p">.</span><span class="na">count</span><span class="p">();</span>
<a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a>
<a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hotPartitionCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a><span class="w">            </span><span class="n">suggestions</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;1. Vérifier la stratégie de partitionnement du producer&quot;</span><span class="p">);</span>
<a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a><span class="w">            </span><span class="n">suggestions</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;2. Considérer une clé de partition plus distribuée&quot;</span><span class="p">);</span>
<a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a><span class="w">            </span><span class="n">suggestions</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;3. Augmenter le nombre de partitions si la clé est nécessaire&quot;</span><span class="p">);</span>
<a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a><span class="w">            </span><span class="n">suggestions</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;4. Implémenter un partitionneur personnalisé avec salage&quot;</span><span class="p">);</span>
<a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a>
<a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">suggestions</span><span class="p">;</span>
<a id="__codelineno-25-60" name="__codelineno-25-60" href="#__codelineno-25-60"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-61" name="__codelineno-25-61" href="#__codelineno-25-61"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Stratégies de résolution</strong></p>
<table>
<thead>
<tr>
<th>Cause</th>
<th>Symptôme</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Clé constante</td>
<td>Une partition monopolise le trafic</td>
<td>Ajouter un suffixe aléatoire à la clé</td>
</tr>
<tr>
<td>Distribution Zipf</td>
<td>Quelques clés dominent</td>
<td>Partitionneur avec hachage modifié</td>
</tr>
<tr>
<td>Pic temporel</td>
<td>Partition hot par moments</td>
<td>Pré-partitionnement temporel</td>
</tr>
<tr>
<td>Mauvais hachage</td>
<td>Distribution inégale</td>
<td>Changer l'algorithme de hachage</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="iii115-reprise-apres-sinistre-et-basculement">III.11.5 Reprise Après Sinistre et Basculement<a class="headerlink" href="#iii115-reprise-apres-sinistre-et-basculement" title="Permanent link">&para;</a></h2>
<h3 id="iii1151-strategies-de-continuite-dactivite">III.11.5.1 Stratégies de Continuité d'Activité<a class="headerlink" href="#iii1151-strategies-de-continuite-dactivite" title="Permanent link">&para;</a></h3>
<p>La stratégie de reprise après sinistre (Disaster Recovery, DR) définit comment l'organisation maintient ses opérations Kafka face à une défaillance majeure.</p>
<p><strong>Modèles de déploiement DR</strong></p>
<table>
<thead>
<tr>
<th>Modèle</th>
<th>RTO</th>
<th>RPO</th>
<th>Coût</th>
<th>Complexité</th>
</tr>
</thead>
<tbody>
<tr>
<td>Backup/Restore</td>
<td>Heures</td>
<td>Heures</td>
<td>Faible</td>
<td>Faible</td>
</tr>
<tr>
<td>Pilot Light</td>
<td>30-60 min</td>
<td>Minutes</td>
<td>Moyen</td>
<td>Moyenne</td>
</tr>
<tr>
<td>Warm Standby</td>
<td>10-30 min</td>
<td>Secondes</td>
<td>Moyen-Élevé</td>
<td>Élevée</td>
</tr>
<tr>
<td>Hot Standby</td>
<td>&lt; 5 min</td>
<td>~0</td>
<td>Élevé</td>
<td>Très élevée</td>
</tr>
<tr>
<td>Active-Active</td>
<td>~0</td>
<td>~0</td>
<td>Très élevé</td>
<td>Maximale</td>
</tr>
</tbody>
</table>
<p><strong>Architecture Hot Standby avec MirrorMaker 2</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>┌─────────────────────────────────────────────────────────────────┐
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>│                      Région Primaire                            │
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>│  ┌─────────────────────────────────────────────────────────┐   │
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>│  │              Cluster Kafka Principal                     │   │
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐    │   │
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>│  │  │Broker 1 │  │Broker 2 │  │Broker 3 │  │Broker 4 │    │   │
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘    │   │
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>│  └─────────────────────────────────────────────────────────┘   │
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>│                              │                                  │
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>│                              │ Réplication MM2                  │
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>│                              ▼                                  │
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>└──────────────────────────────┼──────────────────────────────────┘
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>                               │
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>                               │ Réseau inter-région
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>                               │
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>┌──────────────────────────────┼──────────────────────────────────┐
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>│                              ▼                                  │
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>│  ┌─────────────────────────────────────────────────────────┐   │
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>│  │              Cluster Kafka DR (Standby)                  │   │
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐    │   │
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>│  │  │Broker 1 │  │Broker 2 │  │Broker 3 │  │Broker 4 │    │   │
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘    │   │
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>│  └─────────────────────────────────────────────────────────┘   │
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>│                      Région DR                                  │
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>└─────────────────────────────────────────────────────────────────┘
</code></pre></div>
<h3 id="iii1152-procedure-de-basculement">III.11.5.2 Procédure de Basculement<a class="headerlink" href="#iii1152-procedure-de-basculement" title="Permanent link">&para;</a></h3>
<p><strong>Runbook de basculement automatisé</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="c1"># scripts/failover_to_dr.sh</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="nb">set</span><span class="w"> </span>-e
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="nv">PRIMARY_CLUSTER</span><span class="o">=</span><span class="s2">&quot;kafka-primary.example.com:9092&quot;</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="nv">DR_CLUSTER</span><span class="o">=</span><span class="s2">&quot;kafka-dr.example.com:9092&quot;</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="nv">MM2_CONNECTOR</span><span class="o">=</span><span class="s2">&quot;mirrormaker2&quot;</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="nv">DNS_ZONE</span><span class="o">=</span><span class="s2">&quot;example.com&quot;</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="nv">KAFKA_CNAME</span><span class="o">=</span><span class="s2">&quot;kafka.example.com&quot;</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>log<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2">] </span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="o">}</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>check_primary_health<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Vérification de la santé du cluster primaire...&quot;</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>kafka-broker-api-versions.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$PRIMARY_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="w">        </span>--timeout<span class="w"> </span><span class="m">10000</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="o">}</span>
<a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>
<a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a>check_dr_health<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Vérification de la santé du cluster DR...&quot;</span>
<a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a>
<a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>kafka-broker-api-versions.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$DR_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a><span class="w">        </span>--timeout<span class="w"> </span><span class="m">10000</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a><span class="w">        </span>log<span class="w"> </span><span class="s2">&quot;ERREUR: Cluster DR non disponible&quot;</span>
<a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Cluster DR opérationnel&quot;</span>
<a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a><span class="o">}</span>
<a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a>
<a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a>check_replication_lag<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-27-38" name="__codelineno-27-38" href="#__codelineno-27-38"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Vérification du lag de réplication...&quot;</span>
<a id="__codelineno-27-39" name="__codelineno-27-39" href="#__codelineno-27-39"></a>
<a id="__codelineno-27-40" name="__codelineno-27-40" href="#__codelineno-27-40"></a><span class="w">    </span><span class="nv">lag</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;http://mm2-metrics:8080/metrics&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-41" name="__codelineno-27-41" href="#__codelineno-27-41"></a><span class="w">        </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;mm2_replication_lag&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-42" name="__codelineno-27-42" href="#__codelineno-27-42"></a><span class="w">        </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{sum += $2} END {print sum}&#39;</span><span class="k">)</span>
<a id="__codelineno-27-43" name="__codelineno-27-43" href="#__codelineno-27-43"></a>
<a id="__codelineno-27-44" name="__codelineno-27-44" href="#__codelineno-27-44"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Lag total: </span><span class="nv">$lag</span><span class="s2"> messages&quot;</span>
<a id="__codelineno-27-45" name="__codelineno-27-45" href="#__codelineno-27-45"></a>
<a id="__codelineno-27-46" name="__codelineno-27-46" href="#__codelineno-27-46"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lag</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">10000</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-27-47" name="__codelineno-27-47" href="#__codelineno-27-47"></a><span class="w">        </span>log<span class="w"> </span><span class="s2">&quot;ATTENTION: Lag élevé. Risque de perte de données: ~</span><span class="nv">$lag</span><span class="s2"> messages&quot;</span>
<a id="__codelineno-27-48" name="__codelineno-27-48" href="#__codelineno-27-48"></a><span class="w">        </span><span class="nb">read</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;Continuer le basculement? (yes/no) &quot;</span><span class="w"> </span>confirm
<a id="__codelineno-27-49" name="__codelineno-27-49" href="#__codelineno-27-49"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$confirm</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-27-50" name="__codelineno-27-50" href="#__codelineno-27-50"></a><span class="w">            </span>log<span class="w"> </span><span class="s2">&quot;Basculement annulé&quot;</span>
<a id="__codelineno-27-51" name="__codelineno-27-51" href="#__codelineno-27-51"></a><span class="w">            </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-27-52" name="__codelineno-27-52" href="#__codelineno-27-52"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-27-53" name="__codelineno-27-53" href="#__codelineno-27-53"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-27-54" name="__codelineno-27-54" href="#__codelineno-27-54"></a><span class="o">}</span>
<a id="__codelineno-27-55" name="__codelineno-27-55" href="#__codelineno-27-55"></a>
<a id="__codelineno-27-56" name="__codelineno-27-56" href="#__codelineno-27-56"></a>stop_mirrormaker<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-27-57" name="__codelineno-27-57" href="#__codelineno-27-57"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Arrêt de MirrorMaker 2...&quot;</span>
<a id="__codelineno-27-58" name="__codelineno-27-58" href="#__codelineno-27-58"></a>
<a id="__codelineno-27-59" name="__codelineno-27-59" href="#__codelineno-27-59"></a><span class="w">    </span><span class="c1"># Arrêt gracieux pour finaliser les réplications en cours</span>
<a id="__codelineno-27-60" name="__codelineno-27-60" href="#__codelineno-27-60"></a><span class="w">    </span>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span><span class="s2">&quot;http://kafka-connect:8083/connectors/</span><span class="nv">$MM2_CONNECTOR</span><span class="s2">/pause&quot;</span>
<a id="__codelineno-27-61" name="__codelineno-27-61" href="#__codelineno-27-61"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">30</span>
<a id="__codelineno-27-62" name="__codelineno-27-62" href="#__codelineno-27-62"></a><span class="w">    </span>curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span><span class="s2">&quot;http://kafka-connect:8083/connectors/</span><span class="nv">$MM2_CONNECTOR</span><span class="s2">&quot;</span>
<a id="__codelineno-27-63" name="__codelineno-27-63" href="#__codelineno-27-63"></a>
<a id="__codelineno-27-64" name="__codelineno-27-64" href="#__codelineno-27-64"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;MirrorMaker arrêté&quot;</span>
<a id="__codelineno-27-65" name="__codelineno-27-65" href="#__codelineno-27-65"></a><span class="o">}</span>
<a id="__codelineno-27-66" name="__codelineno-27-66" href="#__codelineno-27-66"></a>
<a id="__codelineno-27-67" name="__codelineno-27-67" href="#__codelineno-27-67"></a>update_dns<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-27-68" name="__codelineno-27-68" href="#__codelineno-27-68"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Mise à jour DNS vers le cluster DR...&quot;</span>
<a id="__codelineno-27-69" name="__codelineno-27-69" href="#__codelineno-27-69"></a>
<a id="__codelineno-27-70" name="__codelineno-27-70" href="#__codelineno-27-70"></a><span class="w">    </span><span class="c1"># Exemple avec AWS Route 53</span>
<a id="__codelineno-27-71" name="__codelineno-27-71" href="#__codelineno-27-71"></a><span class="w">    </span>aws<span class="w"> </span>route53<span class="w"> </span>change-resource-record-sets<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-72" name="__codelineno-27-72" href="#__codelineno-27-72"></a><span class="w">        </span>--hosted-zone-id<span class="w"> </span><span class="nv">$HOSTED_ZONE_ID</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-73" name="__codelineno-27-73" href="#__codelineno-27-73"></a><span class="w">        </span>--change-batch<span class="w"> </span><span class="s1">&#39;{</span>
<a id="__codelineno-27-74" name="__codelineno-27-74" href="#__codelineno-27-74"></a><span class="s1">            &quot;Changes&quot;: [{</span>
<a id="__codelineno-27-75" name="__codelineno-27-75" href="#__codelineno-27-75"></a><span class="s1">                &quot;Action&quot;: &quot;UPSERT&quot;,</span>
<a id="__codelineno-27-76" name="__codelineno-27-76" href="#__codelineno-27-76"></a><span class="s1">                &quot;ResourceRecordSet&quot;: {</span>
<a id="__codelineno-27-77" name="__codelineno-27-77" href="#__codelineno-27-77"></a><span class="s1">                    &quot;Name&quot;: &quot;&#39;</span><span class="nv">$KAFKA_CNAME</span><span class="s1">&#39;&quot;,</span>
<a id="__codelineno-27-78" name="__codelineno-27-78" href="#__codelineno-27-78"></a><span class="s1">                    &quot;Type&quot;: &quot;CNAME&quot;,</span>
<a id="__codelineno-27-79" name="__codelineno-27-79" href="#__codelineno-27-79"></a><span class="s1">                    &quot;TTL&quot;: 60,</span>
<a id="__codelineno-27-80" name="__codelineno-27-80" href="#__codelineno-27-80"></a><span class="s1">                    &quot;ResourceRecords&quot;: [{&quot;Value&quot;: &quot;&#39;</span><span class="nv">$DR_CLUSTER</span><span class="s1">&#39;&quot;}]</span>
<a id="__codelineno-27-81" name="__codelineno-27-81" href="#__codelineno-27-81"></a><span class="s1">                }</span>
<a id="__codelineno-27-82" name="__codelineno-27-82" href="#__codelineno-27-82"></a><span class="s1">            }]</span>
<a id="__codelineno-27-83" name="__codelineno-27-83" href="#__codelineno-27-83"></a><span class="s1">        }&#39;</span>
<a id="__codelineno-27-84" name="__codelineno-27-84" href="#__codelineno-27-84"></a>
<a id="__codelineno-27-85" name="__codelineno-27-85" href="#__codelineno-27-85"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;DNS mis à jour. TTL: 60 secondes&quot;</span>
<a id="__codelineno-27-86" name="__codelineno-27-86" href="#__codelineno-27-86"></a><span class="o">}</span>
<a id="__codelineno-27-87" name="__codelineno-27-87" href="#__codelineno-27-87"></a>
<a id="__codelineno-27-88" name="__codelineno-27-88" href="#__codelineno-27-88"></a>notify_teams<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-27-89" name="__codelineno-27-89" href="#__codelineno-27-89"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Notification des équipes...&quot;</span>
<a id="__codelineno-27-90" name="__codelineno-27-90" href="#__codelineno-27-90"></a>
<a id="__codelineno-27-91" name="__codelineno-27-91" href="#__codelineno-27-91"></a><span class="w">    </span><span class="c1"># Slack notification</span>
<a id="__codelineno-27-92" name="__codelineno-27-92" href="#__codelineno-27-92"></a><span class="w">    </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-93" name="__codelineno-27-93" href="#__codelineno-27-93"></a><span class="w">        </span>--data<span class="w"> </span><span class="s1">&#39;{&quot;text&quot;:&quot;🚨 BASCULEMENT KAFKA: Cluster DR activé. Cluster primaire indisponible.&quot;}&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-94" name="__codelineno-27-94" href="#__codelineno-27-94"></a><span class="w">        </span><span class="nv">$SLACK_WEBHOOK_URL</span>
<a id="__codelineno-27-95" name="__codelineno-27-95" href="#__codelineno-27-95"></a>
<a id="__codelineno-27-96" name="__codelineno-27-96" href="#__codelineno-27-96"></a><span class="w">    </span><span class="c1"># PagerDuty incident</span>
<a id="__codelineno-27-97" name="__codelineno-27-97" href="#__codelineno-27-97"></a><span class="w">    </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;https://events.pagerduty.com/v2/enqueue&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-98" name="__codelineno-27-98" href="#__codelineno-27-98"></a><span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-99" name="__codelineno-27-99" href="#__codelineno-27-99"></a><span class="w">        </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<a id="__codelineno-27-100" name="__codelineno-27-100" href="#__codelineno-27-100"></a><span class="s1">            &quot;routing_key&quot;: &quot;&#39;</span><span class="nv">$PAGERDUTY_KEY</span><span class="s1">&#39;&quot;,</span>
<a id="__codelineno-27-101" name="__codelineno-27-101" href="#__codelineno-27-101"></a><span class="s1">            &quot;event_action&quot;: &quot;trigger&quot;,</span>
<a id="__codelineno-27-102" name="__codelineno-27-102" href="#__codelineno-27-102"></a><span class="s1">            &quot;payload&quot;: {</span>
<a id="__codelineno-27-103" name="__codelineno-27-103" href="#__codelineno-27-103"></a><span class="s1">                &quot;summary&quot;: &quot;Kafka Failover to DR&quot;,</span>
<a id="__codelineno-27-104" name="__codelineno-27-104" href="#__codelineno-27-104"></a><span class="s1">                &quot;severity&quot;: &quot;critical&quot;,</span>
<a id="__codelineno-27-105" name="__codelineno-27-105" href="#__codelineno-27-105"></a><span class="s1">                &quot;source&quot;: &quot;kafka-failover-script&quot;</span>
<a id="__codelineno-27-106" name="__codelineno-27-106" href="#__codelineno-27-106"></a><span class="s1">            }</span>
<a id="__codelineno-27-107" name="__codelineno-27-107" href="#__codelineno-27-107"></a><span class="s1">        }&#39;</span>
<a id="__codelineno-27-108" name="__codelineno-27-108" href="#__codelineno-27-108"></a><span class="o">}</span>
<a id="__codelineno-27-109" name="__codelineno-27-109" href="#__codelineno-27-109"></a>
<a id="__codelineno-27-110" name="__codelineno-27-110" href="#__codelineno-27-110"></a>validate_failover<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-27-111" name="__codelineno-27-111" href="#__codelineno-27-111"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Validation du basculement...&quot;</span>
<a id="__codelineno-27-112" name="__codelineno-27-112" href="#__codelineno-27-112"></a>
<a id="__codelineno-27-113" name="__codelineno-27-113" href="#__codelineno-27-113"></a><span class="w">    </span><span class="c1"># Test de production</span>
<a id="__codelineno-27-114" name="__codelineno-27-114" href="#__codelineno-27-114"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;test-failover-</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>kafka-console-producer.sh<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-115" name="__codelineno-27-115" href="#__codelineno-27-115"></a><span class="w">        </span>--bootstrap-server<span class="w"> </span><span class="nv">$DR_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-116" name="__codelineno-27-116" href="#__codelineno-27-116"></a><span class="w">        </span>--topic<span class="w"> </span>failover-test
<a id="__codelineno-27-117" name="__codelineno-27-117" href="#__codelineno-27-117"></a>
<a id="__codelineno-27-118" name="__codelineno-27-118" href="#__codelineno-27-118"></a><span class="w">    </span><span class="c1"># Test de consommation</span>
<a id="__codelineno-27-119" name="__codelineno-27-119" href="#__codelineno-27-119"></a><span class="w">    </span>timeout<span class="w"> </span><span class="m">10</span><span class="w"> </span>kafka-console-consumer.sh<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-120" name="__codelineno-27-120" href="#__codelineno-27-120"></a><span class="w">        </span>--bootstrap-server<span class="w"> </span><span class="nv">$DR_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-121" name="__codelineno-27-121" href="#__codelineno-27-121"></a><span class="w">        </span>--topic<span class="w"> </span>failover-test<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-122" name="__codelineno-27-122" href="#__codelineno-27-122"></a><span class="w">        </span>--from-beginning<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-27-123" name="__codelineno-27-123" href="#__codelineno-27-123"></a><span class="w">        </span>--max-messages<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-27-124" name="__codelineno-27-124" href="#__codelineno-27-124"></a>
<a id="__codelineno-27-125" name="__codelineno-27-125" href="#__codelineno-27-125"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Validation réussie&quot;</span>
<a id="__codelineno-27-126" name="__codelineno-27-126" href="#__codelineno-27-126"></a><span class="o">}</span>
<a id="__codelineno-27-127" name="__codelineno-27-127" href="#__codelineno-27-127"></a>
<a id="__codelineno-27-128" name="__codelineno-27-128" href="#__codelineno-27-128"></a><span class="c1"># === EXECUTION PRINCIPALE ===</span>
<a id="__codelineno-27-129" name="__codelineno-27-129" href="#__codelineno-27-129"></a>
<a id="__codelineno-27-130" name="__codelineno-27-130" href="#__codelineno-27-130"></a>log<span class="w"> </span><span class="s2">&quot;=== DÉBUT DE LA PROCÉDURE DE BASCULEMENT ===&quot;</span>
<a id="__codelineno-27-131" name="__codelineno-27-131" href="#__codelineno-27-131"></a>
<a id="__codelineno-27-132" name="__codelineno-27-132" href="#__codelineno-27-132"></a><span class="c1"># Vérifier si le basculement est nécessaire</span>
<a id="__codelineno-27-133" name="__codelineno-27-133" href="#__codelineno-27-133"></a><span class="k">if</span><span class="w"> </span>check_primary_health<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-27-134" name="__codelineno-27-134" href="#__codelineno-27-134"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Le cluster primaire est accessible. Basculement non nécessaire.&quot;</span>
<a id="__codelineno-27-135" name="__codelineno-27-135" href="#__codelineno-27-135"></a><span class="w">    </span><span class="nb">read</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;Forcer le basculement? (yes/no) &quot;</span><span class="w"> </span>force
<a id="__codelineno-27-136" name="__codelineno-27-136" href="#__codelineno-27-136"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$force</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-27-137" name="__codelineno-27-137" href="#__codelineno-27-137"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-27-138" name="__codelineno-27-138" href="#__codelineno-27-138"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-27-139" name="__codelineno-27-139" href="#__codelineno-27-139"></a><span class="k">fi</span>
<a id="__codelineno-27-140" name="__codelineno-27-140" href="#__codelineno-27-140"></a>
<a id="__codelineno-27-141" name="__codelineno-27-141" href="#__codelineno-27-141"></a><span class="c1"># Exécuter le basculement</span>
<a id="__codelineno-27-142" name="__codelineno-27-142" href="#__codelineno-27-142"></a>check_dr_health
<a id="__codelineno-27-143" name="__codelineno-27-143" href="#__codelineno-27-143"></a>check_replication_lag
<a id="__codelineno-27-144" name="__codelineno-27-144" href="#__codelineno-27-144"></a>stop_mirrormaker
<a id="__codelineno-27-145" name="__codelineno-27-145" href="#__codelineno-27-145"></a>update_dns
<a id="__codelineno-27-146" name="__codelineno-27-146" href="#__codelineno-27-146"></a>notify_teams
<a id="__codelineno-27-147" name="__codelineno-27-147" href="#__codelineno-27-147"></a>
<a id="__codelineno-27-148" name="__codelineno-27-148" href="#__codelineno-27-148"></a><span class="c1"># Attendre la propagation DNS</span>
<a id="__codelineno-27-149" name="__codelineno-27-149" href="#__codelineno-27-149"></a>log<span class="w"> </span><span class="s2">&quot;Attente de la propagation DNS (120 secondes)...&quot;</span>
<a id="__codelineno-27-150" name="__codelineno-27-150" href="#__codelineno-27-150"></a>sleep<span class="w"> </span><span class="m">120</span>
<a id="__codelineno-27-151" name="__codelineno-27-151" href="#__codelineno-27-151"></a>
<a id="__codelineno-27-152" name="__codelineno-27-152" href="#__codelineno-27-152"></a>validate_failover
<a id="__codelineno-27-153" name="__codelineno-27-153" href="#__codelineno-27-153"></a>
<a id="__codelineno-27-154" name="__codelineno-27-154" href="#__codelineno-27-154"></a>log<span class="w"> </span><span class="s2">&quot;=== BASCULEMENT TERMINÉ ===&quot;</span>
<a id="__codelineno-27-155" name="__codelineno-27-155" href="#__codelineno-27-155"></a>log<span class="w"> </span><span class="s2">&quot;Actions post-basculement requises:&quot;</span>
<a id="__codelineno-27-156" name="__codelineno-27-156" href="#__codelineno-27-156"></a>log<span class="w"> </span><span class="s2">&quot;1. Vérifier les applications clientes&quot;</span>
<a id="__codelineno-27-157" name="__codelineno-27-157" href="#__codelineno-27-157"></a>log<span class="w"> </span><span class="s2">&quot;2. Monitorer les métriques du cluster DR&quot;</span>
<a id="__codelineno-27-158" name="__codelineno-27-158" href="#__codelineno-27-158"></a>log<span class="w"> </span><span class="s2">&quot;3. Planifier le retour sur le cluster primaire&quot;</span>
</code></pre></div>
<h3 id="iii1153-procedure-de-retour-failback">III.11.5.3 Procédure de Retour (Failback)<a class="headerlink" href="#iii1153-procedure-de-retour-failback" title="Permanent link">&para;</a></h3>
<p>Le retour vers le cluster primaire après réparation requiert une planification minutieuse pour éviter la perte de données produites pendant l'incident.</p>
<p><strong>Séquence de failback</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>Phase 1: Préparation
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>├── Valider la santé du cluster primaire
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>├── Estimer le volume de données à resynchroniser
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>├── Planifier la fenêtre de maintenance
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>└── Notifier les parties prenantes
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>Phase 2: Resynchronisation
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>├── Démarrer MirrorMaker DR → Primary
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>├── Attendre la convergence (lag → 0)
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>├── Valider l&#39;intégrité des données
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>└── Préparer les consommateurs
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>Phase 3: Basculement
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>├── Arrêter les producers sur DR
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>├── Attendre le drainage complet
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>├── Mettre à jour le DNS
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>├── Redémarrer les producers sur Primary
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>└── Migrer les offsets consommateurs
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>Phase 4: Nettoyage
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>├── Arrêter MirrorMaker DR → Primary
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>├── Reconfigurer MirrorMaker Primary → DR
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>├── Valider le fonctionnement nominal
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>└── Documentation post-mortem
</code></pre></div>
<blockquote>
<p><strong>Anti-patron</strong></p>
<p>Exécuter un failback précipité sans resynchronisation complète. Les données produites sur le cluster DR pendant l'incident doivent être répliquées vers le primaire avant de rediriger le trafic. Un failback hâtif peut entraîner une perte de données significative.</p>
</blockquote>
<h3 id="iii1154-tests-de-reprise-apres-sinistre">III.11.5.4 Tests de Reprise Après Sinistre<a class="headerlink" href="#iii1154-tests-de-reprise-apres-sinistre" title="Permanent link">&para;</a></h3>
<p>Les tests réguliers de DR valident la capacité réelle de l'organisation à basculer en situation de crise.</p>
<p><strong>Programme de tests DR</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># dr-test-schedule.yaml</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="nt">dr_tests</span><span class="p">:</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">communication&quot;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">    </span><span class="nt">frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">weekly</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">    </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15min</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="nt">scope</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Vérification</span><span class="nv"> </span><span class="s">connectivité</span><span class="nv"> </span><span class="s">MM2&quot;</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="nt">impact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">    </span><span class="nt">automation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">full</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">basculement</span><span class="nv"> </span><span class="s">partiel&quot;</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">    </span><span class="nt">frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monthly</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">    </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2h</span>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">    </span><span class="nt">scope</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Basculement</span><span class="nv"> </span><span class="s">d&#39;un</span><span class="nv"> </span><span class="s">topic</span><span class="nv"> </span><span class="s">non-critique&quot;</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">    </span><span class="nt">impact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">minimal</span>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">    </span><span class="nt">automation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">partial</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">basculement</span><span class="nv"> </span><span class="s">complet&quot;</span>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">    </span><span class="nt">frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quarterly</span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="w">    </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4h</span>
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">    </span><span class="nt">scope</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Simulation</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">perte</span><span class="nv"> </span><span class="s">du</span><span class="nv"> </span><span class="s">datacenter</span><span class="nv"> </span><span class="s">primaire&quot;</span>
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">    </span><span class="nt">impact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">planned_outage</span>
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="w">    </span><span class="nt">automation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual_validation</span>
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">chaos&quot;</span>
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="w">    </span><span class="nt">frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">semi_annually</span>
<a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="w">    </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8h</span>
<a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="w">    </span><span class="nt">scope</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Injection</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">pannes</span><span class="nv"> </span><span class="s">multiples&quot;</span>
<a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a><span class="w">    </span><span class="nt">impact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controlled</span>
<a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="w">    </span><span class="nt">automation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
</code></pre></div>
<p><strong>Script de test DR automatisé</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="c1"># scripts/dr_test.sh</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="nv">TEST_ID</span><span class="o">=</span><span class="s2">&quot;dr-test-</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d-%H%M%S<span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="nv">TEST_TOPIC</span><span class="o">=</span><span class="s2">&quot;dr-test-topic-</span><span class="nv">$TEST_ID</span><span class="s2">&quot;</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="nv">MESSAGE_COUNT</span><span class="o">=</span><span class="m">10000</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>log<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2">] [</span><span class="nv">$TEST_ID</span><span class="s2">] </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/var/log/dr-tests.log
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="o">}</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>setup_test<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Création du topic de test...&quot;</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="w">    </span>kafka-topics.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$PRIMARY_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="w">        </span>--create<span class="w"> </span>--topic<span class="w"> </span><span class="nv">$TEST_TOPIC</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="w">        </span>--partitions<span class="w"> </span><span class="m">6</span><span class="w"> </span>--replication-factor<span class="w"> </span><span class="m">3</span>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Attente de la réplication vers DR...&quot;</span>
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">60</span>
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="w">    </span><span class="c1"># Vérifier que le topic est répliqué</span>
<a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>kafka-topics.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$DR_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a><span class="w">        </span>--list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;primary.</span><span class="nv">$TEST_TOPIC</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a><span class="w">        </span>log<span class="w"> </span><span class="s2">&quot;ERREUR: Topic non répliqué vers DR&quot;</span>
<a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a><span class="o">}</span>
<a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a>
<a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a>produce_test_data<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Production de </span><span class="nv">$MESSAGE_COUNT</span><span class="s2"> messages de test...&quot;</span>
<a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a>
<a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a><span class="w">    </span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nv">$MESSAGE_COUNT</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>kafka-console-producer.sh<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a><span class="w">        </span>--bootstrap-server<span class="w"> </span><span class="nv">$PRIMARY_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a><span class="w">        </span>--topic<span class="w"> </span><span class="nv">$TEST_TOPIC</span>
<a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a>
<a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Production terminée&quot;</span>
<a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a><span class="o">}</span>
<a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a>
<a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a>wait_for_replication<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Attente de la réplication complète...&quot;</span>
<a id="__codelineno-30-42" name="__codelineno-30-42" href="#__codelineno-30-42"></a>
<a id="__codelineno-30-43" name="__codelineno-30-43" href="#__codelineno-30-43"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-30-44" name="__codelineno-30-44" href="#__codelineno-30-44"></a><span class="w">        </span><span class="nv">primary_offset</span><span class="o">=</span><span class="k">$(</span>kafka-run-class.sh<span class="w"> </span>kafka.tools.GetOffsetShell<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-45" name="__codelineno-30-45" href="#__codelineno-30-45"></a><span class="w">            </span>--broker-list<span class="w"> </span><span class="nv">$PRIMARY_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-46" name="__codelineno-30-46" href="#__codelineno-30-46"></a><span class="w">            </span>--topic<span class="w"> </span><span class="nv">$TEST_TOPIC</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-47" name="__codelineno-30-47" href="#__codelineno-30-47"></a><span class="w">            </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F:<span class="w"> </span><span class="s1">&#39;{sum += $3} END {print sum}&#39;</span><span class="k">)</span>
<a id="__codelineno-30-48" name="__codelineno-30-48" href="#__codelineno-30-48"></a>
<a id="__codelineno-30-49" name="__codelineno-30-49" href="#__codelineno-30-49"></a><span class="w">        </span><span class="nv">dr_offset</span><span class="o">=</span><span class="k">$(</span>kafka-run-class.sh<span class="w"> </span>kafka.tools.GetOffsetShell<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-50" name="__codelineno-30-50" href="#__codelineno-30-50"></a><span class="w">            </span>--broker-list<span class="w"> </span><span class="nv">$DR_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-51" name="__codelineno-30-51" href="#__codelineno-30-51"></a><span class="w">            </span>--topic<span class="w"> </span><span class="s2">&quot;primary.</span><span class="nv">$TEST_TOPIC</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-52" name="__codelineno-30-52" href="#__codelineno-30-52"></a><span class="w">            </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F:<span class="w"> </span><span class="s1">&#39;{sum += $3} END {print sum}&#39;</span><span class="k">)</span>
<a id="__codelineno-30-53" name="__codelineno-30-53" href="#__codelineno-30-53"></a>
<a id="__codelineno-30-54" name="__codelineno-30-54" href="#__codelineno-30-54"></a><span class="w">        </span><span class="nv">lag</span><span class="o">=</span><span class="k">$((</span><span class="nv">primary_offset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">dr_offset</span><span class="k">))</span>
<a id="__codelineno-30-55" name="__codelineno-30-55" href="#__codelineno-30-55"></a>
<a id="__codelineno-30-56" name="__codelineno-30-56" href="#__codelineno-30-56"></a><span class="w">        </span>log<span class="w"> </span><span class="s2">&quot;Lag actuel: </span><span class="nv">$lag</span><span class="s2"> messages&quot;</span>
<a id="__codelineno-30-57" name="__codelineno-30-57" href="#__codelineno-30-57"></a>
<a id="__codelineno-30-58" name="__codelineno-30-58" href="#__codelineno-30-58"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lag</span><span class="s2">&quot;</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-30-59" name="__codelineno-30-59" href="#__codelineno-30-59"></a><span class="w">            </span>log<span class="w"> </span><span class="s2">&quot;Réplication complète&quot;</span>
<a id="__codelineno-30-60" name="__codelineno-30-60" href="#__codelineno-30-60"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-30-61" name="__codelineno-30-61" href="#__codelineno-30-61"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-30-62" name="__codelineno-30-62" href="#__codelineno-30-62"></a>
<a id="__codelineno-30-63" name="__codelineno-30-63" href="#__codelineno-30-63"></a><span class="w">        </span>sleep<span class="w"> </span><span class="m">5</span>
<a id="__codelineno-30-64" name="__codelineno-30-64" href="#__codelineno-30-64"></a><span class="w">    </span><span class="k">done</span>
<a id="__codelineno-30-65" name="__codelineno-30-65" href="#__codelineno-30-65"></a><span class="o">}</span>
<a id="__codelineno-30-66" name="__codelineno-30-66" href="#__codelineno-30-66"></a>
<a id="__codelineno-30-67" name="__codelineno-30-67" href="#__codelineno-30-67"></a>verify_data_integrity<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-30-68" name="__codelineno-30-68" href="#__codelineno-30-68"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Vérification de l&#39;intégrité des données...&quot;</span>
<a id="__codelineno-30-69" name="__codelineno-30-69" href="#__codelineno-30-69"></a>
<a id="__codelineno-30-70" name="__codelineno-30-70" href="#__codelineno-30-70"></a><span class="w">    </span><span class="nv">primary_checksum</span><span class="o">=</span><span class="k">$(</span>kafka-console-consumer.sh<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-71" name="__codelineno-30-71" href="#__codelineno-30-71"></a><span class="w">        </span>--bootstrap-server<span class="w"> </span><span class="nv">$PRIMARY_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-72" name="__codelineno-30-72" href="#__codelineno-30-72"></a><span class="w">        </span>--topic<span class="w"> </span><span class="nv">$TEST_TOPIC</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-73" name="__codelineno-30-73" href="#__codelineno-30-73"></a><span class="w">        </span>--from-beginning<span class="w"> </span>--max-messages<span class="w"> </span><span class="nv">$MESSAGE_COUNT</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-74" name="__codelineno-30-74" href="#__codelineno-30-74"></a><span class="w">        </span>--timeout-ms<span class="w"> </span><span class="m">30000</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>md5sum<span class="k">)</span>
<a id="__codelineno-30-75" name="__codelineno-30-75" href="#__codelineno-30-75"></a>
<a id="__codelineno-30-76" name="__codelineno-30-76" href="#__codelineno-30-76"></a><span class="w">    </span><span class="nv">dr_checksum</span><span class="o">=</span><span class="k">$(</span>kafka-console-consumer.sh<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-77" name="__codelineno-30-77" href="#__codelineno-30-77"></a><span class="w">        </span>--bootstrap-server<span class="w"> </span><span class="nv">$DR_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-78" name="__codelineno-30-78" href="#__codelineno-30-78"></a><span class="w">        </span>--topic<span class="w"> </span><span class="s2">&quot;primary.</span><span class="nv">$TEST_TOPIC</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-79" name="__codelineno-30-79" href="#__codelineno-30-79"></a><span class="w">        </span>--from-beginning<span class="w"> </span>--max-messages<span class="w"> </span><span class="nv">$MESSAGE_COUNT</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-80" name="__codelineno-30-80" href="#__codelineno-30-80"></a><span class="w">        </span>--timeout-ms<span class="w"> </span><span class="m">30000</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>md5sum<span class="k">)</span>
<a id="__codelineno-30-81" name="__codelineno-30-81" href="#__codelineno-30-81"></a>
<a id="__codelineno-30-82" name="__codelineno-30-82" href="#__codelineno-30-82"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$primary_checksum</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$dr_checksum</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-30-83" name="__codelineno-30-83" href="#__codelineno-30-83"></a><span class="w">        </span>log<span class="w"> </span><span class="s2">&quot;✓ Intégrité des données validée&quot;</span>
<a id="__codelineno-30-84" name="__codelineno-30-84" href="#__codelineno-30-84"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-30-85" name="__codelineno-30-85" href="#__codelineno-30-85"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-30-86" name="__codelineno-30-86" href="#__codelineno-30-86"></a><span class="w">        </span>log<span class="w"> </span><span class="s2">&quot;✗ ERREUR: Checksums différents&quot;</span>
<a id="__codelineno-30-87" name="__codelineno-30-87" href="#__codelineno-30-87"></a><span class="w">        </span>log<span class="w"> </span><span class="s2">&quot;  Primary: </span><span class="nv">$primary_checksum</span><span class="s2">&quot;</span>
<a id="__codelineno-30-88" name="__codelineno-30-88" href="#__codelineno-30-88"></a><span class="w">        </span>log<span class="w"> </span><span class="s2">&quot;  DR: </span><span class="nv">$dr_checksum</span><span class="s2">&quot;</span>
<a id="__codelineno-30-89" name="__codelineno-30-89" href="#__codelineno-30-89"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-30-90" name="__codelineno-30-90" href="#__codelineno-30-90"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-30-91" name="__codelineno-30-91" href="#__codelineno-30-91"></a><span class="o">}</span>
<a id="__codelineno-30-92" name="__codelineno-30-92" href="#__codelineno-30-92"></a>
<a id="__codelineno-30-93" name="__codelineno-30-93" href="#__codelineno-30-93"></a>cleanup<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-30-94" name="__codelineno-30-94" href="#__codelineno-30-94"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Nettoyage...&quot;</span>
<a id="__codelineno-30-95" name="__codelineno-30-95" href="#__codelineno-30-95"></a>
<a id="__codelineno-30-96" name="__codelineno-30-96" href="#__codelineno-30-96"></a><span class="w">    </span>kafka-topics.sh<span class="w"> </span>--bootstrap-server<span class="w"> </span><span class="nv">$PRIMARY_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-97" name="__codelineno-30-97" href="#__codelineno-30-97"></a><span class="w">        </span>--delete<span class="w"> </span>--topic<span class="w"> </span><span class="nv">$TEST_TOPIC</span>
<a id="__codelineno-30-98" name="__codelineno-30-98" href="#__codelineno-30-98"></a>
<a id="__codelineno-30-99" name="__codelineno-30-99" href="#__codelineno-30-99"></a><span class="w">    </span><span class="c1"># Le topic miroir sera supprimé automatiquement par MM2</span>
<a id="__codelineno-30-100" name="__codelineno-30-100" href="#__codelineno-30-100"></a><span class="o">}</span>
<a id="__codelineno-30-101" name="__codelineno-30-101" href="#__codelineno-30-101"></a>
<a id="__codelineno-30-102" name="__codelineno-30-102" href="#__codelineno-30-102"></a>measure_rpo<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-30-103" name="__codelineno-30-103" href="#__codelineno-30-103"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Mesure du RPO...&quot;</span>
<a id="__codelineno-30-104" name="__codelineno-30-104" href="#__codelineno-30-104"></a>
<a id="__codelineno-30-105" name="__codelineno-30-105" href="#__codelineno-30-105"></a><span class="w">    </span><span class="c1"># Produire un message avec timestamp</span>
<a id="__codelineno-30-106" name="__codelineno-30-106" href="#__codelineno-30-106"></a><span class="w">    </span><span class="nv">start_time</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s%N<span class="k">)</span>
<a id="__codelineno-30-107" name="__codelineno-30-107" href="#__codelineno-30-107"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;rpo-test-</span><span class="nv">$start_time</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>kafka-console-producer.sh<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-108" name="__codelineno-30-108" href="#__codelineno-30-108"></a><span class="w">        </span>--bootstrap-server<span class="w"> </span><span class="nv">$PRIMARY_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-109" name="__codelineno-30-109" href="#__codelineno-30-109"></a><span class="w">        </span>--topic<span class="w"> </span><span class="nv">$TEST_TOPIC</span>
<a id="__codelineno-30-110" name="__codelineno-30-110" href="#__codelineno-30-110"></a>
<a id="__codelineno-30-111" name="__codelineno-30-111" href="#__codelineno-30-111"></a><span class="w">    </span><span class="c1"># Attendre sa réplication</span>
<a id="__codelineno-30-112" name="__codelineno-30-112" href="#__codelineno-30-112"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-30-113" name="__codelineno-30-113" href="#__codelineno-30-113"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span>kafka-console-consumer.sh<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-114" name="__codelineno-30-114" href="#__codelineno-30-114"></a><span class="w">            </span>--bootstrap-server<span class="w"> </span><span class="nv">$DR_CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-115" name="__codelineno-30-115" href="#__codelineno-30-115"></a><span class="w">            </span>--topic<span class="w"> </span><span class="s2">&quot;primary.</span><span class="nv">$TEST_TOPIC</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-116" name="__codelineno-30-116" href="#__codelineno-30-116"></a><span class="w">            </span>--from-beginning<span class="w"> </span>--max-messages<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-30-117" name="__codelineno-30-117" href="#__codelineno-30-117"></a><span class="w">            </span>--timeout-ms<span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;rpo-test-</span><span class="nv">$start_time</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-30-118" name="__codelineno-30-118" href="#__codelineno-30-118"></a><span class="w">            </span><span class="nv">end_time</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s%N<span class="k">)</span>
<a id="__codelineno-30-119" name="__codelineno-30-119" href="#__codelineno-30-119"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-30-120" name="__codelineno-30-120" href="#__codelineno-30-120"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-30-121" name="__codelineno-30-121" href="#__codelineno-30-121"></a><span class="w">    </span><span class="k">done</span>
<a id="__codelineno-30-122" name="__codelineno-30-122" href="#__codelineno-30-122"></a>
<a id="__codelineno-30-123" name="__codelineno-30-123" href="#__codelineno-30-123"></a><span class="w">    </span><span class="nv">rpo_ms</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="o">(</span><span class="nv">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">start_time</span><span class="o">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1000000</span><span class="w"> </span><span class="k">))</span>
<a id="__codelineno-30-124" name="__codelineno-30-124" href="#__codelineno-30-124"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;RPO mesuré: </span><span class="si">${</span><span class="nv">rpo_ms</span><span class="si">}</span><span class="s2">ms&quot;</span>
<a id="__codelineno-30-125" name="__codelineno-30-125" href="#__codelineno-30-125"></a><span class="o">}</span>
<a id="__codelineno-30-126" name="__codelineno-30-126" href="#__codelineno-30-126"></a>
<a id="__codelineno-30-127" name="__codelineno-30-127" href="#__codelineno-30-127"></a><span class="c1"># === EXECUTION ===</span>
<a id="__codelineno-30-128" name="__codelineno-30-128" href="#__codelineno-30-128"></a>
<a id="__codelineno-30-129" name="__codelineno-30-129" href="#__codelineno-30-129"></a>log<span class="w"> </span><span class="s2">&quot;=== DÉBUT DU TEST DR ===&quot;</span>
<a id="__codelineno-30-130" name="__codelineno-30-130" href="#__codelineno-30-130"></a>
<a id="__codelineno-30-131" name="__codelineno-30-131" href="#__codelineno-30-131"></a>setup_test
<a id="__codelineno-30-132" name="__codelineno-30-132" href="#__codelineno-30-132"></a>produce_test_data
<a id="__codelineno-30-133" name="__codelineno-30-133" href="#__codelineno-30-133"></a>wait_for_replication
<a id="__codelineno-30-134" name="__codelineno-30-134" href="#__codelineno-30-134"></a>verify_data_integrity
<a id="__codelineno-30-135" name="__codelineno-30-135" href="#__codelineno-30-135"></a><span class="nv">result</span><span class="o">=</span><span class="nv">$?</span>
<a id="__codelineno-30-136" name="__codelineno-30-136" href="#__codelineno-30-136"></a>
<a id="__codelineno-30-137" name="__codelineno-30-137" href="#__codelineno-30-137"></a>measure_rpo
<a id="__codelineno-30-138" name="__codelineno-30-138" href="#__codelineno-30-138"></a>cleanup
<a id="__codelineno-30-139" name="__codelineno-30-139" href="#__codelineno-30-139"></a>
<a id="__codelineno-30-140" name="__codelineno-30-140" href="#__codelineno-30-140"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$result</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-30-141" name="__codelineno-30-141" href="#__codelineno-30-141"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;=== TEST DR RÉUSSI ===&quot;</span>
<a id="__codelineno-30-142" name="__codelineno-30-142" href="#__codelineno-30-142"></a><span class="k">else</span>
<a id="__codelineno-30-143" name="__codelineno-30-143" href="#__codelineno-30-143"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;=== TEST DR ÉCHOUÉ ===&quot;</span>
<a id="__codelineno-30-144" name="__codelineno-30-144" href="#__codelineno-30-144"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-30-145" name="__codelineno-30-145" href="#__codelineno-30-145"></a><span class="k">fi</span>
</code></pre></div>
<h3 id="iii1155-documentation-et-runbooks">III.11.5.5 Documentation et Runbooks<a class="headerlink" href="#iii1155-documentation-et-runbooks" title="Permanent link">&para;</a></h3>
<p>La documentation opérationnelle constitue un actif critique pour la gestion des incidents.</p>
<p><strong>Structure de runbook recommandée</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="gh"># Runbook: [Nom de la procédure]</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="gu">## Informations générales</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Dernière mise à jour**</span>: YYYY-MM-DD
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Propriétaire**</span>: [Équipe/Personne]
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Temps estimé**</span>: X minutes
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Niveau d&#39;expertise requis**</span>: [Junior/Intermédiaire/Senior]
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="gu">## Prérequis</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="k">- [ ]</span> Accès au cluster Kafka
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="k">- [ ]</span> Droits d&#39;administration
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="k">- [ ]</span> Outils: kafka-cli, kubectl, etc.
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="gu">## Quand utiliser ce runbook</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="k">-</span><span class="w"> </span>Situation 1
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="k">-</span><span class="w"> </span>Situation 2
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="gu">## Procédure</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="gu">### Étape 1: [Titre]</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>```bash
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a><span class="gh"># Commandes</span>
</code></pre></div>
<p><strong>Validation</strong> : [Comment vérifier le succès]
 <strong>En cas d'échec</strong> : [Que faire]</p>
<h3 id="etape-2-titre">Étape 2: [Titre]<a class="headerlink" href="#etape-2-titre" title="Permanent link">&para;</a></h3>
<p>...</p>
<h2 id="rollback">Rollback<a class="headerlink" href="#rollback" title="Permanent link">&para;</a></h2>
<p>En cas de problème, exécuter les étapes suivantes:</p>
<ol>
<li>...</li>
<li>...</li>
</ol>
<h2 id="escalade">Escalade<a class="headerlink" href="#escalade" title="Permanent link">&para;</a></h2>
<p>Si la procédure échoue après 3 tentatives:</p>
<ul>
<li>Contacter: [Équipe]</li>
<li>Slack: #kafka-incidents</li>
<li>PagerDuty: [Service]</li>
</ul>
<h2 id="historique-des-modifications">Historique des modifications<a class="headerlink" href="#historique-des-modifications" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Date</th>
<th>Auteur</th>
<th>Modification</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>&gt; **Note de terrain**  
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>&gt; *Contexte* : Incident majeur dans une banque où le cluster Kafka primaire est devenu indisponible.  
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>&gt; *Défi* : Les runbooks n&#39;avaient pas été testés depuis 8 mois et contenaient des références à des serveurs décommissionnés.  
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>&gt; *Solution* : Improvisation par l&#39;équipe senior, basculement réussi en 45 minutes au lieu des 15 minutes prévues.  
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>&gt; *Leçon* : Les runbooks sont périssables. Intégrer leur validation dans les tests DR réguliers et automatiser leur mise à jour lors des changements d&#39;infrastructure.
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>---
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>## III.11.6 Résumé
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>Ce chapitre a couvert les dimensions essentielles de l&#39;exploitation d&#39;un cluster Kafka en production, depuis les mises à niveau jusqu&#39;à la reprise après sinistre.
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>### Points clés à retenir
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>**Évolution et mises à niveau**
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>La gestion des versions Kafka exige une politique claire qui équilibre stabilité et modernité. La migration vers KRaft représente une évolution majeure qui simplifie l&#39;architecture tout en améliorant la scalabilité. Les rolling upgrades permettent des mises à niveau sans interruption, à condition de respecter la séquence binaires → protocole inter-broker → format des messages.
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>| Phase | Action | Risque de rollback |
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>|-------|--------|-------------------|
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a>| 1 | Mise à niveau binaires | Facile |
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a>| 2 | Protocole inter-broker | Modéré |
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>| 3 | Format messages | Difficile |
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a>
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>**Mobilité des données**
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a>MirrorMaker 2 constitue l&#39;outil de référence pour la réplication inter-clusters. La surveillance du lag de réplication est critique pour les architectures DR. Les migrations de topics requièrent une planification minutieuse incluant la gestion des offsets consommateurs et la validation de l&#39;intégrité des données.
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a>**Surveillance**
<a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a>
<a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a>L&#39;observabilité Kafka repose sur trois piliers : métriques JMX, logs centralisés et traces distribuées. Les métriques critiques incluent les partitions sous-répliquées, le lag des consommateurs et les performances des brokers. L&#39;automatisation des alertes permet une détection précoce des anomalies.
<a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a>
<a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a>**Optimisation des performances**
<a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a>
<a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a>Le diagnostic des problèmes de performance suit une méthodologie systématique. Les leviers principaux d&#39;optimisation sont :
<a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a>- **Producers** : batching (batch.size, linger.ms), compression (lz4/zstd)
<a id="__codelineno-32-37" name="__codelineno-32-37" href="#__codelineno-32-37"></a>- **Consumers** : parallélisme (partitions), fetch size, traitement asynchrone
<a id="__codelineno-32-38" name="__codelineno-32-38" href="#__codelineno-32-38"></a>- **Brokers** : threads de traitement, configuration OS, gestion des hot partitions
<a id="__codelineno-32-39" name="__codelineno-32-39" href="#__codelineno-32-39"></a>
<a id="__codelineno-32-40" name="__codelineno-32-40" href="#__codelineno-32-40"></a>**Reprise après sinistre**
<a id="__codelineno-32-41" name="__codelineno-32-41" href="#__codelineno-32-41"></a>
<a id="__codelineno-32-42" name="__codelineno-32-42" href="#__codelineno-32-42"></a>La stratégie DR définit les objectifs RTO et RPO qui guident l&#39;architecture. Les procédures de basculement doivent être documentées dans des runbooks testés régulièrement. Le failback requiert une resynchronisation complète avant de rediriger le trafic vers le cluster primaire.
<a id="__codelineno-32-43" name="__codelineno-32-43" href="#__codelineno-32-43"></a>
<a id="__codelineno-32-44" name="__codelineno-32-44" href="#__codelineno-32-44"></a>### Recommandations pratiques
<a id="__codelineno-32-45" name="__codelineno-32-45" href="#__codelineno-32-45"></a>
<a id="__codelineno-32-46" name="__codelineno-32-46" href="#__codelineno-32-46"></a>1. **Planifier les mises à niveau** : Établir un calendrier de mise à niveau qui maintient le cluster dans les versions supportées. Ne pas accumuler de retard qui complique les migrations futures.
<a id="__codelineno-32-47" name="__codelineno-32-47" href="#__codelineno-32-47"></a>
<a id="__codelineno-32-48" name="__codelineno-32-48" href="#__codelineno-32-48"></a>2. **Automatiser la surveillance** : Déployer une stack d&#39;observabilité complète dès le démarrage du projet. Les métriques historiques sont précieuses pour le diagnostic.
<a id="__codelineno-32-49" name="__codelineno-32-49" href="#__codelineno-32-49"></a>
<a id="__codelineno-32-50" name="__codelineno-32-50" href="#__codelineno-32-50"></a>3. **Documenter les procédures** : Maintenir des runbooks à jour pour toutes les opérations critiques. Tester régulièrement leur validité.
<a id="__codelineno-32-51" name="__codelineno-32-51" href="#__codelineno-32-51"></a>
<a id="__codelineno-32-52" name="__codelineno-32-52" href="#__codelineno-32-52"></a>4. **Pratiquer le DR** : Les tests de reprise après sinistre révèlent les failles avant les incidents réels. Planifier des tests trimestriels au minimum.
<a id="__codelineno-32-53" name="__codelineno-32-53" href="#__codelineno-32-53"></a>
<a id="__codelineno-32-54" name="__codelineno-32-54" href="#__codelineno-32-54"></a>5. **Investir dans l&#39;automatisation** : Les scripts d&#39;opération réduisent les erreurs humaines et accélèrent la résolution des incidents.
<a id="__codelineno-32-55" name="__codelineno-32-55" href="#__codelineno-32-55"></a>
<a id="__codelineno-32-56" name="__codelineno-32-56" href="#__codelineno-32-56"></a>### Perspectives
<a id="__codelineno-32-57" name="__codelineno-32-57" href="#__codelineno-32-57"></a>
<a id="__codelineno-32-58" name="__codelineno-32-58" href="#__codelineno-32-58"></a>L&#39;exploitation Kafka évolue vers une automatisation croissante. Les opérateurs Kubernetes comme Strimzi et Confluent for Kubernetes simplifient la gestion des clusters. L&#39;observabilité s&#39;enrichit avec l&#39;intégration de l&#39;IA pour la détection d&#39;anomalies et la prédiction des incidents.
<a id="__codelineno-32-59" name="__codelineno-32-59" href="#__codelineno-32-59"></a>
<a id="__codelineno-32-60" name="__codelineno-32-60" href="#__codelineno-32-60"></a>Le chapitre suivant explore l&#39;avenir de Kafka : évolutions architecturales, intégration avec l&#39;intelligence artificielle et nouvelles frontières du streaming événementiel. Ces perspectives éclairent les décisions d&#39;investissement à long terme dans la plateforme.
<a id="__codelineno-32-61" name="__codelineno-32-61" href="#__codelineno-32-61"></a>
<a id="__codelineno-32-62" name="__codelineno-32-62" href="#__codelineno-32-62"></a>---
<a id="__codelineno-32-63" name="__codelineno-32-63" href="#__codelineno-32-63"></a>
<a id="__codelineno-32-64" name="__codelineno-32-64" href="#__codelineno-32-64"></a>*Fin du Chapitre III.11*
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Retour en haut de la page
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/agbruneau/CorpusInformatique" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "toc.integrate", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>