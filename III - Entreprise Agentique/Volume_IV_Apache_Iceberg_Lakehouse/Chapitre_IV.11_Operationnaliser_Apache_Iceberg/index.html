
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Corpus encyclopédique francophone — science informatique, interopérabilité et entreprise agentique">
      
      
        <meta name="author" content="André-Guy Bruneau">
      
      
        <link rel="canonical" href="https://agbruneau.github.io/CorpusInformatique/III%20-%20Entreprise%20Agentique/Volume_IV_Apache_Iceberg_Lakehouse/Chapitre_IV.11_Operationnaliser_Apache_Iceberg/">
      
      
        <link rel="prev" href="../Chapitre_IV.10_Maintenir_Lakehouse_Production/">
      
      
        <link rel="next" href="../Chapitre_IV.12_Evolution_Streaming_Lakehouse/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>IV.11 — Opérationnaliser Apache Iceberg - Corpus Informatique</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapitre-iv11-operationnaliser-apache-iceberg" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../../.." title="Corpus Informatique" class="md-header__button md-logo" aria-label="Corpus Informatique" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Corpus Informatique
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              IV.11 — Opérationnaliser Apache Iceberg
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/agbruneau/CorpusInformatique" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    agbruneau/CorpusInformatique
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Onglets" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Accueil

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.1_Fondements_Logiques_Raisonnement/" class="md-tabs__link">
          
  
  
    
  
  I — Science et Génie Informatique

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.1_Introduction_Problematique/" class="md-tabs__link">
          
  
  
    
  
  II — Interopérabilité

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.1_Crise_Integration_Systemique/" class="md-tabs__link">
          
  
  
    
  
  III — Entreprise Agentique

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Corpus Informatique" class="md-nav__button md-logo" aria-label="Corpus Informatique" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Corpus Informatique
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/agbruneau/CorpusInformatique" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    agbruneau/CorpusInformatique
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    I — Science et Génie Informatique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    I — Science et Génie Informatique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume I — Fondements Mathématiques et Théorie de l'Informatique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume I — Fondements Mathématiques et Théorie de l'Informatique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.1_Fondements_Logiques_Raisonnement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.1 — Fondements logiques et raisonnement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.2_Structures_Discretes_Combinatoire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.2 — Structures discrètes et combinatoire
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.3_Theorie_Graphes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.3 — Théorie des graphes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.4_Langages_Formels_Automates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.4 — Langages formels et automates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.5_Calculabilite_Decidabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.5 — Calculabilité et décidabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_I_Fondements_Mathematiques_Theorie/Chapitre_I.6_Theorie_Complexite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.6 — Théorie de la complexité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume II — Architecture des Ordinateurs et Systèmes Numériques
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume II — Architecture des Ordinateurs et Systèmes Numériques
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.7_Systemes_Numeriques_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.7 — Systèmes numériques et données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.8_Circuits_Combinatoires/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.8 — Circuits combinatoires
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.9_Circuits_Sequentiels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.9 — Circuits séquentiels
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.10_Conception_Systeme_HDL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.10 — Conception système HDL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.11_Architecture_ISA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.11 — Architecture ISA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.12_Conception_CPU/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.12 — Conception CPU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.13_Parallelisme_ILP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.13 — Parallélisme ILP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.14_Hierarchie_Memoire_Stockage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.14 — Hiérarchie mémoire et stockage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_II_Architecture_Ordinateurs_Systemes_Numeriques/Chapitre_I.15_Systemes_IO_Accelere/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.15 — Systèmes I/O accélérés
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume III — Systèmes d'Exploitation, Langages et Environnements
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume III — Systèmes d'Exploitation, Langages et Environnements
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.16_Systemes_Exploitation_OS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.16 — Systèmes d'exploitation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.17_Gestion_Concurrence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.17 — Gestion de la concurrence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.18_Gestion_Memoire_Fichiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.18 — Gestion mémoire et fichiers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.19_Conception_Langages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.19 — Conception des langages
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.20_Compilation_Interpretation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.20 — Compilation et interprétation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_III_Systemes_Exploitation_Langages_Environnements/Chapitre_I.21_Environnements_Virtualisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.21 — Environnements et virtualisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume IV — Structures de Données, Algorithmique et Génie Logiciel
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume IV — Structures de Données, Algorithmique et Génie Logiciel
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.22_Structures_Donnees_Fondamentales/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.22 — Structures de données fondamentales
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.23_Structures_Donnees_Avancees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.23 — Structures de données avancées
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.24_Conception_Analyse_Algorithmes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.24 — Conception et analyse d'algorithmes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.25_Algorithmes_Graphes_Avances/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.25 — Algorithmes de graphes avancés
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.26_Processus_Developpement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.26 — Processus de développement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.27_Architecture_Logicielle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.27 — Architecture logicielle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.28_Qualite_Test_Maintenance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.28 — Qualité, test et maintenance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IV_Structures_Donnees_Algorithmique_Genie_Logiciel/Chapitre_I.29_DevOps_SRE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.29 — DevOps et SRE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume V — Données, Réseaux, Cloud et Sécurité
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume V — Données, Réseaux, Cloud et Sécurité
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.30_SGBD_Fondements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.30 — SGBD fondements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.31_SGBD_Implementation_Transactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.31 — SGBD implémentation et transactions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.32_Donnees_Modernes_BigData/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.32 — Données modernes et Big Data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.33_Fondements_Reseaux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.33 — Fondements des réseaux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.34_Protocoles_Internetworking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.34 — Protocoles et internetworking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.35_Systemes_Distribues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.35 — Systèmes distribués
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.36_Cloud_Infrastructures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.36 — Cloud et infrastructures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.37_Fondements_Securite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.37 — Fondements de la sécurité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.38_Cryptographie_Appliquee/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.38 — Cryptographie appliquée
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.39_Securite_Reseaux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.39 — Sécurité des réseaux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_V_Donnees_Reseaux_Cloud_Securite/Chapitre_I.40_Securite_Systemes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.40 — Sécurité des systèmes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume VI — Intelligence Artificielle et Systèmes Interactifs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume VI — Intelligence Artificielle et Systèmes Interactifs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.41_Fondements_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.41 — Fondements de l'IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.42_Connaissance_Raisonnement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.42 — Connaissance et raisonnement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.43_ML_Fondements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.43 — ML fondements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.44_DeepLearning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.44 — Deep Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.45_Reinforcement_Learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.45 — Reinforcement Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.46_TALN_NLP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.46 — TALN / NLP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.47_Vision_Ordinateur/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.47 — Vision par ordinateur
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.48_Infographie_Visualisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.48 — Infographie et visualisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.49_IHM_HCI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.49 — IHM / HCI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VI_Intelligence_Artificielle_Systemes_Interactifs/Chapitre_I.50_Robotique_IoT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.50 — Robotique et IoT
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume VII — Technologies Émergentes et Frontières
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume VII — Technologies Émergentes et Frontières
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.51_Informatique_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.51 — Informatique quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.52_Algorithmes_Cryptographie_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.52 — Algorithmes et cryptographie quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.53_HPC_Exascale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.53 — HPC et exascale
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.54_Architectures_Post_Moore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.54 — Architectures post-Moore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.55_Modeles_Fondateurs_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.55 — Modèles fondateurs IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.56_AGI_Alignement_Securite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.56 — AGI, alignement et sécurité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.57_Sciences_Computationnelles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.57 — Sciences computationnelles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.58_CyberPhysiques_Jumeaux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.58 — Systèmes cyber-physiques et jumeaux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.59_Web3_Decentralise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.59 — Web3 et décentralisé
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VII_Technologies_Emergentes_Frontieres/Chapitre_I.60_Synthese_Frontieres/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.60 — Synthèse et frontières
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume VIII — Convergence AGI–Quantique : Fondements et Algorithmes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume VIII — Convergence AGI–Quantique : Fondements et Algorithmes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.61_Introduction_Informatique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.61 — Introduction à l'informatique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.62_Convergence_AGI_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.62 — Convergence AGI-quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.63_Evolution_IA_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.63 — Évolution IA-quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.64_Reseaux_Neuronaux_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.64 — Réseaux neuronaux quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.65_Algorithmes_Evolutionnaires_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.65 — Algorithmes évolutionnaires quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.66_Renforcement_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.66 — Renforcement quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.67_Architectures_Hybrides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.67 — Architectures hybrides
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.68_SVM_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.68 — SVM quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.69_Codage_Donnees_Quantiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.69 — Codage de données quantiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_VIII_Convergence_AGI_Quantique_Fondements/Chapitre_I.70_Scalabilite_Correction_Erreurs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.70 — Scalabilité et correction d'erreurs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume IX — Convergence AGI–Quantique : Applications et Perspectives
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume IX — Convergence AGI–Quantique : Applications et Perspectives
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.71_TALN_Quantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.71 — TALN quantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.72_Securite_Confidentialite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.72 — Sécurité et confidentialité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.73_Ethique_Reglementaire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.73 — Éthique et réglementaire
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.74_Implementation_Materielle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.74 — Implémentation matérielle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.75_Middleware_Software/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.75 — Middleware et software
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.76_Etudes_Cas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.76 — Études de cas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.77_Durabilite_Energie/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.77 — Durabilité et énergie
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.78_Metriques_Bancs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.78 — Métriques et bancs d'essai
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.79_Perspectives_Avenir/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.79 — Perspectives d'avenir
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../I%20-%20Science%20et%20G%C3%A9nie%20Informatique/Volume_IX_Convergence_AGI_Quantique_Applications/Chapitre_I.80_Infrastructure_Centres_Donnees_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.80 — Infrastructure et centres de données IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    II — Interopérabilité
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    II — Interopérabilité
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.1_Introduction_Problematique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.1 — Introduction et problématique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.2_Fondements_Theoriques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.2 — Fondements théoriques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.3_Integration_Applications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.3 — Intégration des applications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.4_Integration_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.4 — Intégration des données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.5_Integration_Evenements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.5 — Intégration des événements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.6_Standards_Contrats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.6 — Standards et contrats
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.7_Resilience_Observabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.7 — Résilience et observabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.8_Collaboration_Automatisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.8 — Collaboration et automatisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.9_Architecture_Reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.9 — Architecture de référence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.10_Order_to_Cash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.10 — Order-to-Cash
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.11_Entreprise_Agentique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.11 — Entreprise agentique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.12_Securite_Identite_Conformite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.12 — Sécurité, identité et conformité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../II%20-%20Interop%C3%A9rabilit%C3%A9/Chapitre_II.A_Annexes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Annexes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    III — Entreprise Agentique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    III — Entreprise Agentique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume I — Fondations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume I — Fondations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.1_Crise_Integration_Systemique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.1 — Crise d'intégration systémique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.2_Fondements_Dimensions_Interoperabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.2 — Fondements et dimensions de l'interopérabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.3_Cadres_Reference_Standards_Maturite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.3 — Cadres de référence, standards et maturité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.4_Principes_Architecture_Reactive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.4 — Principes d'architecture réactive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.5_Ecosysteme_API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.5 — Écosystème API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.6_Architecture_Evenements_EDA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.6 — Architecture événements (EDA)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.7_Contrats_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.7 — Contrats de données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.8_Conception_Implementation_Observabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.8 — Conception et implémentation de l'observabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.9_Etudes_Cas_Architecturales/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.9 — Études de cas architecturales
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.10_Limites_Interoperabilite_Semantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.10 — Limites de l'interopérabilité sémantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.11_IA_Moteur_Interoperabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.11 — IA moteur d'interopérabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.12_Definition_Interoperabilite_Cognitivo_Adaptative/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.12 — Définition de l'interopérabilité cognitivo-adaptative
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.13_Ere_IA_Agentique_Modele_Travailleur_Numerique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.13 — Ère IA agentique et modèle du travailleur numérique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.14_Maillage_Agentique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.14 — Maillage agentique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.15_Ingenierie_Systemes_Cognitifs_Protocoles_Interaction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.15 — Ingénierie des systèmes cognitifs et protocoles d'interaction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.16_Modele_Operationnel_Symbiose_Humain_Agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.16 — Modèle opérationnel de symbiose humain-agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.17_Gouvernance_Constitutionnelle_Alignement_IA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.17 — Gouvernance constitutionnelle et alignement IA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.18_AgentOps_Industrialisation_Securisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.18 — AgentOps : industrialisation et sécurisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.19_Architecte_Intentions_Role_Sociotechnique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.19 — Architecte des intentions : rôle sociotechnique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.20_Cockpit_Berger_Intention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.20 — Cockpit du berger d'intention
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.21_Feuille_Route_Transformation_Agentique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.21 — Feuille de route de la transformation agentique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.22_Gestion_Strategique_Portefeuille_Applicatif_APM_Cognitif/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.22 — Gestion stratégique du portefeuille applicatif (APM cognitif)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.23_Patrons_Modernisation_Agentification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.23 — Patrons de modernisation et agentification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.24_Industrialisation_Ingenierie_Plateforme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.24 — Industrialisation et ingénierie de plateforme
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.25_Economie_Cognitive_Diplomatie_Algorithmique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.25 — Économie cognitive et diplomatie algorithmique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.26_Gestion_Risques_Systemiques_Superalignement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.26 — Gestion des risques systémiques et superalignement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.27_Prospective_Agent_Auto_Architecturant_AGI_Entreprise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.27 — Prospective : agent auto-architecturant et AGI d'entreprise
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_I_Fondations_Entreprise_Agentique/Chapitre_I.28_Conclusion_Architecture_Intentionnelle_Sagesse_Collective/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I.28 — Conclusion : architecture intentionnelle et sagesse collective
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume II — Infrastructure Agentique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume II — Infrastructure Agentique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.1_Ingenierie_Plateforme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.1 — Ingénierie de plateforme
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.2_Fondamentaux_Apache_Kafka_Confluent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.2 — Fondamentaux Apache Kafka et Confluent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.3_Conception_Modelisation_Flux_Evenements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.3 — Conception et modélisation des flux d'événements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.4_Contrats_Donnees_Gouvernance_Semantique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.4 — Contrats de données et gouvernance sémantique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.5_Flux_Temps_Reel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.5 — Flux temps réel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.6_Google_Cloud_Vertex_AI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.6 — Google Cloud et Vertex AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.7_Ingenierie_Contexte_RAG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.7 — Ingénierie de contexte et RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.8_Integration_Backbone_Evenementiel_Couche_Cognitive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.8 — Intégration backbone événementiel et couche cognitive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.9_Patrons_Architecturaux_Avances_AEM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.9 — Patrons architecturaux avancés (AEM)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.10_Pipelines_CI_CD_Deploiement_Agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.10 — Pipelines CI/CD et déploiement d'agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.11_Observabilite_Comportementale_Monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.11 — Observabilité comportementale et monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.12_Tests_Evaluation_Simulation_Systemes_Multi_Agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.12 — Tests, évaluation et simulation de systèmes multi-agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.13_Paysage_Menaces_Securite_Systemes_Agentiques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.13 — Paysage des menaces et sécurité des systèmes agentiques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.14_Securisation_Infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.14 — Sécurisation de l'infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_II_Infrastructure_Agentique/Chapitre_II.15_Conformite_Reglementaire_Gestion_Confidentialite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    II.15 — Conformité réglementaire et gestion de la confidentialité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume III — Apache Kafka : Guide de l'Architecte
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume III — Apache Kafka : Guide de l'Architecte
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.1_Decouvrir_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.1 — Découvrir Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.2_Architecture_Cluster_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.2 — Architecture du cluster Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.3_Clients_Kafka_Production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.3 — Clients Kafka en production
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.4_Applications_Consommatrices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.4 — Applications consommatrices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.5_Cas_Utilisation_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.5 — Cas d'utilisation Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.6_Contrats_Donnees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.6 — Contrats de données
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.7_Patrons_Interaction_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.7 — Patrons d'interaction Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.8_Conception_Application_Streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.8 — Conception d'application streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.9_Gestion_Kafka_Entreprise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.9 — Gestion Kafka en entreprise
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.10_Organisation_Projet_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.10 — Organisation d'un projet Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.11_Operer_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.11 — Opérer Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_III_Apache_Kafka_Guide_Architecte/Chapitre_III.12_Avenir_Kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    III.12 — L'avenir de Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume IV — Apache Iceberg et Lakehouse
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume IV — Apache Iceberg et Lakehouse
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.1_Monde_Lakehouse_Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.1 — Le monde Lakehouse et Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.2_Anatomie_Technique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.2 — Anatomie technique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.3_Mise_Pratique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.3 — Mise en pratique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.4_Preparer_Passage_Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.4 — Préparer le passage à Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.5_Selection_Couche_Stockage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.5 — Sélection de la couche de stockage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.6_Architecture_Couche_Ingestion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.6 — Architecture de la couche d'ingestion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.7_Implementation_Couche_Catalogue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.7 — Implémentation de la couche catalogue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.8_Conception_Couche_Federation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.8 — Conception de la couche de fédération
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.9_Comprendre_Couche_Consommation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.9 — Comprendre la couche de consommation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.10_Maintenir_Lakehouse_Production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.10 — Maintenir le Lakehouse en production
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    IV.11 — Opérationnaliser Apache Iceberg
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.11 — Opérationnaliser Apache Iceberg
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iv111-orchestration-du-lakehouse" class="md-nav__link">
    <span class="md-ellipsis">
      
        IV.11.1 Orchestration du Lakehouse
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IV.11.1 Orchestration du Lakehouse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#le-role-de-lorchestration-dans-un-lakehouse-moderne" class="md-nav__link">
    <span class="md-ellipsis">
      
        Le rôle de l'orchestration dans un lakehouse moderne
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#panorama-des-orchestrateurs-pour-les-lakehouses" class="md-nav__link">
    <span class="md-ellipsis">
      
        Panorama des orchestrateurs pour les lakehouses
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparaison-des-orchestrateurs-pour-les-lakehouses" class="md-nav__link">
    <span class="md-ellipsis">
      
        Comparaison des orchestrateurs pour les lakehouses
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criteres-de-selection-dun-orchestrateur" class="md-nav__link">
    <span class="md-ellipsis">
      
        Critères de sélection d'un orchestrateur
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modeles-dorchestration-pour-apache-iceberg" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modèles d'orchestration pour Apache Iceberg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orchestrer-les-operations-de-maintenance-iceberg" class="md-nav__link">
    <span class="md-ellipsis">
      
        Orchestrer les opérations de maintenance Iceberg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infrastructure-as-code-pour-lorchestration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Infrastructure as Code pour l'orchestration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gestion-des-environnements-multiples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gestion des environnements multiples
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bonnes-pratiques-dorchestration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bonnes pratiques d'orchestration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iv112-audit-du-lakehouse" class="md-nav__link">
    <span class="md-ellipsis">
      
        IV.11.2 Audit du Lakehouse
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IV.11.2 Audit du Lakehouse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exigences-daudit-dans-un-contexte-reglementaire" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exigences d'audit dans un contexte réglementaire
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-daudit-pour-un-lakehouse-iceberg" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture d'audit pour un lakehouse Iceberg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-de-la-qualite-des-donnees-dans-laudit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intégration de la qualité des données dans l'audit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-de-collecte-des-journaux-daudit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture de collecte des journaux d'audit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploiter-les-tables-de-metadonnees-pour-laudit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exploiter les tables de métadonnées pour l'audit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observabilite-et-alertes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Observabilité et alertes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-avec-les-plateformes-dobservabilite" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intégration avec les plateformes d'observabilité
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conformite-et-rapports-reglementaires" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conformité et rapports réglementaires
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iv113-recuperation-apres-sinistre" class="md-nav__link">
    <span class="md-ellipsis">
      
        IV.11.3 Récupération Après Sinistre
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IV.11.3 Récupération Après Sinistre">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#definir-les-objectifs-de-recuperation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Définir les objectifs de récupération
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#capacites-natives-diceberg-pour-la-recuperation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Capacités natives d'Iceberg pour la récupération
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenarios-de-recuperation-et-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scénarios de récupération et solutions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strategie-de-sauvegarde-pour-un-lakehouse-iceberg" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stratégie de sauvegarde pour un lakehouse Iceberg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-de-la-replication-s3-cross-region" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration de la réplication S3 Cross-Region
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-dun-inventaire-dr-complet" class="md-nav__link">
    <span class="md-ellipsis">
      
        Création d'un inventaire DR complet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatisation-des-tests-de-recuperation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automatisation des tests de récupération
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plan-de-recuperation-apres-sinistre" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plan de récupération après sinistre
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replication-multi-region-et-haute-disponibilite" class="md-nav__link">
    <span class="md-ellipsis">
      
        Réplication multi-région et haute disponibilité
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conception-dune-architecture-multi-region" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conception d'une architecture multi-région
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#considerations-de-couts-pour-la-dr" class="md-nav__link">
    <span class="md-ellipsis">
      
        Considérations de coûts pour la DR
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iv114-resume" class="md-nav__link">
    <span class="md-ellipsis">
      
        IV.11.4 Résumé
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IV.11.4 Résumé">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#orchestration-du-lakehouse" class="md-nav__link">
    <span class="md-ellipsis">
      
        Orchestration du lakehouse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-du-lakehouse" class="md-nav__link">
    <span class="md-ellipsis">
      
        Audit du lakehouse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recuperation-apres-sinistre" class="md-nav__link">
    <span class="md-ellipsis">
      
        Récupération après sinistre
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principes-directeurs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Principes directeurs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#points-cles-a-retenir" class="md-nav__link">
    <span class="md-ellipsis">
      
        Points clés à retenir
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        Références
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.12_Evolution_Streaming_Lakehouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.12 — Évolution du streaming Lakehouse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.13_Securite_Gouvernance_Conformite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.13 — Sécurité, gouvernance et conformité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.14_Integration_Microsoft_Fabric_PowerBI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.14 — Intégration Microsoft Fabric et Power BI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.15_Contexte_Canadien_Etudes_Cas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.15 — Contexte canadien et études de cas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.16_Conclusion_Perspectives_2026_2030/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IV.16 — Conclusion et perspectives 2026-2030
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.Annexe_A_Specification_Apache_Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Annexe A — Spécification Apache Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapitre_IV.Annexe_B_Glossaire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Annexe B — Glossaire
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Volume V — Développeur Renaissance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Volume V — Développeur Renaissance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.0_Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.0 — Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.1_Convergence_Ages_Or/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.1 — Convergence des âges d'or
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.2_Curiosite_Appliquee/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.2 — Curiosité appliquée
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.3_Pensee_Systemique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.3 — Pensée systémique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.4_Nouvelle_Communication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.4 — Nouvelle communication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.5_Imperatif_Qualite_Responsabilite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.5 — Impératif qualité et responsabilité
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.6_Capital_Humain_Profil_Polymathe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.6 — Capital humain et profil polymathe
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.7_Art_Batir_Futur/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.7 — L'art de bâtir le futur
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.8_Bibliotheque_Developpeur_Renaissance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.8 — Bibliothèque du développeur Renaissance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.9_Mandat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.9 — Mandat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Volume_V_Developpeur_Renaissance/Chapitre_V.10_Spec_Driven_Development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    V.10 — Spec-Driven Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="chapitre-iv11-operationnaliser-apache-iceberg">Chapitre IV.11 - OPÉRATIONNALISER APACHE ICEBERG<a class="headerlink" href="#chapitre-iv11-operationnaliser-apache-iceberg" title="Permanent link">&para;</a></h1>
<p><em>De la conception à l'exploitation : transformer votre lakehouse en plateforme de production</em></p>
<hr />
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Le passage d'un environnement de développement à une plateforme de production représente l'une des transitions les plus critiques dans le cycle de vie d'un Data Lakehouse. Concevoir une architecture Apache Iceberg élégante constitue un accomplissement technique, mais l'opérationnaliser de manière fiable, observable et résiliente représente un défi d'une tout autre nature. Cette distinction entre « ça fonctionne » et « ça fonctionne en production » sépare les projets expérimentaux des plateformes de données d'entreprise.</p>
<p>Les organisations qui adoptent Apache Iceberg découvrent rapidement que la valeur du format de table ne se réalise pleinement qu'avec une discipline opérationnelle rigoureuse. Sans orchestration appropriée, les pipelines s'exécutent de manière chaotique, les dépendances se brisent silencieusement et les opérations de maintenance s'accumulent. Sans audit, les exigences réglementaires deviennent ingérables et le diagnostic des problèmes tourne au cauchemar. Sans stratégie de récupération, un incident mineur peut se transformer en catastrophe.</p>
<p>Dans le chapitre précédent, nous avons exploré les mécanismes de maintenance d'un lakehouse Iceberg en production, notamment la compaction, l'expiration des snapshots et l'exploration des tables de métadonnées. Ce chapitre prolonge cette réflexion en abordant les dimensions opérationnelles plus larges : l'orchestration des pipelines, l'audit et la traçabilité des opérations, ainsi que la récupération après sinistre.</p>
<p>L'opérationnalisation d'Apache Iceberg s'inscrit dans la discipline émergente du DataOps, qui applique les principes DevOps au domaine des données. Cette approche reconnaît que les pipelines de données partagent les mêmes exigences que les applications logicielles en termes de fiabilité, d'observabilité et de récupération. Toutefois, les données présentent des caractéristiques uniques — leur volume, leur état et leur historique — qui nécessitent des stratégies adaptées.</p>
<p>Le contexte réglementaire canadien ajoute une couche de complexité supplémentaire. La Loi 25 au Québec, entrée pleinement en vigueur en 2024, impose des obligations strictes en matière de traçabilité et de protection des données personnelles. Les organisations assujetties doivent pouvoir démontrer où sont stockées les données, qui y accède, et comment elles sont transformées. Un lakehouse bien opérationnalisé, avec ses capacités d'audit et de <em>time travel</em>, répond naturellement à ces exigences lorsqu'il est correctement configuré.</p>
<p>Ce chapitre s'adresse aux architectes data et aux ingénieurs plateforme responsables de l'exploitation quotidienne d'un lakehouse Iceberg. Nous examinerons les outils d'orchestration modernes, les pratiques d'audit conformes aux exigences réglementaires et les stratégies de récupération après sinistre qui exploitent les capacités natives d'Iceberg. L'objectif est de fournir un cadre pratique permettant de transformer une architecture de données en une plateforme opérationnelle robuste.</p>
<hr />
<h2 id="iv111-orchestration-du-lakehouse">IV.11.1 Orchestration du Lakehouse<a class="headerlink" href="#iv111-orchestration-du-lakehouse" title="Permanent link">&para;</a></h2>
<p>L'orchestration constitue le système nerveux central de tout lakehouse en production. Elle coordonne l'exécution des pipelines de données, gère les dépendances entre tâches et assure la résilience face aux défaillances. Dans le contexte d'Apache Iceberg, l'orchestration doit également gérer les opérations de maintenance spécifiques au format de table, telles que la compaction et l'expiration des snapshots.</p>
<h3 id="le-role-de-lorchestration-dans-un-lakehouse-moderne">Le rôle de l'orchestration dans un lakehouse moderne<a class="headerlink" href="#le-role-de-lorchestration-dans-un-lakehouse-moderne" title="Permanent link">&para;</a></h3>
<p>Un lakehouse Iceberg en production comprend typiquement des dizaines, voire des centaines de pipelines interconnectés. Ces pipelines ingèrent des données depuis diverses sources, appliquent des transformations, exécutent des opérations de maintenance et alimentent les consommateurs en aval. Sans orchestration centralisée, la coordination de ces processus devient rapidement ingérable.</p>
<p>L'orchestration remplit plusieurs fonctions essentielles dans ce contexte. Premièrement, elle assure la planification temporelle des tâches selon des calendriers définis ou des événements déclencheurs. Deuxièmement, elle gère les dépendances entre pipelines, garantissant qu'une transformation ne s'exécute qu'après l'ingestion réussie des données sources. Troisièmement, elle orchestre les opérations de reprise automatique en cas d'échec, avec des stratégies de backoff exponentielles pour éviter la surcharge des systèmes. Quatrièmement, elle fournit une vue unifiée de l'état de tous les pipelines, facilitant le diagnostic des problèmes.</p>
<p>L'orchestration moderne va au-delà de la simple planification de tâches. Elle intègre des concepts comme l'orchestration orientée données (<em>data-aware orchestration</em>), où les décisions d'exécution sont basées sur l'état des données plutôt que sur des horaires fixes. Cette approche s'aligne naturellement avec les capacités d'Iceberg, où les snapshots et les métadonnées fournissent une visibilité complète sur l'état des tables.</p>
<h3 id="panorama-des-orchestrateurs-pour-les-lakehouses">Panorama des orchestrateurs pour les lakehouses<a class="headerlink" href="#panorama-des-orchestrateurs-pour-les-lakehouses" title="Permanent link">&para;</a></h3>
<p>Le paysage des outils d'orchestration a considérablement évolué ces dernières années. Selon l'analyse de l'écosystème des orchestrateurs en 2025 (PracData, 2025), Apache Airflow demeure le standard dominant avec plus de 320 millions de téléchargements annuels, suivi de Prefect et Dagster. Chaque outil présente des forces distinctes pour l'orchestration d'un lakehouse Iceberg.</p>
<p><strong>Apache Airflow</strong> représente le choix éprouvé pour les organisations recherchant maturité et écosystème étendu. Son modèle basé sur les DAG (Directed Acyclic Graphs) définit les flux de travail comme du code Python, offrant flexibilité et versionnement. Airflow excelle dans les environnements où les pipelines sont relativement stables et où l'intégration avec des systèmes existants est primordiale. Ses milliers d'opérateurs prêts à l'emploi facilitent l'intégration avec Apache Spark, Trino et les services infonuagiques. Les versions gérées comme Amazon MWAA, Google Cloud Composer et Astronomer simplifient l'exploitation en production.</p>
<p>Toutefois, Airflow présente des limitations pour les lakehouses modernes. Son modèle centré sur les tâches plutôt que sur les données complique la gestion de la lignée et l'observabilité des actifs de données. Les performances peuvent se dégrader avec des déploiements à très grande échelle, nécessitant une optimisation attentive de l'ordonnanceur.</p>
<p><strong>Dagster</strong> adopte une approche fondamentalement différente, centrée sur les actifs de données (<em>software-defined assets</em>). Plutôt que de définir des tâches, les ingénieurs définissent les données qu'ils souhaitent produire, et Dagster gère automatiquement les dépendances et l'exécution. Cette philosophie s'aligne remarquablement bien avec les lakehouses, où les tables Iceberg constituent les actifs principaux.</p>
<p>Dagster offre plusieurs avantages pour l'orchestration Iceberg. Son système de partitionnement natif gère élégamment les tables partitionnées temporellement, courantes dans les lakehouses. Les <em>sensors</em> permettent de déclencher des pipelines en réponse à l'arrivée de nouvelles données, plutôt que selon des horaires fixes. Les vérifications de qualité des données (<em>asset checks</em>) s'intègrent directement dans la définition des actifs, facilitant la validation avant publication.</p>
<p>L'article de Dagster (2025) démontre comment construire un lakehouse complet avec MinIO, Trino et Iceberg en utilisant une approche orientée actifs. Cette architecture permet une observabilité native où chaque table Iceberg est visible avec son historique de matérialisation, ses dépendances et ses métriques de santé.</p>
<p><strong>Prefect</strong> se positionne comme une alternative pythonique avec un modèle d'exécution hybride. La version 3.0 (2025) embrasse l'orchestration sans serveur (<em>serverless</em>), où les ressources de calcul sont provisionnées à la demande. Cette approche peut réduire significativement les coûts pour les pipelines à exécution intermittente.</p>
<p><strong>Temporal</strong> mérite également une mention pour les cas d'usage impliquant des processus de longue durée ou des agents d'intelligence artificielle. Selon Datum Labs (2025), Temporal excelle dans la gestion d'états complexes et la récupération après des défaillances prolongées, ce qui peut être pertinent pour les pipelines d'apprentissage automatique alimentés par un lakehouse.</p>
<h3 id="comparaison-des-orchestrateurs-pour-les-lakehouses">Comparaison des orchestrateurs pour les lakehouses<a class="headerlink" href="#comparaison-des-orchestrateurs-pour-les-lakehouses" title="Permanent link">&para;</a></h3>
<p>Le choix d'un orchestrateur dépend de multiples facteurs : maturité de l'équipe, complexité des pipelines, exigences de latence et intégration avec l'écosystème existant. Le tableau suivant synthétise les caractéristiques clés des principaux orchestrateurs pour les lakehouses Iceberg.</p>
<table>
<thead>
<tr>
<th>Critère</th>
<th>Apache Airflow</th>
<th>Dagster</th>
<th>Prefect</th>
<th>Temporal</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Philosophie</strong></td>
<td>Orienté tâches (DAG)</td>
<td>Orienté actifs (Assets)</td>
<td>Flux de données</td>
<td>Workflows durables</td>
</tr>
<tr>
<td><strong>Maturité</strong></td>
<td>Très mature (2014)</td>
<td>Mature (2019)</td>
<td>Mature (2018)</td>
<td>Mature (2019)</td>
</tr>
<tr>
<td><strong>Communauté</strong></td>
<td>Très large</td>
<td>Large</td>
<td>Moyenne</td>
<td>Moyenne</td>
</tr>
<tr>
<td><strong>Courbe d'apprentissage</strong></td>
<td>Moyenne</td>
<td>Moyenne-haute</td>
<td>Faible</td>
<td>Haute</td>
</tr>
<tr>
<td><strong>Observabilité native</strong></td>
<td>Moyenne</td>
<td>Excellente</td>
<td>Bonne</td>
<td>Bonne</td>
</tr>
<tr>
<td><strong>Lignée des données</strong></td>
<td>Limitée</td>
<td>Native</td>
<td>Limitée</td>
<td>N/A</td>
</tr>
<tr>
<td><strong>Gestion des partitions</strong></td>
<td>Manuelle</td>
<td>Native</td>
<td>Manuelle</td>
<td>N/A</td>
</tr>
<tr>
<td><strong>Tests locaux</strong></td>
<td>Limités</td>
<td>Excellents</td>
<td>Bons</td>
<td>Bons</td>
</tr>
<tr>
<td><strong>Intégration infonuagique</strong></td>
<td>Excellente (MWAA, Composer)</td>
<td>Dagster Cloud</td>
<td>Prefect Cloud</td>
<td>Temporal Cloud</td>
</tr>
<tr>
<td><strong>Coût (auto-hébergé)</strong></td>
<td>Moyen</td>
<td>Moyen</td>
<td>Faible</td>
<td>Moyen</td>
</tr>
<tr>
<td><strong>Cas d'usage optimal</strong></td>
<td>Pipelines batch stables</td>
<td>Lakehouses, ML</td>
<td>Pipelines agiles</td>
<td>Workflows IA</td>
</tr>
</tbody>
</table>
<h3 id="criteres-de-selection-dun-orchestrateur">Critères de sélection d'un orchestrateur<a class="headerlink" href="#criteres-de-selection-dun-orchestrateur" title="Permanent link">&para;</a></h3>
<p>La sélection d'un orchestrateur pour un lakehouse Iceberg doit considérer plusieurs dimensions.</p>
<p><strong>Maturité de l'équipe data</strong> : Les équipes familières avec Airflow peuvent bénéficier de sa large communauté et de ses ressources de formation abondantes. Les équipes plus modernes ou construisant un nouveau lakehouse peuvent préférer Dagster pour son alignement avec les architectures orientées actifs.</p>
<p><strong>Exigences de lignée</strong> : Si la traçabilité des données est critique (conformité réglementaire, debug de pipelines complexes), Dagster offre une lignée native supérieure. Airflow nécessite des outils complémentaires comme Apache Atlas ou des solutions commerciales.</p>
<p><strong>Complexité des pipelines</strong> : Les pipelines simples avec peu de dépendances fonctionnent bien avec n'importe quel orchestrateur. Les architectures complexes avec des centaines de tables interconnectées bénéficient de l'approche orientée actifs de Dagster.</p>
<p><strong>Budget et ressources</strong> : Airflow en mode auto-hébergé peut devenir coûteux en ressources d'administration. Les versions gérées (MWAA, Composer) simplifient l'exploitation mais ajoutent des coûts directs. Dagster Cloud et Prefect Cloud offrent des modèles de tarification basés sur l'usage.</p>
<p><strong>Intégration avec l'IA/ML</strong> : Pour les organisations intégrant fortement l'apprentissage automatique, Dagster offre des intégrations natives avec MLflow, Weights &amp; Biases et les frameworks de feature store. Temporal convient aux workflows d'agents IA nécessitant une gestion d'état durable.</p>
<blockquote>
<p><strong>Étude de cas : Recommandation d'orchestrateur</strong>
<em>Contexte</em> : Une entreprise de commerce électronique canadienne avec 50 tables Iceberg, 20 data engineers et des exigences de conformité Loi 25.
<em>Analyse</em> : L'équipe utilise actuellement des scripts cron et souhaite professionnaliser l'orchestration. La lignée des données est importante pour la conformité. Le budget est limité.
<em>Recommandation</em> : Dagster en mode auto-hébergé sur Kubernetes. La lignée native répond aux exigences de conformité. L'approche orientée actifs s'aligne avec l'architecture Iceberg. Les coûts restent maîtrisés en évitant les solutions SaaS.
<em>Alternative</em> : Airflow sur Amazon MWAA si l'équipe est déjà familière avec Airflow et préfère une exploitation simplifiée.</p>
</blockquote>
<h3 id="modeles-dorchestration-pour-apache-iceberg">Modèles d'orchestration pour Apache Iceberg<a class="headerlink" href="#modeles-dorchestration-pour-apache-iceberg" title="Permanent link">&para;</a></h3>
<p>L'orchestration d'un lakehouse Iceberg requiert des modèles spécifiques qui tiennent compte des caractéristiques du format de table. Nous identifions trois modèles principaux : l'orchestration par horaire, l'orchestration événementielle et l'orchestration hybride.</p>
<p><strong>L'orchestration par horaire</strong> demeure le modèle le plus répandu, où les pipelines s'exécutent selon des calendriers prédéfinis. Un pipeline d'ingestion quotidien pourrait s'exécuter à minuit, suivi des transformations à 2h00 et des tâches de maintenance à 4h00. Ce modèle offre prévisibilité et simplicité, mais peut entraîner des latences importantes et une utilisation inefficace des ressources.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Exemple Airflow : Pipeline Iceberg quotidien</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">airflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">DAG</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">airflow.operators.python</span><span class="w"> </span><span class="kn">import</span> <span class="n">PythonOperator</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">default_args</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="s1">&#39;data-engineering&#39;</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="s1">&#39;depends_on_past&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="s1">&#39;retries&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="s1">&#39;retry_delay&#39;</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="p">}</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="k">with</span> <span class="n">DAG</span><span class="p">(</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="s1">&#39;lakehouse_daily_pipeline&#39;</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">schedule_interval</span><span class="o">=</span><span class="s1">&#39;0 0 * * *&#39;</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">catchup</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="p">)</span> <span class="k">as</span> <span class="n">dag</span><span class="p">:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="n">ingest_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>        <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;ingest_raw_data&#39;</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>        <span class="n">python_callable</span><span class="o">=</span><span class="n">ingest_to_iceberg</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    <span class="p">)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    <span class="n">transform_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>        <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;transform_silver_layer&#39;</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>        <span class="n">python_callable</span><span class="o">=</span><span class="n">transform_silver</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="p">)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="n">compact_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>        <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;compact_iceberg_tables&#39;</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>        <span class="n">python_callable</span><span class="o">=</span><span class="n">run_compaction</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>    <span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>    <span class="n">expire_snapshots_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>        <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;expire_old_snapshots&#39;</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>        <span class="n">python_callable</span><span class="o">=</span><span class="n">expire_snapshots</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    <span class="p">)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>    <span class="n">ingest_task</span> <span class="o">&gt;&gt;</span> <span class="n">transform_task</span> <span class="o">&gt;&gt;</span> <span class="n">compact_task</span> <span class="o">&gt;&gt;</span> <span class="n">expire_snapshots_task</span>
</code></pre></div>
<p><strong>L'orchestration événementielle</strong> déclenche les pipelines en réponse à des événements, tels que l'arrivée de nouveaux fichiers dans le stockage objet ou la publication d'un message Kafka. Ce modèle réduit la latence et optimise l'utilisation des ressources, mais augmente la complexité opérationnelle.</p>
<p>L'intégration avec Apache Kafka, détaillée dans le Volume III de cette monographie, permet de créer des architectures de <em>Streaming Lakehouse</em> où les données s'écoulent continuellement vers les tables Iceberg. L'orchestrateur surveille alors les commits Iceberg ou les offsets Kafka pour déclencher les transformations en aval.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Exemple Dagster : Sensor surveillant MinIO pour nouveaux fichiers</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dagster</span><span class="w"> </span><span class="kn">import</span> <span class="n">sensor</span><span class="p">,</span> <span class="n">RunRequest</span><span class="p">,</span> <span class="n">SensorEvaluationContext</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="nd">@sensor</span><span class="p">(</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">minimum_interval_seconds</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="n">job_name</span><span class="o">=</span><span class="s2">&quot;incremental_ingestion_job&quot;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="p">)</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">minio_new_files_sensor</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">SensorEvaluationContext</span><span class="p">):</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Surveille MinIO pour détecter les nouveaux fichiers et déclencher l&#39;ingestion.&quot;&quot;&quot;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="n">minio_client</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">minio</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="c1"># Vérifier les fichiers des 24 dernières heures</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="k">for</span> <span class="n">days_back</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_back</span><span class="p">)</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>        <span class="n">date_str</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>        <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;raw/transactions/dt=</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">/&quot;</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>        <span class="n">new_files</span> <span class="o">=</span> <span class="n">minio_client</span><span class="o">.</span><span class="n">list_new_objects</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>        <span class="k">if</span> <span class="n">new_files</span><span class="p">:</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>            <span class="k">yield</span> <span class="n">RunRequest</span><span class="p">(</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>                <span class="n">partition_key</span><span class="o">=</span><span class="n">date_str</span><span class="p">,</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>                <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;new_data_detected&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;minio_sensor&quot;</span><span class="p">}</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>            <span class="p">)</span>
</code></pre></div>
<p><strong>L'orchestration hybride</strong> combine les deux approches, utilisant des horaires pour les traitements batch réguliers et des événements pour les besoins de faible latence. Ce modèle représente l'état de l'art pour les lakehouses d'entreprise qui doivent supporter à la fois des rapports quotidiens et des tableaux de bord quasi temps réel.</p>
<h3 id="orchestrer-les-operations-de-maintenance-iceberg">Orchestrer les opérations de maintenance Iceberg<a class="headerlink" href="#orchestrer-les-operations-de-maintenance-iceberg" title="Permanent link">&para;</a></h3>
<p>Les opérations de maintenance constituent un aspect critique de l'orchestration d'un lakehouse. La compaction, l'expiration des snapshots et le nettoyage des fichiers orphelins doivent être exécutés régulièrement pour maintenir des performances optimales.</p>
<p>L'orchestration de la compaction requiert une attention particulière. Exécuter la compaction trop fréquemment consomme des ressources inutilement ; l'exécuter trop rarement dégrade les performances de lecture. Une stratégie efficace consiste à surveiller les métriques des tables (nombre de fichiers, taille moyenne des fichiers) et à déclencher la compaction lorsque des seuils sont dépassés.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Fonction de compaction conditionnelle</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">conditional_compaction</span><span class="p">(</span><span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Exécute la compaction uniquement si nécessaire.&quot;&quot;&quot;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">count</span><span class="p">,</span> <span class="n">avg</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="c1"># Récupérer les métriques des fichiers</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="n">files_df</span> <span class="o">=</span> <span class="n">spark_session</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;iceberg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">.files&quot;</span><span class="p">)</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    <span class="n">metrics</span> <span class="o">=</span> <span class="n">files_df</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="n">count</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;file_count&quot;</span><span class="p">),</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>        <span class="n">avg</span><span class="p">(</span><span class="s2">&quot;file_size_in_bytes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;avg_file_size&quot;</span><span class="p">)</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">file_count</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;file_count&quot;</span><span class="p">]</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="n">avg_file_size</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;avg_file_size&quot;</span><span class="p">]</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    <span class="c1"># Seuils de compaction</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="n">MAX_FILES</span> <span class="o">=</span> <span class="mi">1000</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    <span class="n">MIN_AVG_SIZE</span> <span class="o">=</span> <span class="mi">64</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 64 MB</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>    <span class="k">if</span> <span class="n">file_count</span> <span class="o">&gt;</span> <span class="n">MAX_FILES</span> <span class="ow">or</span> <span class="n">avg_file_size</span> <span class="o">&lt;</span> <span class="n">MIN_AVG_SIZE</span><span class="p">:</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>        <span class="n">spark_session</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="s2">            CALL iceberg.system.rewrite_data_files(</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="s2">                table =&gt; &#39;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#39;,</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="s2">                options =&gt; map(&#39;target-file-size-bytes&#39;, &#39;134217728&#39;)</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="s2">            )</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;compacted&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;file_count&quot;</span><span class="p">:</span> <span class="n">file_count</span><span class="p">}</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;compacted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;file_count&quot;</span><span class="p">:</span> <span class="n">file_count</span><span class="p">}</span>
</code></pre></div>
<p>L'expiration des snapshots doit être coordonnée avec les politiques de rétention de l'organisation et les exigences de <em>time travel</em>. Une pratique courante consiste à conserver les snapshots des 7 derniers jours pour permettre les analyses ad hoc, tout en maintenant des snapshots mensuels pour les audits.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">-- Expiration des snapshots avec rétention de 7 jours</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">CALL</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">expire_snapshots</span><span class="p">(</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="k">table</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;lakehouse.gold.customer_360&#39;</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="n">older_than</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="s1">&#39;2025-01-09 00:00:00&#39;</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="n">retain_last</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="p">);</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="c1">-- Nettoyage des fichiers orphelins (exécuter mensuellement)</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="k">CALL</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">remove_orphan_files</span><span class="p">(</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="k">table</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;lakehouse.gold.customer_360&#39;</span><span class="p">,</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="n">older_than</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="s1">&#39;2025-01-01 00:00:00&#39;</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="p">);</span>
</code></pre></div>
<h3 id="infrastructure-as-code-pour-lorchestration">Infrastructure as Code pour l'orchestration<a class="headerlink" href="#infrastructure-as-code-pour-lorchestration" title="Permanent link">&para;</a></h3>
<p>L'approche <em>Infrastructure as Code</em> (IaC) s'applique naturellement à l'orchestration d'un lakehouse. Les définitions de pipelines, les configurations des tâches et les paramètres d'exécution doivent être versionnés dans un système de contrôle de version comme Git.</p>
<p>Cette approche offre plusieurs avantages. La traçabilité permet de comprendre l'évolution des pipelines et d'identifier les changements responsables de régressions. La reproductibilité garantit que le même code produit le même comportement dans tous les environnements. La collaboration facilite la revue par les pairs et l'amélioration continue des pipelines.</p>
<p>Les outils modernes comme Dagster et Prefect sont conçus pour cette approche, avec des définitions de pipelines en Python pur qui s'intègrent naturellement avec les pratiques de développement logiciel.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Structure de projet recommandée pour un lakehouse orchestré</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1"># lakehouse-orchestration/</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1"># ├── dags/                    # Définitions Airflow</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1"># │   ├── ingestion/</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="c1"># │   ├── transformation/</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="c1"># │   └── maintenance/</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1"># ├── assets/                  # Définitions Dagster</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="c1"># │   ├── bronze/</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="c1"># │   ├── silver/</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="c1"># │   └── gold/</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="c1"># ├── configs/</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="c1"># │   ├── dev.yaml</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="c1"># │   ├── staging.yaml</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="c1"># │   └── prod.yaml</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="c1"># ├── tests/</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="c1"># │   ├── unit/</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="c1"># │   └── integration/</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="c1"># └── requirements.txt</span>
</code></pre></div>
<p>Le déploiement des pipelines doit suivre un flux CI/CD (Intégration Continue / Déploiement Continu) avec des tests automatisés. Les modifications passent d'abord par un environnement de développement, puis de staging, avant d'être promues en production.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Exemple GitHub Actions pour déploiement Airflow</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy DAGs</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nt">on</span><span class="p">:</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;dags/**&#39;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="nt">jobs</span><span class="p">:</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test DAGs</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">          </span><span class="no">pip install apache-airflow pytest</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">          </span><span class="no">pytest tests/unit/</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Sync DAGs to S3</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">          </span><span class="no">aws s3 sync dags/ s3://airflow-dags-bucket/dags/</span>
</code></pre></div>
<h3 id="gestion-des-environnements-multiples">Gestion des environnements multiples<a class="headerlink" href="#gestion-des-environnements-multiples" title="Permanent link">&para;</a></h3>
<p>Un lakehouse d'entreprise comprend typiquement plusieurs environnements : développement, test, staging et production. L'orchestration doit gérer ces environnements de manière cohérente tout en permettant des différences de configuration.</p>
<p>Les pratiques recommandées incluent la paramétrisation des pipelines pour externaliser les configurations spécifiques à l'environnement (chemins de stockage, tailles de cluster, politiques de rétention). La configuration par environnement utilise des fichiers YAML ou des variables d'environnement pour injecter les valeurs appropriées. L'isolation des données garantit que les environnements de développement utilisent des sous-ensembles ou des données anonymisées.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># Configuration multi-environnement avec Dagster</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dagster</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigurableResource</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">IcebergConfig</span><span class="p">(</span><span class="n">ConfigurableResource</span><span class="p">):</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration paramétrable par environnement.&quot;&quot;&quot;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="n">catalog_uri</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;URI du catalogue Iceberg&quot;</span><span class="p">)</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="n">warehouse_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Chemin du warehouse&quot;</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="n">default_database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Base de données par défaut&quot;</span><span class="p">)</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    <span class="n">retention_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Rétention des snapshots&quot;</span><span class="p">)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    <span class="n">compaction_threshold_files</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Seuil de compaction&quot;</span><span class="p">)</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="c1"># Configurations par environnement</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    <span class="s2">&quot;dev&quot;</span><span class="p">:</span> <span class="n">IcebergConfig</span><span class="p">(</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>        <span class="n">catalog_uri</span><span class="o">=</span><span class="s2">&quot;http://nessie-dev:19120/api/v1&quot;</span><span class="p">,</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>        <span class="n">warehouse_path</span><span class="o">=</span><span class="s2">&quot;s3a://lakehouse-dev/warehouse&quot;</span><span class="p">,</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>        <span class="n">default_database</span><span class="o">=</span><span class="s2">&quot;dev_lakehouse&quot;</span><span class="p">,</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>        <span class="n">retention_days</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>        <span class="n">compaction_threshold_files</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>    <span class="p">),</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>    <span class="s2">&quot;prod&quot;</span><span class="p">:</span> <span class="n">IcebergConfig</span><span class="p">(</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>        <span class="n">catalog_uri</span><span class="o">=</span><span class="s2">&quot;http://nessie-prod:19120/api/v1&quot;</span><span class="p">,</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>        <span class="n">warehouse_path</span><span class="o">=</span><span class="s2">&quot;s3a://lakehouse-prod/warehouse&quot;</span><span class="p">,</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>        <span class="n">default_database</span><span class="o">=</span><span class="s2">&quot;prod_lakehouse&quot;</span><span class="p">,</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>        <span class="n">retention_days</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>        <span class="n">compaction_threshold_files</span><span class="o">=</span><span class="mi">500</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>    <span class="p">)</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="p">}</span>
</code></pre></div>
<h3 id="bonnes-pratiques-dorchestration">Bonnes pratiques d'orchestration<a class="headerlink" href="#bonnes-pratiques-dorchestration" title="Permanent link">&para;</a></h3>
<p>L'expérience opérationnelle révèle plusieurs bonnes pratiques pour l'orchestration d'un lakehouse Iceberg.</p>
<p><strong>Idempotence des pipelines</strong> : Chaque tâche doit être idempotente, c'est-à-dire que son exécution répétée avec les mêmes entrées produit le même résultat. Cette propriété est essentielle pour les reprises automatiques. Iceberg facilite l'idempotence grâce aux opérations atomiques et au <em>time travel</em>, permettant de rejouer des transformations à partir d'un snapshot spécifique.</p>
<p><strong>Observabilité native</strong> : L'orchestrateur doit émettre des métriques détaillées sur l'exécution des pipelines : durée, volume de données traitées, nombre de fichiers créés. Ces métriques alimentent les tableaux de bord opérationnels et les alertes.</p>
<p><strong>Gestion des échecs</strong> : Les stratégies de reprise doivent être adaptées au type de défaillance. Une erreur de connexion réseau justifie une reprise immédiate avec backoff exponentiel ; une erreur de données nécessite une intervention humaine. Les alertes doivent distinguer ces cas pour éviter la fatigue des équipes.</p>
<p><strong>Tests des pipelines</strong> : Les DAG et les définitions d'actifs doivent être testés comme du code applicatif. Dagster offre des facilités de test local particulièrement développées, permettant de valider les pipelines avant déploiement en production.</p>
<blockquote>
<p><strong>Étude de cas : Financière Sun Life</strong>
<em>Secteur</em> : Services financiers
<em>Défi</em> : Orchestrer 150+ pipelines de données alimentant les analyses actuarielles et la conformité réglementaire, avec des fenêtres de traitement nocturnes de 4 heures maximum.
<em>Solution</em> : Migration d'Airflow vers Dagster pour bénéficier de l'orchestration orientée actifs. Chaque table Iceberg (bronze, silver, gold) est définie comme un actif avec ses dépendances explicites. Les sensors surveillent les commits Iceberg pour déclencher les transformations en cascade.
<em>Résultats</em> : Réduction de 40 % du temps de traitement global grâce à une meilleure parallélisation. Amélioration de la visibilité avec lignée automatique des données. Temps moyen de résolution des incidents réduit de 2 heures à 25 minutes.</p>
</blockquote>
<hr />
<h2 id="iv112-audit-du-lakehouse">IV.11.2 Audit du Lakehouse<a class="headerlink" href="#iv112-audit-du-lakehouse" title="Permanent link">&para;</a></h2>
<p>L'audit constitue une dimension incontournable de l'opérationnalisation d'un lakehouse, particulièrement dans les secteurs réglementés comme la finance, la santé et les télécommunications. Au-delà des exigences de conformité, l'audit fournit une traçabilité essentielle pour le diagnostic des problèmes et l'analyse forensique des données.</p>
<h3 id="exigences-daudit-dans-un-contexte-reglementaire">Exigences d'audit dans un contexte réglementaire<a class="headerlink" href="#exigences-daudit-dans-un-contexte-reglementaire" title="Permanent link">&para;</a></h3>
<p>Les réglementations modernes imposent des exigences strictes en matière de traçabilité des données. Le Règlement général sur la protection des données (RGPD) en Europe et la Loi 25 au Québec exigent que les organisations puissent démontrer comment les données personnelles sont collectées, transformées et utilisées. Les normes sectorielles comme SOX (secteur financier) ou HIPAA (santé) ajoutent des contraintes supplémentaires.</p>
<p>Ces exigences se traduisent en capacités d'audit spécifiques pour un lakehouse. La traçabilité des accès enregistre qui a accédé à quelles données, quand et depuis quelle application. La traçabilité des modifications documente chaque changement apporté aux données, incluant l'auteur, le moment et la nature de la modification. La lignée des données trace le parcours des données depuis leur source jusqu'à leur consommation, permettant de comprendre comment un rapport est produit à partir des données brutes.</p>
<p>Apache Iceberg offre des fondations solides pour répondre à ces exigences grâce à son architecture basée sur les snapshots. Chaque modification d'une table Iceberg crée un nouveau snapshot, préservant l'historique complet des changements. Cette immutabilité native constitue un avantage significatif par rapport aux systèmes traditionnels où les données sont modifiées en place.</p>
<h3 id="architecture-daudit-pour-un-lakehouse-iceberg">Architecture d'audit pour un lakehouse Iceberg<a class="headerlink" href="#architecture-daudit-pour-un-lakehouse-iceberg" title="Permanent link">&para;</a></h3>
<p>Une architecture d'audit complète pour un lakehouse Iceberg comprend plusieurs composants : les journaux d'accès, les journaux de modification, la lignée des données et les rapports de conformité.</p>
<p><strong>Journaux d'accès</strong> : Les moteurs de requête comme Dremio et Trino génèrent des journaux détaillant chaque requête exécutée. Ces journaux capturent l'identité de l'utilisateur, la requête SQL, les tables accédées, les données retournées (ou un résumé) et les performances. Ces journaux doivent être centralisés dans un système d'observabilité comme Elasticsearch/Kibana (ELK) ou une solution spécialisée.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1">-- Exemple de structure pour une table de journalisation des accès</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">audit</span><span class="p">.</span><span class="n">query_logs</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="n">query_id</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="n">user_email</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="n">client_ip</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="n">query_text</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="n">tables_accessed</span><span class="w"> </span><span class="nb">ARRAY</span><span class="o">&lt;</span><span class="n">STRING</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="n">columns_accessed</span><span class="w"> </span><span class="nb">ARRAY</span><span class="o">&lt;</span><span class="n">STRING</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="n">rows_returned</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="n">execution_time_ms</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">    </span><span class="n">query_status</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">    </span><span class="n">error_message</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">    </span><span class="k">timestamp</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">iceberg</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="n">PARTITIONED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">days</span><span class="p">(</span><span class="k">timestamp</span><span class="p">));</span>
</code></pre></div>
<p><strong>Journaux de modification</strong> : Iceberg maintient nativement l'historique des modifications à travers les snapshots. La table de métadonnées <code>snapshots</code> fournit un journal de toutes les opérations effectuées sur une table.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1">-- Consulter l&#39;historique des modifications d&#39;une table</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="k">SELECT</span><span class="w"> </span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="n">snapshot_id</span><span class="p">,</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="n">committed_at</span><span class="p">,</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="k">operation</span><span class="p">,</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;added-data-files&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">files_added</span><span class="p">,</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;deleted-data-files&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">files_deleted</span><span class="p">,</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;added-records&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">records_added</span><span class="p">,</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;deleted-records&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">records_deleted</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="k">FROM</span><span class="w"> </span><span class="n">lakehouse</span><span class="p">.</span><span class="n">gold</span><span class="p">.</span><span class="n">customer_360</span><span class="p">.</span><span class="n">snapshots</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">committed_at</span><span class="w"> </span><span class="k">DESC</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>
<p>Pour enrichir ces journaux avec des informations contextuelles (utilisateur, application source, raison de la modification), une pratique efficace consiste à utiliser les propriétés de snapshot. Lors de chaque écriture, l'application peut définir des propriétés personnalisées qui seront préservées dans les métadonnées.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Écriture avec métadonnées d&#39;audit</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">df</span><span class="o">.</span><span class="n">writeTo</span><span class="p">(</span><span class="s2">&quot;lakehouse.gold.customer_360&quot;</span><span class="p">)</span> \
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;snapshot-property.audit.user&quot;</span><span class="p">,</span> <span class="n">current_user</span><span class="p">)</span> \
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;snapshot-property.audit.application&quot;</span><span class="p">,</span> <span class="s2">&quot;etl-pipeline-v2&quot;</span><span class="p">)</span> \
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;snapshot-property.audit.reason&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily refresh from CRM&quot;</span><span class="p">)</span> \
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;snapshot-property.audit.ticket&quot;</span><span class="p">,</span> <span class="s2">&quot;JIRA-12345&quot;</span><span class="p">)</span> \
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="o">.</span><span class="n">append</span><span class="p">()</span>
</code></pre></div>
<p><strong>Lignée des données</strong> : La lignée documente les relations entre les tables, permettant de tracer le parcours des données. Cette information est cruciale pour comprendre l'impact d'un changement en amont sur les rapports en aval, et pour répondre aux demandes de conformité concernant la provenance des données.</p>
<p>Les outils de catalogues comme Apache Polaris, Atlan ou Alation peuvent extraire automatiquement la lignée en analysant les requêtes SQL et les définitions de pipelines. Cette lignée peut être enrichie par les orchestrateurs orientés actifs comme Dagster, qui maintiennent une lignée native basée sur les définitions de dépendances.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Exemple Dagster : Définition d&#39;actifs avec lignée explicite</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dagster</span><span class="w"> </span><span class="kn">import</span> <span class="n">asset</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="nd">@asset</span><span class="p">(</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Table agrégée des ventes par région&quot;</span><span class="p">,</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>        <span class="s2">&quot;owner&quot;</span><span class="p">:</span> <span class="s2">&quot;equipe-analytics&quot;</span><span class="p">,</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>        <span class="s2">&quot;data_quality_score&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>        <span class="s2">&quot;pii_classification&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    <span class="p">}</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="p">)</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">ventes_par_region</span><span class="p">(</span><span class="n">transactions_nettoyees</span><span class="p">,</span> <span class="n">reference_regions</span><span class="p">):</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Agrège les transactions par région géographique.&quot;&quot;&quot;</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    <span class="c1"># La lignée est automatiquement déduite des dépendances</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    <span class="k">return</span> <span class="n">transactions_nettoyees</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">reference_regions</span><span class="p">)</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>
<h3 id="integration-de-la-qualite-des-donnees-dans-laudit">Intégration de la qualité des données dans l'audit<a class="headerlink" href="#integration-de-la-qualite-des-donnees-dans-laudit" title="Permanent link">&para;</a></h3>
<p>La qualité des données fait partie intégrante de l'audit d'un lakehouse. Les vérifications de qualité documentent l'état des données à chaque étape du pipeline, fournissant une piste d'audit de la fiabilité des données.</p>
<p>Les cadres de qualité des données comme Great Expectations, Soda ou dbt tests permettent de définir des attentes sur les données et de les valider automatiquement. Ces validations génèrent des rapports qui alimentent la piste d'audit.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># Exemple Great Expectations pour validation avec audit</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">great_expectations</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gx</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">context</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="c1"># Définir les attentes pour la table customer_360</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="n">suite</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">add_expectation_suite</span><span class="p">(</span><span class="s2">&quot;customer_360_quality&quot;</span><span class="p">)</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="c1"># Attentes de complétude</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="n">suite</span><span class="o">.</span><span class="n">add_expectation</span><span class="p">(</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    <span class="n">gx</span><span class="o">.</span><span class="n">expectations</span><span class="o">.</span><span class="n">ExpectColumnValuesToNotBeNull</span><span class="p">(</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>        <span class="n">column</span><span class="o">=</span><span class="s2">&quot;customer_id&quot;</span><span class="p">,</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>        <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;audit_category&quot;</span><span class="p">:</span> <span class="s2">&quot;completeness&quot;</span><span class="p">,</span> <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">}</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    <span class="p">)</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="p">)</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="c1"># Attentes de validité</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="n">suite</span><span class="o">.</span><span class="n">add_expectation</span><span class="p">(</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>    <span class="n">gx</span><span class="o">.</span><span class="n">expectations</span><span class="o">.</span><span class="n">ExpectColumnValuesToBeBetween</span><span class="p">(</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>        <span class="n">column</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>        <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>        <span class="n">max_value</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>        <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;audit_category&quot;</span><span class="p">:</span> <span class="s2">&quot;validity&quot;</span><span class="p">,</span> <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">}</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>    <span class="p">)</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="p">)</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="c1"># Attentes de cohérence</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="n">suite</span><span class="o">.</span><span class="n">add_expectation</span><span class="p">(</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>    <span class="n">gx</span><span class="o">.</span><span class="n">expectations</span><span class="o">.</span><span class="n">ExpectColumnPairValuesAToBeGreaterThanB</span><span class="p">(</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>        <span class="n">column_A</span><span class="o">=</span><span class="s2">&quot;total_purchases&quot;</span><span class="p">,</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>        <span class="n">column_B</span><span class="o">=</span><span class="s2">&quot;total_returns&quot;</span><span class="p">,</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>        <span class="n">or_equal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>        <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;audit_category&quot;</span><span class="p">:</span> <span class="s2">&quot;consistency&quot;</span><span class="p">,</span> <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">}</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>    <span class="p">)</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="p">)</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="c1"># Exécuter la validation et stocker les résultats pour audit</span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="n">checkpoint</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">add_checkpoint</span><span class="p">(</span>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;customer_360_daily_validation&quot;</span><span class="p">,</span>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>    <span class="n">validations</span><span class="o">=</span><span class="p">[{</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>        <span class="s2">&quot;batch_request&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;datasource_name&quot;</span><span class="p">:</span> <span class="s2">&quot;iceberg_lakehouse&quot;</span><span class="p">,</span> <span class="s2">&quot;data_asset_name&quot;</span><span class="p">:</span> <span class="s2">&quot;customer_360&quot;</span><span class="p">},</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>        <span class="s2">&quot;expectation_suite_name&quot;</span><span class="p">:</span> <span class="s2">&quot;customer_360_quality&quot;</span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>    <span class="p">}]</span>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="p">)</span>
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="n">results</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a><span class="c1"># Les résultats sont automatiquement stockés pour audit</span>
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation réussie : </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">success</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Statistiques : </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">statistics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Les résultats de validation doivent être persistés dans une table d'audit dédiée, permettant l'analyse historique de la qualité des données.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1">-- Table d&#39;audit de qualité des données</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">audit</span><span class="p">.</span><span class="n">data_quality_results</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="n">validation_id</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="k">table_name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="n">validation_time</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">    </span><span class="n">expectation_type</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span><span class="k">column_name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="n">success</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="p">,</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">    </span><span class="n">observed_value</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">    </span><span class="n">expected_value</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">    </span><span class="n">severity</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">    </span><span class="n">audit_category</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">    </span><span class="n">snapshot_id</span><span class="w"> </span><span class="nb">BIGINT</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">iceberg</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="n">PARTITIONED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">days</span><span class="p">(</span><span class="n">validation_time</span><span class="p">));</span>
</code></pre></div>
<h3 id="architecture-de-collecte-des-journaux-daudit">Architecture de collecte des journaux d'audit<a class="headerlink" href="#architecture-de-collecte-des-journaux-daudit" title="Permanent link">&para;</a></h3>
<p>Une architecture robuste de collecte des journaux d'audit doit gérer le volume, la fiabilité et la rétention des données d'audit.</p>
<p><strong>Collecte des journaux</strong> : Les journaux proviennent de multiples sources : moteurs de requête (Dremio, Trino, Spark), orchestrateurs (Airflow, Dagster), applications métier et services infonuagiques. Un agent de collecte comme Fluentd ou Vector agrège ces journaux et les achemine vers un système centralisé.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># Configuration Vector pour collecte des journaux d&#39;audit</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nt">sources</span><span class="p">:</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">trino_logs</span><span class="p">:</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/var/log/trino/query*.log&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">  </span><span class="nt">spark_logs</span><span class="p">:</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/var/log/spark/audit*.log&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">  </span><span class="nt">airflow_logs</span><span class="p">:</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">    </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/var/log/airflow/scheduler*.log&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="nt">transforms</span><span class="p">:</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">  </span><span class="nt">parse_trino</span><span class="p">:</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remap</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">    </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;trino_logs&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w">      </span><span class="no">. = parse_json!(.message)</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="w">      </span><span class="no">.source = &quot;trino&quot;</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="w">      </span><span class="no">.audit_timestamp = now()</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="nt">sinks</span><span class="p">:</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="w">  </span><span class="nt">iceberg_audit</span><span class="p">:</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="w">    </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;parse_trino&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;parse_spark&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;parse_airflow&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="w">    </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://spark-rest:8080/audit/ingest&quot;</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="w">    </span><span class="nt">encoding</span><span class="p">:</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="w">      </span><span class="nt">codec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json</span>
</code></pre></div>
<p><strong>Rétention et archivage</strong> : Les journaux d'audit doivent être conservés selon les exigences réglementaires, souvent 7 ans pour les données financières. Une stratégie de tiering déplace les journaux anciens vers un stockage économique (S3 Glacier, Azure Archive) tout en maintenant leur accessibilité.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1">-- Politique de rétention pour les journaux d&#39;audit</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c1">-- Tables actives (&lt; 90 jours) : Stockage standard</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1">-- Tables archivées (90 jours - 7 ans) : Stockage archive</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="c1">-- Vue unifiée des journaux d&#39;audit</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">audit</span><span class="p">.</span><span class="n">unified_query_logs</span><span class="w"> </span><span class="k">AS</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">audit</span><span class="p">.</span><span class="n">query_logs_active</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">audit</span><span class="p">.</span><span class="n">query_logs_archive</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">CURRENT_DATE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="k">YEAR</span><span class="p">;</span>
</code></pre></div>
<h3 id="exploiter-les-tables-de-metadonnees-pour-laudit">Exploiter les tables de métadonnées pour l'audit<a class="headerlink" href="#exploiter-les-tables-de-metadonnees-pour-laudit" title="Permanent link">&para;</a></h3>
<p>Iceberg expose plusieurs tables de métadonnées qui constituent des sources d'information précieuses pour l'audit. Ces tables sont accessibles via des requêtes SQL standard, facilitant leur intégration dans les processus d'audit existants.</p>
<p><strong>Table <code>history</code></strong> : Fournit l'historique des snapshots avec les métadonnées associées.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">-- Historique complet des modifications</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">SELECT</span><span class="w"> </span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="n">made_current_at</span><span class="p">,</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="n">snapshot_id</span><span class="p">,</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="n">parent_id</span><span class="p">,</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">    </span><span class="n">is_current_ancestor</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">lakehouse</span><span class="p">.</span><span class="n">gold</span><span class="p">.</span><span class="n">customer_360</span><span class="p">.</span><span class="n">history</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">made_current_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>
<p><strong>Table <code>snapshots</code></strong> : Détaille chaque snapshot avec les statistiques d'opération.</p>
<p><strong>Table <code>manifests</code></strong> : Liste les fichiers manifest pour chaque snapshot, permettant une analyse fine des modifications au niveau des fichiers.</p>
<p><strong>Table <code>files</code></strong> : Énumère tous les fichiers de données avec leurs statistiques (taille, nombre d'enregistrements, valeurs min/max par colonne).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">-- Analyse des fichiers pour détecter des anomalies</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">SELECT</span><span class="w"> </span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="n">partition</span><span class="p">,</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">file_count</span><span class="p">,</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">record_count</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_records</span><span class="p">,</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">file_size_in_bytes</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_file_size_mb</span><span class="p">,</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="k">MIN</span><span class="p">(</span><span class="n">file_size_in_bytes</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">min_file_size_kb</span><span class="p">,</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="n">file_size_in_bytes</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">max_file_size_mb</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="k">FROM</span><span class="w"> </span><span class="n">lakehouse</span><span class="p">.</span><span class="n">gold</span><span class="p">.</span><span class="n">customer_360</span><span class="p">.</span><span class="n">files</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">partition</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="k">HAVING</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">file_size_in_bytes</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1024</span><span class="w">  </span><span class="c1">-- Fichiers &lt; 1 MB</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">file_count</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>
<h3 id="observabilite-et-alertes">Observabilité et alertes<a class="headerlink" href="#observabilite-et-alertes" title="Permanent link">&para;</a></h3>
<p>L'observabilité transforme les données d'audit brutes en informations actionnables. Elle permet de détecter proactivement les anomalies, d'alerter les équipes et de faciliter le diagnostic des problèmes.</p>
<p><strong>Métriques clés à surveiller</strong> :</p>
<table>
<thead>
<tr>
<th>Métrique</th>
<th>Description</th>
<th>Seuil d'alerte suggéré</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nombre de fichiers par partition</td>
<td>Indicateur de fragmentation</td>
<td>&gt; 500 fichiers</td>
</tr>
<tr>
<td>Taille moyenne des fichiers</td>
<td>Performance de lecture</td>
<td>&lt; 32 MB ou &gt; 512 MB</td>
</tr>
<tr>
<td>Latence d'ingestion</td>
<td>Fraîcheur des données</td>
<td>&gt; 15 minutes du SLA</td>
</tr>
<tr>
<td>Taux d'échec des requêtes</td>
<td>Santé du système</td>
<td>&gt; 1 %</td>
</tr>
<tr>
<td>Durée de compaction</td>
<td>Efficacité de maintenance</td>
<td>&gt; 2x moyenne historique</td>
</tr>
<tr>
<td>Croissance du stockage</td>
<td>Coûts et capacité</td>
<td>&gt; 20 % /semaine</td>
</tr>
</tbody>
</table>
<p><strong>Architecture d'observabilité</strong> : Une architecture typique comprend la collecte des métriques via Prometheus ou DataDog, la visualisation via Grafana, et les alertes configurées pour notifier les équipes via Slack, PagerDuty ou courriel.</p>
<p>L'architecture d'observabilité pour un lakehouse Iceberg doit couvrir plusieurs dimensions : la santé des tables, la performance des requêtes, l'état des pipelines et les métriques d'infrastructure.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># Configuration Prometheus pour métriques Iceberg</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nt">global</span><span class="p">:</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="nt">evaluation_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="nt">rule_files</span><span class="p">:</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/prometheus/rules/iceberg_alerts.yml</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="nt">scrape_configs</span><span class="p">:</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;spark-metrics&#39;</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;spark-master:4040&#39;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">    </span><span class="nt">metrics_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/metrics/prometheus</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;trino-metrics&#39;</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;trino-coordinator:8080&#39;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">    </span><span class="nt">metrics_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/v1/jmx</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;nessie-metrics&#39;</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;nessie:19120&#39;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">    </span><span class="nt">metrics_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/api/v2/metrics</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Règles d&#39;alerte Prometheus pour le lakehouse</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nt">groups</span><span class="p">:</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iceberg_table_health</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IcebergTableFragmented</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iceberg_table_file_count &gt; 500</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30m</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">          </span><span class="nt">team</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-engineering</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Table</span><span class="nv"> </span><span class="s">Iceberg</span><span class="nv"> </span><span class="s">fragmentée:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.table_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;La</span><span class="nv"> </span><span class="s">table</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.table_name</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">contient</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">fichiers.</span><span class="nv"> </span><span class="s">Compaction</span><span class="nv"> </span><span class="s">recommandée.&quot;</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">          </span><span class="nt">runbook_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://runbooks.example.com/iceberg/compaction&quot;</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IcebergIngestionLatency</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iceberg_last_commit_age_seconds &gt; 3600</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">          </span><span class="nt">team</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-engineering</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Retard</span><span class="nv"> </span><span class="s">d&#39;ingestion:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.table_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;La</span><span class="nv"> </span><span class="s">table</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.table_name</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">n&#39;a</span><span class="nv"> </span><span class="s">pas</span><span class="nv"> </span><span class="s">été</span><span class="nv"> </span><span class="s">mise</span><span class="nv"> </span><span class="s">à</span><span class="nv"> </span><span class="s">jour</span><span class="nv"> </span><span class="s">depuis</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">humanizeDuration</span><span class="nv"> </span><span class="s">}}.&quot;</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IcebergSnapshotGrowth</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(iceberg_snapshot_count[1h]) &gt; 100</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1h</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Croissance</span><span class="nv"> </span><span class="s">rapide</span><span class="nv"> </span><span class="s">des</span><span class="nv"> </span><span class="s">snapshots:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.table_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;La</span><span class="nv"> </span><span class="s">table</span><span class="nv"> </span><span class="s">génère</span><span class="nv"> </span><span class="s">des</span><span class="nv"> </span><span class="s">snapshots</span><span class="nv"> </span><span class="s">à</span><span class="nv"> </span><span class="s">un</span><span class="nv"> </span><span class="s">rythme</span><span class="nv"> </span><span class="s">élevé.</span><span class="nv"> </span><span class="s">Vérifier</span><span class="nv"> </span><span class="s">la</span><span class="nv"> </span><span class="s">fréquence</span><span class="nv"> </span><span class="s">d&#39;écriture.&quot;</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IcebergStorageGrowth</span>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(iceberg_table_size_bytes[24h]) / iceberg_table_size_bytes &gt; 0.2</span>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2h</span>
<a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Croissance</span><span class="nv"> </span><span class="s">du</span><span class="nv"> </span><span class="s">stockage</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">20%/jour:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.table_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Croissance</span><span class="nv"> </span><span class="s">inhabituelle</span><span class="nv"> </span><span class="s">du</span><span class="nv"> </span><span class="s">stockage.</span><span class="nv"> </span><span class="s">Vérifier</span><span class="nv"> </span><span class="s">les</span><span class="nv"> </span><span class="s">politiques</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">rétention.&quot;</span>
<a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>
<a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iceberg_query_performance</span>
<a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a><span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IcebergSlowQueries</span>
<a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">histogram_quantile(0.95, rate(query_execution_time_seconds_bucket{engine=&quot;trino&quot;}[5m])) &gt; 30</span>
<a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Requêtes</span><span class="nv"> </span><span class="s">lentes</span><span class="nv"> </span><span class="s">détectées&quot;</span>
<a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Le</span><span class="nv"> </span><span class="s">95e</span><span class="nv"> </span><span class="s">percentile</span><span class="nv"> </span><span class="s">des</span><span class="nv"> </span><span class="s">requêtes</span><span class="nv"> </span><span class="s">dépasse</span><span class="nv"> </span><span class="s">30</span><span class="nv"> </span><span class="s">secondes.&quot;</span>
<a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a>
<a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IcebergQueryFailureRate</span>
<a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(query_failures_total[5m]) / rate(query_total[5m]) &gt; 0.01</span>
<a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id="__codelineno-18-60" name="__codelineno-18-60" href="#__codelineno-18-60"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-18-61" name="__codelineno-18-61" href="#__codelineno-18-61"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Taux</span><span class="nv"> </span><span class="s">d&#39;échec</span><span class="nv"> </span><span class="s">des</span><span class="nv"> </span><span class="s">requêtes</span><span class="nv"> </span><span class="s">élevé&quot;</span>
<a id="__codelineno-18-62" name="__codelineno-18-62" href="#__codelineno-18-62"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Plus</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">1%</span><span class="nv"> </span><span class="s">des</span><span class="nv"> </span><span class="s">requêtes</span><span class="nv"> </span><span class="s">échouent.</span><span class="nv"> </span><span class="s">Investiguer</span><span class="nv"> </span><span class="s">immédiatement.&quot;</span>
</code></pre></div>
<h3 id="integration-avec-les-plateformes-dobservabilite">Intégration avec les plateformes d'observabilité<a class="headerlink" href="#integration-avec-les-plateformes-dobservabilite" title="Permanent link">&para;</a></h3>
<p>Les organisations utilisent souvent des plateformes d'observabilité intégrées qui combinent métriques, journaux et traces. L'intégration avec ces plateformes est essentielle pour une vision unifiée.</p>
<p><strong>Intégration DataDog</strong> : DataDog offre des intégrations natives pour de nombreux composants du lakehouse, incluant Spark, Trino et AWS S3.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Émission de métriques personnalisées vers DataDog</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datadog</span><span class="w"> </span><span class="kn">import</span> <span class="n">initialize</span><span class="p">,</span> <span class="n">statsd</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="n">initialize</span><span class="p">(</span><span class="n">statsd_host</span><span class="o">=</span><span class="s1">&#39;datadog-agent&#39;</span><span class="p">,</span> <span class="n">statsd_port</span><span class="o">=</span><span class="mi">8125</span><span class="p">)</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">emit_table_metrics</span><span class="p">(</span><span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Émet les métriques de santé d&#39;une table Iceberg vers DataDog.&quot;&quot;&quot;</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>    <span class="c1"># Récupérer les statistiques de fichiers</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>    <span class="n">files_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="s2">        SELECT </span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="s2">            COUNT(*) as file_count,</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="s2">            AVG(file_size_in_bytes) as avg_file_size,</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="s2">            SUM(file_size_in_bytes) as total_size,</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="s2">            SUM(record_count) as total_records</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="s2">        FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">.files</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>    <span class="c1"># Récupérer les statistiques de snapshots</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>    <span class="n">snapshots_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="s2">        SELECT </span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="s2">            COUNT(*) as snapshot_count,</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="s2">            MAX(committed_at) as last_commit</span>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="s2">        FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">.snapshots</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>    <span class="c1"># Émettre les métriques</span>
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>    <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;table:</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;lakehouse:prod&quot;</span><span class="p">]</span>
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>    <span class="n">statsd</span><span class="o">.</span><span class="n">gauge</span><span class="p">(</span><span class="s1">&#39;iceberg.table.file_count&#39;</span><span class="p">,</span> <span class="n">files_df</span><span class="p">[</span><span class="s1">&#39;file_count&#39;</span><span class="p">],</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>    <span class="n">statsd</span><span class="o">.</span><span class="n">gauge</span><span class="p">(</span><span class="s1">&#39;iceberg.table.avg_file_size_mb&#39;</span><span class="p">,</span> 
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>                 <span class="n">files_df</span><span class="p">[</span><span class="s1">&#39;avg_file_size&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a>    <span class="n">statsd</span><span class="o">.</span><span class="n">gauge</span><span class="p">(</span><span class="s1">&#39;iceberg.table.total_size_gb&#39;</span><span class="p">,</span> 
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a>                 <span class="n">files_df</span><span class="p">[</span><span class="s1">&#39;total_size&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>    <span class="n">statsd</span><span class="o">.</span><span class="n">gauge</span><span class="p">(</span><span class="s1">&#39;iceberg.table.total_records&#39;</span><span class="p">,</span> <span class="n">files_df</span><span class="p">[</span><span class="s1">&#39;total_records&#39;</span><span class="p">],</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a>    <span class="n">statsd</span><span class="o">.</span><span class="n">gauge</span><span class="p">(</span><span class="s1">&#39;iceberg.table.snapshot_count&#39;</span><span class="p">,</span> <span class="n">snapshots_df</span><span class="p">[</span><span class="s1">&#39;snapshot_count&#39;</span><span class="p">],</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
<a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a>
<a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a>    <span class="c1"># Calculer l&#39;âge du dernier commit</span>
<a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a>    <span class="k">if</span> <span class="n">snapshots_df</span><span class="p">[</span><span class="s1">&#39;last_commit&#39;</span><span class="p">]:</span>
<a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a>        <span class="n">last_commit_age</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">snapshots_df</span><span class="p">[</span><span class="s1">&#39;last_commit&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
<a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a>        <span class="n">statsd</span><span class="o">.</span><span class="n">gauge</span><span class="p">(</span><span class="s1">&#39;iceberg.table.last_commit_age_seconds&#39;</span><span class="p">,</span> <span class="n">last_commit_age</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
</code></pre></div>
<p><strong>Intégration OpenTelemetry</strong> : OpenTelemetry fournit un standard ouvert pour la collecte de métriques, traces et journaux. Cette approche offre flexibilité et évite le verrouillage fournisseur.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># Configuration OpenTelemetry pour le lakehouse</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace</span><span class="p">,</span> <span class="n">metrics</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.sdk.trace</span><span class="w"> </span><span class="kn">import</span> <span class="n">TracerProvider</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.sdk.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeterProvider</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.exporter.otlp.proto.grpc.trace_exporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">OTLPSpanExporter</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.exporter.otlp.proto.grpc.metric_exporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">OTLPMetricExporter</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="c1"># Configuration du traceur</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="n">trace</span><span class="o">.</span><span class="n">set_tracer_provider</span><span class="p">(</span><span class="n">TracerProvider</span><span class="p">())</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_tracer</span><span class="p">(</span><span class="s2">&quot;lakehouse.iceberg&quot;</span><span class="p">)</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="n">otlp_exporter</span> <span class="o">=</span> <span class="n">OTLPSpanExporter</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;otel-collector:4317&quot;</span><span class="p">,</span> <span class="n">insecure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="n">trace</span><span class="o">.</span><span class="n">get_tracer_provider</span><span class="p">()</span><span class="o">.</span><span class="n">add_span_processor</span><span class="p">(</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>    <span class="n">BatchSpanProcessor</span><span class="p">(</span><span class="n">otlp_exporter</span><span class="p">)</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="p">)</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="c1"># Configuration des métriques</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="n">metrics</span><span class="o">.</span><span class="n">set_meter_provider</span><span class="p">(</span><span class="n">MeterProvider</span><span class="p">())</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="n">meter</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_meter</span><span class="p">(</span><span class="s2">&quot;lakehouse.iceberg&quot;</span><span class="p">)</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="c1"># Création des instruments de métrique</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="n">file_count_gauge</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_observable_gauge</span><span class="p">(</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>    <span class="s2">&quot;iceberg.table.file_count&quot;</span><span class="p">,</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_file_counts</span><span class="p">()],</span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Nombre de fichiers par table Iceberg&quot;</span>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="p">)</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="n">query_duration_histogram</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_histogram</span><span class="p">(</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>    <span class="s2">&quot;iceberg.query.duration&quot;</span><span class="p">,</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Durée des requêtes Iceberg&quot;</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="p">)</span>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="c1"># Exemple d&#39;instrumentation d&#39;une opération</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="k">def</span><span class="w"> </span><span class="nf">instrumented_write</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Écriture instrumentée avec tracing.&quot;&quot;&quot;</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">&quot;iceberg.write&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">span</span><span class="p">:</span>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>        <span class="n">span</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s2">&quot;table.name&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>        <span class="n">span</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s2">&quot;records.count&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>        <span class="n">df</span><span class="o">.</span><span class="n">writeTo</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">()</span>
<a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a>        <span class="n">duration_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
<a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a>
<a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a>        <span class="n">query_duration_histogram</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">duration_ms</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;operation&quot;</span><span class="p">:</span> <span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table_name</span><span class="p">})</span>
<a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a>        <span class="n">span</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s2">&quot;duration.ms&quot;</span><span class="p">,</span> <span class="n">duration_ms</span><span class="p">)</span>
</code></pre></div>
<p>Les plateformes d'observabilité des données comme Monte Carlo, Bigeye ou Great Expectations complètent cette architecture en surveillant la qualité des données elles-mêmes : distribution des valeurs, valeurs nulles inattendues, anomalies de volume.</p>
<blockquote>
<p><strong>Performance</strong>
L'exploitation intensive des tables de métadonnées Iceberg pour l'audit peut impacter les performances du catalogue, particulièrement pour les tables avec un historique long. Une bonne pratique consiste à extraire périodiquement ces métadonnées vers des tables d'audit dédiées, réduisant la charge sur le catalogue principal.</p>
</blockquote>
<h3 id="conformite-et-rapports-reglementaires">Conformité et rapports réglementaires<a class="headerlink" href="#conformite-et-rapports-reglementaires" title="Permanent link">&para;</a></h3>
<p>Les organisations assujetties à des réglementations doivent produire régulièrement des rapports de conformité démontrant la traçabilité et la protection des données.</p>
<p><strong>Rapports RGPD/Loi 25</strong> : Ces rapports documentent le traitement des données personnelles, incluant les bases légales du traitement, les durées de rétention et les accès effectués.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">-- Rapport d&#39;accès aux données personnelles (derniers 90 jours)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">SELECT</span><span class="w"> </span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span><span class="n">q</span><span class="p">.</span><span class="n">user_email</span><span class="p">,</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="p">,</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">access_count</span><span class="p">,</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="k">timestamp</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">last_access</span><span class="p">,</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">pii_classification</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">audit</span><span class="p">.</span><span class="n">query_logs</span><span class="w"> </span><span class="n">q</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">metadata</span><span class="p">.</span><span class="n">table_classifications</span><span class="w"> </span><span class="n">t</span><span class="w"> </span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">ARRAY_CONTAINS</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">tables_accessed</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="p">)</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="k">timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="k">DAY</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">pii_classification</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;PII&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Sensitive-PII&#39;</span><span class="p">)</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">user_email</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">pii_classification</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">access_count</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>
<p><strong>Rapports SOX</strong> : Pour les entreprises cotées en bourse, les rapports SOX documentent les contrôles sur les données financières, incluant la séparation des tâches et les approbations.</p>
<p><strong>Demandes de droit d'accès</strong> : Le <em>time travel</em> d'Iceberg facilite la réponse aux demandes de droit d'accès des individus en permettant de reconstituer l'état des données personnelles à une date donnée.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1">-- Reconstituer l&#39;état des données d&#39;un client à une date spécifique</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">lakehouse</span><span class="p">.</span><span class="n">gold</span><span class="p">.</span><span class="n">customer_360</span><span class="w"> </span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="k">FOR</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="s1">&#39;2024-06-15 00:00:00&#39;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CUST-12345&#39;</span><span class="p">;</span>
</code></pre></div>
<blockquote>
<p><strong>Étude de cas : Mouvement Desjardins</strong>
<em>Secteur</em> : Services financiers
<em>Défi</em> : Répondre aux exigences de l'Autorité des marchés financiers (AMF) et de la Loi 25 pour la traçabilité des données des 7 millions de membres.
<em>Solution</em> : Déploiement d'une architecture d'audit basée sur les tables de métadonnées Iceberg, enrichie par des journaux applicatifs centralisés dans Elasticsearch. Chaque modification de données membres est associée à un ticket de changement et un approbateur.
<em>Résultats</em> : Temps de réponse aux demandes de l'AMF réduit de 5 jours à 4 heures. Capacité de produire un rapport complet de lignée pour n'importe quel point de données en moins de 30 minutes. Conformité Loi 25 attestée par audit externe.</p>
</blockquote>
<hr />
<h2 id="iv113-recuperation-apres-sinistre">IV.11.3 Récupération Après Sinistre<a class="headerlink" href="#iv113-recuperation-apres-sinistre" title="Permanent link">&para;</a></h2>
<p>La récupération après sinistre (Disaster Recovery, DR) constitue l'ultime filet de sécurité d'un lakehouse en production. Malgré toutes les précautions, des événements catastrophiques peuvent survenir : défaillance d'une région infonuagique, corruption de données à grande échelle, erreur humaine dévastatrice ou cyberattaque. Une stratégie de DR robuste garantit la continuité des opérations face à ces scénarios.</p>
<h3 id="definir-les-objectifs-de-recuperation">Définir les objectifs de récupération<a class="headerlink" href="#definir-les-objectifs-de-recuperation" title="Permanent link">&para;</a></h3>
<p>Avant de concevoir une stratégie de DR, l'organisation doit définir deux métriques fondamentales pour chaque classe de données.</p>
<p><strong>RTO (Recovery Time Objective)</strong> : Le temps maximum acceptable entre la survenue d'un sinistre et la restauration du service. Un RTO de 4 heures signifie que le lakehouse doit être opérationnel dans les 4 heures suivant l'incident.</p>
<p><strong>RPO (Recovery Point Objective)</strong> : La quantité maximale de données que l'organisation peut se permettre de perdre. Un RPO de 1 heure signifie que les sauvegardes doivent avoir moins d'une heure d'ancienneté.</p>
<p>Ces objectifs varient selon la criticité des données. Les tables alimentant les systèmes transactionnels peuvent exiger un RTO de 15 minutes et un RPO de 5 minutes, tandis que les données d'archivage peuvent tolérer un RTO de 24 heures et un RPO d'une semaine.</p>
<table>
<thead>
<tr>
<th>Classe de données</th>
<th>Exemple</th>
<th>RTO cible</th>
<th>RPO cible</th>
</tr>
</thead>
<tbody>
<tr>
<td>Critique</td>
<td>Données clients actifs</td>
<td>15 min</td>
<td>5 min</td>
</tr>
<tr>
<td>Important</td>
<td>Rapports financiers</td>
<td>2 heures</td>
<td>1 heure</td>
</tr>
<tr>
<td>Standard</td>
<td>Analyses marketing</td>
<td>8 heures</td>
<td>4 heures</td>
</tr>
<tr>
<td>Archive</td>
<td>Données historiques</td>
<td>24 heures</td>
<td>1 semaine</td>
</tr>
</tbody>
</table>
<h3 id="capacites-natives-diceberg-pour-la-recuperation">Capacités natives d'Iceberg pour la récupération<a class="headerlink" href="#capacites-natives-diceberg-pour-la-recuperation" title="Permanent link">&para;</a></h3>
<p>L'architecture d'Apache Iceberg offre des capacités de récupération supérieures aux formats de données traditionnels, grâce à plusieurs caractéristiques fondamentales.</p>
<p><strong>Immutabilité des fichiers</strong> : Les fichiers de données Iceberg ne sont jamais modifiés une fois écrits. Chaque modification crée de nouveaux fichiers, préservant l'historique complet. Cette immutabilité signifie qu'une corruption ou suppression accidentelle n'affecte pas les snapshots historiques tant que leurs fichiers sont préservés.</p>
<p><strong>Snapshots comme points de récupération</strong> : Chaque snapshot représente un état cohérent et complet de la table. La récupération vers un snapshot antérieur est une opération atomique qui ne nécessite aucune restauration de fichiers.</p>
<p><strong>Séparation métadonnées/données</strong> : Les métadonnées Iceberg (fichiers JSON et manifest) sont distinctes des fichiers de données. Cette séparation permet des stratégies de sauvegarde différenciées et facilite la récupération en cas de corruption partielle.</p>
<p><strong>Procédures de récupération intégrées</strong> : Iceberg fournit des procédures Spark pour les opérations de récupération courantes, notamment <code>rollback_to_snapshot</code>, <code>rollback_to_timestamp</code> et <code>register_table</code>.</p>
<h3 id="scenarios-de-recuperation-et-solutions">Scénarios de récupération et solutions<a class="headerlink" href="#scenarios-de-recuperation-et-solutions" title="Permanent link">&para;</a></h3>
<p>L'article de Dremio (2025) sur la récupération après sinistre pour les tables Iceberg identifie plusieurs scénarios de défaillance et leurs solutions.</p>
<p><strong>Scénario 1 : Erreur humaine — suppression ou modification accidentelle de données</strong></p>
<p>Ce scénario représente la cause la plus fréquente de perte de données. Un ingénieur exécute par erreur un <code>DELETE</code> sans clause <code>WHERE</code>, ou un script de migration corrompt des enregistrements.</p>
<p><em>Solution</em> : Utiliser la procédure <code>rollback_to_snapshot</code> ou <code>rollback_to_timestamp</code> pour revenir à l'état antérieur à l'erreur.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1">-- Identifier le snapshot cible</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">snapshot_id</span><span class="p">,</span><span class="w"> </span><span class="n">committed_at</span><span class="p">,</span><span class="w"> </span><span class="k">operation</span><span class="p">,</span><span class="w"> </span><span class="n">summary</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">lakehouse</span><span class="p">.</span><span class="n">gold</span><span class="p">.</span><span class="n">customer_360</span><span class="p">.</span><span class="n">snapshots</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">committed_at</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="s1">&#39;2025-01-15 14:30:00&#39;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">committed_at</span><span class="w"> </span><span class="k">DESC</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="c1">-- Revenir au snapshot avant l&#39;erreur</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="k">CALL</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">rollback_to_snapshot</span><span class="p">(</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">    </span><span class="s1">&#39;lakehouse.gold.customer_360&#39;</span><span class="p">,</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">    </span><span class="mi">8744736658442914487</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="p">);</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="c1">-- Ou revenir à un horodatage spécifique</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="k">CALL</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">rollback_to_timestamp</span><span class="p">(</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">    </span><span class="s1">&#39;lakehouse.gold.customer_360&#39;</span><span class="p">,</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">    </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="s1">&#39;2025-01-15 14:00:00&#39;</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="p">);</span>
</code></pre></div>
<p>Cette récupération est quasi instantanée car elle ne modifie que le pointeur du snapshot courant, sans copier de données.</p>
<p><strong>Scénario 2 : Corruption du catalogue</strong></p>
<p>Le catalogue Iceberg (Hive Metastore, Nessie, REST Catalog) peut être corrompu ou indisponible, rendant les tables inaccessibles même si les fichiers de données sont intacts.</p>
<p><em>Solution</em> : Utiliser la procédure <code>register_table</code> pour recréer l'entrée du catalogue en pointant vers le fichier de métadonnées le plus récent.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1">-- Ré-enregistrer une table à partir de son fichier metadata.json</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="k">CALL</span><span class="w"> </span><span class="n">spark_catalog</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">register_table</span><span class="p">(</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">    </span><span class="k">table</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;lakehouse.gold.customer_360&#39;</span><span class="p">,</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">    </span><span class="n">metadata_file</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;s3a://lakehouse-bucket/gold/customer_360/metadata/v17.metadata.json&#39;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="p">);</span>
</code></pre></div>
<blockquote>
<p><strong>Migration</strong>
<em>De</em> : Catalogue corrompu ou inaccessible
<em>Vers</em> : Table réenregistrée dans un nouveau catalogue
<em>Stratégie</em> : Localiser le fichier <code>metadata.json</code> le plus récent dans le répertoire <code>metadata/</code> de la table, puis utiliser <code>register_table</code> pour recréer l'entrée du catalogue. Maintenir un inventaire des chemins metadata.json comme partie de la documentation de DR.</p>
</blockquote>
<p><strong>Scénario 3 : Restauration depuis une sauvegarde vers un nouvel emplacement</strong></p>
<p>Lors d'une restauration de sauvegarde, les fichiers peuvent être copiés vers un emplacement différent de l'original. Les métadonnées Iceberg utilisent des chemins absolus, qui deviennent alors invalides.</p>
<p><em>Solution</em> : Utiliser la procédure <code>rewrite_table_path</code> pour mettre à jour tous les chemins dans les métadonnées.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1">-- Réécrire les chemins après restauration vers un nouvel emplacement</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="k">CALL</span><span class="w"> </span><span class="n">spark_catalog</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">rewrite_table_path</span><span class="p">(</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="k">table</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;lakehouse.gold.customer_360&#39;</span><span class="p">,</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">    </span><span class="n">source_prefix</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;hdfs://old-cluster/warehouse/customer_360&#39;</span><span class="p">,</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="n">target_prefix</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;s3a://dr-bucket/warehouse/customer_360&#39;</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="p">);</span>
</code></pre></div>
<p>Cette procédure génère un fichier CSV listant tous les fichiers à copier physiquement vers le nouvel emplacement.</p>
<p><strong>Scénario 4 : Perte complète d'une région infonuagique</strong></p>
<p>Ce scénario catastrophique nécessite une réplication préventive vers une région secondaire.</p>
<p><em>Solution</em> : Implémenter une réplication continue des fichiers de données et de métadonnées vers une région DR. Les fournisseurs de stockage objet comme AWS S3 et Azure Blob offrent des fonctionnalités de réplication inter-région. Une approche complémentaire consiste à utiliser des outils comme Apache DistCp pour Hadoop ou des solutions de réplication spécialisées.</p>
<h3 id="strategie-de-sauvegarde-pour-un-lakehouse-iceberg">Stratégie de sauvegarde pour un lakehouse Iceberg<a class="headerlink" href="#strategie-de-sauvegarde-pour-un-lakehouse-iceberg" title="Permanent link">&para;</a></h3>
<p>Une stratégie de sauvegarde complète pour un lakehouse Iceberg doit couvrir trois composants : les métadonnées du catalogue, les métadonnées des tables et les fichiers de données.</p>
<p><strong>Sauvegarde des métadonnées du catalogue</strong> : Le catalogue (Hive Metastore, base de données Nessie, etc.) doit être sauvegardé régulièrement. Pour un Hive Metastore MySQL, cela signifie des sauvegardes de base de données. Pour Nessie, l'exportation du journal des commits.</p>
<p><strong>Sauvegarde des métadonnées Iceberg</strong> : Les fichiers <code>metadata.json</code> et les manifests doivent être inclus dans les sauvegardes. Une bonne pratique consiste à maintenir un inventaire des fichiers metadata.json pour chaque table, avec leur horodatage.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># Script de catalogage des fichiers metadata.json pour DR</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">catalog_metadata_files</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Catalogue les fichiers metadata.json pour faciliter la récupération.&quot;&quot;&quot;</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>    <span class="n">paginator</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s1">&#39;list_objects_v2&#39;</span><span class="p">)</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>    <span class="n">pages</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>        <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>        <span class="n">Prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table_prefix</span><span class="si">}</span><span class="s2">/metadata/&quot;</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>    <span class="p">)</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>    <span class="n">metadata_files</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">:</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Contents&#39;</span><span class="p">,</span> <span class="p">[]):</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.metadata.json&#39;</span><span class="p">):</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>                <span class="n">metadata_files</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>                    <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;s3a://</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>                    <span class="s1">&#39;last_modified&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;LastModified&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>                    <span class="s1">&#39;size_bytes&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Size&#39;</span><span class="p">]</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>                <span class="p">})</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>    <span class="c1"># Trier par date, le plus récent en premier</span>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>    <span class="n">metadata_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;last_modified&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>    <span class="k">return</span> <span class="n">metadata_files</span>
</code></pre></div>
<p><strong>Sauvegarde des fichiers de données</strong> : Pour les fichiers de données (Parquet, ORC), la stratégie dépend des objectifs RPO. Une réplication synchrone vers une région secondaire offre un RPO proche de zéro mais augmente les coûts. Une réplication asynchrone quotidienne offre un compromis coût/RPO acceptable pour de nombreux cas d'usage.</p>
<h3 id="configuration-de-la-replication-s3-cross-region">Configuration de la réplication S3 Cross-Region<a class="headerlink" href="#configuration-de-la-replication-s3-cross-region" title="Permanent link">&para;</a></h3>
<p>AWS S3 offre une fonctionnalité de réplication inter-région (CRR) qui peut être configurée pour répliquer automatiquement les fichiers du lakehouse vers une région DR. Cette configuration est essentielle pour les organisations déployées sur AWS.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="p">{</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">  </span><span class="nt">&quot;Role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::123456789012:role/s3-replication-role&quot;</span><span class="p">,</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span><span class="nt">&quot;Rules&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">      </span><span class="nt">&quot;ID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReplicateLakehouseData&quot;</span><span class="p">,</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">      </span><span class="nt">&quot;Status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span><span class="p">,</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">      </span><span class="nt">&quot;Priority&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">      </span><span class="nt">&quot;Filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">        </span><span class="nt">&quot;Prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;warehouse/&quot;</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">      </span><span class="p">},</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">      </span><span class="nt">&quot;Destination&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="w">        </span><span class="nt">&quot;Bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::lakehouse-dr-bucket&quot;</span><span class="p">,</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">        </span><span class="nt">&quot;StorageClass&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;STANDARD&quot;</span><span class="p">,</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">        </span><span class="nt">&quot;ReplicationTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">          </span><span class="nt">&quot;Status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span><span class="p">,</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="w">          </span><span class="nt">&quot;Time&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="w">            </span><span class="nt">&quot;Minutes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="w">        </span><span class="nt">&quot;Metrics&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a><span class="w">          </span><span class="nt">&quot;Status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span><span class="p">,</span>
<a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a><span class="w">          </span><span class="nt">&quot;EventThreshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="w">            </span><span class="nt">&quot;Minutes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span>
<a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a><span class="w">      </span><span class="p">},</span>
<a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a><span class="w">      </span><span class="nt">&quot;DeleteMarkerReplication&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a><span class="w">        </span><span class="nt">&quot;Status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span>
<a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a><span class="p">}</span>
</code></pre></div>
<p>Pour Azure Blob Storage, la fonctionnalité équivalente s'appelle <em>Object Replication</em>. Pour Google Cloud Storage, il s'agit de <em>Dual-region</em> ou <em>Multi-region</em> buckets combinés avec des politiques de réplication personnalisées.</p>
<h3 id="creation-dun-inventaire-dr-complet">Création d'un inventaire DR complet<a class="headerlink" href="#creation-dun-inventaire-dr-complet" title="Permanent link">&para;</a></h3>
<p>Un inventaire DR complet facilite la récupération en documentant tous les composants du lakehouse et leurs emplacements de sauvegarde.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Script complet d&#39;inventaire DR</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">DRInventoryManager</span><span class="p">:</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Gère l&#39;inventaire de récupération après sinistre pour un lakehouse Iceberg.&quot;&quot;&quot;</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">warehouse_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">inventory_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">warehouse_bucket</span> <span class="o">=</span> <span class="n">warehouse_bucket</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inventory_bucket</span> <span class="o">=</span> <span class="n">inventory_bucket</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_all_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Découvre toutes les tables Iceberg dans le warehouse.&quot;&quot;&quot;</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>        <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>        <span class="n">paginator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s1">&#39;list_objects_v2&#39;</span><span class="p">)</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>        <span class="c1"># Rechercher les répertoires metadata/ qui indiquent une table Iceberg</span>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>        <span class="n">pages</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">warehouse_bucket</span><span class="p">,</span>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>            <span class="n">Delimiter</span><span class="o">=</span><span class="s1">&#39;/&#39;</span>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>        <span class="p">)</span>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">:</span>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>            <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CommonPrefixes&#39;</span><span class="p">,</span> <span class="p">[]):</span>
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>                <span class="n">table_prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="p">[</span><span class="s1">&#39;Prefix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>                <span class="c1"># Vérifier si c&#39;est une table Iceberg (présence de metadata/)</span>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">head_object</span><span class="p">(</span>
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a>                        <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">warehouse_bucket</span><span class="p">,</span>
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a>                        <span class="n">Key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table_prefix</span><span class="si">}</span><span class="s2">/metadata/&quot;</span>
<a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a>                    <span class="p">)</span>
<a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a>                    <span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_prefix</span><span class="p">)</span>
<a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a>                <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a>                    <span class="k">pass</span>
<a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a>
<a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a>        <span class="k">return</span> <span class="n">tables</span>
<a id="__codelineno-28-40" name="__codelineno-28-40" href="#__codelineno-28-40"></a>
<a id="__codelineno-28-41" name="__codelineno-28-41" href="#__codelineno-28-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_metadata_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<a id="__codelineno-28-42" name="__codelineno-28-42" href="#__codelineno-28-42"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Liste tous les fichiers metadata.json pour une table.&quot;&quot;&quot;</span>
<a id="__codelineno-28-43" name="__codelineno-28-43" href="#__codelineno-28-43"></a>        <span class="n">metadata_files</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-28-44" name="__codelineno-28-44" href="#__codelineno-28-44"></a>        <span class="n">paginator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s1">&#39;list_objects_v2&#39;</span><span class="p">)</span>
<a id="__codelineno-28-45" name="__codelineno-28-45" href="#__codelineno-28-45"></a>
<a id="__codelineno-28-46" name="__codelineno-28-46" href="#__codelineno-28-46"></a>        <span class="n">pages</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span>
<a id="__codelineno-28-47" name="__codelineno-28-47" href="#__codelineno-28-47"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">warehouse_bucket</span><span class="p">,</span>
<a id="__codelineno-28-48" name="__codelineno-28-48" href="#__codelineno-28-48"></a>            <span class="n">Prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table_prefix</span><span class="si">}</span><span class="s2">/metadata/&quot;</span>
<a id="__codelineno-28-49" name="__codelineno-28-49" href="#__codelineno-28-49"></a>        <span class="p">)</span>
<a id="__codelineno-28-50" name="__codelineno-28-50" href="#__codelineno-28-50"></a>
<a id="__codelineno-28-51" name="__codelineno-28-51" href="#__codelineno-28-51"></a>        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">:</span>
<a id="__codelineno-28-52" name="__codelineno-28-52" href="#__codelineno-28-52"></a>            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Contents&#39;</span><span class="p">,</span> <span class="p">[]):</span>
<a id="__codelineno-28-53" name="__codelineno-28-53" href="#__codelineno-28-53"></a>                <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.metadata.json&#39;</span><span class="p">):</span>
<a id="__codelineno-28-54" name="__codelineno-28-54" href="#__codelineno-28-54"></a>                    <span class="n">metadata_files</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-28-55" name="__codelineno-28-55" href="#__codelineno-28-55"></a>                        <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;s3a://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">warehouse_bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-28-56" name="__codelineno-28-56" href="#__codelineno-28-56"></a>                        <span class="s1">&#39;last_modified&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;LastModified&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a id="__codelineno-28-57" name="__codelineno-28-57" href="#__codelineno-28-57"></a>                        <span class="s1">&#39;size_bytes&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Size&#39;</span><span class="p">],</span>
<a id="__codelineno-28-58" name="__codelineno-28-58" href="#__codelineno-28-58"></a>                        <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_version</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">])</span>
<a id="__codelineno-28-59" name="__codelineno-28-59" href="#__codelineno-28-59"></a>                    <span class="p">})</span>
<a id="__codelineno-28-60" name="__codelineno-28-60" href="#__codelineno-28-60"></a>
<a id="__codelineno-28-61" name="__codelineno-28-61" href="#__codelineno-28-61"></a>        <span class="n">metadata_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;last_modified&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-28-62" name="__codelineno-28-62" href="#__codelineno-28-62"></a>        <span class="k">return</span> <span class="n">metadata_files</span>
<a id="__codelineno-28-63" name="__codelineno-28-63" href="#__codelineno-28-63"></a>
<a id="__codelineno-28-64" name="__codelineno-28-64" href="#__codelineno-28-64"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-28-65" name="__codelineno-28-65" href="#__codelineno-28-65"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extrait le numéro de version du nom de fichier metadata.&quot;&quot;&quot;</span>
<a id="__codelineno-28-66" name="__codelineno-28-66" href="#__codelineno-28-66"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<a id="__codelineno-28-67" name="__codelineno-28-67" href="#__codelineno-28-67"></a>        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;v(\d+)\.metadata\.json$&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<a id="__codelineno-28-68" name="__codelineno-28-68" href="#__codelineno-28-68"></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-28-69" name="__codelineno-28-69" href="#__codelineno-28-69"></a>
<a id="__codelineno-28-70" name="__codelineno-28-70" href="#__codelineno-28-70"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_full_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-28-71" name="__codelineno-28-71" href="#__codelineno-28-71"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Crée un inventaire complet du lakehouse pour DR.&quot;&quot;&quot;</span>
<a id="__codelineno-28-72" name="__codelineno-28-72" href="#__codelineno-28-72"></a>        <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_all_tables</span><span class="p">()</span>
<a id="__codelineno-28-73" name="__codelineno-28-73" href="#__codelineno-28-73"></a>
<a id="__codelineno-28-74" name="__codelineno-28-74" href="#__codelineno-28-74"></a>        <span class="n">inventory</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-28-75" name="__codelineno-28-75" href="#__codelineno-28-75"></a>            <span class="s1">&#39;generated_at&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a id="__codelineno-28-76" name="__codelineno-28-76" href="#__codelineno-28-76"></a>            <span class="s1">&#39;warehouse_bucket&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">warehouse_bucket</span><span class="p">,</span>
<a id="__codelineno-28-77" name="__codelineno-28-77" href="#__codelineno-28-77"></a>            <span class="s1">&#39;table_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">),</span>
<a id="__codelineno-28-78" name="__codelineno-28-78" href="#__codelineno-28-78"></a>            <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="p">[]</span>
<a id="__codelineno-28-79" name="__codelineno-28-79" href="#__codelineno-28-79"></a>        <span class="p">}</span>
<a id="__codelineno-28-80" name="__codelineno-28-80" href="#__codelineno-28-80"></a>
<a id="__codelineno-28-81" name="__codelineno-28-81" href="#__codelineno-28-81"></a>        <span class="k">for</span> <span class="n">table_path</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
<a id="__codelineno-28-82" name="__codelineno-28-82" href="#__codelineno-28-82"></a>            <span class="n">metadata_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table_metadata_files</span><span class="p">(</span><span class="n">table_path</span><span class="p">)</span>
<a id="__codelineno-28-83" name="__codelineno-28-83" href="#__codelineno-28-83"></a>
<a id="__codelineno-28-84" name="__codelineno-28-84" href="#__codelineno-28-84"></a>            <span class="k">if</span> <span class="n">metadata_files</span><span class="p">:</span>
<a id="__codelineno-28-85" name="__codelineno-28-85" href="#__codelineno-28-85"></a>                <span class="n">table_info</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-28-86" name="__codelineno-28-86" href="#__codelineno-28-86"></a>                    <span class="s1">&#39;table_path&#39;</span><span class="p">:</span> <span class="n">table_path</span><span class="p">,</span>
<a id="__codelineno-28-87" name="__codelineno-28-87" href="#__codelineno-28-87"></a>                    <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">table_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">),</span>
<a id="__codelineno-28-88" name="__codelineno-28-88" href="#__codelineno-28-88"></a>                    <span class="s1">&#39;latest_metadata&#39;</span><span class="p">:</span> <span class="n">metadata_files</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">],</span>
<a id="__codelineno-28-89" name="__codelineno-28-89" href="#__codelineno-28-89"></a>                    <span class="s1">&#39;latest_version&#39;</span><span class="p">:</span> <span class="n">metadata_files</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">],</span>
<a id="__codelineno-28-90" name="__codelineno-28-90" href="#__codelineno-28-90"></a>                    <span class="s1">&#39;metadata_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadata_files</span><span class="p">),</span>
<a id="__codelineno-28-91" name="__codelineno-28-91" href="#__codelineno-28-91"></a>                    <span class="s1">&#39;last_updated&#39;</span><span class="p">:</span> <span class="n">metadata_files</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;last_modified&#39;</span><span class="p">],</span>
<a id="__codelineno-28-92" name="__codelineno-28-92" href="#__codelineno-28-92"></a>                    <span class="s1">&#39;recovery_commands&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_recovery_commands</span><span class="p">(</span>
<a id="__codelineno-28-93" name="__codelineno-28-93" href="#__codelineno-28-93"></a>                        <span class="n">table_path</span><span class="p">,</span> 
<a id="__codelineno-28-94" name="__codelineno-28-94" href="#__codelineno-28-94"></a>                        <span class="n">metadata_files</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
<a id="__codelineno-28-95" name="__codelineno-28-95" href="#__codelineno-28-95"></a>                    <span class="p">)</span>
<a id="__codelineno-28-96" name="__codelineno-28-96" href="#__codelineno-28-96"></a>                <span class="p">}</span>
<a id="__codelineno-28-97" name="__codelineno-28-97" href="#__codelineno-28-97"></a>                <span class="n">inventory</span><span class="p">[</span><span class="s1">&#39;tables&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_info</span><span class="p">)</span>
<a id="__codelineno-28-98" name="__codelineno-28-98" href="#__codelineno-28-98"></a>
<a id="__codelineno-28-99" name="__codelineno-28-99" href="#__codelineno-28-99"></a>        <span class="k">return</span> <span class="n">inventory</span>
<a id="__codelineno-28-100" name="__codelineno-28-100" href="#__codelineno-28-100"></a>
<a id="__codelineno-28-101" name="__codelineno-28-101" href="#__codelineno-28-101"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_recovery_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metadata_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-28-102" name="__codelineno-28-102" href="#__codelineno-28-102"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Génère les commandes de récupération pour une table.&quot;&quot;&quot;</span>
<a id="__codelineno-28-103" name="__codelineno-28-103" href="#__codelineno-28-103"></a>        <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a id="__codelineno-28-104" name="__codelineno-28-104" href="#__codelineno-28-104"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-28-105" name="__codelineno-28-105" href="#__codelineno-28-105"></a>            <span class="s1">&#39;register_table&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-28-106" name="__codelineno-28-106" href="#__codelineno-28-106"></a><span class="s2">CALL spark_catalog.system.register_table(</span>
<a id="__codelineno-28-107" name="__codelineno-28-107" href="#__codelineno-28-107"></a><span class="s2">    table =&gt; &#39;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#39;,</span>
<a id="__codelineno-28-108" name="__codelineno-28-108" href="#__codelineno-28-108"></a><span class="s2">    metadata_file =&gt; &#39;</span><span class="si">{</span><span class="n">metadata_file</span><span class="si">}</span><span class="s2">&#39;</span>
<a id="__codelineno-28-109" name="__codelineno-28-109" href="#__codelineno-28-109"></a><span class="s2">);&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-28-110" name="__codelineno-28-110" href="#__codelineno-28-110"></a>            <span class="s1">&#39;verify_table&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-28-111" name="__codelineno-28-111" href="#__codelineno-28-111"></a><span class="s2">SELECT COUNT(*) as row_count, </span>
<a id="__codelineno-28-112" name="__codelineno-28-112" href="#__codelineno-28-112"></a><span class="s2">       MAX(updated_at) as last_update</span>
<a id="__codelineno-28-113" name="__codelineno-28-113" href="#__codelineno-28-113"></a><span class="s2">FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">;&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-28-114" name="__codelineno-28-114" href="#__codelineno-28-114"></a>            <span class="s1">&#39;list_snapshots&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-28-115" name="__codelineno-28-115" href="#__codelineno-28-115"></a><span class="s2">SELECT snapshot_id, committed_at, operation</span>
<a id="__codelineno-28-116" name="__codelineno-28-116" href="#__codelineno-28-116"></a><span class="s2">FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">.snapshots</span>
<a id="__codelineno-28-117" name="__codelineno-28-117" href="#__codelineno-28-117"></a><span class="s2">ORDER BY committed_at DESC</span>
<a id="__codelineno-28-118" name="__codelineno-28-118" href="#__codelineno-28-118"></a><span class="s2">LIMIT 10;&quot;&quot;&quot;</span>
<a id="__codelineno-28-119" name="__codelineno-28-119" href="#__codelineno-28-119"></a>        <span class="p">}</span>
<a id="__codelineno-28-120" name="__codelineno-28-120" href="#__codelineno-28-120"></a>
<a id="__codelineno-28-121" name="__codelineno-28-121" href="#__codelineno-28-121"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inventory</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-28-122" name="__codelineno-28-122" href="#__codelineno-28-122"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sauvegarde l&#39;inventaire dans le bucket de sauvegarde.&quot;&quot;&quot;</span>
<a id="__codelineno-28-123" name="__codelineno-28-123" href="#__codelineno-28-123"></a>        <span class="n">inventory_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dr-inventory/</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">/%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/inventory.json&quot;</span>
<a id="__codelineno-28-124" name="__codelineno-28-124" href="#__codelineno-28-124"></a>
<a id="__codelineno-28-125" name="__codelineno-28-125" href="#__codelineno-28-125"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span>
<a id="__codelineno-28-126" name="__codelineno-28-126" href="#__codelineno-28-126"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inventory_bucket</span><span class="p">,</span>
<a id="__codelineno-28-127" name="__codelineno-28-127" href="#__codelineno-28-127"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">inventory_key</span><span class="p">,</span>
<a id="__codelineno-28-128" name="__codelineno-28-128" href="#__codelineno-28-128"></a>            <span class="n">Body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">inventory</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
<a id="__codelineno-28-129" name="__codelineno-28-129" href="#__codelineno-28-129"></a>            <span class="n">ContentType</span><span class="o">=</span><span class="s1">&#39;application/json&#39;</span>
<a id="__codelineno-28-130" name="__codelineno-28-130" href="#__codelineno-28-130"></a>        <span class="p">)</span>
<a id="__codelineno-28-131" name="__codelineno-28-131" href="#__codelineno-28-131"></a>
<a id="__codelineno-28-132" name="__codelineno-28-132" href="#__codelineno-28-132"></a>        <span class="c1"># Créer également un pointeur vers la dernière version</span>
<a id="__codelineno-28-133" name="__codelineno-28-133" href="#__codelineno-28-133"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span>
<a id="__codelineno-28-134" name="__codelineno-28-134" href="#__codelineno-28-134"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inventory_bucket</span><span class="p">,</span>
<a id="__codelineno-28-135" name="__codelineno-28-135" href="#__codelineno-28-135"></a>            <span class="n">Key</span><span class="o">=</span><span class="s2">&quot;dr-inventory/latest.json&quot;</span><span class="p">,</span>
<a id="__codelineno-28-136" name="__codelineno-28-136" href="#__codelineno-28-136"></a>            <span class="n">Body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">inventory</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
<a id="__codelineno-28-137" name="__codelineno-28-137" href="#__codelineno-28-137"></a>            <span class="n">ContentType</span><span class="o">=</span><span class="s1">&#39;application/json&#39;</span>
<a id="__codelineno-28-138" name="__codelineno-28-138" href="#__codelineno-28-138"></a>        <span class="p">)</span>
<a id="__codelineno-28-139" name="__codelineno-28-139" href="#__codelineno-28-139"></a>
<a id="__codelineno-28-140" name="__codelineno-28-140" href="#__codelineno-28-140"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;s3://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inventory_bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">inventory_key</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-28-141" name="__codelineno-28-141" href="#__codelineno-28-141"></a>
<a id="__codelineno-28-142" name="__codelineno-28-142" href="#__codelineno-28-142"></a>
<a id="__codelineno-28-143" name="__codelineno-28-143" href="#__codelineno-28-143"></a><span class="c1"># Utilisation</span>
<a id="__codelineno-28-144" name="__codelineno-28-144" href="#__codelineno-28-144"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-28-145" name="__codelineno-28-145" href="#__codelineno-28-145"></a>    <span class="n">manager</span> <span class="o">=</span> <span class="n">DRInventoryManager</span><span class="p">(</span>
<a id="__codelineno-28-146" name="__codelineno-28-146" href="#__codelineno-28-146"></a>        <span class="n">warehouse_bucket</span><span class="o">=</span><span class="s2">&quot;lakehouse-prod&quot;</span><span class="p">,</span>
<a id="__codelineno-28-147" name="__codelineno-28-147" href="#__codelineno-28-147"></a>        <span class="n">inventory_bucket</span><span class="o">=</span><span class="s2">&quot;lakehouse-dr-backups&quot;</span>
<a id="__codelineno-28-148" name="__codelineno-28-148" href="#__codelineno-28-148"></a>    <span class="p">)</span>
<a id="__codelineno-28-149" name="__codelineno-28-149" href="#__codelineno-28-149"></a>
<a id="__codelineno-28-150" name="__codelineno-28-150" href="#__codelineno-28-150"></a>    <span class="n">inventory</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">create_full_inventory</span><span class="p">()</span>
<a id="__codelineno-28-151" name="__codelineno-28-151" href="#__codelineno-28-151"></a>    <span class="n">location</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">save_inventory</span><span class="p">(</span><span class="n">inventory</span><span class="p">)</span>
<a id="__codelineno-28-152" name="__codelineno-28-152" href="#__codelineno-28-152"></a>
<a id="__codelineno-28-153" name="__codelineno-28-153" href="#__codelineno-28-153"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inventaire DR créé : </span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-28-154" name="__codelineno-28-154" href="#__codelineno-28-154"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tables documentées : </span><span class="si">{</span><span class="n">inventory</span><span class="p">[</span><span class="s1">&#39;table_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="automatisation-des-tests-de-recuperation">Automatisation des tests de récupération<a class="headerlink" href="#automatisation-des-tests-de-recuperation" title="Permanent link">&para;</a></h3>
<p>Les tests de récupération doivent être automatisés et exécutés régulièrement. Un pipeline de test DR valide la capacité à restaurer les tables critiques dans les délais RTO définis.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># Pipeline de test DR automatisé</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">DRTestRunner</span><span class="p">:</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Exécute et valide les tests de récupération après sinistre.&quot;&quot;&quot;</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">,</span> <span class="n">dr_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">dr_config</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_snapshot_rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_rto_seconds</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Teste la récupération par rollback de snapshot.&quot;&quot;&quot;</span>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a>            <span class="c1"># Identifier le snapshot cible (24h avant)</span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>            <span class="n">target_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a>
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a>            <span class="n">snapshots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="s2">                SELECT snapshot_id, committed_at </span>
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="s2">                FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">.snapshots</span>
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="s2">                WHERE committed_at &lt; &#39;</span><span class="si">{</span><span class="n">target_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;</span>
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="s2">                ORDER BY committed_at DESC</span>
<a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="s2">                LIMIT 1</span>
<a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a>
<a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">snapshots</span><span class="p">:</span>
<a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_result</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="s2">&quot;rollback&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> 
<a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a>                    <span class="s2">&quot;Aucun snapshot disponible&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
<a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a>
<a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a>            <span class="n">target_snapshot</span> <span class="o">=</span> <span class="n">snapshots</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;snapshot_id&#39;</span><span class="p">]</span>
<a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a>
<a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a>            <span class="c1"># Créer une branche de test pour ne pas affecter la production</span>
<a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a><span class="s2">                ALTER TABLE </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span>
<a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a><span class="s2">                CREATE BRANCH dr_test_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span>
<a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a><span class="s2">                AS OF VERSION </span><span class="si">{</span><span class="n">target_snapshot</span><span class="si">}</span>
<a id="__codelineno-29-41" name="__codelineno-29-41" href="#__codelineno-29-41"></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-29-42" name="__codelineno-29-42" href="#__codelineno-29-42"></a>
<a id="__codelineno-29-43" name="__codelineno-29-43" href="#__codelineno-29-43"></a>            <span class="n">branch_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dr_test_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-29-44" name="__codelineno-29-44" href="#__codelineno-29-44"></a>
<a id="__codelineno-29-45" name="__codelineno-29-45" href="#__codelineno-29-45"></a>            <span class="c1"># Valider la branche</span>
<a id="__codelineno-29-46" name="__codelineno-29-46" href="#__codelineno-29-46"></a>            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-29-47" name="__codelineno-29-47" href="#__codelineno-29-47"></a><span class="s2">                SELECT COUNT(*) as cnt FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">.branch_</span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span>
<a id="__codelineno-29-48" name="__codelineno-29-48" href="#__codelineno-29-48"></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;cnt&#39;</span><span class="p">]</span>
<a id="__codelineno-29-49" name="__codelineno-29-49" href="#__codelineno-29-49"></a>
<a id="__codelineno-29-50" name="__codelineno-29-50" href="#__codelineno-29-50"></a>            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-29-51" name="__codelineno-29-51" href="#__codelineno-29-51"></a>
<a id="__codelineno-29-52" name="__codelineno-29-52" href="#__codelineno-29-52"></a>            <span class="c1"># Nettoyer</span>
<a id="__codelineno-29-53" name="__codelineno-29-53" href="#__codelineno-29-53"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ALTER TABLE </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> DROP BRANCH </span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-29-54" name="__codelineno-29-54" href="#__codelineno-29-54"></a>
<a id="__codelineno-29-55" name="__codelineno-29-55" href="#__codelineno-29-55"></a>            <span class="n">success</span> <span class="o">=</span> <span class="n">elapsed</span> <span class="o">&lt;=</span> <span class="n">max_rto_seconds</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-29-56" name="__codelineno-29-56" href="#__codelineno-29-56"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_result</span><span class="p">(</span>
<a id="__codelineno-29-57" name="__codelineno-29-57" href="#__codelineno-29-57"></a>                <span class="n">table_name</span><span class="p">,</span> <span class="s2">&quot;rollback&quot;</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span>
<a id="__codelineno-29-58" name="__codelineno-29-58" href="#__codelineno-29-58"></a>                <span class="sa">f</span><span class="s2">&quot;Durée: </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s, Enregistrements: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">, Snapshot: </span><span class="si">{</span><span class="n">target_snapshot</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-29-59" name="__codelineno-29-59" href="#__codelineno-29-59"></a>                <span class="n">elapsed</span>
<a id="__codelineno-29-60" name="__codelineno-29-60" href="#__codelineno-29-60"></a>            <span class="p">)</span>
<a id="__codelineno-29-61" name="__codelineno-29-61" href="#__codelineno-29-61"></a>
<a id="__codelineno-29-62" name="__codelineno-29-62" href="#__codelineno-29-62"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-29-63" name="__codelineno-29-63" href="#__codelineno-29-63"></a>            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-29-64" name="__codelineno-29-64" href="#__codelineno-29-64"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_result</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="s2">&quot;rollback&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">elapsed</span><span class="p">)</span>
<a id="__codelineno-29-65" name="__codelineno-29-65" href="#__codelineno-29-65"></a>
<a id="__codelineno-29-66" name="__codelineno-29-66" href="#__codelineno-29-66"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_register_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metadata_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-29-67" name="__codelineno-29-67" href="#__codelineno-29-67"></a>                           <span class="n">max_rto_seconds</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-29-68" name="__codelineno-29-68" href="#__codelineno-29-68"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Teste la récupération par ré-enregistrement de table.&quot;&quot;&quot;</span>
<a id="__codelineno-29-69" name="__codelineno-29-69" href="#__codelineno-29-69"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-29-70" name="__codelineno-29-70" href="#__codelineno-29-70"></a>
<a id="__codelineno-29-71" name="__codelineno-29-71" href="#__codelineno-29-71"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-29-72" name="__codelineno-29-72" href="#__codelineno-29-72"></a>            <span class="c1"># Enregistrer la table avec un nouveau nom temporaire</span>
<a id="__codelineno-29-73" name="__codelineno-29-73" href="#__codelineno-29-73"></a>            <span class="n">test_table_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dr_test_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-29-74" name="__codelineno-29-74" href="#__codelineno-29-74"></a>
<a id="__codelineno-29-75" name="__codelineno-29-75" href="#__codelineno-29-75"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-29-76" name="__codelineno-29-76" href="#__codelineno-29-76"></a><span class="s2">                CALL iceberg.system.register_table(</span>
<a id="__codelineno-29-77" name="__codelineno-29-77" href="#__codelineno-29-77"></a><span class="s2">                    table =&gt; &#39;dr_catalog.</span><span class="si">{</span><span class="n">test_table_name</span><span class="si">}</span><span class="s2">&#39;,</span>
<a id="__codelineno-29-78" name="__codelineno-29-78" href="#__codelineno-29-78"></a><span class="s2">                    metadata_file =&gt; &#39;</span><span class="si">{</span><span class="n">metadata_file</span><span class="si">}</span><span class="s2">&#39;</span>
<a id="__codelineno-29-79" name="__codelineno-29-79" href="#__codelineno-29-79"></a><span class="s2">                )</span>
<a id="__codelineno-29-80" name="__codelineno-29-80" href="#__codelineno-29-80"></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-29-81" name="__codelineno-29-81" href="#__codelineno-29-81"></a>
<a id="__codelineno-29-82" name="__codelineno-29-82" href="#__codelineno-29-82"></a>            <span class="c1"># Valider que la table est accessible</span>
<a id="__codelineno-29-83" name="__codelineno-29-83" href="#__codelineno-29-83"></a>            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-29-84" name="__codelineno-29-84" href="#__codelineno-29-84"></a><span class="s2">                SELECT COUNT(*) as cnt FROM dr_catalog.</span><span class="si">{</span><span class="n">test_table_name</span><span class="si">}</span>
<a id="__codelineno-29-85" name="__codelineno-29-85" href="#__codelineno-29-85"></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;cnt&#39;</span><span class="p">]</span>
<a id="__codelineno-29-86" name="__codelineno-29-86" href="#__codelineno-29-86"></a>
<a id="__codelineno-29-87" name="__codelineno-29-87" href="#__codelineno-29-87"></a>            <span class="c1"># Vérifier les métadonnées</span>
<a id="__codelineno-29-88" name="__codelineno-29-88" href="#__codelineno-29-88"></a>            <span class="n">schema_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-29-89" name="__codelineno-29-89" href="#__codelineno-29-89"></a><span class="s2">                DESCRIBE dr_catalog.</span><span class="si">{</span><span class="n">test_table_name</span><span class="si">}</span>
<a id="__codelineno-29-90" name="__codelineno-29-90" href="#__codelineno-29-90"></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-29-91" name="__codelineno-29-91" href="#__codelineno-29-91"></a>
<a id="__codelineno-29-92" name="__codelineno-29-92" href="#__codelineno-29-92"></a>            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-29-93" name="__codelineno-29-93" href="#__codelineno-29-93"></a>
<a id="__codelineno-29-94" name="__codelineno-29-94" href="#__codelineno-29-94"></a>            <span class="c1"># Nettoyer</span>
<a id="__codelineno-29-95" name="__codelineno-29-95" href="#__codelineno-29-95"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DROP TABLE dr_catalog.</span><span class="si">{</span><span class="n">test_table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-29-96" name="__codelineno-29-96" href="#__codelineno-29-96"></a>
<a id="__codelineno-29-97" name="__codelineno-29-97" href="#__codelineno-29-97"></a>            <span class="n">success</span> <span class="o">=</span> <span class="n">elapsed</span> <span class="o">&lt;=</span> <span class="n">max_rto_seconds</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-29-98" name="__codelineno-29-98" href="#__codelineno-29-98"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_result</span><span class="p">(</span>
<a id="__codelineno-29-99" name="__codelineno-29-99" href="#__codelineno-29-99"></a>                <span class="n">table_path</span><span class="p">,</span> <span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span>
<a id="__codelineno-29-100" name="__codelineno-29-100" href="#__codelineno-29-100"></a>                <span class="sa">f</span><span class="s2">&quot;Durée: </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s, Enregistrements: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">, Colonnes: </span><span class="si">{</span><span class="n">schema_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-29-101" name="__codelineno-29-101" href="#__codelineno-29-101"></a>                <span class="n">elapsed</span>
<a id="__codelineno-29-102" name="__codelineno-29-102" href="#__codelineno-29-102"></a>            <span class="p">)</span>
<a id="__codelineno-29-103" name="__codelineno-29-103" href="#__codelineno-29-103"></a>
<a id="__codelineno-29-104" name="__codelineno-29-104" href="#__codelineno-29-104"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-29-105" name="__codelineno-29-105" href="#__codelineno-29-105"></a>            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-29-106" name="__codelineno-29-106" href="#__codelineno-29-106"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_result</span><span class="p">(</span><span class="n">table_path</span><span class="p">,</span> <span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">elapsed</span><span class="p">)</span>
<a id="__codelineno-29-107" name="__codelineno-29-107" href="#__codelineno-29-107"></a>
<a id="__codelineno-29-108" name="__codelineno-29-108" href="#__codelineno-29-108"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_time_travel_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hours_back</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">48</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-29-109" name="__codelineno-29-109" href="#__codelineno-29-109"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Teste la capacité de requête time travel.&quot;&quot;&quot;</span>
<a id="__codelineno-29-110" name="__codelineno-29-110" href="#__codelineno-29-110"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-29-111" name="__codelineno-29-111" href="#__codelineno-29-111"></a>
<a id="__codelineno-29-112" name="__codelineno-29-112" href="#__codelineno-29-112"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-29-113" name="__codelineno-29-113" href="#__codelineno-29-113"></a>            <span class="n">target_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">hours_back</span><span class="p">)</span>
<a id="__codelineno-29-114" name="__codelineno-29-114" href="#__codelineno-29-114"></a>
<a id="__codelineno-29-115" name="__codelineno-29-115" href="#__codelineno-29-115"></a>            <span class="c1"># Exécuter une requête time travel</span>
<a id="__codelineno-29-116" name="__codelineno-29-116" href="#__codelineno-29-116"></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-29-117" name="__codelineno-29-117" href="#__codelineno-29-117"></a><span class="s2">                SELECT COUNT(*) as cnt</span>
<a id="__codelineno-29-118" name="__codelineno-29-118" href="#__codelineno-29-118"></a><span class="s2">                FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span>
<a id="__codelineno-29-119" name="__codelineno-29-119" href="#__codelineno-29-119"></a><span class="s2">                FOR TIMESTAMP AS OF TIMESTAMP &#39;</span><span class="si">{</span><span class="n">target_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;</span>
<a id="__codelineno-29-120" name="__codelineno-29-120" href="#__codelineno-29-120"></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;cnt&#39;</span><span class="p">]</span>
<a id="__codelineno-29-121" name="__codelineno-29-121" href="#__codelineno-29-121"></a>
<a id="__codelineno-29-122" name="__codelineno-29-122" href="#__codelineno-29-122"></a>            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-29-123" name="__codelineno-29-123" href="#__codelineno-29-123"></a>
<a id="__codelineno-29-124" name="__codelineno-29-124" href="#__codelineno-29-124"></a>            <span class="n">success</span> <span class="o">=</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-29-125" name="__codelineno-29-125" href="#__codelineno-29-125"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_result</span><span class="p">(</span>
<a id="__codelineno-29-126" name="__codelineno-29-126" href="#__codelineno-29-126"></a>                <span class="n">table_name</span><span class="p">,</span> <span class="s2">&quot;time_travel&quot;</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span>
<a id="__codelineno-29-127" name="__codelineno-29-127" href="#__codelineno-29-127"></a>                <span class="sa">f</span><span class="s2">&quot;Durée: </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s, Enregistrements à t-</span><span class="si">{</span><span class="n">hours_back</span><span class="si">}</span><span class="s2">h: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-29-128" name="__codelineno-29-128" href="#__codelineno-29-128"></a>                <span class="n">elapsed</span>
<a id="__codelineno-29-129" name="__codelineno-29-129" href="#__codelineno-29-129"></a>            <span class="p">)</span>
<a id="__codelineno-29-130" name="__codelineno-29-130" href="#__codelineno-29-130"></a>
<a id="__codelineno-29-131" name="__codelineno-29-131" href="#__codelineno-29-131"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-29-132" name="__codelineno-29-132" href="#__codelineno-29-132"></a>            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-29-133" name="__codelineno-29-133" href="#__codelineno-29-133"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_result</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="s2">&quot;time_travel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">elapsed</span><span class="p">)</span>
<a id="__codelineno-29-134" name="__codelineno-29-134" href="#__codelineno-29-134"></a>
<a id="__codelineno-29-135" name="__codelineno-29-135" href="#__codelineno-29-135"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_record_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">test_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> 
<a id="__codelineno-29-136" name="__codelineno-29-136" href="#__codelineno-29-136"></a>                      <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-29-137" name="__codelineno-29-137" href="#__codelineno-29-137"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enregistre le résultat d&#39;un test.&quot;&quot;&quot;</span>
<a id="__codelineno-29-138" name="__codelineno-29-138" href="#__codelineno-29-138"></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-29-139" name="__codelineno-29-139" href="#__codelineno-29-139"></a>            <span class="s1">&#39;table&#39;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span>
<a id="__codelineno-29-140" name="__codelineno-29-140" href="#__codelineno-29-140"></a>            <span class="s1">&#39;test_type&#39;</span><span class="p">:</span> <span class="n">test_type</span><span class="p">,</span>
<a id="__codelineno-29-141" name="__codelineno-29-141" href="#__codelineno-29-141"></a>            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="n">success</span><span class="p">,</span>
<a id="__codelineno-29-142" name="__codelineno-29-142" href="#__codelineno-29-142"></a>            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
<a id="__codelineno-29-143" name="__codelineno-29-143" href="#__codelineno-29-143"></a>            <span class="s1">&#39;duration_seconds&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-29-144" name="__codelineno-29-144" href="#__codelineno-29-144"></a>            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<a id="__codelineno-29-145" name="__codelineno-29-145" href="#__codelineno-29-145"></a>        <span class="p">}</span>
<a id="__codelineno-29-146" name="__codelineno-29-146" href="#__codelineno-29-146"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-29-147" name="__codelineno-29-147" href="#__codelineno-29-147"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-29-148" name="__codelineno-29-148" href="#__codelineno-29-148"></a>
<a id="__codelineno-29-149" name="__codelineno-29-149" href="#__codelineno-29-149"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_full_test_suite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">critical_tables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-29-150" name="__codelineno-29-150" href="#__codelineno-29-150"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Exécute la suite complète de tests DR.&quot;&quot;&quot;</span>
<a id="__codelineno-29-151" name="__codelineno-29-151" href="#__codelineno-29-151"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Démarrage des tests DR à </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-29-152" name="__codelineno-29-152" href="#__codelineno-29-152"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tables à tester : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">critical_tables</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-29-153" name="__codelineno-29-153" href="#__codelineno-29-153"></a>
<a id="__codelineno-29-154" name="__codelineno-29-154" href="#__codelineno-29-154"></a>        <span class="k">for</span> <span class="n">table_config</span> <span class="ow">in</span> <span class="n">critical_tables</span><span class="p">:</span>
<a id="__codelineno-29-155" name="__codelineno-29-155" href="#__codelineno-29-155"></a>            <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_config</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<a id="__codelineno-29-156" name="__codelineno-29-156" href="#__codelineno-29-156"></a>            <span class="n">max_rto</span> <span class="o">=</span> <span class="n">table_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_rto_seconds&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<a id="__codelineno-29-157" name="__codelineno-29-157" href="#__codelineno-29-157"></a>            <span class="n">metadata_file</span> <span class="o">=</span> <span class="n">table_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;metadata_file&#39;</span><span class="p">)</span>
<a id="__codelineno-29-158" name="__codelineno-29-158" href="#__codelineno-29-158"></a>
<a id="__codelineno-29-159" name="__codelineno-29-159" href="#__codelineno-29-159"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test de </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-29-160" name="__codelineno-29-160" href="#__codelineno-29-160"></a>
<a id="__codelineno-29-161" name="__codelineno-29-161" href="#__codelineno-29-161"></a>            <span class="c1"># Test 1: Rollback de snapshot</span>
<a id="__codelineno-29-162" name="__codelineno-29-162" href="#__codelineno-29-162"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">test_snapshot_rollback</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">max_rto</span><span class="p">)</span>
<a id="__codelineno-29-163" name="__codelineno-29-163" href="#__codelineno-29-163"></a>
<a id="__codelineno-29-164" name="__codelineno-29-164" href="#__codelineno-29-164"></a>            <span class="c1"># Test 2: Time travel</span>
<a id="__codelineno-29-165" name="__codelineno-29-165" href="#__codelineno-29-165"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">test_time_travel_query</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
<a id="__codelineno-29-166" name="__codelineno-29-166" href="#__codelineno-29-166"></a>
<a id="__codelineno-29-167" name="__codelineno-29-167" href="#__codelineno-29-167"></a>            <span class="c1"># Test 3: Register table (si metadata_file fourni)</span>
<a id="__codelineno-29-168" name="__codelineno-29-168" href="#__codelineno-29-168"></a>            <span class="k">if</span> <span class="n">metadata_file</span><span class="p">:</span>
<a id="__codelineno-29-169" name="__codelineno-29-169" href="#__codelineno-29-169"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">test_register_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">metadata_file</span><span class="p">,</span> <span class="n">max_rto</span><span class="p">)</span>
<a id="__codelineno-29-170" name="__codelineno-29-170" href="#__codelineno-29-170"></a>
<a id="__codelineno-29-171" name="__codelineno-29-171" href="#__codelineno-29-171"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>
<a id="__codelineno-29-172" name="__codelineno-29-172" href="#__codelineno-29-172"></a>
<a id="__codelineno-29-173" name="__codelineno-29-173" href="#__codelineno-29-173"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-29-174" name="__codelineno-29-174" href="#__codelineno-29-174"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Génère un rapport de test DR complet.&quot;&quot;&quot;</span>
<a id="__codelineno-29-175" name="__codelineno-29-175" href="#__codelineno-29-175"></a>        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
<a id="__codelineno-29-176" name="__codelineno-29-176" href="#__codelineno-29-176"></a>        <span class="n">passed</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
<a id="__codelineno-29-177" name="__codelineno-29-177" href="#__codelineno-29-177"></a>        <span class="n">failed</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">passed</span>
<a id="__codelineno-29-178" name="__codelineno-29-178" href="#__codelineno-29-178"></a>
<a id="__codelineno-29-179" name="__codelineno-29-179" href="#__codelineno-29-179"></a>        <span class="n">avg_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;duration_seconds&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span> <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-29-180" name="__codelineno-29-180" href="#__codelineno-29-180"></a>        <span class="n">max_duration</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;duration_seconds&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-29-181" name="__codelineno-29-181" href="#__codelineno-29-181"></a>
<a id="__codelineno-29-182" name="__codelineno-29-182" href="#__codelineno-29-182"></a>        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-29-183" name="__codelineno-29-183" href="#__codelineno-29-183"></a>            <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-29-184" name="__codelineno-29-184" href="#__codelineno-29-184"></a>                <span class="s1">&#39;generated_at&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a id="__codelineno-29-185" name="__codelineno-29-185" href="#__codelineno-29-185"></a>                <span class="s1">&#39;total_tests&#39;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span>
<a id="__codelineno-29-186" name="__codelineno-29-186" href="#__codelineno-29-186"></a>                <span class="s1">&#39;passed&#39;</span><span class="p">:</span> <span class="n">passed</span><span class="p">,</span>
<a id="__codelineno-29-187" name="__codelineno-29-187" href="#__codelineno-29-187"></a>                <span class="s1">&#39;failed&#39;</span><span class="p">:</span> <span class="n">failed</span><span class="p">,</span>
<a id="__codelineno-29-188" name="__codelineno-29-188" href="#__codelineno-29-188"></a>                <span class="s1">&#39;success_rate&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">passed</span><span class="o">/</span><span class="n">total</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span> <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span><span class="p">,</span>
<a id="__codelineno-29-189" name="__codelineno-29-189" href="#__codelineno-29-189"></a>                <span class="s1">&#39;average_duration_seconds&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">avg_duration</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-29-190" name="__codelineno-29-190" href="#__codelineno-29-190"></a>                <span class="s1">&#39;max_duration_seconds&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">max_duration</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-29-191" name="__codelineno-29-191" href="#__codelineno-29-191"></a>            <span class="p">},</span>
<a id="__codelineno-29-192" name="__codelineno-29-192" href="#__codelineno-29-192"></a>            <span class="s1">&#39;by_test_type&#39;</span><span class="p">:</span> <span class="p">{},</span>
<a id="__codelineno-29-193" name="__codelineno-29-193" href="#__codelineno-29-193"></a>            <span class="s1">&#39;failures&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]],</span>
<a id="__codelineno-29-194" name="__codelineno-29-194" href="#__codelineno-29-194"></a>            <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>
<a id="__codelineno-29-195" name="__codelineno-29-195" href="#__codelineno-29-195"></a>        <span class="p">}</span>
<a id="__codelineno-29-196" name="__codelineno-29-196" href="#__codelineno-29-196"></a>
<a id="__codelineno-29-197" name="__codelineno-29-197" href="#__codelineno-29-197"></a>        <span class="c1"># Agrégation par type de test</span>
<a id="__codelineno-29-198" name="__codelineno-29-198" href="#__codelineno-29-198"></a>        <span class="k">for</span> <span class="n">test_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rollback&#39;</span><span class="p">,</span> <span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="s1">&#39;time_travel&#39;</span><span class="p">]:</span>
<a id="__codelineno-29-199" name="__codelineno-29-199" href="#__codelineno-29-199"></a>            <span class="n">type_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;test_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">test_type</span><span class="p">]</span>
<a id="__codelineno-29-200" name="__codelineno-29-200" href="#__codelineno-29-200"></a>            <span class="k">if</span> <span class="n">type_results</span><span class="p">:</span>
<a id="__codelineno-29-201" name="__codelineno-29-201" href="#__codelineno-29-201"></a>                <span class="n">report</span><span class="p">[</span><span class="s1">&#39;by_test_type&#39;</span><span class="p">][</span><span class="n">test_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-29-202" name="__codelineno-29-202" href="#__codelineno-29-202"></a>                    <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_results</span><span class="p">),</span>
<a id="__codelineno-29-203" name="__codelineno-29-203" href="#__codelineno-29-203"></a>                    <span class="s1">&#39;passed&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">type_results</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]),</span>
<a id="__codelineno-29-204" name="__codelineno-29-204" href="#__codelineno-29-204"></a>                    <span class="s1">&#39;avg_duration&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span>
<a id="__codelineno-29-205" name="__codelineno-29-205" href="#__codelineno-29-205"></a>                        <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;duration_seconds&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">type_results</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_results</span><span class="p">),</span> <span class="mi">2</span>
<a id="__codelineno-29-206" name="__codelineno-29-206" href="#__codelineno-29-206"></a>                    <span class="p">)</span>
<a id="__codelineno-29-207" name="__codelineno-29-207" href="#__codelineno-29-207"></a>                <span class="p">}</span>
<a id="__codelineno-29-208" name="__codelineno-29-208" href="#__codelineno-29-208"></a>
<a id="__codelineno-29-209" name="__codelineno-29-209" href="#__codelineno-29-209"></a>        <span class="k">return</span> <span class="n">report</span>
</code></pre></div>
<blockquote>
<p><strong>Performance</strong>
La réplication inter-région peut avoir un impact significatif sur les performances d'écriture si elle est synchrone. Pour les tables à haut débit d'écriture, privilégier une réplication asynchrone avec un objectif RPO de 15-60 minutes, combinée à des snapshots horodatés réguliers permettant une récupération à un point précis dans le temps.</p>
</blockquote>
<h3 id="plan-de-recuperation-apres-sinistre">Plan de récupération après sinistre<a class="headerlink" href="#plan-de-recuperation-apres-sinistre" title="Permanent link">&para;</a></h3>
<p>Un plan de DR documenté et testé est essentiel. Ce plan doit inclure les éléments suivants.</p>
<p><strong>Inventaire des actifs</strong> : Liste de toutes les tables Iceberg, leur classification de criticité, et les chemins des fichiers metadata.json correspondants.</p>
<p><strong>Procédures de récupération</strong> : Scripts et runbooks pour chaque scénario de défaillance identifié, avec les commandes exactes à exécuter.</p>
<p><strong>Rôles et responsabilités</strong> : Identification des personnes autorisées à déclencher une récupération et des équipes responsables de chaque composant.</p>
<p><strong>Tests réguliers</strong> : Simulation de sinistres et exécution des procédures de récupération dans un environnement de test, au minimum trimestriellement.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="gh"># Runbook de récupération — Suppression accidentelle de données</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="gu">## Prérequis</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="k">-</span><span class="w"> </span>Accès administrateur au cluster Spark
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="k">-</span><span class="w"> </span>Identifiants du catalogue Iceberg
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="k">-</span><span class="w"> </span>Connaissance de l&#39;heure approximative de l&#39;incident
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="gu">## Étapes</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="k">1.</span> <span class="gs">**Identifier le snapshot cible**</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="sb">   ```sql</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w">   </span><span class="k">SELECT</span><span class="w"> </span><span class="n">snapshot_id</span><span class="p">,</span><span class="w"> </span><span class="n">committed_at</span><span class="p">,</span><span class="w"> </span><span class="k">operation</span><span class="p">,</span><span class="w"> </span><span class="n">summary</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w">   </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="p">.</span><span class="n">snapshots</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="w">   </span><span class="k">WHERE</span><span class="w"> </span><span class="n">committed_at</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">&#39;&lt;heure_incident&gt;&#39;</span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="w">   </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">committed_at</span><span class="w"> </span><span class="k">DESC</span>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="w">   </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="sb">   ```</span>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="k">2.</span> <span class="gs">**Valider le snapshot**</span> (vérifier que les données attendues sont présentes)
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="sb">   ```sql</span>
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a><span class="w">   </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">updated_at</span><span class="p">)</span>
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="w">   </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">VERSION</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="o">&lt;</span><span class="n">snapshot_id</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="sb">   ```</span>
<a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>
<a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a><span class="k">3.</span> <span class="gs">**Exécuter le rollback**</span>
<a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="sb">   ```sql</span>
<a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a><span class="w">   </span><span class="k">CALL</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">rollback_to_snapshot</span><span class="p">(</span><span class="s1">&#39;&lt;table&gt;&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">snapshot_id</span><span class="o">&gt;</span><span class="p">);</span>
<a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a><span class="sb">   ```</span>
<a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a>
<a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="k">4.</span> <span class="gs">**Valider la récupération**</span>
<a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="sb">   ```sql</span>
<a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a><span class="w">   </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">updated_at</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a><span class="sb">   ```</span>
<a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a>
<a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a><span class="k">5.</span> <span class="gs">**Notifier les parties prenantes**</span>
<a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a><span class="w">   </span><span class="k">-</span><span class="w"> </span>Informer l&#39;équipe data engineering
<a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a><span class="w">   </span><span class="k">-</span><span class="w"> </span>Créer un ticket d&#39;incident
<a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a><span class="w">   </span><span class="k">-</span><span class="w"> </span>Documenter la cause racine
<a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a>
<a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a><span class="gu">## Escalade</span>
<a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a>Si la récupération échoue, contacter le DBA de garde au [numéro].
</code></pre></div>
<h3 id="replication-multi-region-et-haute-disponibilite">Réplication multi-région et haute disponibilité<a class="headerlink" href="#replication-multi-region-et-haute-disponibilite" title="Permanent link">&para;</a></h3>
<p>Pour les organisations exigeant une haute disponibilité (HA) avec des RTO de quelques minutes, une architecture multi-région active-passive ou active-active est nécessaire.</p>
<p><strong>Architecture active-passive</strong> : Une région primaire traite toutes les écritures, avec réplication asynchrone vers une région secondaire. En cas de sinistre, la région secondaire est promue en primaire. Cette architecture offre un bon compromis entre coût et résilience.</p>
<p><strong>Architecture active-active</strong> : Les deux régions acceptent les écritures, avec résolution des conflits. Cette architecture est complexe à implémenter avec Iceberg en raison des garanties ACID, et nécessite généralement une couche de coordination externe.</p>
<p>Les catalogues modernes comme Apache Polaris et Nessie offrent des fonctionnalités de réplication qui facilitent la synchronisation des métadonnées entre régions. Combinées à la réplication de stockage objet, ces fonctionnalités permettent de construire des architectures HA sophistiquées.</p>
<h3 id="conception-dune-architecture-multi-region">Conception d'une architecture multi-région<a class="headerlink" href="#conception-dune-architecture-multi-region" title="Permanent link">&para;</a></h3>
<p>L'architecture multi-région pour un lakehouse Iceberg requiert une planification minutieuse des composants de stockage, de catalogue et de calcul.</p>
<p><strong>Composant stockage</strong> : Le stockage objet constitue la fondation. AWS S3, Azure Blob Storage et Google Cloud Storage offrent tous des options de réplication inter-région. La configuration dépend des exigences RPO.</p>
<ul>
<li><strong>Réplication S3 Cross-Region</strong> : Latence typique de 15 minutes pour la réplication. Convient pour RPO &gt; 15 minutes.</li>
<li><strong>S3 Multi-Region Access Points</strong> : Permet des écritures automatiquement routées vers la région la plus proche. Convient pour les architectures actif-actif.</li>
<li><strong>Azure Geo-Redundant Storage (GRS)</strong> : Réplication synchrone vers une région secondaire. RPO proche de zéro mais surcoût significatif.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Configuration AWS CLI pour activer la réplication CRR</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>aws<span class="w"> </span>s3api<span class="w"> </span>put-bucket-replication<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">    </span>--bucket<span class="w"> </span>lakehouse-primary<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">    </span>--replication-configuration<span class="w"> </span>file://replication-config.json
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="c1"># Vérification du statut de réplication</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>aws<span class="w"> </span>s3api<span class="w"> </span>get-bucket-replication-metrics<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">    </span>--bucket<span class="w"> </span>lakehouse-primary<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">    </span>--id<span class="w"> </span>ReplicationRule1
</code></pre></div>
<p><strong>Composant catalogue</strong> : Le catalogue doit être répliqué pour permettre la découverte des tables dans la région DR.</p>
<ul>
<li><strong>Nessie</strong> : Supporte la réplication via export/import des commits. La communauté travaille sur une réplication native.</li>
<li><strong>Apache Polaris</strong> : Offre des API de synchronisation pour les environnements multi-région.</li>
<li><strong>Hive Metastore</strong> : Peut être répliqué via la réplication de la base de données sous-jacente (MySQL, PostgreSQL).</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># Script de synchronisation Nessie vers région DR</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">NessieReplicator</span><span class="p">:</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Réplique les commits Nessie vers une région DR.&quot;&quot;&quot;</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_uri</span> <span class="o">=</span> <span class="n">source_uri</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_uri</span> <span class="o">=</span> <span class="n">target_uri</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_synced_commit</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_commits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">branch</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">since_commit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Récupère les commits depuis la source.&quot;&quot;&quot;</span>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">source_uri</span><span class="si">}</span><span class="s2">/api/v2/trees/</span><span class="si">{</span><span class="n">branch</span><span class="si">}</span><span class="s2">/log&quot;</span>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>        <span class="k">if</span> <span class="n">since_commit</span><span class="p">:</span>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;commit.hash != &#39;</span><span class="si">{</span><span class="n">since_commit</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logEntries&#39;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a>
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">replicate_commits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commits</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Réplique les commits vers la cible.&quot;&quot;&quot;</span>
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>        <span class="k">for</span> <span class="n">commit</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">commits</span><span class="p">):</span>  <span class="c1"># Du plus ancien au plus récent</span>
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>            <span class="c1"># Récupérer les opérations du commit</span>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a>            <span class="n">operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_commit_operations</span><span class="p">(</span><span class="n">commit</span><span class="p">[</span><span class="s1">&#39;commitMeta&#39;</span><span class="p">][</span><span class="s1">&#39;hash&#39;</span><span class="p">])</span>
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a>            <span class="c1"># Appliquer à la cible</span>
<a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">apply_operations</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="n">commit</span><span class="p">[</span><span class="s1">&#39;commitMeta&#39;</span><span class="p">])</span>
<a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a>
<a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_synced_commit</span> <span class="o">=</span> <span class="n">commit</span><span class="p">[</span><span class="s1">&#39;commitMeta&#39;</span><span class="p">][</span><span class="s1">&#39;hash&#39;</span><span class="p">]</span>
<a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a>
<a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_commit_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit_hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Récupère les opérations d&#39;un commit.&quot;&quot;&quot;</span>
<a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">source_uri</span><span class="si">}</span><span class="s2">/api/v2/trees/main/diff&quot;</span>
<a id="__codelineno-32-37" name="__codelineno-32-37" href="#__codelineno-32-37"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">commit_hash</span><span class="si">}</span><span class="s1">^&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="n">commit_hash</span><span class="p">}</span>
<a id="__codelineno-32-38" name="__codelineno-32-38" href="#__codelineno-32-38"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-32-39" name="__codelineno-32-39" href="#__codelineno-32-39"></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;diffs&#39;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-32-40" name="__codelineno-32-40" href="#__codelineno-32-40"></a>
<a id="__codelineno-32-41" name="__codelineno-32-41" href="#__codelineno-32-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operations</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">commit_meta</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-32-42" name="__codelineno-32-42" href="#__codelineno-32-42"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Applique les opérations à la cible.&quot;&quot;&quot;</span>
<a id="__codelineno-32-43" name="__codelineno-32-43" href="#__codelineno-32-43"></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_uri</span><span class="si">}</span><span class="s2">/api/v2/trees/main/commit&quot;</span>
<a id="__codelineno-32-44" name="__codelineno-32-44" href="#__codelineno-32-44"></a>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-32-45" name="__codelineno-32-45" href="#__codelineno-32-45"></a>            <span class="s1">&#39;commitMeta&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-32-46" name="__codelineno-32-46" href="#__codelineno-32-46"></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;[REPLICATED] </span><span class="si">{</span><span class="n">commit_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-32-47" name="__codelineno-32-47" href="#__codelineno-32-47"></a>                <span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="n">commit_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">),</span>
<a id="__codelineno-32-48" name="__codelineno-32-48" href="#__codelineno-32-48"></a>                <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-32-49" name="__codelineno-32-49" href="#__codelineno-32-49"></a>                    <span class="s1">&#39;source_commit&#39;</span><span class="p">:</span> <span class="n">commit_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hash&#39;</span><span class="p">),</span>
<a id="__codelineno-32-50" name="__codelineno-32-50" href="#__codelineno-32-50"></a>                    <span class="s1">&#39;replicated_at&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<a id="__codelineno-32-51" name="__codelineno-32-51" href="#__codelineno-32-51"></a>                <span class="p">}</span>
<a id="__codelineno-32-52" name="__codelineno-32-52" href="#__codelineno-32-52"></a>            <span class="p">},</span>
<a id="__codelineno-32-53" name="__codelineno-32-53" href="#__codelineno-32-53"></a>            <span class="s1">&#39;operations&#39;</span><span class="p">:</span> <span class="n">operations</span>
<a id="__codelineno-32-54" name="__codelineno-32-54" href="#__codelineno-32-54"></a>        <span class="p">}</span>
<a id="__codelineno-32-55" name="__codelineno-32-55" href="#__codelineno-32-55"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-32-56" name="__codelineno-32-56" href="#__codelineno-32-56"></a>        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<a id="__codelineno-32-57" name="__codelineno-32-57" href="#__codelineno-32-57"></a>
<a id="__codelineno-32-58" name="__codelineno-32-58" href="#__codelineno-32-58"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">branch</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;main&quot;</span><span class="p">):</span>
<a id="__codelineno-32-59" name="__codelineno-32-59" href="#__codelineno-32-59"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Exécute une synchronisation incrémentale.&quot;&quot;&quot;</span>
<a id="__codelineno-32-60" name="__codelineno-32-60" href="#__codelineno-32-60"></a>        <span class="n">commits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_commits</span><span class="p">(</span><span class="n">branch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_synced_commit</span><span class="p">)</span>
<a id="__codelineno-32-61" name="__codelineno-32-61" href="#__codelineno-32-61"></a>        <span class="k">if</span> <span class="n">commits</span><span class="p">:</span>
<a id="__codelineno-32-62" name="__codelineno-32-62" href="#__codelineno-32-62"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Réplication de </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">commits</span><span class="p">)</span><span class="si">}</span><span class="s2"> commits...&quot;</span><span class="p">)</span>
<a id="__codelineno-32-63" name="__codelineno-32-63" href="#__codelineno-32-63"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">replicate_commits</span><span class="p">(</span><span class="n">commits</span><span class="p">)</span>
<a id="__codelineno-32-64" name="__codelineno-32-64" href="#__codelineno-32-64"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Synchronisation terminée. Dernier commit: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last_synced_commit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-32-65" name="__codelineno-32-65" href="#__codelineno-32-65"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-32-66" name="__codelineno-32-66" href="#__codelineno-32-66"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aucun nouveau commit à répliquer.&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Composant calcul</strong> : Les clusters Spark, Trino ou Dremio doivent être déployés dans chaque région avec accès au stockage et au catalogue locaux.</p>
<h3 id="considerations-de-couts-pour-la-dr">Considérations de coûts pour la DR<a class="headerlink" href="#considerations-de-couts-pour-la-dr" title="Permanent link">&para;</a></h3>
<p>La récupération après sinistre engendre des coûts significatifs qu'il convient d'optimiser selon les exigences réelles.</p>
<table>
<thead>
<tr>
<th>Composant</th>
<th>Coût mensuel typique (100 TB)</th>
<th>Stratégie d'optimisation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Réplication stockage</td>
<td>500-2000 $</td>
<td>Répliquer seulement les tables critiques</td>
</tr>
<tr>
<td>Stockage DR</td>
<td>1000-3000 $</td>
<td>Utiliser des classes de stockage économiques (S3 IA)</td>
</tr>
<tr>
<td>Infrastructure de test DR</td>
<td>200-500 $</td>
<td>Clusters éphémères pour les tests</td>
</tr>
<tr>
<td>Bande passante inter-région</td>
<td>100-500 $</td>
<td>Compression des données répliquées</td>
</tr>
</tbody>
</table>
<p><strong>Stratégies d'optimisation des coûts</strong> :</p>
<ol>
<li>
<p><strong>Classification des données</strong> : Ne pas répliquer toutes les tables avec la même stratégie. Les données d'archivage peuvent tolérer un RPO plus long et utiliser une réplication asynchrone moins coûteuse.</p>
</li>
<li>
<p><strong>Réplication sélective</strong> : Répliquer uniquement les métadonnées pour les tables volumineuses mais facilement reconstituables. Les fichiers de données peuvent être régénérés depuis les sources en cas de sinistre.</p>
</li>
<li>
<p><strong>Compression et déduplication</strong> : Les outils de réplication peuvent compresser les données en transit, réduisant les coûts de bande passante.</p>
</li>
<li>
<p><strong>Classes de stockage DR</strong> : Utiliser S3 Intelligent-Tiering ou S3 Glacier Instant Retrieval pour le stockage DR, réduisant les coûts tout en maintenant l'accessibilité.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1"># Exemple de politique de réplication différenciée par criticité</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">replication_policies</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    <span class="s1">&#39;critical&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>        <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;customer_360&#39;</span><span class="p">,</span> <span class="s1">&#39;transactions&#39;</span><span class="p">,</span> <span class="s1">&#39;orders&#39;</span><span class="p">],</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>        <span class="s1">&#39;storage_class&#39;</span><span class="p">:</span> <span class="s1">&#39;STANDARD&#39;</span><span class="p">,</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>        <span class="s1">&#39;replication_time_minutes&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>        <span class="s1">&#39;retain_snapshots_days&#39;</span><span class="p">:</span> <span class="mi">30</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>    <span class="p">},</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>    <span class="s1">&#39;important&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>        <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;product_catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;inventory&#39;</span><span class="p">,</span> <span class="s1">&#39;pricing&#39;</span><span class="p">],</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>        <span class="s1">&#39;storage_class&#39;</span><span class="p">:</span> <span class="s1">&#39;STANDARD_IA&#39;</span><span class="p">,</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>        <span class="s1">&#39;replication_time_minutes&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>        <span class="s1">&#39;retain_snapshots_days&#39;</span><span class="p">:</span> <span class="mi">14</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>    <span class="p">},</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>    <span class="s1">&#39;standard&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>        <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;analytics_*&#39;</span><span class="p">,</span> <span class="s1">&#39;reporting_*&#39;</span><span class="p">],</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>        <span class="s1">&#39;storage_class&#39;</span><span class="p">:</span> <span class="s1">&#39;INTELLIGENT_TIERING&#39;</span><span class="p">,</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>        <span class="s1">&#39;replication_time_minutes&#39;</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>        <span class="s1">&#39;retain_snapshots_days&#39;</span><span class="p">:</span> <span class="mi">7</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>    <span class="p">},</span>
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>    <span class="s1">&#39;archive&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a>        <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;historical_*&#39;</span><span class="p">,</span> <span class="s1">&#39;audit_logs_*&#39;</span><span class="p">],</span>
<a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a>        <span class="s1">&#39;storage_class&#39;</span><span class="p">:</span> <span class="s1">&#39;GLACIER_IR&#39;</span><span class="p">,</span>
<a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a>        <span class="s1">&#39;replication_time_minutes&#39;</span><span class="p">:</span> <span class="mi">1440</span><span class="p">,</span>  <span class="c1"># 24 heures</span>
<a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a>        <span class="s1">&#39;retain_snapshots_days&#39;</span><span class="p">:</span> <span class="mi">90</span>
<a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a>    <span class="p">}</span>
<a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a><span class="p">}</span>
</code></pre></div>
<blockquote>
<p><strong>Étude de cas : Banque Nationale du Canada</strong>
<em>Secteur</em> : Services financiers
<em>Défi</em> : Répondre aux exigences du Bureau du surintendant des institutions financières (BSIF) pour la continuité des activités, avec un RTO de 2 heures et un RPO de 15 minutes pour les données critiques.
<em>Solution</em> : Architecture multi-région active-passive avec lakehouse Iceberg principal à Toronto et DR à Montréal. Réplication S3 Cross-Region Replication pour les fichiers de données. Catalogue Nessie avec réplication des commits vers la région DR. Tests de basculement trimestriels.
<em>Résultats</em> : RTO effectif de 45 minutes lors du dernier test de basculement. RPO de 12 minutes garanti par la fréquence de réplication. Conformité BSIF attestée.</p>
</blockquote>
<hr />
<h2 id="iv114-resume">IV.11.4 Résumé<a class="headerlink" href="#iv114-resume" title="Permanent link">&para;</a></h2>
<p>L'opérationnalisation d'Apache Iceberg transforme une architecture de données prometteuse en une plateforme de production fiable et résiliente. Ce chapitre a exploré les trois piliers de cette transformation : l'orchestration, l'audit et la récupération après sinistre.</p>
<h3 id="orchestration-du-lakehouse">Orchestration du lakehouse<a class="headerlink" href="#orchestration-du-lakehouse" title="Permanent link">&para;</a></h3>
<p>L'orchestration constitue le système nerveux central du lakehouse, coordonnant les pipelines d'ingestion, de transformation et de maintenance. Les orchestrateurs modernes se divisent en deux catégories : les outils orientés tâches comme Apache Airflow, et les outils orientés actifs comme Dagster.</p>
<p>Pour les lakehouses Iceberg, l'orchestration orientée actifs présente des avantages significatifs en termes de lignée, d'observabilité et de gestion des partitions. Les modèles d'orchestration incluent l'approche par horaire, l'approche événementielle et l'hybride, chacun adapté à des exigences de latence et de complexité différentes.</p>
<p>Les opérations de maintenance Iceberg (compaction, expiration des snapshots, nettoyage des orphelins) doivent être intégrées dans les pipelines orchestrés avec des stratégies conditionnelles basées sur les métriques des tables.</p>
<h3 id="audit-du-lakehouse">Audit du lakehouse<a class="headerlink" href="#audit-du-lakehouse" title="Permanent link">&para;</a></h3>
<p>L'audit répond aux exigences de conformité réglementaire tout en fournissant une traçabilité essentielle pour le diagnostic et l'analyse forensique. Les tables de métadonnées Iceberg offrent une base solide pour l'audit, capturant l'historique complet des modifications.</p>
<p>Une architecture d'audit complète comprend les journaux d'accès (générés par les moteurs de requête), les journaux de modification (via les snapshots Iceberg) et la lignée des données (maintenue par les catalogues et les orchestrateurs).</p>
<p>L'observabilité transforme les données d'audit en informations actionnables, avec des métriques clés à surveiller incluant la fragmentation des fichiers, la latence d'ingestion et les taux d'échec.</p>
<h3 id="recuperation-apres-sinistre">Récupération après sinistre<a class="headerlink" href="#recuperation-apres-sinistre" title="Permanent link">&para;</a></h3>
<p>La stratégie de DR doit être alignée sur les objectifs RTO et RPO définis pour chaque classe de données. Iceberg offre des capacités natives de récupération grâce à l'immutabilité des fichiers, les snapshots comme points de récupération et les procédures intégrées (rollback, register_table, rewrite_table_path).</p>
<p>Les scénarios de récupération couverts incluent les erreurs humaines (rollback vers un snapshot antérieur), la corruption du catalogue (ré-enregistrement des tables) et la restauration vers un nouvel emplacement (réécriture des chemins).</p>
<p>Pour les exigences de haute disponibilité, les architectures multi-région active-passive ou active-active peuvent être implémentées en combinant la réplication de stockage objet et la réplication des métadonnées du catalogue.</p>
<h3 id="principes-directeurs">Principes directeurs<a class="headerlink" href="#principes-directeurs" title="Permanent link">&para;</a></h3>
<p>L'opérationnalisation réussie d'un lakehouse Iceberg repose sur plusieurs principes directeurs :</p>
<ol>
<li>
<p><strong>Automatisation systématique</strong> : Toute opération répétitive doit être automatisée et orchestrée, éliminant les interventions manuelles sources d'erreurs.</p>
</li>
<li>
<p><strong>Observabilité native</strong> : Les métriques, journaux et traces doivent être collectés et corrélés pour permettre un diagnostic rapide et une détection proactive des anomalies.</p>
</li>
<li>
<p><strong>Défense en profondeur</strong> : La protection des données repose sur plusieurs couches : snapshots pour la récupération rapide, sauvegardes pour la protection contre la corruption, réplication pour la continuité régionale.</p>
</li>
<li>
<p><strong>Tests réguliers</strong> : Les procédures de récupération doivent être testées régulièrement dans des conditions réalistes pour valider leur efficacité.</p>
</li>
<li>
<p><strong>Documentation vivante</strong> : Les runbooks et procédures doivent être maintenus à jour et accessibles à toutes les équipes concernées.</p>
</li>
</ol>
<p>Le chapitre suivant explorera l'évolution vers le <em>Streaming Lakehouse</em>, où l'intégration d'Apache Kafka avec Apache Iceberg permet de traiter les données en temps réel tout en maintenant les garanties de cohérence et la gouvernance du lakehouse.</p>
<hr />
<h3 id="points-cles-a-retenir">Points clés à retenir<a class="headerlink" href="#points-cles-a-retenir" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>L'orchestration orientée actifs (Dagster, Prefect) s'aligne naturellement avec l'architecture Iceberg centrée sur les tables et les snapshots</p>
</li>
<li>
<p>Les tables de métadonnées Iceberg (<code>snapshots</code>, <code>history</code>, <code>files</code>, <code>manifests</code>) constituent des sources d'audit natives nécessitant un enrichissement contextuel</p>
</li>
<li>
<p>Le <em>time travel</em> Iceberg permet une récupération quasi instantanée des erreurs humaines sans restauration de fichiers</p>
</li>
<li>
<p>La procédure <code>register_table</code> permet de reconstruire un catalogue corrompu à partir des fichiers de métadonnées</p>
</li>
<li>
<p>La réplication multi-région combine la réplication du stockage objet et la synchronisation des métadonnées du catalogue</p>
</li>
<li>
<p>Les tests de récupération réguliers sont essentiels pour valider les procédures et former les équipes</p>
</li>
</ul>
<hr />
<h3 id="references">Références<a class="headerlink" href="#references" title="Permanent link">&para;</a></h3>
<ul>
<li>Apache Iceberg Documentation (2025). <em>Maintenance Operations</em>. https://iceberg.apache.org/docs/latest/maintenance/</li>
<li>Dagster (2025). <em>Building a Better Lakehouse: From Airflow to Dagster</em>. https://dagster.io/blog/building-a-better-lakehouse</li>
<li>Dremio (2025). <em>Disaster Recovery for Apache Iceberg Tables</em>. https://www.dremio.com/blog/disaster-recovery-for-apache-iceberg-tables</li>
<li>IOMETE (2025). <em>Iceberg Disaster Recovery</em>. https://iomete.com/resources/blog/iceberg-disaster-recovery</li>
<li>PracData (2025). <em>State of Open Source Workflow Orchestration Systems 2025</em>. https://www.pracdata.io/p/state-of-workflow-orchestration-ecosystem-2025</li>
<li>Atlan (2025). <em>Apache Iceberg Tables Governance: A Practical Guide</em>. https://atlan.com/know/iceberg/apache-iceberg-table-governance/</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Retour en haut de la page
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/agbruneau/CorpusInformatique" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "toc.integrate", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>